<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>PerspectiveManage View</title>

  <link rel="stylesheet" href="../../themes/carbonfiber/theme.css">

  <style>
    body {
      padding: 1em;
    }

    #content {
      width: 370px;
      max-height: 80px;
      background-color: white;
    }

  </style>
  <script src="../../../nuc/lib/require.js"></script>
  <script src="../../../nuc/config.js" data-csui-path="../../../nuc"></script>
  <script src="../../../smart/config.js" data-csui-path="../../../smart"></script>
  <script>
    // Help the test page waiting on all "deps" config sections.
    var csuiCallbacks = [],
      csuiBlocks = 0;

    window.blockCsui = function () {
      ++csuiBlocks;
    };

    window.unBlockCsui = function () {
      if (--csuiBlocks === 0) {
        while (csuiCallbacks.length) {
          csuiCallbacks.shift()();
          if (csuiBlocks > 0) {
            break;
          }
        }
      }
    };

    window.csuiDemo = function (callback) {
      if (csuiBlocks === 0) {
        callback();
      } else {
        csuiCallbacks.push(callback);
      }
    };

    window.blockCsui();
    require.config({
      paths: {
        csui: "../../../csui"
      },
      deps: [
        'nuc/lib/require.config!nuc/nuc-extensions.json',
        'nuc/lib/require.config!smart/smart-extensions.json',
        'csui/lib/require.config!csui/csui-extensions.json'
      ],
      callback: window.unBlockCsui
    });

    // Default server connection is generated by the server
    window.csuiDemo(function () {
      require.config({
        config: {
          'csui/utils/contexts/factories/connector': {
            connection: {
              url: '//server/otcs/cs/api/v1',
              supportPath: '/support',
              session: {
                ticket: 'dummy'
              }
            }
          }
        }
      });

      require(["csui/lib/jquery", "csui/lib/underscore", 'nuc/lib/marionette', "csui/lib/backbone",
        'csui/utils/contexts/page/page.context', '../pman.view', 'csui/utils/contexts/factories/connector',
        'csui/models/perspective/perspective.model', 'csui/controls/perspective.panel/perspective.panel.view',
        './perspective.manage.mock'
      ], function ($, _, Marionette, Backbone, PageContext, PManView, ConnectorFactory, PerspectiveModel,
        PerspectivePanelView, mock) {
        mock.enable();
        var contentRegion = new Marionette.Region({ el: '#content' }),
          pageContext = new PageContext();
        pageContext.perspective = new Backbone.Model({
          "id": 398548,
          "type": "flow",
          "options": {
            "widgets": [{
              "type": "csui/widgets/welcome.placeholder"
            },
            {
              "type": "csui/widgets/myassignments"
            },
            {
              "type": "csui/widgets/recentlyaccessed"
            },
            {
              "type": "csui/widgets/search.custom",
              "options": {
                "savedSearchQueryId": 391383
              }
            }
            ]
          }
        });
        var perspective = new PerspectiveModel({
          id: pageContext.perspective.get('id'),
          perspective: _.pick(pageContext.perspective.attributes, 'type', 'options')
        }, {
          connector: pageContext.getObject(ConnectorFactory)
        });
        var perspectivePanel = new PerspectivePanelView({
          context: pageContext
        });
        $('body').append('<div id="perspective-panel-view"></div>');
        var region = new Marionette.Region({
          el: "#perspective-panel-view"
        });
        region.show(perspectivePanel);
        perspectivePanel.listenTo(perspectivePanel, 'show:perspective', function () {
          var pmanView = new PManView({
            context: pageContext,
            perspective: perspective
          });
          pmanView.show();
        });
        pageContext.fetch();
      });
    });
  </script>
</head>

<body class="binf-widgets">
</body>

</html>
<!-- Copyright (c) 2016-2017  OpenText Corp. All Rights Reserved. -->