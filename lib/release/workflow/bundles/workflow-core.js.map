{"version":3,"sources":["../../src/models/workitem/workitem.model.js","../../src/models/workflow/workflow.model.js","../../src/models/workitem/workitem.model.factory.js","../../src/commands/defaultactionitems.js","../../src/widgets/workitem/workitem/impl/nls/lang.js","../../src/widgets/workitem/workitem/impl/nls/root/lang.js","../../src/widgets/workitem/workitem/impl/nls/lang!i18n","../../src/commands/initiate.workflow/initiate.workflow.js","../../src/commands/edit.workflow.map/edit.workflow.map.js","../../src/commands/initiate.document.workflow/initiate.document.workflow.js","../../src/commands/open.workitem/open.workitem.js","../../src/commands/open.form/open.form.js","../../src/perspective/routers/workflow.perspective.router.js","../../src/utils/workitem.extension.controller.js","workflow-core.js"],"names":["csui","define","Backbone","Url","base","_","$","ConnectorFactory","ActionModel","Model","extend","defaults","id","key","label","custom","constructor","attributes","options","prototype","apply","this","arguments","parse","response","ActionsCollection","Collection","model","models","FormModel","_saveChanges","changes","formView","connector","context","getObject","baseUrl","connection","url","replace","formUrl","alpaca","form","split","putUrl","combine","dfd","Deferred","ajaxOptions","type","data","makeAjaxCall","done","bind","resolve","fail","jqxhr","error","Error","reject","FormsCollection","process_id","subprocess_id","task_id","isDraft","title","instructions","doc_id","mapsList","assignTo","get","draftId","processId","length","forms","actions","customActions","custom_actions","datafetchedfromfactory","isFetchable","docId","reset","clear","isUndefined","sendAction","action","content","custom_action","undefined","comment","assignee","toString","isNumber","assigneeOption","authentication_info","duration","duration_unit","formData","FormData","append","JSON","stringify","contentType","processData","resp","results","trigger","sendMemberAcceptAction","acceptStatus","responseText","workflow_id","createDraftProcess","postUrl","doc_ids","responseJSON","getDocumentWorkflows","getUrl","docIds","DocIDs","selectionID","each","concat","ParentID","checkEnabled","firstRow","attr","value","uniqueId","appendTo","val","newDocID","async","startWorkflow","ModelFactory","WorkItemModel","WorkflowModel","propertyPrefix","property","workflow","fetch","isDoc","mapList","silent","set","workflow_type","datafetched","promise","equals","signature","sequence","root","en-us","en","CloseButtonLabel","CancelButtonLabel","StartButtonLabel","ActionFailMessageTitle","ActionFailMessage","AssigneePickerLabelTo","AssigneePickerLabelSendTo","CommentTextFieldLabelInstructions","CommentTextFieldPlaceholderInstructions","CommentTextFieldLabelReply","CommentTextFieldPlaceholderReply","SubmitLabelSend","SuccessSendOnMessage","SuccessInitiateMessage","ErrorMessageLoadExtension","MultipleMapsSelectPlaceholder","ChangeWorkflowTypeTitle","ChangeWorkflowTypeMessage","ReserveDocumentMessageTitle","ReserveDocumentMessageText","MemberAcceptDialogTitle","MemberAcceptDialogMessage","MemberAcceptAcceptButtonLabel","MemberAcceptCloseButtonLabel","MemberAcceptedMessage","MemberAcceptErrorDescription","MemberAcceptErrorTitle","DialogModelTitle","WorkflowStepTitle","StartWorkflowTitle","StartWorkflowSingleMessage","NoAttachmentsMessage","PropertyLabel","wfPropertyLabel","ErrorTitleLoadWorkitem","CommandHelper","OpenClassicPageCommand","ApplicationScopeModelFactory","NodeActionCollection","ModalAlert","WorkitemModelFactory","lang","GlobalMessage","command_key","scope","enabled","status","node","getJustOneNode","execute","_getActionParameters","then","showStartStep","_intiateWorkflow","workItem","popupOptions","centerVertically","buttons","OkCancel","message","str","sformat","nodes","attrs","getModel","docModels","docModel","parent_id","url_org","isNewDraft","doc_names","docNames","confirmQuestion","always","result","_startWorkflow","originatingView","deferred","workflow_parent_id","self","original","blockActions","require","successMsg","custom_message","showMessage","IsNextUrlStep","window","open","NextURL","WRID","WorkID","webReportId","workId","isWebreport","_navigateTo","unblockActions","viewStateModel","restoreLastRouter","initiateInSmartView","initiatecmd","location","href","isDocDraft","draft_id","draftprocess_id","smartViewAttachmentsView","cmd","workflowActionCollection","commands","getUrlQueryParameters","urlParams","params","func","DocNames","WFMapsDataID","nexturl","param","index","objAction","objId","WorkId","NodeModel","NodeModelFactory","hasCommonWorkflows","selectedWfList","wfListLength","i","lengthFirstSelectedWfList","j","item","contains","wfList","list","signatures","getAtLeastOneNode","enableAction","checkPermittedActions","push","getDocIds","getDocNames","getDelimitedString","docList","delimiter","delimitedString","delim","doc","getCommonWorkflows","container","cmdOptions","_getNodesByScope","CheckEnable","curSelection","prevNodeSelection","filter","remove","that","delimitedDocIds","containerId","docArgs","statusMsg","workflowType","workModelOptions","wfMapModel","wfdata","workflowModel","DataID","WorkflowType","_prepareDocModels","args","cmdData","draftResp","_prepareWorkItem","popupModelOptions","Name","name","original_id","type_name","original_id_expand","modelOptions","CommandError","openTab","isAttachmentCentric","openInNewTab","workid","subworkid","taskid","_openForm","formActionCollection","PerspectiveRouter","WorkItemModelFactory","routes","processes/:process_id/:subprocess_id/:task_id","draftprocesses/:draftprocess_id","docworkflows/:doc_id/:parent_id","docworkflows/:doc_id/:parent_id/draftprocesses/:draftprocess_id","applicationScope","listenTo","_updateUrl","openProcess","parseInt","validateURL","_getUrl","_isAttachmentCentric","openDraftProcess","openDocumentProcess","openDocumentDraftProcess","onOtherRoute","vars","m","originIndex","nextUrl","reloadClassicUi","base_url","strURLArray","decodeURIComponent","document","referrer","indexOf","_routeWithSlashes","urlStringParam","queryData","attachmentsview","combineQueryString","appendQuery","navigate","surl","parseURL","urlHostname","hostname","trim","toUpperCase","a","createElement","source","protocol","host","port","query","search","s","ret","seg","len","hash","segments","pathname","attachmentsView","log","WorkItemExtensionController","initialize","validate","sub_type","executeAction","customizeFooter","ExtensionPoints","AddSidebar","AddForm","FullView"],"mappings":"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","file":"workflow-core.js","sourcesContent":["csui.define('workflow/models/workitem/workitem.model',[\r\n  'csui/lib/backbone',\r\n  'csui/utils/url',\r\n  'csui/utils/base',\r\n  'csui/lib/underscore',\r\n  'csui/lib/jquery',\r\n  'csui/utils/contexts/factories/connector'\r\n], function (Backbone, Url, base, _, $, ConnectorFactory) {\r\n  'use strict';\r\n\r\n  var ActionModel = Backbone.Model.extend({\r\n\r\n    defaults: {\r\n      id: \"\",\r\n      key: \"\",\r\n      label: \"\",\r\n      custom: false\r\n    },\r\n    constructor: function ActionModel(attributes, options) {\r\n      Backbone.Model.prototype.constructor.apply(this, arguments);\r\n    },\r\n\r\n    parse: function (response, options) {\r\n      //parse the current action structure into a model structure\r\n      var key = response.key;\r\n      var label = response.label;\r\n      var id = options.custom ? \"custom-\" + key : \"standard-\" + key;\r\n      // Return the data\r\n      return {key: key, label: label, id: id, custom: options.custom};\r\n    }\r\n\r\n  });\r\n\r\n  var ActionsCollection = Backbone.Collection.extend({\r\n    model: ActionModel,\r\n\r\n    constructor: function ActionsCollection(models, options) {\r\n      Backbone.Collection.prototype.constructor.apply(this, arguments);\r\n    }\r\n  });\r\n\r\n  var FormModel = Backbone.Model.extend({\r\n\r\n    constructor: function FormModel(attributes, options) {\r\n      Backbone.Model.prototype.constructor.apply(this, arguments);\r\n    },\r\n\r\n    _saveChanges: function (changes, formView) {\r\n      var connector = formView.options.context.getObject(ConnectorFactory),\r\n          baseUrl   = connector.connection.url.replace('/v1', '/v2'),\r\n          formUrl   = (formView.alpaca.options.form.attributes.action).split(\"v1\"),\r\n          putUrl    = Url.combine(baseUrl, formUrl[1]),\r\n          dfd       = $.Deferred();\r\n\r\n      var ajaxOptions = {\r\n        type: 'PUT',\r\n        url: putUrl,\r\n        data: changes\r\n      };\r\n      connector.makeAjaxCall(ajaxOptions)\r\n          .done(_.bind(function () {\r\n            dfd.resolve();\r\n          }, this))\r\n          .fail(_.bind(function (jqxhr) {\r\n            // show the error\r\n            var error = new base.Error(jqxhr);\r\n            dfd.reject(error);\r\n          }, this));\r\n      return dfd;\r\n    }\r\n  });\r\n\r\n  var FormsCollection = Backbone.Collection.extend({\r\n    model: FormModel,\r\n\r\n    constructor: function FormsCollection(models, options) {\r\n      Backbone.Collection.prototype.constructor.apply(this, arguments);\r\n    }\r\n  });\r\n\r\n  /**\r\n   * Workitem model which represents an instance of a running workflow\r\n   * It contains the REST calls to get and set the workitem properties and to send on the workflow.\r\n   *\r\n   * The model fires the following events:\r\n   *\r\n   * workitem:sendon  This event is triggered when the workitem was successful sent on.\r\n   *\r\n   */\r\n  var WorkItemModel = Backbone.Model.extend({\r\n\r\n    defaults: {\r\n      process_id: 0,\r\n      subprocess_id: 0,\r\n      task_id: 0,\r\n      isDraft: false,\r\n      title: \"\",\r\n      instructions: \"\",\r\n      doc_id: 0,\r\n      mapsList: []\r\n    },\r\n\r\n    // Constructor gives an explicit name to the object in the debugger\r\n    constructor: function WorkItemModel(attributes, options) {\r\n      Backbone.Model.prototype.constructor.apply(this, arguments);\r\n\r\n      // Enable this model for communication with the CS REST API\r\n      if (options && options.connector) {\r\n        options.connector.assignTo(this);\r\n      }\r\n    },\r\n\r\n    url: function () {\r\n\r\n      var baseUrl = this.connector.connection.url;\r\n\r\n      var isDraft   = this.get('isDraft'),\r\n          mapsList  = this.get('mapsList'),\r\n          draftId   = this.get('draft_id'),\r\n          processId = draftId ? draftId : this.get('process_id');\r\n\r\n      if (isDraft || this.get('isDocDraft') || (mapsList && mapsList.length === 1)) {\r\n        // URL of the REST call to get the work item\r\n        return Url.combine(baseUrl,\r\n            '/forms/draftprocesses/update?draftprocess_id=' + processId);\r\n      } else {\r\n        // URL of the REST call to get the work item\r\n        return Url.combine(baseUrl,\r\n            '/forms/processes/tasks/update?process_id=' + this.get('process_id') +\r\n            '&subprocess_id=' +\r\n            this.get('subprocess_id') + '&task_id=' + this.get('task_id'));\r\n      }\r\n    },\r\n\r\n    parse: function (response) {\r\n      // Forms\r\n      this.forms = new FormsCollection(response.forms);\r\n\r\n      // Actions\r\n      this.actions = new ActionsCollection(response.data.actions, {parse: true, custom: false});\r\n      delete response.data.actions; //remove action property, so that it is not part of the general model\r\n\r\n      this.customActions = new ActionsCollection(response.data.custom_actions, {\r\n        parse: true,\r\n        custom: true\r\n      });\r\n      delete response.data.custom_actions;//remove action property, so that it is not part of the general model\r\n      response.data.datafetchedfromfactory = true;\r\n      // Return the data\r\n      return response.data;\r\n\r\n    },\r\n\r\n    isFetchable: function () {\r\n      var docId = this.get('doc_id');\r\n      return docId ? docId : !!this.get('process_id');\r\n    },\r\n\r\n    /**\r\n     * Clear the model and its collections\r\n     * @param options\r\n     */\r\n    reset: function (options) {\r\n      this.clear(options);\r\n\r\n      //reset the different collections\r\n      if (!_.isUndefined(this.actions)) {\r\n        this.actions.reset();\r\n      }\r\n      if (!_.isUndefined(this.customActions)) {\r\n        this.customActions.reset();\r\n      }\r\n      if (!_.isUndefined(this.forms)) {\r\n        this.forms.reset();\r\n      }\r\n    },\r\n\r\n    title: function () {\r\n      return this.get('title');\r\n    },\r\n\r\n    /**\r\n     * Sends an action to the server\r\n     * @param action Action object for the current action.\r\n     *\r\n     * @returns a promise object. This promise is resolved when the send action call returns from the server without an error.\r\n     * In the case of an error the promise will be rejected.\r\n     */\r\n    sendAction: function (action) {\r\n      // URL of the REST call to send the workflow with the correct action attached\r\n      var baseUrl   = this.connector.connection.url.replace('/v1', '/v2'),\r\n          putUrl    = Url.combine(baseUrl, 'processes', this.get('process_id'), 'subprocesses',\r\n              this.get('subprocess_id'), 'tasks', this.get('task_id')),\r\n          dfd       = $.Deferred(),\r\n          isDraft   = this.get('isDraft'),\r\n          mapsList  = this.get('mapsList'),\r\n          draftId   = this.get('draft_id'),\r\n          processId = draftId ? draftId : this.get('process_id');\r\n\r\n      // is it a draft process\r\n      if (isDraft || this.get('isDocDraft') || (mapsList && mapsList.length === 1)) {\r\n        putUrl = Url.combine(baseUrl, 'draftprocesses', processId);\r\n      }\r\n\r\n      // prepare request content - action\r\n      var content = {};\r\n      if (action.get('custom')) {\r\n        //custom action\r\n        content.custom_action = action.get('key');\r\n      } else {\r\n        //standard action\r\n        content.action = action.get('key');\r\n      }\r\n      // prepare request content - comment\r\n      // TODO: verify whether the 'comments_on' flag is set.\r\n      if (this.get('comment') !== undefined && this.get('comment').length > 0) {\r\n        content.comment = this.get('comment');\r\n      }\r\n      // prepare request content - assignee\r\n      if (action.get('key') === 'Delegate') {\r\n        content.assignee = this.get('assignee').toString();\r\n      }\r\n      // prepare request content - assignee and assignee option\r\n      if (action.get('key') === 'Review') {\r\n        content.assignee = this.get('assignee').toString();\r\n        if (_.isNumber(this.get('assigneeOption'))) {\r\n          content.assigneeOption = this.get('assigneeOption').toString();\r\n        } else {\r\n          // fall back to default value which is 0 == member accept\r\n          content.assigneeOption = '0';\r\n        }\r\n      }\r\n      // prepare request content - authentication\r\n      if (this.get('authentication') === true) {\r\n        content.authentication_info = this.get('authentication_info');\r\n      }\r\n\r\n      // prepare request content - duration and duration unit\r\n      if (this.get('duration') !== undefined && this.get('duration').length > 0) {\r\n        content.duration = this.get('duration');\r\n      }\r\n\r\n      if (this.get('duration_unit') !== undefined && this.get('duration_unit').length > 0) {\r\n        content.duration_unit = this.get('duration_unit');\r\n      }\r\n\r\n      var formData = new FormData();\r\n      formData.append('body', JSON.stringify(content));\r\n\r\n      var ajaxOptions = {\r\n        type: 'PUT',\r\n        url: putUrl,\r\n        data: formData,\r\n        contentType: false,\r\n        processData: false\r\n      };\r\n      this.connector.makeAjaxCall(ajaxOptions)\r\n          .done(_.bind(function (resp) {\r\n            dfd.resolve(resp.results);\r\n            //the workitem was sent on, fire an event\r\n            this.trigger('workitem:sendon');\r\n          }, this))\r\n          .fail(_.bind(function (resp) {\r\n            dfd.reject(resp);\r\n          }, this));\r\n\r\n      return dfd;\r\n    },\r\n\r\n    /**\r\n     * Sends a member accept action to the server to accept the current workitem.\r\n     *\r\n     * @returns a promise object. This promise is resolved when the accept call returns from the server without an error. In the case of an error\r\n     * the promise will be rejected.\r\n     */\r\n    sendMemberAcceptAction: function (acceptStatus) {\r\n      // URL of the REST call to send the workflow with the accept action\r\n      var baseUrl = this.connector.connection.url.replace('/v1', '/v2');\r\n      var putUrl = Url.combine(baseUrl, 'processes', this.get('process_id'), 'subprocesses',\r\n          this.get('subprocess_id'), 'tasks', this.get('task_id'));\r\n      acceptStatus = acceptStatus ? acceptStatus : \"accept\";\r\n      var content = {action: acceptStatus};\r\n      var formData = new FormData();\r\n      var dfd = $.Deferred();\r\n      formData.append('body', JSON.stringify(content));\r\n\r\n      var ajaxOptions = {\r\n        type: 'PUT',\r\n        url: putUrl,\r\n        data: formData,\r\n        contentType: false,\r\n        processData: false\r\n      };\r\n      this.connector.makeAjaxCall(ajaxOptions)\r\n          .done(_.bind(function () {\r\n            dfd.resolve();\r\n          }, this))\r\n          .fail(_.bind(function (resp) {\r\n            var response = JSON.parse(resp.responseText);\r\n            dfd.reject(response);\r\n          }, this));\r\n      return dfd;\r\n    }\r\n\r\n  });\r\n\r\n  return WorkItemModel;\r\n\r\n});\r\n\n","csui.define('workflow/models/workflow/workflow.model',[\r\n  'csui/lib/backbone',\r\n  'csui/utils/url',\r\n  'csui/utils/base',\r\n  'csui/lib/underscore',\r\n  'csui/lib/jquery',\r\n  'csui/utils/contexts/factories/connector'\r\n], function (Backbone, Url, base, _, $, ConnectorFactory) {\r\n  'use strict';\r\n\r\n  /**\r\n   * Workflow model which represents a workflow definition\r\n   * It contains the REST calls to create a draft process which could then be initiate.\r\n   * Other parts for the workflow are currently not implemented\r\n   */\r\n  var WorkflowModel = Backbone.Model.extend({\r\n\r\n    defaults: {\r\n      workflow_id: 0\r\n    },\r\n\r\n    // Constructor gives an explicit name to the object in the debugger\r\n    constructor: function WorkflowModel(attributes, options) {\r\n      Backbone.Model.prototype.constructor.apply(this, arguments);\r\n\r\n      // Enable this model for communication with the CS REST API\r\n      if (options && options.connector) {\r\n        options.connector.assignTo(this);\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Create a draft process instance for the workflow\r\n     *\r\n     * @returns {*}\r\n     */\r\n    createDraftProcess: function () {\r\n      // URL of the REST call to create a draft process\r\n      var baseUrl = this.connector.connection.url.replace('/v1', '/v2');\r\n      var postUrl = Url.combine(baseUrl, 'draftprocesses');\r\n      var content = {workflow_id: this.get('workflow_id'),doc_ids : this.get('DocIDs')};\r\n      var formData = new FormData();\r\n      var dfd = $.Deferred();\r\n      formData.append('body', JSON.stringify(content));\r\n\r\n      // call REST service to create a draft processs\r\n      var ajaxOptions = {\r\n        type: 'POST',\r\n        url: postUrl,\r\n        data: formData,\r\n        contentType: false,\r\n        processData: false\r\n      };\r\n\r\n      this.connector.makeAjaxCall(ajaxOptions)\r\n          .done(_.bind(function (resp) {\r\n            // call successful, return draft process id\r\n            dfd.resolve(resp.results);\r\n          }, this))\r\n          .fail(_.bind(function (resp) {\r\n            // call failed, return error\r\n            dfd.reject(resp.responseJSON.error);\r\n          }, this));\r\n      return dfd;\r\n    },\r\n\r\n    /**\r\n     * list workflows for document node\r\n     *\r\n     * @returns {*}\r\n     */\r\n    getDocumentWorkflows: function () {\r\n\r\n      var generateUrl = function (attributes) {\r\n        var url         = '',\r\n            docIds      = (attributes.doc_id) ? attributes.doc_id.split(',') : attributes.DocIDs,\r\n            selectionID = $(\"#selectionID\");\r\n\r\n        _.each(docIds, function (docId) {\r\n          url = url.concat('doc_id').concat('=').concat(docId).concat('&');\r\n        });\r\n\r\n        if (attributes.ParentID) {\r\n          url = url.concat('parent_id=').concat(attributes.ParentID);\r\n        }\r\n        if (attributes.checkEnabled) {\r\n          url = url.concat('&checkEnabled=').concat(attributes.checkEnabled);\r\n        }\r\n        // The unique ID is used to determine that the user selection(of the documents) is happening\r\n        // from the the same page\r\n        // Created : On the first selection of the node(document)\r\n        // Removed : This uinique ID is removed on deselection of a node\r\n        if (selectionID.length === 0) {\r\n          var firstRow = $(\"#tableview tbody>tr\")[0];\r\n          if(firstRow){\r\n            $('<input>').attr({\r\n              type: 'hidden',\r\n              id: 'selectionID',\r\n              value: _.uniqueId()\r\n            }).appendTo(firstRow);\r\n            selectionID = $(\"#selectionID\");\r\n          }\r\n        }\r\n        if(selectionID.val()){\r\n          url = url.concat('&selectionID=').concat(selectionID.val());\r\n        }\r\n        // newDocID contains the document id's of the newly selected nodes(documents) if there is a\r\n        // previous selection already exist\r\n        if (attributes.newDocID) {\r\n          _.each(attributes.newDocID, function (docId) {\r\n            url = url.concat('&newDocID').concat('=').concat(docId);\r\n          });\r\n\r\n          \r\n        }\r\n        return url;\r\n      };\r\n\r\n      // URL of the REST call to create a draft process\r\n      var baseUrl     = this.connector.connection.url.replace('/v1', '/v2'),\r\n          getUrl      = Url.combine(baseUrl, 'docworkflows?' + generateUrl(this.attributes)),\r\n          dfd         = $.Deferred(),\r\n          // call REST service to get matched workflow types\r\n          ajaxOptions = {\r\n            type: 'GET',\r\n            url: getUrl,\r\n            async: (this.get(\"CheckEnable\")) ? false : true\r\n          };\r\n\r\n      this.connector.makeAjaxCall(ajaxOptions)\r\n        .done(_.bind(function (resp) {\r\n          // call successfull, return the results.\r\n          dfd.resolve(resp.results);\r\n        }, this))\r\n        .fail(_.bind(function (resp) {\r\n          // call failed, return error\r\n          dfd.reject(resp);\r\n        }, this));\r\n      return dfd;\r\n    },\r\n\r\n    /**\r\n     * To start the workflow for which start step is not enabled.\r\n     */\r\n    startWorkflow: function () {\r\n      // URL of the REST call to start the workflow\r\n      var baseUrl = this.connector.connection.url.replace('/v1', '/v2'),\r\n        postUrl = Url.combine(baseUrl, 'draftprocesses/startwf'),\r\n        content = { workflow_id: this.get('workflow_id'), doc_ids: this.get('DocIDs') },\r\n        formData = new FormData(),\r\n        dfd = $.Deferred();\r\n\r\n      formData.append('body', JSON.stringify(content));\r\n\r\n      // call REST service to start the workflow\r\n      var ajaxOptions = {\r\n        type: 'POST',\r\n        url: postUrl,\r\n        data: formData,\r\n        contentType: false,\r\n        processData: false\r\n      };\r\n\r\n      this.connector.makeAjaxCall(ajaxOptions)\r\n        .done(_.bind(function (resp) {\r\n          // call successful, return the process id and custom message if any\r\n          dfd.resolve(resp.results);\r\n        }, this))\r\n        .fail(_.bind(function (resp) {\r\n          // call failed, return error\r\n          dfd.reject(resp);\r\n        }, this));\r\n      return dfd;\r\n    }\r\n    \r\n  });\r\n\r\n  return WorkflowModel;\r\n});\r\n\n","csui.define('workflow/models/workitem/workitem.model.factory',[\r\n  'csui/lib/jquery',\r\n  'csui/lib/underscore',\r\n  'csui/utils/contexts/factories/factory',   // Factory base to inherit from\r\n  'csui/utils/contexts/factories/connector', // Factory for the server connector\r\n  'workflow/models/workitem/workitem.model',     // Model to create the factory for\r\n  'workflow/models/workflow/workflow.model'\r\n], function ($, _, ModelFactory, ConnectorFactory, WorkItemModel, WorkflowModel) {\r\n  'use strict';\r\n\r\n  var WorkItemModelFactory = ModelFactory.extend({\r\n\r\n    // Unique prefix of the default model instance, when this model is placed\r\n    // to a context to be shared by multiple widgets\r\n    propertyPrefix: 'workitem',\r\n\r\n    constructor: function WorkItemModelFactory(context, options) {\r\n      ModelFactory.prototype.constructor.apply(this, arguments);\r\n\r\n      // Obtain the server connector from the application context to share\r\n      // the server connection with the rest of the application; include\r\n      // the options, which can contain settings for dependent factories\r\n      var connector = context.getObject(ConnectorFactory, options);\r\n      this.context = context;\r\n\r\n      // Expose the model instance in the `property` key on this factory\r\n      // instance to be used by the context\r\n      this.property = new WorkItemModel(undefined, {\r\n        connector: connector\r\n      });\r\n\r\n      this.workflow = new WorkflowModel(undefined, {\r\n        connector: connector\r\n      });\r\n    },\r\n\r\n    isFetchable: function () {\r\n      return this.property.isFetchable();\r\n    },\r\n\r\n    fetch: function (options) {\r\n\r\n      var isDoc   = this.property.get('isDoc'),\r\n          mapList = this.property.get('mapsList'),\r\n          dfd     = $.Deferred();\r\n\r\n      if (isDoc && !(this.property.get('process_id') || this.property.get('draft_id'))) {\r\n\r\n        if (mapList && mapList.length > 0) {\r\n          return dfd.resolve(this.property);\r\n\r\n        } else {\r\n\r\n          this.workflow.set('doc_id', this.property.get(\"doc_id\"));\r\n          this.workflow.set('ParentID', this.property.get(\"parent_id\"));\r\n          this.workflow.set('isNewDraft', this.property.get(\"isNewDraft\"));\r\n\r\n          // create a draft process\r\n          this.workflow.getDocumentWorkflows()\r\n              .done(_.bind(function (resp) {\r\n                this.property.set({datafetched: true}, {silent: true});\r\n                this.property.set('mapsList', resp.data);\r\n                dfd.resolve(this.property);\r\n              }, this))\r\n              .fail(_.bind(function (error) {\r\n                dfd.reject(error);\r\n              }, this));\r\n\r\n          return dfd.promise();\r\n\r\n        }\r\n\r\n      } else if (this.property.get('isDocDraft')) {\r\n        var model = this.property.fetch({silent: true});\r\n        model.done(_.bind(function (resp) {\r\n\r\n          this.workflow.set('doc_id', this.property.get(\"doc_id\"));\r\n          this.workflow.set('ParentID', this.property.get(\"parent_id\"));\r\n          this.workflow.set('isNewDraft', this.property.get(\"isNewDraft\"));\r\n          this.property.set('workflowType', resp.data.workflow_type);\r\n\r\n          // create a draft process\r\n          this.workflow.getDocumentWorkflows()\r\n              .done(_.bind(function (resp) {\r\n                this.property.set({datafetched: true}, {silent: true});\r\n                this.property.set('mapsList', resp.data);\r\n                dfd.resolve(this.property);\r\n              }, this))\r\n              .fail(_.bind(function (error) {\r\n                dfd.reject(error);\r\n              }, this));\r\n        }, this))\r\n            .fail(_.bind(function (error) {\r\n              dfd.reject(error);\r\n            }, this));\r\n        return dfd.promise();\r\n      } else {\r\n        // Just fetch the model exposed y this factory\r\n        return this.property.fetch(options);\r\n      }\r\n    }\r\n\r\n  });\r\n\r\n  return WorkItemModelFactory;\r\n\r\n});\r\n\n","csui.define('workflow/commands/defaultactionitems',[],function () {\r\n    'use strict';\r\n\r\n    return [\r\n        // Workflow\r\n        {\r\n            equals: {type: [128]},\r\n            signature: 'InitiateWorkflow',\r\n            sequence: 30\r\n        },\r\n        // WorkItem\r\n        {\r\n            equals: {type: [153]},\r\n            signature: 'OpenWorkflowStep',\r\n            sequence: 30\r\n        },\r\n        // Forms\r\n        {\r\n            equals: {type: [223]},\r\n            signature: 'openform',\r\n            sequence: 30\r\n        }\r\n    ];\r\n\r\n});\n","// Lists explicit locale mappings and fallbacks\r\n\r\ncsui.define('workflow/widgets/workitem/workitem/impl/nls/lang',{\r\n  // Always load the root bundle for the default locale (en-us)\r\n  \"root\": true,\r\n  // Do not load English locale bundle provided by the root bundle\r\n  \"en-us\": false,\r\n  \"en\": false\r\n});\r\n\n","// Defines localizable strings in the default language (English)\r\n\r\ncsui.define('workflow/widgets/workitem/workitem/impl/nls/root/lang',{\r\n  CloseButtonLabel: 'Close',\r\n  CancelButtonLabel: 'Cancel',\r\n  StartButtonLabel: 'Start',\r\n  ActionFailMessageTitle: 'Action \"{0}\" failed',\r\n  ActionFailMessage: 'Action \"{0}\" failed. \\n\\n{1}',\r\n  AssigneePickerLabelTo: 'To',\r\n  AssigneePickerLabelSendTo: 'Send to',\r\n  CommentTextFieldLabelInstructions: 'Instructions',\r\n  CommentTextFieldPlaceholderInstructions: 'Add instructions',\r\n  CommentTextFieldLabelReply: 'Reply',\r\n  CommentTextFieldPlaceholderReply: 'Add reply',\r\n  SubmitLabelSend: 'Send',\r\n  SuccessSendOnMessage: 'One workflow submitted by you.',\r\n  SuccessInitiateMessage: 'Start workflow action was successful.',\r\n  ErrorMessageLoadExtension: 'Workflow could not load extension.',\r\n  MultipleMapsSelectPlaceholder: 'Select workflow type',\r\n  ChangeWorkflowTypeTitle: 'Changing Workflow Type',\r\n  ChangeWorkflowTypeMessage: 'Any changes you have made to this step will be lost.',\r\n  ReserveDocumentMessageTitle: 'Document reserved',\r\n  ReserveDocumentMessageText: 'The document {0} is reserved. \\nDo you want to continue anyway?',\r\n  MemberAcceptDialogTitle: 'Workflow sent to a group',\r\n  MemberAcceptDialogMessage: 'Click Accept to work on this Workflow. It will be removed from the My Assignments tile of the other group members. It will be available on your My Assignments tile.',\r\n  MemberAcceptAcceptButtonLabel: 'Accept',\r\n  MemberAcceptCloseButtonLabel: 'Close',\r\n  MemberAcceptedMessage: 'This workflow has been accepted by you',\r\n  MemberAcceptErrorDescription: 'This Workflow was accepted by another group member.',\r\n  MemberAcceptErrorTitle: 'Workflow no longer available',\r\n  DialogModelTitle: '{0}: {1}',\r\n  WorkflowStepTitle: 'Workflow Step : {0}',\r\n  StartWorkflowTitle: 'Start workflow',\r\n  StartWorkflowSingleMessage: 'Clicking OK will initiate the \"{0}\" workflow. Do you want to continue?',\r\n  NoAttachmentsMessage: 'There is no data to display since there are no attached files to this window.',\r\n  PropertyLabel: 'Properties',\r\n  wfPropertyLabel: 'Workflow Properties',\r\n  ErrorTitleLoadWorkitem: 'Unable to serve the requested page'\r\n});\r\n\n","\n","csui.define('workflow/commands/initiate.workflow/initiate.workflow',['csui/lib/jquery',\r\n  'csui/lib/underscore',\r\n  'csui/utils/commandhelper',\r\n  'csui/utils/commands/open.classic.page',\r\n  'csui/utils/contexts/factories/application.scope.factory',\r\n  'csui/models/node.actions',\r\n  'csui/dialogs/modal.alert/modal.alert',\r\n  'workflow/models/workitem/workitem.model.factory',\r\n  'workflow/models/workflow/workflow.model',\r\n  'i18n!workflow/widgets/workitem/workitem/impl/nls/lang'\r\n], function ($, _, CommandHelper, OpenClassicPageCommand, ApplicationScopeModelFactory, NodeActionCollection, ModalAlert, WorkitemModelFactory, WorkflowModel, lang) {\r\n  'use strict';\r\n\r\n  // Dependencies loaded in the execute method first\r\n  var GlobalMessage,\r\n      ConnectorFactory;\r\n\r\n  var InitiateWorkflowCommand = OpenClassicPageCommand.extend({\r\n\r\n    defaults: {\r\n      signature: 'InitiateWorkflow',\r\n      command_key: ['initiateworkflow'],\r\n      scope: 'single'\r\n    },\r\n\r\n    enabled: function (status) {\r\n      var node = CommandHelper.getJustOneNode(status);\r\n      // support both scenarios - default action only or a full node info\r\n      return node && node.get('type') === 128 && (node.get('openable') || node.actions.get('initiateworkflow'));\r\n    },\r\n\r\n    // check if work item should be opened in smart or standard UI\r\n    execute: function (status, options) {\r\n      return this._getActionParameters(status, options)\r\n        .then(_.bind(function (action) {\r\n          var resp = action.get(\"body\");\r\n          resp = resp && JSON.parse(resp);\r\n          if (resp && !resp.showStartStep) {\r\n\r\n            var popupOptions = { centerVertically: true, buttons: ModalAlert.buttons.OkCancel },\r\n              message = _.str.sformat(lang.StartWorkflowSingleMessage, status.nodes.models[0].get(\"name\")),\r\n              context = status.context || options && options.context,\r\n              attrs = {},\r\n              workItem;\r\n\r\n            if (status.isDoc && status.mapsList && status.mapsList.length > 0) {\r\n              workItem = context.getModel(WorkitemModelFactory);\r\n\r\n              attrs.isDoc = status.isDoc;\r\n              attrs.docModels = status.docModel;\r\n              attrs.parent_id = status.parent_id;\r\n              attrs.status = status;\r\n              attrs.url_org = status.url_org;\r\n              attrs.isNewDraft = true; // created label to verify from start workflow or browser back button\r\n\r\n              workItem.set(attrs, { silent: true });\r\n              workItem.set({ 'doc_id': status.doc_id, 'doc_names': status.docNames });\r\n            }\r\n\r\n            ModalAlert.confirmQuestion(message, lang.StartWorkflowTitle, popupOptions)\r\n              .always(_.bind(function (result) {\r\n                if (result) {\r\n                  return this._startWorkflow(status, options, resp);\r\n                }\r\n                else {\r\n                  return $.Deferred().resolve();\r\n                }\r\n              }, this));\r\n          }\r\n          else {\r\n            return this._intiateWorkflow(status, options, resp);\r\n          }\r\n        }, this));\r\n    },\r\n\r\n    _startWorkflow: function (status, options, action) {\r\n\r\n      var deferred = $.Deferred(), originatingView;\r\n      var node = CommandHelper.getJustOneNode(status);\r\n      status.workflow_parent_id = node.get(\"parent_id\");\r\n\r\n      var self = this;\r\n\r\n      //if this is true, it is a shortcut, for which the Start Workitem command was clicked,\r\n      // and the original node has to be extracted\r\n      if (node.get('type') === 1) {\r\n        node = node.original;\r\n      }\r\n\r\n      if (options && options.originatingView) {\r\n        originatingView = options.originatingView;\r\n      }\r\n      else if (status && status.originatingView) {\r\n        originatingView = status.originatingView;\r\n      }\r\n\r\n      if (originatingView) {\r\n        originatingView.blockActions();\r\n      }\r\n\r\n      // init workflow in smart UI\r\n      require(['csui/controls/globalmessage/globalmessage',\r\n        'csui/utils/contexts/factories/connector' // Factory for the server connector\r\n      ], function () {\r\n        GlobalMessage = arguments[0];\r\n        ConnectorFactory = arguments[1];\r\n\r\n        options = options || {};\r\n        var context = status.context || options && options.context,\r\n        connector = context.getObject(ConnectorFactory, options),\r\n        workflow = new WorkflowModel({\r\n          workflow_id: node.get('id'),\r\n          DocIDs: status.doc_id\r\n        },\r\n        _.extend(options, {\r\n          connector: connector\r\n        }));\r\n        \r\n        // start the workflow\r\n        workflow.startWorkflow()\r\n          .done(_.bind(function (resp) {\r\n            var successMsg = lang.SuccessInitiateMessage;\r\n\r\n            // check if the custom message available or not.\r\n            if (resp && resp.custom_message) {\r\n              successMsg = resp.custom_message;\r\n            }\r\n            // workflow started sucessfully, show the success message\r\n            GlobalMessage.showMessage('success', successMsg);\t\t\t\r\n\t\t\t\r\n            if(resp && resp.IsNextUrlStep){\r\n              window.open(resp.NextURL, \"_blank\");\t\t\t\t\r\n            }\r\n            deferred.resolve();\r\n\r\n            // checking if the webreport navigation is needed or not\r\n            if (resp && resp.WRID && resp.WorkID) {\r\n              options = options || {};\r\n              options.webReportId = resp.WRID;\r\n              options.workId = resp.WorkID;\r\n              options.isWebreport = true;\r\n              return self._navigateTo(node, options);\r\n            }\r\n\r\n          }, this))\r\n          .fail(_.bind(function (error) {\r\n            // starting the workflow failed, show message\r\n            if (error.responseJSON) {\r\n              GlobalMessage.showMessage('error', error.responseJSON.error);\r\n            }\r\n            deferred.reject();\r\n          }, this))\r\n          .always(function() {\r\n            if (originatingView) {\r\n              originatingView.unblockActions();\r\n            }\r\n            if (status.isDoc && status.mapsList && status.mapsList.length > 1) {\r\n              var viewStateModel = status.context.viewStateModel;\r\n              if (viewStateModel.get(\"lastRouter\")) {\r\n                viewStateModel.restoreLastRouter();\r\n              }\r\n              else {\r\n                this.options.context.getModel(ApplicationScopeModelFactory).set('id', '');\r\n              }\r\n            }\r\n          });\r\n\r\n        // set the map it to load the temp map\r\n\r\n      }, function (error) {\r\n        deferred.reject(error);\r\n      });\r\n      // Return deferred to react on issues/success in the caller\r\n      return deferred;\r\n    },\r\n\r\n    _intiateWorkflow: function (status, options, action) {\r\n\r\n      var deferred = $.Deferred();\r\n      var node = CommandHelper.getJustOneNode(status);\r\n      status.workflow_parent_id = node.get(\"parent_id\");\r\n\r\n      //if this is true, it is a shortcut, for which the Start Workitem command was clicked,\r\n      // and the original node has to be extracted\r\n      if (node.get('type') === 1) {\r\n        node = node.original;\r\n      }\r\n\r\n      if (action && action.initiateInSmartView && action.initiatecmd && action.initiatecmd === 'initiate_in_smartview') {\r\n        // init workflow in smart UI\r\n        require(['csui/controls/globalmessage/globalmessage',\r\n          'csui/utils/contexts/factories/connector' // Factory for the server connector\r\n        ], function () {\r\n          GlobalMessage = arguments[0];\r\n          ConnectorFactory = arguments[1];\r\n\r\n          options = options || {};\r\n          var context   = status.context || options && options.context,\r\n              connector = context.getObject(ConnectorFactory, options),\r\n              workflow  = new WorkflowModel({\r\n                    workflow_id: node.get('id'),\r\n                    DocIDs : status.doc_id\r\n                  },\r\n                  _.extend(options, {\r\n                    connector: connector\r\n                  }));\r\n\r\n          // create a draft process\r\n          workflow.createDraftProcess()\r\n              .done(_.bind(function (resp) {\r\n                // creation of the draft process succeeded, load the work item model and switch perspective\r\n                var workItem = context.getModel(WorkitemModelFactory);\r\n                var url = location.href;\r\n                if (status.isDoc === true) {\r\n                  var attrs = {};\r\n                  attrs.isDocDraft = true;\r\n                  attrs.docModels = status.docModel;\r\n                  attrs.parent_id = status.parent_id;\r\n                  attrs.status = status;\r\n                  attrs.url_org = status.url_org;\r\n                  attrs.draft_id = resp.draftprocess_id;\r\n                  attrs.isNewDraft = true; // created label to verify from start workflow or browser back button\r\n\r\n                  workItem.set(attrs, {silent: true});\r\n                  workItem.set('doc_names', status.docNames);\r\n                  workItem.set('doc_id', status.doc_id);\r\n\r\n\r\n                } else {\r\n                  workItem.set('isDraft', true);\r\n                  workItem.set('url_org', url);\r\n                  workItem.set('isAttachmentCentric', action.smartViewAttachmentsView);\r\n                  workItem.set('parent_id', status.workflow_parent_id);\r\n                  workItem.set('process_id', resp.draftprocess_id);\r\n\r\n                }\r\n              }, this))\r\n              .fail(_.bind(function (error) {\r\n                // creation of the draft process failed, show message\r\n                GlobalMessage.showMessage('error', error);\r\n                deferred.reject();\r\n              }, this));\r\n\r\n          // set the map it to load the temp map\r\n\r\n        }, function (error) {\r\n          deferred.reject(error);\r\n        });\r\n        // Return deferred to react on issues/success in the caller\r\n        return deferred;\r\n      } else {\r\n        // classic UI\r\n        var context  = status.context || options && options.context,\r\n            workItem = context.getModel(WorkitemModelFactory);\r\n        options = options || {};\r\n        workItem.set('isDoc', status.isDoc);\r\n        workItem.set('parent_id', status.parent_id);\r\n        workItem.set('doc_id', status.doc_id);\r\n        workItem.set('doc_names', status.docNames);\r\n        if (status.isDoc === true) {\r\n          options.isDoc = true;\r\n          options.doc_id = status.doc_id;\r\n          options.parent_id = status.parent_id;\r\n          options.doc_names = status.docNames;\r\n          options.connector = workItem.connector;\r\n        }\r\n        return this._navigateTo(node, options);\r\n      }\r\n    },\r\n\r\n    _getActionParameters: function (status, options) {\r\n\r\n      var node = CommandHelper.getJustOneNode(status);\r\n\r\n       //if this is true, it is a shortcut, for which the Start Workitem command was clicked,\r\n       // and the original node has to be extracted\r\n       if (node.get('type') === 1) {\r\n         node = node.original;\r\n       }\r\n\r\n      //if this is e.g called by 'initiate from document' the necessary informatimn is\r\n      // already available\r\n      var cmd;\r\n      if (node.actions) {\r\n        cmd = node.actions.get(this.get('command_key')[0]);\r\n      }\r\n      if (cmd) {\r\n        var deferred = $.Deferred();\r\n        deferred.resolve(cmd);\r\n        return deferred;\r\n      }\r\n\r\n      //get the necessary information for initiation\r\n      var workflowActionCollection = new NodeActionCollection(undefined, {\r\n        connector: node.connector,\r\n        nodes: [ node.get('id') ],\r\n        commands: [ 'initiateworkflow' ]\r\n      });\r\n      var originatingView = status.originatingView || options.originatingView;\r\n      originatingView && originatingView.blockActions && originatingView.blockActions();\r\n      return workflowActionCollection\r\n          .fetch()\r\n          .then(function () {\r\n            var action = workflowActionCollection\r\n                .get(node.get('id'))\r\n            .actions.get('initiateworkflow');\r\n            return action;\r\n          })\r\n          .always(function () {\r\n            originatingView && originatingView.unblockActions && originatingView.unblockActions();\r\n          });\r\n    },\r\n\r\n\r\n\r\n    getUrlQueryParameters: function (node, options) {\r\n      var urlParams;\r\n      if (options.isDoc === true) {\r\n        var params = {},\r\n            baseUrl     = options.connector.connection.url.replace('/api/v1', '');\r\n        params.func = 'wfinitiation.InitiateWorkflowMap';\r\n        params.ParentID = options.parent_id;\r\n        params.DocNames = options.doc_names;\r\n        params.WFMapsDataID = node.get('id');\r\n        params.nexturl = baseUrl + '/app' + (options.parent_id !== -1 ? '/nodes/' + params.ParentID: '');\r\n        urlParams = $.param(params);\r\n        var docIds = options.doc_id.split(\",\");\r\n        for ( var index = 0; index < docIds.length; index++ ) {\r\n          urlParams += '&DocID='.concat(docIds[index]);\r\n        }\r\n      }\r\n      else if (options.isWebreport === true) {\r\n        urlParams = {};\r\n        urlParams.func = 'll';\r\n        urlParams.objAction = 'RunReport';\r\n        urlParams.objId = options.webReportId;\r\n        urlParams.WorkId = options.workId;\r\n        urlParams.nexturl = location.href;\r\n      }\r\n      else {\r\n        urlParams = {};\r\n        urlParams.func = 'll';\r\n        urlParams.objAction = 'Initiate';\r\n        urlParams.objId = node.get('id');\r\n        urlParams.nexturl = location.href;\r\n      }\r\n\r\n      return urlParams;\r\n\r\n    }\r\n  });\r\n\r\n  return InitiateWorkflowCommand;\r\n\r\n});\r\n\n","csui.define('workflow/commands/edit.workflow.map/edit.workflow.map',['csui/lib/jquery',\r\n    'csui/lib/underscore',\r\n    'csui/utils/commandhelper',\r\n    'csui/utils/commands/open.classic.page',\r\n    'workflow/models/workitem/workitem.model.factory'\r\n], function ($, _, CommandHelper, OpenClassicPageCommand, WorkitemModelFactory) {\r\n    'use strict';\r\n\r\n    // Dependencies loaded in the execute method first\r\n\r\n    var EditWorkflowMapCommand = OpenClassicPageCommand.extend({\r\n\r\n        defaults: {\r\n            signature: 'EditWorkflowMap',\r\n            command_key: ['editworkflowmap'],\r\n            scope: 'single'\r\n        },\r\n\r\n        execute: function (status, options) {\r\n            var node = CommandHelper.getJustOneNode(status);\r\n\r\n            // classic UI\r\n            options = options || {};\r\n            return this._navigateTo(node, options);\r\n        },\r\n\r\n        getUrlQueryParameters: function (node, options) {\r\n            var urlParams;\r\n            urlParams = {};\r\n            urlParams.func = 'll';\r\n            urlParams.objAction = 'paint';\r\n            urlParams.objId = node.get('id');\r\n            return urlParams;\r\n        }\r\n    });\r\n\r\n    return EditWorkflowMapCommand;\r\n\r\n});\n","csui.define('workflow/commands/initiate.document.workflow/initiate.document.workflow',['csui/lib/jquery',\r\n  'csui/lib/underscore',\r\n  'csui/utils/commandhelper',\r\n  'csui/utils/commands/open.classic.page',\r\n  'csui/models/node/node.model',\r\n  'csui/controls/globalmessage/globalmessage',\r\n  'csui/dialogs/modal.alert/modal.alert',\r\n  'workflow/models/workitem/workitem.model.factory',\r\n  'workflow/models/workflow/workflow.model',\r\n  'i18n!workflow/widgets/workitem/workitem/impl/nls/lang'\r\n], function ($, _, CommandHelper, OpenClassicPageCommand, NodeModel, GlobalMessage, ModalAlert, WorkitemModelFactory,\r\n    WorkflowModel, lang) {\r\n  'use strict';\r\n\r\n  // Dependencies loaded in the execute method first\r\n  var ConnectorFactory,\r\n      NodeModelFactory;\r\n\r\n  var InitiateDocumentWorkflowCommand = OpenClassicPageCommand.extend({\r\n\r\n    defaults: {\r\n      signature: 'InitiateDocumentWorkflow',\r\n      command_key: ['initiatedocumentworkflow'],\r\n      scope: 'multiple'\r\n    },\r\n\r\n    // returns a boolean value by caluclating common workflows of selected doc's.\r\n    hasCommonWorkflows: function (selectedWfList) {\r\n\r\n      // return a boolean value by caluclating common workflows.\r\n      var wfListLength = selectedWfList.length;\r\n      for (var i = 0, lengthFirstSelectedWfList = selectedWfList[0].length;\r\n           i < lengthFirstSelectedWfList; i++) {\r\n        var item = selectedWfList[0][i];\r\n        var j;\r\n        for (j = 1; j < wfListLength; j++) {\r\n          if (!_.contains(selectedWfList[j], item)) { break; }\r\n        }\r\n        if (j === wfListLength) { return true; }\r\n      }\r\n      return false;\r\n    },\r\n\r\n    enabled: function (status, options) {\r\n\r\n      // stopping the execution if the status object not available.\r\n      // by using status we can get the selected nodes.\r\n      if (!status) {\r\n        return false;\r\n      }\r\n\r\n      var signatures   = this.get(\"command_key\"),\r\n          nodes        = CommandHelper.getAtLeastOneNode(status).models,\r\n          enableAction = false, \r\n          wfList, list;\r\n\r\n      // stopping the exection if no node selected\r\n      // and checking permitted actions on the nodes\r\n      if (nodes.length > 0 && this.checkPermittedActions(nodes, signatures)) {\r\n        \r\n        list = [];\r\n\r\n        if (nodes.length === 1) {\r\n  \r\n          wfList = nodes[0].actions.get(\"initiatedocumentworkflow\").get(\"wfList\");\r\n          if(wfList) {\r\n            enableAction = wfList.length > 0;\r\n          }\r\n        } else if (nodes.length > 1) {\r\n  \r\n          for (var j = 0; j < nodes.length; j++) {\r\n  \r\n            wfList = nodes[j].actions.get(\"initiatedocumentworkflow\").get(\"wfList\");\r\n            if (wfList && wfList.length > 0) {\r\n              enableAction = true;\r\n              list.push(wfList);\r\n            } else {\r\n              enableAction = false;\r\n              break;\r\n            }\r\n          }\r\n          if (enableAction) {\r\n            enableAction = this.hasCommonWorkflows(list);\r\n          }\r\n        }\r\n      }\r\n    \r\n      return enableAction;\r\n    },\r\n    //Get all the doc_ids for the selected nodes(document).\r\n    getDocIds: function (nodes) {\r\n      var docIds = [];\r\n      _.each(nodes, function (node) {\r\n        docIds.push(node.get('id'));\r\n      });\r\n      return docIds;\r\n    },\r\n    //Get all the doc names for the selected nodes(document).\r\n    getDocNames: function (nodes) {\r\n      var docNames = {};\r\n      _.each(nodes, function (node) {\r\n        docNames[node.get('id')] = node.get('name');\r\n      });\r\n      return docNames;\r\n    },\r\n    getDelimitedString : function (docList , delimiter) {\r\n      var delimitedString = '', delim = '';\r\n      _.each(docList, function (doc) {\r\n        delimitedString = delimitedString.concat(delim).concat(doc);\r\n        delim = delimiter;\r\n      });\r\n      return delimitedString;\r\n    },\r\n    getCommonWorkflows: function (status, options) {\r\n      var deferred = $.Deferred();\r\n      var connector = status.container.connector;\r\n      var scope      = this.get(\"scope\"),\r\n          cmdOptions = options || {},\r\n          nodes      = this._getNodesByScope(status, scope);\r\n      var workflow = new WorkflowModel({\r\n            CheckEnable: true\r\n          },\r\n          _.extend(cmdOptions, {\r\n            connector: connector\r\n          }));\r\n      var curSelection = this.getDocIds(nodes);\r\n      workflow.set('DocIDs', curSelection);\r\n      workflow.set('ParentID', status.container.attributes.id);\r\n      workflow.set('checkEnabled', options.checkEnabled );\r\n\r\n      var prevNodeSelection = this.get(\"prevNodeSelection\");\r\n\r\n      if (prevNodeSelection) {\r\n        // Determine the newly selected nodes using  previous node selection\r\n        var newDocID = _.filter(curSelection, function (id) {\r\n          return !_.contains(prevNodeSelection, id);\r\n        });\r\n\r\n        // Determining the action based on the current selection(curSelection) and previous selection of\r\n        // nodes(prevNodeSelection)\r\n        if (curSelection.length > prevNodeSelection.length &&\r\n            $(curSelection).filter(prevNodeSelection).length === prevNodeSelection.length) {\r\n          // Adding newDocID if the current node selection contains previous node selection along\r\n          // with newly added nodes\r\n          workflow.set('newDocID', newDocID);\r\n        } else if (((curSelection.length < prevNodeSelection.length) ||\r\n                    (curSelection.length === 1 && curSelection.length === prevNodeSelection.length &&\r\n                     curSelection[0] !== prevNodeSelection[0]) ) && $(\"#selectionID\").length > 0) {\r\n          // Removing selectionID on deselecting a node\r\n          $(\"#selectionID\").remove();\r\n        }\r\n      }\r\n\r\n      // 'prevEnabledNodeLen'  stores the length of the selected documents.\r\n      // Once the results are available, based on 'prevEnabledNodeLen' we make 'commandEnabled'\r\n      // as a check to stop other 'XHR'/'REST' calls.\r\n      workflow.getDocumentWorkflows()\r\n          .done(_.bind(function (resp) {\r\n\r\n            this.set('prevEnabledNodeLen', nodes.length);\r\n            this.set('prevNodeSelection', curSelection);\r\n\r\n            if (resp.data.length > 0) {\r\n              deferred.resolve();\r\n            } else {\r\n              deferred.reject();\r\n            }\r\n          }, this))\r\n          .fail(_.bind(function (resp) {\r\n            this.set('prevEnabledNodeLen', nodes.length);\r\n            this.set('prevNodeSelection', curSelection);\r\n            deferred.reject();\r\n          }, this));\r\n      return deferred.promise();\r\n    },\r\n    // check if work item should be opened in smart or standard UI\r\n    execute: function (status, options) {\r\n\r\n      var nodes     = CommandHelper.getAtLeastOneNode(status).models,\r\n          deferred  = $.Deferred(),\r\n          that      = this,\r\n          docIds    = this.getDocIds(nodes),\r\n          docNames   = this.getDocNames(nodes),\r\n          delimitedDocIds = this.getDelimitedString(docIds, \",\"),\r\n          containerId = status.container && status.container.get(\"id\"),\r\n          parent_id = containerId ? containerId : -1,\r\n          docArgs   = {DocIDs: docIds, ParentID: parent_id};\r\n\r\n      // init workflow in smart UI\r\n      require(['csui/utils/contexts/factories/connector', // Factory for the server connector\r\n        'csui/utils/contexts/factories/node'\r\n      ], function () {\r\n        ConnectorFactory = arguments[0];\r\n        NodeModelFactory = arguments[1];\r\n\r\n        options = options || {};\r\n        var context   = status.context || options && options.context,\r\n            connector = context.getObject(ConnectorFactory, options),\r\n            workflow  = new WorkflowModel(docArgs,\r\n                _.extend(options, {\r\n                  connector: connector\r\n                }));\r\n\r\n        // create a draft process\r\n        workflow.getDocumentWorkflows()\r\n            .done(_.bind(function (resp) {\r\n              var url = location.href;\r\n              if (resp.statusMsg) {\r\n                GlobalMessage.showMessage('error', resp.statusMsg);\r\n                deferred.reject();\r\n              } else {\r\n                var docModels = [], workflowType, workModelOptions;\r\n\r\n                workModelOptions = {\r\n                  'isDoc': true,\r\n                  'docModels': docModels,\r\n                  'mapsList': resp.data,\r\n                  'datafetched': true,\r\n                  'url_org': url,\r\n                  'parent_id': parent_id,\r\n                  'status': status,\r\n                  // created label to verify from start workflow or browser back button\r\n                  'isNewDraft': true,\r\n                  'doc_id': delimitedDocIds,\r\n                  'doc_names': docNames\r\n                };\r\n\r\n                if (resp.data.length === 1) {\r\n                  var wfMapModel, wfdata = resp.data[0],\r\n                    workflowModel = new WorkflowModel({\r\n                      workflow_id: wfdata.DataID,\r\n                      DocIDs: docIds\r\n                    },\r\n                      _.extend(options, {\r\n                        connector: connector\r\n                      }));\r\n                  wfMapModel = context.getModel(NodeModelFactory, { attributes: { id: wfdata.DataID } });\r\n\r\n                  workflowType = wfdata.WorkflowType;\r\n                  docModels = this._prepareDocModels(workflowType, nodes, connector);\r\n                  workModelOptions.docModels = docModels;\r\n\r\n                  wfMapModel.fetch()\r\n                    .done(_.bind(function (args) {\r\n                      var cmd = wfMapModel.actions.get('initiateworkflow'),\r\n                        cmdData = cmd ? JSON.parse(cmd.get(\"body\")) : false;\r\n\r\n                      if (cmdData && cmdData.showStartStep) {\r\n                        if (cmdData.initiateInSmartView && cmdData.initiatecmd && cmdData.initiatecmd === 'initiate_in_smartview') {\r\n                          workflowModel.createDraftProcess()\r\n                            .done(_.bind(function (draftResp) {\r\n                              workflowType = resp.workflow_type;\r\n                              workModelOptions.draft_id = draftResp.draftprocess_id;\r\n                              workModelOptions['isAttachmentCentric'] = cmdData.smartViewAttachmentsView;\r\n                              this._prepareWorkItem(context, workModelOptions);\r\n                              deferred.resolve();\r\n                            }, this))\r\n                            .fail(_.bind(function (resp) {\r\n                              deferred.reject(resp);\r\n                            }, this));\r\n\r\n                        } else {\r\n                          options.isDoc = true;\r\n                          options.doc_id = delimitedDocIds;\r\n                          options.doc_names = docNames;\r\n                          options.parent_id = parent_id;\r\n                          deferred.resolve();\r\n                          return that._navigateTo(wfMapModel, options);\r\n                        }\r\n                      }\r\n                      else {\r\n                        var popupModelOptions = { centerVertically: true, buttons: ModalAlert.buttons.OkCancel },\r\n                          message = _.str.sformat(lang.StartWorkflowSingleMessage, wfdata.Name);\r\n\r\n                        ModalAlert.confirmQuestion(message, lang.StartWorkflowTitle, popupModelOptions).always(_.bind(function (result) {\r\n                          if (result) {\r\n                            if (status.originatingView) {\r\n                              status.originatingView.blockActions();\r\n                            }\r\n\r\n                            // start the workflow\r\n                            workflowModel.startWorkflow()\r\n                              .done(_.bind(function (resp) {\r\n                                var successMsg = lang.SuccessInitiateMessage;\r\n\r\n                                if (resp && resp.custom_message) {\r\n                                  successMsg = resp.custom_message;\r\n                                }\r\n\r\n                                GlobalMessage.showMessage('success', successMsg);\r\n\r\n                                deferred.resolve();\r\n\r\n                                // checking if the webreport navigation is needed or not\r\n                                if (resp && resp.WRID && resp.WorkID) {\r\n                                  options = options || {};\r\n                                  options.webReportId = resp.WRID;\r\n                                  options.workId = resp.WorkID;\r\n                                  options.isWebreport = true;\r\n                                  return this._navigateTo(wfMapModel, options);\r\n                                }\r\n\r\n                              }, this))\r\n                              .fail(_.bind(function (error) {\r\n                                // starting a workflow failed, show message\r\n                                GlobalMessage.showMessage('error', error.responseJSON.error);\r\n                                deferred.reject();\r\n                              }, this))\r\n                              .always(function() {\r\n                                if (status.originatingView) {\r\n                                  status.originatingView.unblockActions();\r\n                                }\r\n                              });\r\n                          }\r\n                          else {\r\n                            deferred.resolve();\r\n                          }\r\n                        }, this));\r\n                        }\r\n\r\n                      }, this))\r\n                      .fail(_.bind(function (error) {\r\n                        if (error.responseJSON) {\r\n                          GlobalMessage.showMessage('error', error.responseJSON.error);\r\n                        }\r\n                      }, this));\r\n                }\r\n                else {\r\n                  docModels = this._prepareDocModels(workflowType, nodes, connector);\r\n                  workModelOptions.docModels = docModels;\r\n                  this._prepareWorkItem(context, workModelOptions);\r\n                }\r\n              }\r\n            }, that))\r\n            .fail(_.bind(function (error) {\r\n              // creation of the draft process failed, show message\r\n              if (error.responseJSON) {\r\n                GlobalMessage.showMessage('error', error.responseJSON.error);\r\n              }\r\n              deferred.reject();\r\n            }, this));\r\n\r\n        // set the map it to load the temp map\r\n\r\n      }, function (error) {\r\n        deferred.reject(error);\r\n      });\r\n\r\n      // Return deferred to react on issues/success in the caller\r\n      return deferred;\r\n    },\r\n\r\n    _prepareDocModels: function (workflowType, nodes, connector) {\r\n      var docModels = [], docModel;\r\n      if (nodes && nodes.length > 0) {\r\n        _.each(nodes, function (model) {\r\n          //For Signing workflows, we need to create a copy of the attachment\r\n          if (workflowType === \"101_1\") {\r\n            docModel = new NodeModel({\r\n              \"name\": model.attributes.name,\r\n              \"original_id\": model.attributes.id\r\n            }, { connector: connector });\r\n          } else {\r\n            docModel = new NodeModel({\r\n              \"type\": 1,\r\n              \"type_name\": \"Shortcut\",\r\n              \"container\": false,\r\n              \"name\": model.attributes.name,\r\n              \"original_id\": model.attributes.id,\r\n              \"original_id_expand\": model.attributes\r\n            }, { connector: connector });\r\n          }\r\n          docModels.push(docModel);\r\n        });\r\n      }\r\n      return docModels;\r\n    },\r\n\r\n    _prepareWorkItem: function (context, modelOptions) {\r\n\r\n      var workItem;\r\n\r\n      workItem = context.getModel(WorkitemModelFactory);\r\n      workItem.set(modelOptions);\r\n\r\n      return workItem;\r\n    },\r\n\r\n    getUrlQueryParameters: function (node, options) {\r\n      var urlParams;\r\n      if (options.isDoc === true) {\r\n        var params = {},\r\n            baseUrl     = options.connector.connection.url.replace('/api/v1', '');\r\n        params.func = 'wfinitiation.InitiateWorkflowMap';\r\n        params.ParentID = options.parent_id;\r\n        params.DocNames = options.doc_names;\r\n        params.WFMapsDataID = node.get('id');\r\n        params.nexturl = baseUrl + '/app' + (options.parent_id !== -1 ? '/nodes/' + params.ParentID: '');\r\n        urlParams = $.param(params);\r\n        var docIds = options.doc_id.split(\",\");\r\n        for ( var index = 0; index < docIds.length; index++ ) {\r\n          urlParams += '&DocID='.concat(docIds[index]);\r\n        }\r\n      }\r\n      else if (options.isWebreport === true) {\r\n        urlParams = {};\r\n        urlParams.func = 'll';\r\n        urlParams.objAction = 'RunReport';\r\n        urlParams.objId = options.webReportId;\r\n        urlParams.WorkId = options.workId;\r\n        urlParams.nexturl = location.href;\r\n      }\r\n      else {\r\n        urlParams = {};\r\n        urlParams.func = 'll';\r\n        urlParams.objAction = 'Initiate';\r\n        urlParams.objId = node.get('id');\r\n        urlParams.nexturl = location.href;\r\n      }\r\n\r\n      return urlParams;\r\n\r\n    }\r\n\r\n  });\r\n\r\n  return InitiateDocumentWorkflowCommand;\r\n\r\n});\n","csui.define('workflow/commands/open.workitem/open.workitem',['csui/lib/underscore',\r\n  'csui/lib/jquery',\r\n  'csui/utils/commandhelper',\r\n  'csui/utils/commands/open.classic.page',\r\n  'csui/utils/command.error',\r\n  'csui/utils/contexts/factories/connector',\r\n  'workflow/models/workitem/workitem.model.factory',\r\n], function (_, $, CommandHelper, OpenClassicPageCommand, CommandError, ConnectorFactory, WorkitemModelFactory) {\r\n  'use strict';\r\n\r\n  var OpenWorkItemCommand = OpenClassicPageCommand.extend({\r\n\r\n    defaults: {\r\n      signature: 'OpenWorkflowStep'\r\n    },\r\n\r\n    enabled: function (status) {\r\n      var node = CommandHelper.getJustOneNode(status);\r\n      return node && node.get('type') === 153;\r\n    },\r\n\r\n    openTab: true,\r\n\r\n\r\n    // check if work item should be opened in smart or standard UI\r\n    execute: function (status, options) {\r\n      var node = CommandHelper.getJustOneNode(status);\r\n      if (node.get('workflow_open_in_smart_ui')) {\r\n        // smart UI\r\n        options = options || {};\r\n        var context   = status.context || options && options.context,\r\n            deferred  = $.Deferred(),\r\n            workItem = context.getModel(WorkitemModelFactory);\r\n\r\n        // set the work item ids in the model\r\n        workItem.set({\r\n          process_id: node.get('workflow_id'),\r\n          subprocess_id: node.get('workflow_subworkflow_id'),\r\n          task_id: node.get('workflow_subworkflow_task_id'),\r\n          url_org: location.href,\r\n          isAttachmentCentric: node.get('smartViewAttachmentsView')\r\n        });\r\n\r\n\r\n        // Return deferred to react on issues/success in the caller\r\n        return deferred;\r\n      } else if ( node.get('maptask_subtype')=== 110 ) {\r\n        // form task\r\n        this.openTab = false ;\r\n        return this._navigateTo(node, options);\r\n        } else {\r\n        // classic UI\r\n        return this._navigateTo(node, options);\r\n      }\r\n    },\r\n\r\n    openInNewTab: function () {\r\n        return this.openTab;\r\n    },\r\n\r\n\r\n    // URL for standard UI\r\n    getUrlQueryParameters: function (node, options) {\r\n\r\n      return {\r\n        func: 'work.EditTask',\r\n        workid: node.get('workflow_id'),\r\n        subworkid: node.get('workflow_subworkflow_id'),\r\n        taskid: node.get('workflow_subworkflow_task_id'),\r\n        nexturl: location.href\r\n      };\r\n    }\r\n  });\r\n\r\n  return OpenWorkItemCommand;\r\n\r\n});\n","csui.define('workflow/commands/open.form/open.form',['csui/lib/underscore', 'csui/utils/commandhelper', 'csui/utils/commands/open.classic.page', 'csui/models/node.actions'\r\n], function (_, CommandHelper, OpenClassicPageCommand, NodeActionCollection) {\r\n  'use strict';\r\n\r\n  var OpenFormCommand = OpenClassicPageCommand.extend({\r\n\r\n    defaults: {\r\n      signature: 'openform',\r\n      command_key: ['openform'],\r\n      scope: 'single'\r\n    },\r\n\r\n    enabled: function (status) {\r\n      var node = CommandHelper.getJustOneNode(status);\r\n      // support both scenarios - default action only or a full node info\r\n      return node && (node.get('openable') || node.actions.get('openform'));\r\n    },\r\n\r\n    execute: function (status, options) {\r\n      return this._getActionParameters(status, options)\r\n          .then(_.bind(function (action) {\r\n            return this._openForm(status, options, action);\r\n          }, this));\r\n    },\r\n\r\n    _openForm: function (status, options, action) {\r\n      this.objAction = 'EditForm';\r\n      var node     = CommandHelper.getJustOneNode(status);\r\n      if (action && action.get('body')) {\r\n        //the body contains either 'ConfirmView' or 'EditForm' dependent of the permissions of the\r\n        // current User\r\n        this.objAction = action.get('body');\r\n      }\r\n      return this._navigateTo(node, options);\r\n    },\r\n\r\n    _getActionParameters: function (status, options) {\r\n      //\r\n      var node = CommandHelper.getJustOneNode(status);\r\n      var formActionCollection = new NodeActionCollection(undefined, {\r\n        connector: node.connector,\r\n        nodes: [ node.get('id') ],\r\n        commands: [ 'openform' ]\r\n      });\r\n      var originatingView = status.originatingView || options.originatingView;\r\n      originatingView && originatingView.blockActions && originatingView.blockActions();\r\n      return formActionCollection\r\n          .fetch()\r\n          .then(function () {\r\n            var action = formActionCollection\r\n                .get(node.get('id'))\r\n                .actions.get('openform');\r\n            return action;\r\n          })\r\n          .always(function () {\r\n            originatingView && originatingView.unblockActions && originatingView.unblockActions();\r\n          });\r\n    },\r\n\r\n    getUrlQueryParameters: function (node, options) {\r\n      return {\r\n        func: 'll',\r\n        objAction: this.objAction,\r\n        objId: node.get('id'),\r\n        nexturl: location.href\r\n      };\r\n    }\r\n\r\n  });\r\n\r\n  return OpenFormCommand;\r\n\r\n});\r\n\n","csui.define('workflow/perspective/routers/workflow.perspective.router',[\r\n  'csui/pages/start/perspective.router',\r\n  'csui/utils/contexts/factories/application.scope.factory',\r\n  'csui/utils/url',\r\n  'workflow/models/workitem/workitem.model.factory'\r\n], function (PerspectiveRouter, ApplicationScopeModelFactory, Url,\r\n    WorkItemModelFactory) {\r\n  'use strict';\r\n\r\n  var WorkflowPerspectiveRouter = PerspectiveRouter.extend({\r\n\r\n    // defined routes, see workflow.perspective.router.md for more details\r\n    routes: {\r\n      'processes/:process_id/:subprocess_id/:task_id': 'openProcess',\r\n      'draftprocesses/:draftprocess_id': 'openDraftProcess',\r\n      'docworkflows/:doc_id/:parent_id': 'openDocumentProcess',\r\n      'docworkflows/:doc_id/:parent_id/draftprocesses/:draftprocess_id': 'openDocumentDraftProcess'\r\n    },\r\n\r\n    constructor: function WorkflowPerspectiveRouter(options) {\r\n      PerspectiveRouter.prototype.constructor.apply(this, arguments);\r\n\r\n      this.applicationScope = this.context.getModel(ApplicationScopeModelFactory);\r\n\r\n      this.workItem = this.context.getModel(WorkItemModelFactory);\r\n      this.listenTo(this.workItem, 'change:process_id', this._updateUrl);\r\n      this.listenTo(this.workItem, 'change:doc_id', this._updateUrl);\r\n    },\r\n\r\n    /**\r\n     * Called when the route is activated\r\n     * @param process_id Process id of the workflow\r\n     * @param subprocess_id Sub process od of the workflow\r\n     * @param task_id Task id of the workflow\r\n     */\r\n    openProcess: function (process_id, subprocess_id, task_id) {\r\n      //set the ids in the model to reload it\r\n      this.workItem.set({\r\n        process_id: parseInt(process_id),\r\n        subprocess_id: parseInt(subprocess_id),\r\n        task_id: parseInt(task_id),\r\n        isDraft: false,\r\n        url_org: this.validateURL(this._getUrl()),\r\n        isAttachmentCentric: this._isAttachmentCentric()\r\n      });\r\n    },\r\n\r\n    /**\r\n     * Called when the route is activated\r\n     * @param draftprocess_id Draft process id of the workflow\r\n     */\r\n    openDraftProcess: function (draftprocess_id) {\r\n      //set the ids in the model to reload it\r\n      this.workItem.set({\r\n        process_id: parseInt(draftprocess_id),\r\n        isDraft: true,\r\n        url_org: this.validateURL(this._getUrl()),\r\n        isAttachmentCentric: this._isAttachmentCentric()\r\n      });\r\n    },\r\n\r\n    /**\r\n     * Called when the route is activated\r\n     * @param doc_id docId to retrive list of workflows associated to document\r\n     * @param parent_id parentId to retrive  list of workflows associated to document\r\n     */\r\n    openDocumentProcess: function (doc_id, parent_id) {\r\n\r\n      var defaults = this.workItem.defaults;\r\n      this.workItem.reset({silent: true});\r\n      this.workItem.set(defaults, {silent: true});\r\n      //set the ids in the model to reload it\r\n      this.workItem.set({\r\n        parent_id: parseInt(parent_id),\r\n        isDoc: true,\r\n        doc_id: doc_id,\r\n        url_org: this.validateURL(this._getUrl()),\r\n        isAttachmentCentric: this._isAttachmentCentric()\r\n      });\r\n    },\r\n\r\n    /**\r\n     * Called when the route is activated\r\n     * @param doc_id docId to retrive list of workflows associated to document\r\n     * @param parent_id parentId to retrive  list of workflows associated to document\r\n     * @param draftprocess_id Draft process id of the workflow\r\n     */\r\n    openDocumentDraftProcess: function (doc_id, parent_id, draftprocess_id) {\r\n      //set the ids in the model to reload it\r\n      this.workItem.set({\r\n        parent_id: parseInt(parent_id),\r\n        draft_id: parseInt(draftprocess_id),\r\n        isDocDraft: true,\r\n        doc_id: doc_id,\r\n        url_org: this.validateURL(this._getUrl()),\r\n        isAttachmentCentric: this._isAttachmentCentric()\r\n      });\r\n    },\r\n\r\n    onOtherRoute: function () {\r\n      // reset the model in the case a different route is activated\r\n      this.workItem.reset({silent: true});\r\n    },\r\n\r\n    _getUrl: function () {\r\n      //Constructing the url to navigate to the classic ui\r\n      var vars = {};\r\n      //Extracting the query string values from the url\r\n      window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,\r\n          function (m, key, value) {\r\n            vars[key] = value;\r\n          });\r\n      var originIndex = vars[\"origin_index\"],\r\n          nextUrl     = vars[\"nexturl\"],\r\n          reloadClassicUi = vars[\"reload_classic_ui\"],\r\n          base_url    = this.workItem.connector.connection.url.replace(\"/api/v1\", \"\"),\r\n          strURLArray = [\"func=Personal.Assignments\", \"func=work.Workflows&tabname=Assignments\"];\r\n\r\n      if (reloadClassicUi === \"true\" && originIndex >= 0 && originIndex <= strURLArray.length - 1) {\r\n        return base_url + \"?\" + strURLArray[originIndex];\r\n      } else if (nextUrl) {\r\n        return decodeURIComponent(nextUrl);\r\n      } else if (document.referrer) {\r\n        var referrer = document.referrer;\r\n        if ((referrer.indexOf(\"/app/\") >= 0) || (referrer.indexOf(\"?func\") >= 0)) {\r\n          return document.referrer;\r\n        }\r\n        else {\r\n          return \"\";\r\n        }\r\n      }\r\n      else {\r\n        return \"\";\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Update the URL when a model is changed\r\n     * @private\r\n     */\r\n    _updateUrl: function () {\r\n      // get the workflow ids for the URL\r\n      var process_id    = this.workItem.get('process_id'),\r\n          subprocess_id = this.workItem.get('subprocess_id'),\r\n          task_id       = this.workItem.get('task_id'),\r\n          isDraft       = this.workItem.get('isDraft'),\r\n          isDocDraft    = this.workItem.get('isDocDraft'),\r\n          isDoc         = this.workItem.get('isDoc'),\r\n          mapsList      = this.workItem.get('mapsList'),\r\n          doc_id        = this.workItem.get('doc_id'),\r\n          parent_id     = this.workItem.get('parent_id'),\r\n          draftId       = this.workItem.get('draft_id'),\r\n          isAttachmentCentric = this.workItem.get('isAttachmentCentric');\r\n\r\n      if (!!process_id && !!doc_id) {\r\n        return;\r\n      }\r\n      if (!(doc_id || process_id) && this.applicationScope.id !== 'workflow') {\r\n        return;\r\n      }\r\n\r\n      var url = 'processes';\r\n\r\n      if (isDraft) {\r\n        // create the URL from the workflow ids\r\n        url = 'draftprocesses';\r\n        if (process_id) {\r\n          url += '/' + process_id;\r\n        }\r\n      } else if (isDocDraft || (mapsList && mapsList.length === 1)) {\r\n        url = 'docworkflows';\r\n        if (doc_id && parent_id && draftId) {\r\n          url += '/' + doc_id + '/' + parent_id + '/' + 'draftprocesses' + '/' +\r\n                 draftId;\r\n        }\r\n      } else if (isDoc) {\r\n        // create the URL from the workflow ids\r\n        url = 'docworkflows';\r\n        if (doc_id && parent_id) {\r\n          url += '/' + doc_id + '/' + parent_id;\r\n        }\r\n      } else {\r\n        // create the URL from the workflow ids\r\n        url = 'processes';\r\n        if (process_id) {\r\n          url += '/' + process_id + '/' + subprocess_id + '/' + task_id;\r\n        }\r\n      }\r\n      this._routeWithSlashes = false;\r\n\r\n      if (isAttachmentCentric) {\r\n        var queryData = {}, urlStringParam;\r\n        queryData.attachmentsview = 1;\r\n        urlStringParam = Url.combineQueryString(queryData);\r\n        url = Url.appendQuery(url, urlStringParam);\r\n      }\r\n\r\n      this.navigate(url);\r\n    },\r\n\r\n    validateURL: function (surl) {\r\n      var url = this.parseURL(surl);\r\n      var urlHostname = url.hostname.trim();\r\n\r\n      if (urlHostname === '') {\r\n        return surl;\r\n      }\r\n      else {\r\n        if (urlHostname.toUpperCase() === location.hostname.trim().toUpperCase()) {\r\n          return surl;\r\n        }\r\n        else\r\n        {\r\n          return \"\";\r\n        }\r\n      }\r\n    } ,\r\n\r\n    parseURL: function(url) {\r\n\r\n      var a =document.createElement('a');\r\n      a.href = url;\r\n\r\n      return {\r\n        source: url,\r\n        protocol: a.protocol.replace(':', ''),\r\n        hostname: a.hostname,\r\n        host: a.host,\r\n        port: a.port,\r\n        query: a.search,\r\n        params: (function () {\r\n          var ret = {},\r\n              seg = a.search.replace(/^\\?/, '').split('&'),\r\n              len = seg.length, i = 0, s;\r\n          for (; i < len; i++) {\r\n            if (!seg[i]) { continue; }\r\n            s = seg[i].split('=');\r\n            ret[s[0]] = s[1];\r\n          }\r\n          return ret;\r\n        })(),\r\n\r\n        hash: a.hash.replace('#', ''),\r\n\r\n        segments: a.pathname.replace(/^\\//, '').split('/')\r\n      };\r\n    },\r\n\r\n    _isAttachmentCentric: function () {\r\n      //Constructing the url to navigate to the classic ui\r\n      var vars = {};\r\n      //Extracting the query string values from the url\r\n      window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,\r\n        function (m, key, value) {\r\n          vars[key] = value;\r\n        });\r\n\r\n      var attachmentsView = vars[\"attachmentsview\"];\r\n\r\n      attachmentsView = parseInt(attachmentsView);\r\n\r\n      if (attachmentsView && attachmentsView === 1) {\r\n        return true;\r\n      } else {\r\n        return false;\r\n      }\r\n\r\n    }\r\n\r\n  });\r\n\r\n  return WorkflowPerspectiveRouter;\r\n\r\n});\r\n\n","csui.define('workflow/utils/workitem.extension.controller',[\r\n  'csui/lib/underscore',\r\n  'csui/lib/jquery',\r\n  'csui/lib/backbone',\r\n  'csui/utils/log'\r\n], function (_, $, Backbone, log) {\r\n  'use strict';\r\n\r\n  /**\r\n   * Work item extensions controller.\r\n   * Base object for other extension controller for the workflow Smart UI.\r\n   *\r\n   * @param options\r\n   * @constructor\r\n   */\r\n  function WorkItemExtensionController(options) {\r\n    this.context = options.context;\r\n  }\r\n\r\n  // Attach all inheritable methods to the Controller prototype.\r\n  _.extend(WorkItemExtensionController.prototype, {\r\n\r\n    /**\r\n     * Initialize is an empty function by default. Override it with your own\r\n     * initialization logic.\r\n     */\r\n    initialize: function () {},\r\n\r\n    /**\r\n     * Validates the controller for the given data package type and sub type\r\n     * @param type Type of the data package\r\n     * @param sub_type Sub type of the data package\r\n     * @returns {boolean} true when this controller can handle this data package, false if not\r\n     */\r\n    validate: function (type, sub_type) {\r\n      return false;\r\n    },\r\n\r\n    /**\r\n     * Execute method for the controller.\r\n     * It does the main work for the controller and returns a promise object\r\n     * which is resolved when the controller work is done (e.g. a model is loaded)\r\n     * The parameter of the promise done method contains an member viewToShow\r\n     * this is the view which has to be shown in the work item view.\r\n     * @param options Parameters for the execution method, integration point, model, data package data, parent view, ...\r\n     * @return {promise} Returns a promise which will be resolved when the necessary actions are done.\r\n     *                   The argument of the done method has to contain the view which has to be displayed in the property viewToShow\r\n     */\r\n    execute: function (options) {\r\n      var deferred = $.Deferred();\r\n\r\n      // resolve the dummy promise\r\n      deferred.resolve();\r\n\r\n      // return the dummy promise\r\n      return deferred.promise();\r\n    },\r\n\r\n    /**\r\n     * ExcuteAction function for the controller.\r\n     *\r\n     * @param options Parameters for the function, including workitem model, executed action, ...\r\n     * @returns {*}\r\n     */\r\n    executeAction: function (options) {\r\n      var deferred = $.Deferred();\r\n\r\n      // resolve the dummy promise\r\n      deferred.resolve();\r\n\r\n      // return the dummy promise\r\n      return deferred.promise();\r\n    },\r\n\r\n    /**\r\n     * customizeFooter function for the controller.\r\n     *\r\n     * @param options Parameters for the function, including buttonlist and workitem model\r\n     * action, ...\r\n     * @returns {*}\r\n     */\r\n    customizeFooter: function (options) {\r\n      var deferred = $.Deferred();\r\n\r\n      // resolve the dummy promise\r\n      deferred.resolve();\r\n\r\n      // return the dummy promise\r\n      return deferred.promise();\r\n    }\r\n  });\r\n\r\n  WorkItemExtensionController.extend = Backbone.Model.extend;\r\n\r\n  // Definitions of the possible extension points\r\n  WorkItemExtensionController.ExtensionPoints = {\r\n    // Show an additional side bar view\r\n    AddSidebar: 1,\r\n    // Show an additional view in the forms area\r\n    AddForm: 2,\r\n    // Show extension view instead of the workitem view\r\n    FullView: 3\r\n  };\r\n\r\n  return WorkItemExtensionController;\r\n});\r\n\n","csui.define('bundles/workflow-core',[\r\n  //factories\r\n  'workflow/models/workitem/workitem.model.factory',\r\n\r\n  // Commands\r\n  'workflow/commands/defaultactionitems',\r\n  'workflow/commands/initiate.workflow/initiate.workflow',\r\n  'workflow/commands/edit.workflow.map/edit.workflow.map',\r\n  'workflow/commands/initiate.document.workflow/initiate.document.workflow',\r\n  'workflow/commands/open.workitem/open.workitem',\r\n  'workflow/commands/open.form/open.form',\r\n\r\n  // Perspective router\r\n  'workflow/perspective/routers/workflow.perspective.router',\r\n\r\n  // Extension controller\r\n  'workflow/utils/workitem.extension.controller'\r\n], {});\r\n\r\n\r\n\n"]}