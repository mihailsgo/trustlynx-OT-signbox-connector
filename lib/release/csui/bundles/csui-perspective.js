csui.define("csui/perspective.manage/mixins/manifest.edit.mixin",["csui/lib/underscore","csui/lib/jquery"],function(e,i){"use strict";return{"mixin":function(t){return e.extend(t,{"objectToPrimitive":function(t){var s=i.extend(!0,{},this.manifest),n=this.manifest.schema.properties[t],o=this.manifest.options.fields[t],a=o&&o.items.fields,r=e.keys(n.items.properties)[0];this.manifest.modifiedItems=s;var l=n.items.properties[r];delete n.items.properties,n.items.type=l.type,n.title=l.title,n.required=n.items.required&&n.items.required.length>0,n.itemKey=r,a&&(delete o.items.fields,o.items=e.values(a)[0])},"updateDataToPrimitive":function(e,i){var t=[],s=this.manifest.schema.properties[i].itemKey;0==e[i].length&&t.push(""),e[i].forEach(function(e){t.push(e[s])}),e[i]=t},"getPrimitiveToObjectvalues":function(e,i){var t=this.manifest.schema.properties[e].itemKey;if(t){this.manifest.modifiedItems&&(this.manifest.options.fields[e].items=this.manifest.modifiedItems.options.fields[e].items,this.manifest.schema.properties[e].items=this.manifest.modifiedItems.schema.properties[e].items);for(var s in i[e]){var n={};n[t]=i[e][s],i[e][s]=n}return i}return i}})}}}),csui.define("hbs!csui/perspective.manage/impl/options.form.wrapper",["module","hbs","nuc/lib/handlebars"],function(e,i,t){var s=t.template({"compiler":[8,">= 4.3.0"],"main":function(e,i,t,s,n){var o,a=e.lookupProperty||function(e,i){if(Object.prototype.hasOwnProperty.call(e,i))return e[i]};return'<div class="csui-pman-form-header">\r\n    <div class="csui-pman-form-title">'+e.escapeExpression((o=null!=(o=a(t,"title")||(null!=i?a(i,"title"):i))?o:e.hooks.helperMissing,"function"==typeof o?o.call(null!=i?i:e.nullContext||{},{"name":"title","hash":{},"loc":{"start":{"line":2,"column":38},"end":{"line":2,"column":49}}}):o))+'</div>\r\n    <div class="csui-pman-form-description">'+e.escapeExpression((o=null!=(o=a(t,"description")||(null!=i?a(i,"description"):i))?o:e.hooks.helperMissing,"function"==typeof o?o.call(null!=i?i:e.nullContext||{},{"name":"description","hash":{},"loc":{"start":{"line":3,"column":44},"end":{"line":3,"column":61}}}):o))+'</div>\r\n    <div class="csui-pman-config-unsupported">\r\n        <div class="csui-state">\r\n            <span class="csui-state-icon csui-icon csui-icon-notification-error-white"></span>\r\n        </div>\r\n        <div class="csui-error-message">\r\n            <span>'+e.escapeExpression((o=null!=(o=a(t,"configNotSupported")||(null!=i?a(i,"configNotSupported"):i))?o:e.hooks.helperMissing,"function"==typeof o?o.call(null!=i?i:e.nullContext||{},{"name":"configNotSupported","hash":{},"loc":{"start":{"line":9,"column":18},"end":{"line":9,"column":42}}}):o))+'</span>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div class="csui-pman-form-content cs-formview-wrapper"></div>\r\n'}});return t.registerPartial("csui_perspective.manage_impl_options.form.wrapper",s),s}),csui.define("css!csui/perspective.manage/impl/options.form",[],function(){}),csui.define("csui/perspective.manage/impl/options.form.view",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/lib/marionette","csui/lib/alpaca/js/alpaca.lite","csui/controls/mixins/layoutview.events.propagation/layoutview.events.propagation.mixin","csui/perspective.manage/mixins/manifest.edit.mixin","csui/controls/tile/behaviors/perfect.scrolling.behavior","csui/controls/form/form.view","i18n!csui/perspective.manage/impl/nls/lang","hbs!csui/perspective.manage/impl/options.form.wrapper","csui/utils/perspective/perspective.util","css!csui/perspective.manage/impl/options.form"],function(e,i,t,s,n,o,a,r,l,c,p,d){var u=s.LayoutView.extend({"template":p,"className":"csui-pman-form-wrapper","regions":{"bodyRegion":".csui-pman-form-content"},"behaviors":{"PerfectScrolling":{"behaviorClass":r,"scrollYMarginOffset":1}},"templateHelpers":function(){return{"title":this.options.manifest.title,"description":this.options.manifest.description,"configNotSupported":c.configNotSupported}},"ui":{"unSupportedConfig":".csui-pman-config-unsupported","description":".csui-pman-form-description"},"events":{"keydown":"_onKeyDown"},"constructor":function(e){this.options=e||{},this.manifest=this.options.manifest,s.LayoutView.prototype.constructor.apply(this,arguments)},"_createForm":function(e){this.widgetOptionsFormView=new g({"context":this.options.context,"model":e,"mode":"create"}),this.listenToOnce(this.widgetOptionsFormView,"render:form",function(){this.trigger("render:form")}.bind(this)),this.listenTo(this.widgetOptionsFormView,"change:field",function(e){this.trigger("change:field",e),this.trigger("ensure:scrollbar")}.bind(this))},"_hasSchema":function(){return this.manifest&&this.manifest.hasConfigForm},"refresh":function(e){this.widgetOptionsFormView?this.widgetOptionsFormView.refresh(e):e()},"onRender":function(){if(this.ui.unSupportedConfig.hide(),!this._hasSchema())return void this.trigger("render:form");var e=this._prepareFormModel();this.hasValidSchema=u._normalizeOptions(e.attributes.schema.properties,e.attributes.options.fields,e.attributes.data),this.hasValidSchema?(this._createForm(e),this.bodyRegion.show(this.widgetOptionsFormView)):(this.ui.description.hide(),this.ui.unSupportedConfig.show(),this.trigger("render:form"))},"onPopoverShow":function(e){this._hasSchema()&&!this.hasValidSchema&&(e.find(".binf-popover-content").addClass("invalid-options"),e.find(".binf-arrow").addClass("invalid-options")),this._focusField(".alpaca-container-item-first")},"_focusField":function(e){var i=this.$el.find(e);if(i.length){i=i.first();var t=i.find("input:visible, textarea:visible, button.binf-dropdown-toggle:visible"),s=i.find(".cs-browse-icon");t.length&&(s.length?s.trigger("focus"):t.first().trigger("focus"))}},"_onKeyDown":function(e){var t=!0,s=i(e.target);switch(e.keyCode){case 9:!e.shiftKey&&s.parents(".alpaca-container-item-last").length?(this._focusField(".alpaca-container-item-first"),t=!1):e.shiftKey&&s.parents(".alpaca-container-item-first").length&&(this._focusField(".alpaca-container-item-last"),t=!1)}return t},"getValues":function(){if(this._hasSchema()){if(this.hasValidSchema){var i=this.widgetOptionsFormView.getValues();if(this.manifest.modifiedProperties)for(var t in e.keys(i))this.manifest.modifiedProperties.indexOf(e.keys(i)[t])>=0&&(i=this.getPrimitiveToObjectvalues(e.keys(i)[t],i));return i}return this._getOptionsData()}},"validate":function(){if(!this._hasSchema())return!0;if(!this.hasValidSchema){var i=!0;if(d.hasRequiredFields(this.manifest)){var t=this._getOptionsData(),s=this.manifest.schema.required;e.each(s,function(e){t[e]||(i=!1)})}return i}return this.widgetOptionsFormView.validate()},"_isPreviewWidget":function(){return"csui/perspective.manage/widgets/perspective.widget"===this.options.widgetConfig.type},"_prepareFormModel":function(){var i=this._getOptionsData(),s=[];for(var n in this.manifest.schema.properties){if("businessobjecttypes"!==n)break;var o=this.manifest.schema.properties[n];"array"===o.type&&"object"===o.items.type&&1===e.keys(o.items.properties).length?(s.push(n),this.objectToPrimitive(n),i[n]&&this.updateDataToPrimitive(i,n)):this.manifest.modifiedProperties&&i[n]&&this.updateDataToPrimitive(i,n)}s.length>0&&(this.manifest.modifiedProperties=s);var a=JSON.parse(JSON.stringify(this.manifest.schema)),r=JSON.parse(JSON.stringify(this.manifest.options||{}));return r||(r={}),r.fields||(r.fields={}),this._addWidgetSizePropertyIfSupported(a,r,i),new t.Model({"schema":a,"options":r,"data":i})},"_getOptionsData":function(){var e=this.options.widgetConfig.options||{};return this._isPreviewWidget()&&(e=e.options||{}),e},"_addWidgetSizePropertyIfSupported":function(i,t,s){if(this.options.perspectiveView.getSupportedWidgetSizes){var n=this.options.perspectiveView.getSupportedWidgetSizes(this.manifest,this.options.widgetView);if(this.options.context&&this.options.context.perspective&&("sidepanel-right"!=this.options.context.perspective.type&&"sidepanel-left"!=this.options.context.perspective.type?n=e.filter(n,function(e){return"heroTile"!==e.kind}):this.options.perspectiveView.$el.hasClass("cs-bcs-perspective-banner")&&delete i.properties.titlefield),n&&0!==n.length){var o={"title":c.widgetSizeTitle,"description":c.widgetSizeDescription,"type":"string","enum":e.map(n,function(e){return e.kind})},a={"type":"select","optionLabels":e.map(n,function(e){return e.label}),"removeDefaultNone":!0},r=e.find(n,function(e){return e.selected});r&&(s[u.widgetSizeProperty]=r.kind);var l={};l[u.widgetSizeProperty]=o,i.properties=e.extend(l,i.properties);var p={};p[u.widgetSizeProperty]=a,t.fields=e.extend(p,t.fields),i.required=i.required||[],i.required.push(u.widgetSizeProperty)}}}},{"widgetSizeProperty":"__widgetSize","_resolveOptionsType":function(e,i){var t=e.type;return t||(t=n.getSchemaType(i)),t||(t=i&&n.isArray(i)?"array":"object"),e&&e.enum?e.enum.length>3?"select":"radio":n.defaultSchemaFieldMapping[t]},"_normalizeOptions":function(i,t,s){var o=!0;return e.each(i,function(i,a){var r=t[a],l=s[a];r||(t[a]=r={});var c=r.type;switch(!c&&i.type&&(c=u._resolveOptionsType(i,l)),n.getFieldClass(c)||(o=!1),i.type){case"array":if(r.fields||e.defaults(r,{"fields":{"item":{}}}),r.items&&(r.fields.item=r.items),"object"===i.items.type){r.fields.item.type&&!n.getFieldClass(r.fields.item.type)&&(o=!1),r.fields.item.fields||(r.fields.item.fields={}),l&&0!==l.length||(s[a]=l=[{}]);u._normalizeOptions(i.items.properties,r.fields.item.fields,l[0])||(o=!1)}l||(s[a]=[null]);break;case"object":l||(s[a]=l={}),r.fields||(r.fields={});u._normalizeOptions(i.properties,r.fields,l)||(o=!1);break;default:e.isUndefined(l)&&(s[a]=i.default||null)}}),o}}),g=l.extend({"className":function(){return l.prototype.className.call(this)+" perspective-widget-form"},"constructor":function(e){l.apply(this,arguments)},"popover":!1,"refresh":function(e){this.form&&this.form.refresh(e)},"_modifyModel":function(){l.prototype._modifyModel.apply(this,arguments),this.alpaca.options.hideInitValidationError=!1}});return e.extend(g.prototype,o),a.mixin(u.prototype),u}),csui.define("hbs!csui/perspective.manage/impl/widget.item",["module","hbs","nuc/lib/handlebars"],function(e,i,t){var s=t.template({"1":function(e,i,t,s,n){var o,a=e.lookupProperty||function(e,i){if(Object.prototype.hasOwnProperty.call(e,i))return e[i]};return'\r\n        <div class="'+(null!=(o=a(t,"if").call(null!=i?i:e.nullContext||{},null!=(o=null!=i?a(i,"attributes"):i)?a(o,"draggable"):o,{"name":"if","hash":{},"fn":e.program(2,n,0),"inverse":e.program(4,n,0),"loc":{"start":{"line":11,"column":20},"end":{"line":11,"column":76}}}))?o:"")+'"\r\n             data-widget-type="'+e.escapeExpression(e.lambda(null!=(o=null!=i?a(i,"attributes"):i)?a(o,"dataAttr"):o,i))+'"\r\n             data-widget-allow-multiple="'+e.escapeExpression(e.lambda(null!=(o=null!=i?a(i,"attributes"):i)?a(o,"allowMultiple"):o,i))+'">\r\n          <div class="csui-widget-item icon-draggable-handle csui-draggable-widget-item"\r\n               data-widget-index="'+e.escapeExpression(e.lambda(null!=(o=null!=i?a(i,"attributes"):i)?a(o,"index"):o,i))+'" draggable="true" title="'+e.escapeExpression(e.lambda(null!=(o=null!=i?a(i,"attributes"):i)?a(o,"title"):o,i))+'">\r\n            <span>'+e.escapeExpression(e.lambda(null!=(o=null!=i?a(i,"attributes"):i)?a(o,"title"):o,i))+'</span>\r\n            <div class="csui-layout-icon '+e.escapeExpression(e.lambda(null!=(o=null!=i?a(i,"attributes"):i)?a(o,"icon"):o,i))+'"></div>\r\n          </div>\r\n        </div>\r\n\r\n        <div class="'+(null!=(o=a(t,"if").call(null!=i?i:e.nullContext||{},null!=(o=null!=i?a(i,"attributes"):i)?a(o,"draggable"):o,{"name":"if","hash":{},"fn":e.program(4,n,0),"inverse":e.program(2,n,0),"loc":{"start":{"line":21,"column":20},"end":{"line":21,"column":76}}}))?o:"")+'" data-widget-type="'+e.escapeExpression(e.lambda(null!=(o=null!=i?a(i,"attributes"):i)?a(o,"dataAttr"):o,i))+'"\r\n             data-widget-allow-multiple="'+e.escapeExpression(e.lambda(null!=(o=null!=i?a(i,"attributes"):i)?a(o,"allowMultiple"):o,i))+'">\r\n          <div class="csui-widget-item icon-draggable-handle" title="'+e.escapeExpression(e.lambda(null!=(o=null!=i?a(i,"attributes"):i)?a(o,"disableTitle"):o,i))+'">\r\n            <span>'+e.escapeExpression(e.lambda(null!=(o=null!=i?a(i,"attributes"):i)?a(o,"title"):o,i))+'</span>\r\n            <div class="csui-layout-icon '+e.escapeExpression(e.lambda(null!=(o=null!=i?a(i,"attributes"):i)?a(o,"icon"):o,i))+'"></div>\r\n          </div>\r\n        </div>\r\n\r\n'},"2":function(e,i,t,s,n){return""},"4":function(e,i,t,s,n){return" binf-hidden "},"compiler":[8,">= 4.3.0"],"main":function(e,i,t,s,n){var o,a=e.lookupProperty||function(e,i){if(Object.prototype.hasOwnProperty.call(e,i))return e[i]};return'<div class="csui-accordion-header" title="'+e.escapeExpression(e.lambda(null!=i?a(i,"title"):i,i))+'">\r\n  <div class="csui-accordion-header-title">'+e.escapeExpression(e.lambda(null!=i?a(i,"title"):i,i))+'</div>\r\n  <div class="csui-button-icon cs-icon icon-expandArrowDown"></div>\r\n  <div class="csui-button-icon cs-icon icon-expandArrowUp"></div>\r\n</div>\r\n<div class="csui-accordion-content">\r\n  <div class="cs-content csui-list-pannel">\r\n    <div class="cs-list-group">\r\n'+(null!=(o=a(t,"each").call(null!=i?i:e.nullContext||{},null!=i?a(i,"widgets"):i,{"name":"each","hash":{},"fn":e.program(1,n,0),"inverse":e.noop,"loc":{"start":{"line":9,"column":6},"end":{"line":29,"column":15}}}))?o:"")+"    </div>\r\n  </div>\r\n</div>"}});return t.registerPartial("csui_perspective.manage_impl_widget.item",s),s}),csui.define("hbs!csui/perspective.manage/impl/widget.drag.template",["module","hbs","nuc/lib/handlebars"],function(e,i,t){var s=t.template({"compiler":[8,">= 4.3.0"],"main":function(e,i,t,s,n){var o=e.lookupProperty||function(e,i){if(Object.prototype.hasOwnProperty.call(e,i))return e[i]};return'<div class="csui-widget-template">\r\n  <div class="csui-template-header">'+e.escapeExpression(e.lambda(null!=i?o(i,"header"):i,i))+'</div>\r\n  <div class="csui-template-body">'+e.escapeExpression(e.lambda(null!=i?o(i,"body"):i,i))+"</div>\r\n</div>"}});return t.registerPartial("csui_perspective.manage_impl_widget.drag.template",s),s}),csui.define("csui/perspective.manage/impl/widget.list.view",["module","csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/lib/marionette","csui/utils/base","csui/controls/tile/behaviors/perfect.scrolling.behavior","csui/perspective.manage/impl/options.form.view","i18n!csui/perspective.manage/impl/nls/lang","csui/models/widget/widget.collection","hbs!csui/perspective.manage/impl/widget.item","hbs!csui/perspective.manage/impl/widget.drag.template"],function(e,i,t,s,n,o,a,r,l,c,p,d){"use strict";var u=e.config();i.defaults(u,{"dragImageOffsetTop":50,"dragImageOffsetLeft":50});var g=n.ItemView.extend({"constructor":function(e){e||(e={}),n.ItemView.prototype.constructor.apply(this,arguments)},"tagName":"div","className":"csui-module-group","template":p,"templateHelpers":function(){var e=new s.Collection(this.model.attributes.widgets),i=l.disableTitle,t=0;return e.models.forEach(function(e){e.set({"draggable":!!e.get("canDragAndDrop"),"disableTitle":i,"dataAttr":e.get("id").replace(/\//g,"-"),"allowMultiple":!!e.get("allowMultiple"),"index":t++},{"silent":!0})}),{"widgets":e.models}},"ui":{"accordionHeader":".csui-accordion-header","accordionContent":".csui-accordion-content","accordionHeaderIcon":".csui-accordion-header .cs-icon","widget":".csui-draggable-widget-item"},"events":{"click @ui.accordionHeader":"toggle","keydown @ui.accordionHeader":"toggle","dragstart @ui.widget":"onDragStart","dragend @ui.widget":"onDragEnd"},"toggle":function(){var e=this.ui.accordionHeader.hasClass("csui-accordion-expand");this.ui.accordionHeader.toggleClass("csui-accordion-expand"),this.options.parentView.$el.find(".csui-module-group").removeClass("csui-accordion-visible").find(".csui-accordion-header").removeClass("csui-accordion-expand"),e||(this.$el.addClass("csui-accordion-visible"),this.ui.accordionHeader.addClass("csui-accordion-expand")),o.onTransitionEnd(this.ui.accordionContent,function(){this.trigger("widgets:expanded")},this)},"onRender":function(){if(t(".perspective-editing .csui-dnd-container").length)this._makeWidgetSortable();else{var e="function"==typeof document.createElement("span").dragDrop;!this._hasNativeDragImageSupport()&&e&&this.ui.widget.on("mousedown",this._handleDragImageForIE.bind(this))}},"_makeWidgetSortable":function(){var e=this,i=this.$el.find(".csui-widget-item.csui-draggable-widget-item"),t=i.parent();t.data("pman.widget",this.model.get("widgets")),t.sortable({"connectWith":[".perspective-editing .csui-dnd-container",".perspective-editing .pman-trash-area"],"containment":".perspective-editing ","helper":function(i,t){var s=t.data("widget-index");return e.widgetDragTemplate=new h({"title":e.model.get("widgets")[s].get("title"),"newWidget":e.model.get("widgets")[s]}),e.widgetDragTemplate.render(),e.widgetDragTemplate.$el.width("220px"),e.widgetDragTemplate.$el.height("220px"),e.widgetDragTemplate.$el.css({"opacity":.75}),e.widgetDragTemplate.$el.appendTo(e.options.parentView.$el.closest(".pman-pannel-wrapper")),e.widgetDragTemplate.$el},"tolerance":"pointer","cursorAt":{"top":u.dragImageOffsetTop,"left":u.dragImageOffsetLeft},"start":function(i,t){t.item.css("display","block"),t.placeholder.css("display","block"),e.dragStart()},"stop":function(){e.dragEnd()}})},"_handleDragImageForIE":function(e){var s=e.originalEvent,n=t(event.currentTarget).data("widget-index"),o=t(".csui-template-wrapper").clone(),a=this.model.get("widgets")[n];o.find(".csui-template-header").text(a.get("title")),o.css({"top":Math.max(0,s.pageY-u.dragImageOffsetTop)+"px","left":Math.max(0,s.pageX-u.dragImageOffsetLeft)+"px","position":"absolute","pointerEvents":"none"}).appendTo(document.body),setTimeout(function(){o.remove()}),o.on("dragstart",i.bind(function(e){var i=this.model.get("widgets")[n];e.originalEvent.dataTransfer.setData("text",JSON.stringify(i.toJSON())),this.dragStart()},this)),o.on("dragend",i.bind(function(e){this.dragEnd()},this)),o[0].dragDrop()},"onDragStart":function(e){var i=t(e.currentTarget).data("widget-index"),s=this.model.get("widgets")[i],n=e.originalEvent.dataTransfer,o=t(".csui-template-wrapper");o.find(".csui-template-header").text(s.get("title")),this._hasNativeDragImageSupport()&&(n.setData("text",JSON.stringify(s.toJSON())),n.setDragImage(o[0],u.dragImageOffsetLeft,u.dragImageOffsetTop)),this.dragStart()},"_hasNativeDragImageSupport":function(){return"setDragImage"in(window.DataTransfer||window.Clipboard).prototype},"onDragEnd":function(e){this.dragEnd()},"dragStart":function(){this.$el.closest(".csui-pman-panel").addClass("csui-pman-drag-start"),t(document.body).addClass("csui-pman-dnd-active")},"dragEnd":function(){this.$el.closest(".csui-pman-panel").removeClass("csui-pman-drag-start"),t(document.body).removeClass("csui-pman-dnd-active")}}),h=n.ItemView.extend({"constructor":function(e){n.ItemView.prototype.constructor.apply(this,arguments)},"tagName":"div","className":"csui-template-wrapper","template":d,"templateHelpers":function(){return{"header":this.options&&this.options.title,"body":l.templateMessage}},"onRender":function(){this.$el.data("pman.widget",this.options.newWidget)}});return n.ItemView.extend({"tagName":"div","template":p,"constructor":function(e){e||(e={}),e.data||(e.data={}),e.existsWidgetTypes||(e.existsWidgetTypes=[]),n.ItemView.call(this,e),this.context=this.options.pmanView.context;var t=this;t.widegtsUpdated=!1,this.allWidgets=new c,this.allWidgets.fetch().done(function(){t.collection=t._groupWidgetsByModule(),t.render(),t.trigger("items:fetched")}),this.listenTo(this.context,"update:widget:panel",i.bind(function(e){this.widegtsUpdated=!0;var t=e.widgetModel&&e.widgetModel.type?e.widgetModel.type:void 0,s=e.oldWidgetModel&&e.oldWidgetModel.type?e.oldWidgetModel.type:void 0;if(t){var n=i.indexOf(this.options.existsWidgetTypes,t);n>=0?this.options.existsWidgetTypes.splice(n,1):this.options.existsWidgetTypes.push(t),t=t.replace(/\//g,"-");var o=this.$el.find('div[data-widget-type="'+t+'"][data-widget-allow-multiple="false"]');o.length&&o.toggleClass("binf-hidden")}if(s){var n=i.indexOf(this.options.existsWidgetTypes,s);n>=0&&this.options.existsWidgetTypes.splice(n,1),s=s.replace(/\//g,"-");var o=this.$el.find('div[data-widget-type="'+s+'"][data-widget-allow-multiple="false"]');o.length&&o.toggleClass("binf-hidden")}},this)),this.listenTo(this.context,"reset:widget:panel",i.bind(function(e){this.options.existsWidgetTypes=[],this.widegtsUpdated=!0},this))},"initialize":function(){i.bindAll(this,"renderItem")},"className":"cs-module-list","render":function(){this.collection&&this.collection.each(this.renderItem)},"renderItem":function(e){var s=this,n=new g({"model":e,"parentView":s,"context":this.context});n.render(),this.listenTo(n,"widgets:expanded",i.bind(this.trigger,this,"dom:refresh",this)),t(this.el).append(n.el)},"_groupWidgetsByModule":function(){var e=new s.Collection,n=this.allWidgets.filter(function(e){var t=e.get("manifest");if(!t||!i.has(t,"title")||!i.has(t,"description")||t.deprecated)return!1;var s=JSON.parse(JSON.stringify(t.schema||{})),n=JSON.parse(JSON.stringify(t.options||{}));return!!r._normalizeOptions(s.properties,n.fields||{},{})});return i.each(n,i.bind(function(e){var s=i.defaults(e.get("manifest"),{"allowMultiple":!0,"title":l.noTitle}),n=s.allowMultiple;n||(n=-1===t.inArray(e.get("id"),this.options.existsWidgetTypes)),e.set({"allowMultiple":s.allowMultiple,"canDragAndDrop":n,"title":s.title})},this)),i.each(i.groupBy(n,function(e){return e.serverModule.id}),function(t,s){var n=i.first(t).serverModule.get("title");n=n?n.replace(/OpenText /,""):i.first(t).serverModule.get("id").toUpperCase(),e.add({"id":s,"title":n,"widgets":t})}),e},"_sanitiseWidgetLibrary":function(){},"onInitWidgets":function(){this.$el.empty(),this.widegtsUpdated&&(this.collection=this._groupWidgetsByModule(),this.widegtsUpdated=!1),this.render()}})}),csui.define("csui/perspective.manage/impl/perspectivelayouts",["module","csui/lib/underscore","i18n!csui/perspective.manage/impl/nls/lang","csui-ext!perspective.manage/impl/perspectivelayouts"],function(e,i,t,s){var n=i.extend({"enableNewlayoutOption":!1},e.config()),o=[{"title":t.LcrLayoutTitle,"type":"left-center-right","icon":"csui-layout-lcr"},{"title":t.FlowLayoutTitle,"type":"flow","icon":"csui-layout-flow"}];return n.enableNewlayoutOption&&o.push({"title":t.RSPLayoutTitle,"type":"sidepanel-right","icon":"csui-layout-sidepanel-right"},{"title":t.LSPLayoutTitle,"type":"sidepanel-left","icon":"csui-layout-sidepanel-left"}),s&&(o=i.union(o,s)),o}),csui.define("hbs!csui/perspective.manage/impl/pman.panel",["module","hbs","nuc/lib/handlebars"],function(e,i,t){var s=t.template({"compiler":[8,">= 4.3.0"],"main":function(e,i,t,s,n){var o=e.lookupProperty||function(e,i){if(Object.prototype.hasOwnProperty.call(e,i))return e[i]};return'<div class="csui-tab-pannel">\r\n  <div class="csui-layout-tab" title="'+e.escapeExpression(e.lambda(null!=i?o(i,"layoutTabTitle"):i,i))+'">\r\n    '+e.escapeExpression(e.lambda(null!=i?o(i,"layoutTabTitle"):i,i))+'\r\n  </div>\r\n  <div class="csui-AddWidget-tab" title="'+e.escapeExpression(e.lambda(null!=i?o(i,"widgetTabTitle"):i,i))+'">\r\n    '+e.escapeExpression(e.lambda(null!=i?o(i,"widgetTabTitle"):i,i))+'\r\n  </div>\r\n  <div class="csui-widget-tab"></div>\r\n</div>\r\n<div class="csui-list-pannel"></div>\r\n<div class="csui-template-overlay"></div>\r\n<div class="csui-template-wrapper">\r\n  <div class="csui-widget-template">\r\n    <div class="csui-template-header"></div>\r\n    <div class="csui-template-body">'+e.escapeExpression(e.lambda(null!=i?o(i,"templateMessage"):i,i))+"</div>\r\n  </div>\r\n</div>"}});return t.registerPartial("csui_perspective.manage_impl_pman.panel",s),s}),csui.define("hbs!csui/perspective.manage/impl/list.item",["module","hbs","nuc/lib/handlebars"],function(e,i,t){var s=t.template({"compiler":[8,">= 4.3.0"],"main":function(e,i,t,s,n){var o=e.lookupProperty||function(e,i){if(Object.prototype.hasOwnProperty.call(e,i))return e[i]};return'<div class="'+e.escapeExpression(e.lambda(null!=i?o(i,"className"):i,i))+'" title="'+e.escapeExpression(e.lambda(null!=i?o(i,"title"):i,i))+'"\r\n     draggable="'+e.escapeExpression(e.lambda(null!=i?o(i,"draggable"):i,i))+'" tabindex= "-1">\r\n  <span>'+e.escapeExpression(e.lambda(null!=i?o(i,"title"):i,i))+'</span>\r\n  <div class="csui-layout-icon '+e.escapeExpression(e.lambda(null!=i?o(i,"iconClass"):i,i))+'"></div>\r\n</div>'}});return t.registerPartial("csui_perspective.manage_impl_list.item",s),s}),csui.define("hbs!csui/perspective.manage/impl/list",["module","hbs","nuc/lib/handlebars"],function(e,i,t){var s=t.template({"compiler":[8,">= 4.3.0"],"main":function(e,i,t,s,n){var o,a=e.lookupProperty||function(e,i){if(Object.prototype.hasOwnProperty.call(e,i))return e[i]};return'<div class="cs-header binf-panel-heading cs-header-with-go-back" role="link"\r\n     aria-label="'+e.escapeExpression((o=null!=(o=a(t,"goBackAria")||(null!=i?a(i,"goBackAria"):i))?o:e.hooks.helperMissing,"function"==typeof o?o.call(null!=i?i:e.nullContext||{},{"name":"goBackAria","hash":{},"loc":{"start":{"line":2,"column":17},"end":{"line":2,"column":31}}}):o))+'">\r\n  <span class="icon circular arrow_back cs-go-back" title="'+e.escapeExpression((o=null!=(o=a(t,"goBackTooltip")||(null!=i?a(i,"goBackTooltip"):i))?o:e.hooks.helperMissing,"function"==typeof o?o.call(null!=i?i:e.nullContext||{},{"name":"goBackTooltip","hash":{},"loc":{"start":{"line":3,"column":59},"end":{"line":3,"column":76}}}):o))+'"></span>\r\n</div>\r\n<div class="cs-content">\r\n  <div class="cs-list-group"></div>\r\n</div>\r\n'}});return t.registerPartial("csui_perspective.manage_impl_list",s),s}),csui.define("css!csui/perspective.manage/impl/pman.panel",[],function(){}),csui.define("csui/perspective.manage/impl/pman.panel.view",["require","module","csui/lib/jquery","csui/lib/backbone","csui/lib/underscore","csui/lib/marionette","csui/controls/progressblocker/blocker","csui/controls/tile/behaviors/perfect.scrolling.behavior","csui/perspective.manage/impl/widget.list.view","csui/perspective.manage/impl/perspectivelayouts","i18n!csui/perspective.manage/impl/nls/lang","hbs!csui/perspective.manage/impl/pman.panel","hbs!csui/perspective.manage/impl/list.item","hbs!csui/perspective.manage/impl/list","hbs!csui/perspective.manage/impl/widget.drag.template","css!csui/perspective.manage/impl/pman.panel"],function(e,i,t,s,n,o,a,r,l,c,p,d,u,g,h){"use strict";var m=o.ItemView.extend({"tagName":"div","template":d,"events":{"click @ui.layoutTab":"onTabClicked","keydown @ui.layoutTab":"onKeyDown"},"ui":{"tabPannel":".csui-tab-pannel","listPannel":".csui-list-pannel","layoutTab":".csui-layout-tab","widgetTab":".csui-widget-tab","template":".csui-widget-template"},"className":"csui-pman-panel","behaviors":{"PerfectScrolling":{"behaviorClass":r,"contentParent":".csui-tab-pannel, .csui-list-pannel","suppressScrollX":!0,"scrollYMarginOffset":8}},"templateHelpers":function(){return{"layoutTabTitle":p.layoutTabTitle,"widgetTabTitle":p.widgetTabTitle,"templateMessage":p.templateMessage}},"onPanelOpen":function(){this.accordionView.triggerMethod("init:widgets"),this.trigger("ensure:scrollbar")},"onRender":function(){this.ui.widgetTab.hide(),this.ui.layoutTab.hide(),this.accordionRegion=new o.Region({"el":this.ui.widgetTab}),this.accordionView=new l(this.options),this.accordionRegion.show(this.accordionView),this.blockActions(),this.listenTo(this.accordionView,"items:fetched",function(){this.unblockActions(),this.ui.layoutTab.show(),this.ui.widgetTab.show()}),this.listenTo(this.accordionView,"dom:refresh",function(){this.trigger("dom:refresh")})},"constructor":function(e){this.options=e||{},this.options.existsWidgetTypes=this._getExistsWidgetTypes()||[],o.ItemView.prototype.constructor.apply(this,arguments),a.imbue(this),this.listenTo(this,"reset:items",function(){this.listView&&this.listView.destroy()})},"_getExistsWidgetTypes":function(){var e=this.options.pmanView.perspective.get("perspective"),i=e.type,t={},s=[];return"flow"==i?(t=e.options,t.widgets.forEach(n.bind(function(e){e.type&&s.push(e.type)},this))):"left-center-right"==i&&(t=e.options,t.center&&s.push(t.center.type),t.right&&s.push(t.right.type),t.left&&s.push(t.left.type)),s},"onTabClicked":function(e){var i=e.data?e:{"data":{"items":c}};i.draggable=!!i.data.draggable,i.itemClassName="csui-layout-item",i.pmanView=this.options.pmanView,this.ui.tabPannel.addClass("binf-hidden"),this.listregion=new o.Region({"el":this.ui.listPannel}),this.listView=new v(i),this.listregion.show(this.listView),this.$el.find(".cs-go-back").attr("tabindex",0);var s=this.$el.find(".csui-layout-item.binf-active");t(s[0]).attr("tabindex",0),s.focus(),this.listenTo(this.listView,"before:destroy",function(){this.ui.tabPannel.removeClass("binf-hidden")}).listenTo(this.listView,"click:back",function(){this.listView.destroy()})},"onKeyDown":function(e){13!==e.keyCode&&32!==e.keyCode||this.onTabClicked(e)}}),f=o.ItemView.extend({"constructor":function(e){o.ItemView.prototype.constructor.apply(this,arguments)},"tagName":"div","template":u,"templateHelpers":function(){return{"draggable":!!this.options.draggable,"className":this.options.itemClassName,"iconClass":this.model.get("icon")}},"events":{"click .csui-layout-item:not(.binf-active)":n.debounce(function(){this.trigger("change:layout")},200,!0),"keydown .csui-layout-item":n.debounce(function(e){13===e.keyCode||32===e.keyCode?this.trigger("change:layout"):9===e.keyCode||16===e.keyCode?(this.$el.find(".csui-layout-item").attr("tabindex",-1),9===e.keyCode&&e.shiftKey?(e.preventDefault(),this.options.pmanView.$el.find(".cs-go-back").focus()):9===e.keyCode?(e.preventDefault(),t(this.options.pmanView.$el.find(".binf-btn.icon-save")).focus(),t(this.options.pmanView.$el.find(".csui-layout-item.binf-active")[0]).attr("tabindex",0)):e.shiftKey||t(this.options.pmanView.$el.find(".csui-layout-item.binf-active")[0]).attr("tabindex",0)):this.handleKeydown(e)},200,!0)},"handleKeydown":function(e){if(38===e.keyCode||40===e.keyCode)if(this.$el.find(".csui-layout-item").attr("tabindex",-1),e.preventDefault(),e.stopPropagation(),38===e.keyCode){var i=this.$el.prev().find(".csui-layout-item");i.length>0&&i.trigger("focus")}else if(40===e.keyCode){var t=this.$el.next().find(".csui-layout-item");t.length>0&&t.trigger("focus")}},"onRender":function(){this.model.get("type")===this.options.pmanView.perspective.get("perspective").type&&this.trigger("set:active")}}),v=o.CompositeView.extend({"constructor":function(e){if(e||(e={}),e.data||(e.data={}),this.behaviors&&n.any(this.behaviors,function(e,i){return e.behaviorClass===r})||(this.behaviors=n.extend({"PerfectScrolling":{"behaviorClass":r,"contentParent":".csui-pman-list","suppressScrollX":!0,"scrollYMarginOffset":15}},this.behaviors)),o.CompositeView.call(this,e),this.options.data&&this.options.data.items){if(!this.collection){var i=s.Collection.extend({"model":s.Model.extend({"idAttribute":null})});this.collection=new i}this.collection.add(this.options.data.items)}},"ui":{"back":".cs-go-back"},"className":"csui-pman-list","events":{"click @ui.back":"onClickBack","keydown @ui.back":"onKeyInView"},"childEvents":{"change:layout":"onChangeLayout","set:active":"setActive"},"template":g,"templateHelpers":function(){return{"goBackTooltip":p.goBackTooltip}},"childViewContainer":".cs-list-group","childView":f,"childViewOptions":function(){return this.options},"onClickBack":function(e){e.preventDefault(),e.stopPropagation(),this.trigger("click:back")},"onKeyInView":function(e){13===e.keyCode||32===e.keyCode?(this.onClickBack(e),this.options.pmanView.$el.find(".csui-layout-tab").focus()):9===e.keyCode&&(e.shiftKey||(e.preventDefault(),this.$el.find(".csui-layout-item.binf-active").focus()))},"setActive":function(e){
this.$el.find(".csui-layout-item").removeClass("binf-active"),e.$el.find(".csui-layout-item").addClass("binf-active")},"onChangeLayout":function(e){var i=this,t=e.model.get("type"),s=this.options.pmanView.perspective.get("perspective").type;"sidepanel-right"!==s&&"sidepanel-left"!==s||"sidepanel-right"!==t&&"sidepanel-left"!==t?csui.require(["csui/dialogs/modal.alert/modal.alert"],function(t){t.confirmWarning(p.changePageLayoutConfirmatonText,p.layoutTabTitle,{"buttons":{"showYes":!0,"labelYes":p.proceedButton,"showNo":!0,"labelNo":p.changeLayoutCancelButton}}).done(function(t){t&&(i.setActive(e),i.options.pmanView.trigger("change:layout",e.model.get("type")),i.options.pmanView.context.trigger("reset:widget:panel"))})}):(i.setActive(e),i.options.pmanView.trigger("swap:layout",t))}});return m}),csui.define("csui/perspectives/mixins/draganddrop.kn.mixin",["csui/lib/underscore","csui/lib/jquery","i18n"],function(e,i,t){"use strict";return{"mixin":function(s){return e.extend(s,{"moveToRight":function(e,i,s){function n(){e&&e.insertAfter(r),i&&i.trigger("focus"),o.swapIndexPositions(s,e.index(),r.index())}var o=this,a=t&&t.settings.rtl,r=e.next();r.length&&this.animation(e,r,!a,n)},"moveToLeft":function(e,i,s){function n(){e&&e.insertBefore(r),i&&i.trigger("focus"),o.swapIndexPositions(s,e.index(),r.index())}var o=this,a=t&&t.settings.rtl,r=e.prev();r.length&&this.animation(e,r,a,n)},"animation":function(e,t,s,n){var o=this.findPositions(e,t),a=o.destEle.top===o.movableEle.top,r=t.width(),l=e.width(),c=this,p=400;e.css("zIndex",99999),t.css("zIndex",99998),c.isAnimationInProgress&&(p=0,this.movableEleAnimate&&this.movableEleAnimate.stop(),this.destEleAnimate&&this.destEleAnimate.stop()),c.isAnimationInProgress=!0,this.movableEleAnimate=e.animate({"left":a&&s?r:o.destEle.left-o.movableEle.left,"top":a?0:o.destEle.top-o.movableEle.top},{"duration":p,"easing":"easeInOutCubic","queue":!1}),this.destEleAnimate=t.animate({"left":a?s?o.movableEle.left-o.destEle.left:l<r?l:r:o.movableEle.left-o.destEle.left,"top":a?0:o.movableEle.top-o.destEle.top},{"duration":p,"easing":"easeInOutCubic","queue":!1}),i.when(this.movableEleAnimate,this.destEleAnimate).always(function(){c.isAnimationInProgress=!1,e.css({"top":0,"left":0,"zIndex":"initial"}),t.css({"top":0,"left":0,"zIndex":"initial"}),n()})},"swapIndexPositions":function(e,i,t){var s=e[i];return e[i]=e[t],e[t]=s,e},"findPositions":function(e,i){return{"movableEle":e.offset(),"destEle":i.offset()}}})}}}),csui.define("hbs!csui/perspective.manage/impl/pman",["module","hbs","nuc/lib/handlebars"],function(e,i,t){var s=t.template({"1":function(e,i,t,s,n){var o=e.lookupProperty||function(e,i){if(Object.prototype.hasOwnProperty.call(e,i))return e[i]};return'          <li>\r\n            <button class="binf-btn icon-reset" title="'+e.escapeExpression(e.lambda(null!=i?o(i,"reset"):i,i))+'"\r\n                    aria-label="'+e.escapeExpression(e.lambda(null!=i?o(i,"resetAriaLabel"):i,i))+'">'+e.escapeExpression(e.lambda(null!=i?o(i,"reset"):i,i))+"</button>\r\n          </li>\r\n"},"compiler":[8,">= 4.3.0"],"main":function(e,i,t,s,n){var o,a=e.lookupProperty||function(e,i){if(Object.prototype.hasOwnProperty.call(e,i))return e[i]};return'<div class="pman-backdrop"></div>\r\n<div class="pman-header">\r\n  <div class="pman-header-backdrop"></div>\r\n  <div class="pman-tools-container">\r\n    <div class="pman-left-tools">\r\n      <ul>\r\n        <li class="pman-toolitem">\r\n          <button class="icon icon-toolbarAdd" title="'+e.escapeExpression(e.lambda(null!=i?a(i,"addWidget"):i,i))+'"></button>\r\n        </li>\r\n      </ul>\r\n      <div class="pman-pannel-wrapper"></div>\r\n    </div>\r\n    <div class="pman-right-tools">\r\n      <ul>\r\n'+(null!=(o=a(t,"if").call(null!=i?i:e.nullContext||{},null!=i?a(i,"personalizeMode"):i,{"name":"if","hash":{},"fn":e.program(1,n,0),"inverse":e.noop,"loc":{"start":{"line":15,"column":8},"end":{"line":20,"column":15}}}))?o:"")+'        <li>\r\n          <button class="binf-btn icon-save" title="'+e.escapeExpression(e.lambda(null!=i?a(i,"save"):i,i))+'"\r\n                  aria-label="'+e.escapeExpression(e.lambda(null!=i?a(i,"saveAriaLabel"):i,i))+'">'+e.escapeExpression(e.lambda(null!=i?a(i,"save"):i,i))+'</button>\r\n        </li>\r\n        <li>\r\n          <button class="binf-btn cancel-edit" title="'+e.escapeExpression(e.lambda(null!=i?a(i,"cancel"):i,i))+'"\r\n                  aria-label="'+e.escapeExpression(e.lambda(null!=i?a(i,"cancelAriaLabel"):i,i))+'">'+e.escapeExpression(e.lambda(null!=i?a(i,"cancel"):i,i))+'</button>\r\n        </li>\r\n      </ul>\r\n    </div>\r\n  </div>\r\n  <div class="pman-trash-area">\r\n    <div class="pman-trash-banner"></div>\r\n  </div>\r\n</div>'}});return t.registerPartial("csui_perspective.manage_impl_pman",s),s}),csui.define("css!csui/perspective.manage/impl/pman",[],function(){}),csui.define("csui/perspective.manage/behaviours/impl/nls/lang",{"root":!0,"en-us":!1,"en":!1}),csui.define("csui/perspective.manage/behaviours/impl/nls/root/lang",{"deleteConfirmMsg":"Widget will be removed from the page.","deleteConfirmTitle":"Remove Widget","replaceConfirmMsg":"Do you want to replace this widget?","replaceConfirmTitle":"Replace Widget","widgetSizeTitle":"Widget size","widgetSizeDescription":"Determines how much space the widget occupies. Note that widgets are re-sized automatically to display optimally on smaller screens.","removeWidget":"Remove widget","editWidget":"Widget settings","replace":"Replace","remove":"Remove","cancel":"Cancel","configNeeded":"Configuration needed.","hideWidget":"Hide","showWidget":"Display","personalizeModewidgetFocusLabel":"{0} widget. Press Enter to access {1} action. Press Ctrl+ Right or Left Arrow to move the widget to the right or left .","personalizeShortcutwidgetFocusLabel":"{0}. Press Enter to access {1} action. Press Ctrl+ Right or Left Arrow to move the widget to the right or left .","editModewidgetFocusLabel":"{0} widget. Press Enter to access associated actions. Press Ctrl+ Right or Left  Arrow to move the widget to the right or left.","widgetSettings":"{0} widget settings","objects":"{0} widget shows {0} objects of the current user","delete":"remove {0} Widget","hideWidgetAriaLabel":"Hide {0} Widget","showWidgetriaLabel":"Display {0} Widget","info":"Info about {0}"}),csui.define("hbs!csui/perspective.manage/behaviours/impl/widget.masking",["module","hbs","nuc/lib/handlebars"],function(e,i,t){var s=t.template({"1":function(e,i,t,s,n){var o,a=e.lookupProperty||function(e,i){if(Object.prototype.hasOwnProperty.call(e,i))return e[i]};return'    <div class="csui-pman-widget-error">\r\n      <div class="csui-pman-widget-error-heading"> '+e.escapeExpression((o=null!=(o=a(t,"widgetTitle")||(null!=i?a(i,"widgetTitle"):i))?o:e.hooks.helperMissing,"function"==typeof o?o.call(null!=i?i:e.nullContext||{},{"name":"widgetTitle","hash":{},"loc":{"start":{"line":7,"column":51},"end":{"line":7,"column":66}}}):o))+'</div>\r\n      <div class="csui-pman-widget-error-body">\r\n        <div class="csui-pman-widget-error-icon"></div>\r\n        <div class="csui-pman-widget-error-message"> '+e.escapeExpression((o=null!=(o=a(t,"configNeeded")||(null!=i?a(i,"configNeeded"):i))?o:e.hooks.helperMissing,"function"==typeof o?o.call(null!=i?i:e.nullContext||{},{"name":"configNeeded","hash":{},"loc":{"start":{"line":10,"column":53},"end":{"line":10,"column":69}}}):o))+'</div>\r\n      </div>\r\n    </div>\r\n    <div class="csui-pman-perspective-actions">\r\n      <button class="csui-pman-perspective-btn csui-pman-widget-edit icon-edit"\r\n              title="'+e.escapeExpression((o=null!=(o=a(t,"editWidget")||(null!=i?a(i,"editWidget"):i))?o:e.hooks.helperMissing,"function"==typeof o?o.call(null!=i?i:e.nullContext||{},{"name":"editWidget","hash":{},"loc":{"start":{"line":15,"column":21},"end":{"line":15,"column":35}}}):o))+'"></button>\r\n      <button class="csui-pman-perspective-btn csui-pman-widget-close clear-icon"\r\n              title="'+e.escapeExpression((o=null!=(o=a(t,"removeWidget")||(null!=i?a(i,"removeWidget"):i))?o:e.hooks.helperMissing,"function"==typeof o?o.call(null!=i?i:e.nullContext||{},{"name":"removeWidget","hash":{},"loc":{"start":{"line":17,"column":21},"end":{"line":17,"column":37}}}):o))+'"></button>\r\n    </div>\r\n'},"3":function(e,i,t,s,n){var o,a,r=e.lookupProperty||function(e,i){if(Object.prototype.hasOwnProperty.call(e,i))return e[i]};return'    <div class="csui-pman-widget-personalize-mask text-center">\r\n      <button class="binf-btn csui-pman-personalize-btn csui-pman-hide-show-toggle"\r\n              title="'+e.escapeExpression((a=null!=(a=r(t,"hideShowToggle")||(null!=i?r(i,"hideShowToggle"):i))?a:e.hooks.helperMissing,"function"==typeof a?a.call(null!=i?i:e.nullContext||{},{"name":"hideShowToggle","hash":{},"loc":{"start":{"line":22,"column":21},"end":{"line":22,"column":39}}}):a))+'"\r\n'+(null!=(o=r(t,"if").call(null!=i?i:e.nullContext||{},null!=i?r(i,"isWidgetHidden"):i,{"name":"if","hash":{},"fn":e.program(4,n,0),"inverse":e.program(6,n,0),"loc":{"start":{"line":23,"column":8},"end":{"line":27,"column":15}}}))?o:"")+"      >"+e.escapeExpression((a=null!=(a=r(t,"hideShowToggle")||(null!=i?r(i,"hideShowToggle"):i))?a:e.hooks.helperMissing,"function"==typeof a?a.call(null!=i?i:e.nullContext||{},{"name":"hideShowToggle","hash":{},"loc":{"start":{"line":28,"column":7},"end":{"line":28,"column":25}}}):a))+"\r\n      </button>\r\n    </div>\r\n"},"4":function(e,i,t,s,n){var o,a=e.lookupProperty||function(e,i){if(Object.prototype.hasOwnProperty.call(e,i))return e[i]};return'              aria-label="'+e.escapeExpression((o=null!=(o=a(t,"showWidgetriaLabel")||(null!=i?a(i,"showWidgetriaLabel"):i))?o:e.hooks.helperMissing,"function"==typeof o?o.call(null!=i?i:e.nullContext||{},{"name":"showWidgetriaLabel","hash":{},"loc":{"start":{"line":24,"column":26},"end":{"line":24,"column":48}}}):o))+'"\r\n'},"6":function(e,i,t,s,n){var o,a=e.lookupProperty||function(e,i){if(Object.prototype.hasOwnProperty.call(e,i))return e[i]};return'              aria-label="'+e.escapeExpression((o=null!=(o=a(t,"hideWidgetAriaLabel")||(null!=i?a(i,"hideWidgetAriaLabel"):i))?o:e.hooks.helperMissing,"function"==typeof o?o.call(null!=i?i:e.nullContext||{},{"name":"hideWidgetAriaLabel","hash":{},"loc":{"start":{"line":26,"column":26},"end":{"line":26,"column":49}}}):o))+'"\r\n'},"compiler":[8,">= 4.3.0"],"main":function(e,i,t,s,n){var o,a,r=e.lookupProperty||function(e,i){if(Object.prototype.hasOwnProperty.call(e,i))return e[i]};return'<div class="csui-pman-popover-right csui-pman-popover-holder"></div>\r\n<div class="csui-pman-popover-left csui-pman-popover-holder"></div>\r\n<button class="binf-btn wrapper-button" aria-label="'+e.escapeExpression((a=null!=(a=r(t,"widgetName")||(null!=i?r(i,"widgetName"):i))?a:e.hooks.helperMissing,"function"==typeof a?a.call(null!=i?i:e.nullContext||{},{"name":"widgetName","hash":{},"loc":{"start":{"line":3,"column":52},"end":{"line":3,"column":66}}}):a))+'"></button>\r\n<div class="csui-pman-widget-masking">\r\n'+(null!=(o=r(t,"if").call(null!=i?i:e.nullContext||{},null!=i?r(i,"isEditMode"):i,{"name":"if","hash":{},"fn":e.program(1,n,0),"inverse":e.program(3,n,0),"loc":{"start":{"line":5,"column":2},"end":{"line":31,"column":9}}}))?o:"")+"</div>\r\n\r\n"}});return t.registerPartial("csui_perspective.manage_behaviours_impl_widget.masking",s),s}),csui.define("css!csui/perspective.manage/behaviours/impl/widget.masking",[],function(){}),csui.define("csui/perspective.manage/behaviours/pman.widget.config.behaviour",["require","i18n","csui/lib/underscore","csui/lib/jquery","csui/lib/marionette","csui/utils/base","csui/lib/backbone","csui/utils/log","csui/models/widget/widget.model","csui/perspective.manage/impl/options.form.view","i18n!csui/perspective.manage/behaviours/impl/nls/lang","hbs!csui/perspective.manage/behaviours/impl/widget.masking","csui/utils/perspective/perspective.util","css!csui/perspective.manage/behaviours/impl/widget.masking"],function(e,i,t,s,n,o,a,r,l,c,p,d,u){"use strict";var g={"removeConfirmMsg":p.deleteConfirmMsg,"removeConfirmTitle":p.deleteConfirmTitle,"configNeededMessage":p.configNeeded,"confirmOnRemove":!0,"allowReplace":!0,"notifyUpdatesImmediatly":!1,"perspectiveMode":"edit"},h=n.ItemView.extend({"template":d,"className":function(){var e=[h.className,"csui-widget-focusable"];return e.push("csui-pman-widget-mode-"+this.options.perspectiveMode),e.push(this._getStateClass()),t.unique(e).join(" ")},"_getStateClass":function(){return"csui-pman-widget-state-"+(u.isHiddenWidget(this.options.widgetConfig)?"hidden":"shown")},"templateHelpers":function(){var e=u.isHiddenWidget(this.options.widgetConfig)?p.showWidget:p.hideWidget;return{"removeWidget":this.options.removeConfirmTitle,"editWidget":p.editWidget,"widgetTitle":this.manifest&&this.manifest.title,"configNeeded":this.options.configNeededMessage,"isEditMode":this.isEditPage(),"isWidgetHidden":u.isHiddenWidget(this.options.widgetConfig),"hideShowToggle":e,"widgetName":this._getWidgetName(),"hideWidgetAriaLabel":t.str.sformat(p.hideWidgetAriaLabel,this._getWidgetName()),"showWidgetriaLabel":t.str.sformat(p.showWidgetriaLabel,this._getWidgetName())}},"ui":{"edit":".csui-pman-widget-edit","delete":".csui-pman-widget-close","masking":".csui-pman-widget-masking","widgetTitle":".csui-pman-widget-error-heading","wrapperButton":".wrapper-button","hideShowToggle":".csui-pman-hide-show-toggle"},"configureEvents":{"click @ui.masking":"_showCallout","click @ui.delete":"onDeleteClick"},"personalizationEvents":{"click @ui.hideShowToggle":"_onHideShowWidget"},"events":function(){var e={"keydown":"onKeyDown","click @ui.wrapperButton":"_onClicked"};switch(this.options.perspectiveMode){case"edit":e=t.extend(e,this.configureEvents),this.options.allowReplace&&(e=t.extend(e,{"drop":"onDrop","dragover":"onDragOver","dragenter":"onDragEnter","dragleave":"onDragLeave"}));break;case"personalize":e=t.extend(e,this.personalizationEvents),this.options.personalizable&&(e=t.extend(e,this.configureEvents))}return e},"constructor":function(e){e=t.defaults(e,g),n.ItemView.apply(this,arguments),this.dropCounter=0,this.manifest=e.manifest,this.perspectiveView=e.perspectiveView,this.widgetView=e.widgetView,this.widgetConfig=e.widgetConfig,this.perspectiveMode=e.perspectiveMode,this.listenTo(this.widgetView,"refresh:mask",this._doRefreshMask),this.listenTo(this.widgetView,"reposition:flyout",function(){this.$popoverEl&&this.$popoverEl.data("binf.popover")&&(this._previousFocusElm=document.activeElement,this.$popoverEl.binf_popover("show"),this.options.notifyUpdatesImmediatly&&this._previousFocusElm&&s(this._previousFocusElm).trigger("focus"))})},"_onClicked":function(e){return!s(e.target).is(this.$el.find(".wrapper-button"))||(this._enterConfiguration(e),!1)},"handlePopoverClick":function(e){e.data.view.writeFieldClicked=!0},"onKeyDown":function(e){var i=!0,t=s(e.target),n=this.optionsFormView&&this.optionsFormView.$el.has(t).length,a=s(".perspective-editing .pman-header .cancel-edit"),r=s(".perspective-editing .cs-perspective-panel .cs-perspective"),l=o.isMacintosh();switch((l&&e.metaKey&&!e.ctrlKey||!l&&!e.metaKey&&e.ctrlKey)&&(t.is("input:text")||t.is("textarea"))&&e.stopPropagation(),!this.widgetView.$el.find(".binf-popover").length&&o.clearFocusables(r.find(".tile, .csui-nodestable")),e.keyCode){case 13:case 32:i=t.is(this.ui.hideShowToggle)?this._onHideShowWidget():this._onClicked(e);break;case 27:n?(this._hideCallout(),this.options.useEnterToConfigure||(this.ui.edit&&this.ui.edit.trigger("focus"),i=!1)):this.options.useEnterToConfigure||t.is(this.$el.find(".wrapper-button"))||(this._exitConfiguration(),i=!1);break;case 9:if(n||this.perspectiveMode!==u.MODE_EDIT_PERSPECTIVE)e.shiftKey&&t.is(s(".wrapper-button").first())&&(a.trigger("focus"),i=!1);else{var t=s(e.target);t.is(this.$el.find(".wrapper-button"))||(this.ui.delete.is(":focus")?this.ui.edit.trigger("focus"):this.ui.delete.trigger("focus"),i=!1)}if(e.shiftKey&&t.is(s(".wrapper-button"))){var c=s(document.activeElement).closest(".csui-draggable-item.csui-pman-editable-widget").index(),p=s(".csui-dnd-container>.csui-pman-editable-widget"),d=p.eq(c-1).offset().top;if(p.eq(c).offset().top!==d){var g=c<0?0:d-s(".pman-header").height();s("html, body").animate({"scrollTop":g},0)}}break;default:(t.is(".csui-pman-perspective-btn")||t.is(".csui-pman-personalize-btn"))&&(i=!1)}return i},"_enterConfiguration":function(e){this.$el.addClass("csui-pman-widget-active"),this.options.useEnterToConfigure?this._showCallout(e):this.$el.find("button:not(.wrapper-button):visible")&&this.$el.find("button:not(.wrapper-button):visible").first().trigger("focus")},"_exitConfiguration":function(){this.$el.removeClass("csui-pman-widget-active"),this.ui.wrapperButton.trigger("focus"),this._hideCallout()},"_getWidgetName":function(){return this.manifest&&this.manifest.title?this.manifest.title:this.options&&this.options.widgetConfig&&this.options.widgetConfig.type.split("/").pop()},"_clearViewTabIndexes":function(){function e(){var e=u.isHiddenWidget(i.options.widgetConfig);!i.widgetView.$el.find(".binf-popover").length&&o.clearFocusables(i.widgetView.$el);var s=i.$el.find(".wrapper-button"),n=i._getWidgetName(),a=i.options.notifyUpdatesImmediatly;if(i.options.ItemsInGroupAriaLabel&&(n=" "+i.options.ItemsInGroupAriaLabel,s=s.closest(".csui-draggable-item").children(".csui-pman-widget-mode-personalize").find(".wrapper-button")),"edit"!==i.options.perspectiveMode||a){e&&s.attr("data-hidden",e);var r=s.attr("data-hidden")?p.showWidget:p.hideWidget,l=a?p.personalizeShortcutwidgetFocusLabel:p.personalizeModewidgetFocusLabel;n=t.str.sformat(l,n,r)}else n=t.str.sformat(p.editModewidgetFocusLabel,n);s.attr("tabindex",0).attr("aria-label",n)}this.widgetView.$el.off();var i=this;this.listenTo(this.widgetView,"dom:refresh",e),e()},"_isConfigurable":function(){return!!this.widgetConfig&&!t.isEmpty(this.widgetConfig)&&this.widgetConfig.type!==h.placeholderWidget&&"csui/widgets/error"!==this.widgetConfig.type},"isEditPage":function(){return this.perspectiveMode===u.MODE_EDIT_PERSPECTIVE},"onRender":function(){if(!this._isConfigurable())return void this._clearViewTabIndexes();var e=this;this._loadManifest().done(function(i){var s=i.hasConfigForm?"csui-widget-perspective-config":"csui-widget-perspective-info";e.$el.addClass(s),"edit"===e.options.perspectiveMode&&(e.$el.parent().find(".cs-no-expanding").length?e.ui.edit.attr("aria-label",t.str.sformat(p.objects,i.title)).attr("title",t.str.sformat(p.info,i.title)):e.ui.edit.attr("aria-label",t.str.sformat(p.widgetSettings,i.title)),e.ui.delete.attr("aria-label",t.str.sformat(p.delete,i.title))),e.ui.widgetTitle.text(i.title),e.manifest.selfConfigurable?e._adoptToSelfConfigurableWidget():e.isEditPage()||e.options.personalizable?(e._clearViewTabIndexes(),e._createOptionsForm(function(){if(!this.isDestroyed){var t=!!e.widgetConfig.options&&(e.widgetConfig.options.___pman_isdropped||e.widgetConfig.options.___pman_opencallout),s=e._updateWidgetOptions(!1,!0);e.optionsFormView.refresh(function(){e.$el.addClass("cs-pman-callout-ready"),e.$el.addClass("cs-pman-config-ready"),t&&!s&&e._showOptionsCallout(i,!0)})}})):(e.$el.addClass("cs-pman-config-ready"),e._clearViewTabIndexes())})},"onDestroy":function(){this.optionsFormView&&this.optionsFormView.destroy()},"_adoptToSelfConfigurableWidget":function(){if(!u.isEmptyPlaceholder(this.widgetConfig,this.perspectiveMode)&&this.perspectiveMode===u.MODE_PERSONALIZE&&!u.isPersonalWidget(this.widgetConfig))return void this._clearViewTabIndexes();this.$el.addClass("csui-has-editing-capability"),delete this.widgetConfig.options.___pman_isdropped,this.listenTo(this.widgetView,"update:widget:options",function(e){delete this.widgetConfig.options.___pman_isdropped,this._notifyConfigChanges(e,e.isValid,!1)}),this.listenTo(this.widgetView,"remove:widget",this._doDeleteWidget),this.listenTo(this.widgetView,"replace:widget",this.onDrop)},"_doRefreshMask":function(e){this.options=t.extend({},this.options,g,e),this.ui.delete.attr("title",this.options.removeConfirmTitle)},"_showCallout":function(e){this.isDestroyed||this._isConfigurable()&&(e.preventDefault(),e.stopPropagation(),this.ui.delete.is(e.target)||(this._loadManifest().done(function(e){this._showOptionsCallout(e)}.bind(this)),s(".perspective-editing .cs-perspective-panel .cs-field-write").off("click."+this.cid).on("mousedown."+this.cid,{"view":this},this.handlePopoverClick)))},"_showOptionsCallout":function(e,i){if(!this.isDestroyed){if(o.isIE11()&&document.activeElement&&document.activeElement.blur(),this.$popoverEl&&this.$popoverEl.data("binf.popover"))return void this.$popoverEl.binf_popover("destroy");this.$el.closest(".cs-perspective").find(".binf-popover").length&&(this._closePopover(),!i)||(this._calculatePopoverPlacement(),this.optionsFormView?this._showPopover():this._createOptionsForm())}},"_closePopover":function(){this.$el.closest(".cs-perspective").find("."+h.className+" .csui-pman-popover-holder").binf_popover("destroy")},"_createOptionsForm":function(e){this.optionsFormView=new c(t.defaults({"context":this.perspectiveView.options.context,"manifest":this.manifest},this.options)),e&&this.optionsFormView.listenToOnce(this.optionsFormView,"render:form",e),this.optionsFormView.render(),this.optionsFormView.listenTo(this.optionsFormView,"change:field",this._onChangeField.bind(this))},"_calculatePopoverPlacement":function(){var e=this._determineCalloutPlacement();this.$popoverEl=this.$el.find(".csui-pman-popover-"+e.placement),e.mirror&&(e.placement="right"==e.placement?"left":"right"),this.placement=e.placement,this.$popoverContainer=s('<div class="binf-popover pman-widget-popover pman-ms-popover" role="tooltip" tabindex=0><div class="binf-arrow"></div><h3 class="binf-popover-title"></h3><div class="binf-popover-content"></div></div>'),this.$popoverContainer.css("max-width",e.availableSpace+"px")},"_showPopover":function(){var e={"html":!0,"content":this.optionsFormView.el,"trigger":"manual","viewport":{"selector":this.options.perspectiveView&&this.options.perspectiveView.$el.parent()[0],"padding":18},"placement":this.placement,"template":this.$popoverContainer,"animation":!1};this.$popoverEl.binf_popover(e),this.$popoverEl.off("hidden.binf.popover").on("hidden.binf.popover",this._handleCalloutHide.bind(this)),this.$popoverEl.binf_popover("show"),this.optionsFormView.onPopoverShow(this.$popoverContainer),this.optionsFormView.$el.find(".cs-formview-wrapper").trigger("refresh:setcontainer"),this._registerPopoverEvents(),this.optionsFormView.trigger("ensure:scrollbar");var i=this.$popoverEl.next(".binf-popover"),n=t.uniqueId("popoverLabelId"),o=i.find(">.binf-popover-title");o&&(o.attr("id",n),o.html(this.manifest.title),i.attr("aria-labelledby",n)),s(".perspective-editing .cs-perspective-panel .cs-field-write").on("keydown."+this.cid).on("mousedown."+this.cid,{"view":this},this.handlePopoverClick)},"_hideCallout":function(){this.$popoverEl&&this.$popoverEl.binf_popover("destroy"),s(".perspective-editing .cs-perspective-panel .cs-field-write").off("keydown."+this.cid).off("mousedown."+this.cid)},"_registerPopoverEvents":function(){s(".perspective-editing .cs-perspective-panel").off("click."+this.cid).on("click."+this.cid,{"view":this},this._documentClickHandler),s(".pman-container").off("click."+this.cid).on("click."+this.cid,{"view":this},this._documentClickHandler),s(window).off("click."+this.cid).on("resize."+this.cid,{"view":this},this._windowResizeHandler)},"_windowResizeHandler":function(e){e.data.view._hideCallout()},"_unregisterPopoverEvents":function(){s(".perspective-editing .cs-perspective-panel").off("click."+this.cid,this._documentClickHandler),s(".pman-container").off("click."+this.cid,this._documentClickHandler),s(window).off("resize."+this.cid,this._windowResizeHandler)},"_handleCalloutHide":function(){this._validateWidgetConfig(),this._unregisterPopoverEvents(),delete this.widgetConfig.options.___pman_opencallout,this._updateWidgetOptions(!0),this._enableorDisableSaveButton()},"_validateWidgetConfig":function(){var e=this.optionsFormView.getValues(),i=this.optionsFormView.validate();t.isFunction(this.widgetView.validateConfiguration)&&(i=i&&this.widgetView.validateConfiguration(e));var s=i?"removeClass":"addClass";this.$el[s]("binf-perspective-has-error")},"_enableorDisableSaveButton":function(){var e=s(".perspective-editing .pman-header .icon-save"),i=s(".perspective-editing").find(".binf-perspective-has-error").length>0;e.prop("disabled",i)},"_updateWidgetOptions":function(e,i){var s=this.optionsFormView.validate(),n=this.optionsFormView.getValues();i=t.isUndefined(i)?!e:i;var o=this._notifyConfigChanges(n,s,e,i);return this._enableorDisableSaveButton(),o},"_notifyConfigChanges":function(e,i,s,n){e=e||{};var o=this.widgetConfig.options||{},a=t.isEqual(o,e);if(this.perspectiveView.trigger("update:widget:options",{"widgetView":this.widgetView,"isValid":i,"options":e,"softUpdate":n}),!a&&i&&!this.manifest.callback&&(s||o.___pman_isdropped)){var r=this.widgetConfig.type;if(this._isPreviewWidget()){r=this.widgetConfig.options.widget.id}o.___pman_isdropped&&(e=t.extend({"___pman_opencallout":o.___pman_isdropped},e));var l={"type":r,"kind":this.widgetConfig.kind,"options":e,"cid":t.uniqueId("pman")};return this.perspectiveView.trigger("replace:widget",this.widgetView,l),!0}},"_documentClickHandler":function(e){var i=e.data.view;return s(e.target).closest(".binf-popover").length||i.writeFieldClicked?void(i.writeFieldClicked=!1):n.isNodeAttached(e.target)?void(i.$el.is(e.target)||i.$el.has(e.target).length&&!i.ui.delete.is(e.target)||i.widgetView.$el.is(e.target)||i.widgetView.$el.has(e.target).length||(i._unregisterPopoverEvents(),i._hideCallout())):void i.widgetView.trigger("reposition:flyout")},"_onChangeField":function(e){e.name===c.widgetSizeProperty?(this.perspectiveView.trigger("update:widget:size",this.options.widgetView,e.value),this.$popoverEl.binf_popover("destroy")):this.options.notifyUpdatesImmediatly&&(this._updateWidgetOptions(!1,!1),this.widgetView.trigger("reposition:flyout"))},"_evalRequiredFormWidth":function(){this.optionsFormView.$el.addClass("pman-prerender-form"),this.optionsFormView.$el.addClass("pman-widget-popover"),this.optionsFormView.$el.appendTo(document.body),this.optionsFormView.$el.find(".cs-formview-wrapper").trigger("refresh:setcontainer");var e=this.optionsFormView.$el.width();return this.optionsFormView.$el.find(".csui-scrollablecols").length>0&&(e+=this.optionsFormView.$el.find(".csui-scrollablecols")[0].scrollWidth-this.optionsFormView.$el.find(".csui-scrollablecols")[0].offsetWidth),this.optionsFormView.$el.removeClass("pman-widget-popover"),e},"_calculateSpaceAroundWidget":function(){var e=(this.$el.width(),s(document).width()),i=this.$el.find(".csui-pman-popover-left").offset().left,t=e-this.$el.find(".csui-pman-popover-right").offset().left;return{"right":{"placement":"right","mirror":!1,"availableSpace":t},"rightFlip":{"placement":"right","mirror":!0,"availableSpace":e-t},"left":{"placement":"left","mirror":!1,"availableSpace":i},"leftFlip":{"placement":"left","mirror":!0,"availableSpace":e-i}}},"_determineCalloutPlacement":function(){var e,t,s,n=i&&i.settings.rtl,o=this._evalRequiredFormWidth()+20,a=this._calculateSpaceAroundWidget(),r=n?[a.rightFlip,a.leftFlip,a.left,a.right]:[a.right,a.left,a.leftFlip,a.rightFlip];for(e=0;e<r.length;e++){var l=r[e];if(o<l.availableSpace){t=l;break}(!s||l.availableSpace>s.availableSpace)&&(s=l)}return t||(t=s),t.availableSpace-=20,t},"_isPreviewWidget":function(){return this.widgetConfig.type===h.perspectiveWidget},"_addMoreManifestInfo":function(){var e=!0;this.manifest&&this.manifest.schema&&this.manifest.schema.properties&&!t.isEmpty(this.manifest.schema.properties)||(e=!1),this.manifest.hasConfigForm=e},"_loadManifest":function(){if(void 0!==this.manifest)return this._addMoreManifestInfo(),s.Deferred().resolve(this.manifest);if(this._isPreviewWidget())return this.manifest=this.widgetConfig.options.widget.get("manifest"),this._loadManifest();var e=s.Deferred(),i=new l({"id":this.widgetConfig.type});return i.fetch().then(t.bind(function(){this.manifest=i.get("manifest"),this._addMoreManifestInfo(),e.resolve(this.manifest)},this),function(i){e.reject(i)}),e.promise()},"onDeleteClick":function(e){if(this._closePopover(),e.preventDefault(),this.options.confirmOnRemove){var i=this,t=this.$el.parents(".csui-draggable-item.csui-pman-editable-widget").index();csui.require(["csui/dialogs/modal.alert/modal.alert"],function(e){e.confirmQuestion(i.options.removeConfirmMsg,i.options.removeConfirmTitle,{"buttons":{"showYes":!0,"labelYes":p.remove,"showNo":!0,"labelNo":p.cancel}}).always(function(e){e?(i._doDeleteWidget(),i._doSpecificWidgetFocusble(t)):i.ui.delete.trigger("focus")})})}else this._doDeleteWidget()},"_doSpecificWidgetFocusble":function(e){s(".csui-dnd-container>.csui-pman-editable-widget").eq(e).children(".csui-widget-focusable").find(".wrapper-button").trigger("focus")},"_doDeleteWidget":function(){this.perspectiveView.trigger("delete:widget",this.widgetView),this.perspectiveView.options.context.trigger("update:widget:panel",{"action":"delete","widgetModel":this.widgetView.model.get("widget")}),this._enableorDisableSaveButton()},"_doReplaceWidget":function(e,i){var s=e.get("manifest")||{},n={"type":e.id,"kind":s.kind};u.isEligibleForLiveWidget(s)||(n={"type":h.perspectiveWidget,"kind":s.kind,"options":{"options":{},"widget":e}}),n.options=t.extend({"___pman_isdropped":!0},n.options),this.perspectiveView.trigger("replace:widget",this.widgetView,n),this.perspectiveView.options.context.trigger("update:widget:panel",{"action":i?"replace":"add","widgetModel":n,"oldWidgetModel":i})},"onDragOver":function(e){e.preventDefault()},"onDragEnter":function(e){e.preventDefault(),this.dropCounter++,this.$el.siblings(".csui-perspective-placeholder").addClass("csui-widget-drop")},"onDragLeave":function(){0===--this.dropCounter&&this.$el.siblings(".csui-perspective-placeholder").removeClass("csui-widget-drop")},"_extractWidgetToDrop":function(e){var i=e.originalEvent.dataTransfer.getData("text");if(i)try{return new l(JSON.parse(i))}catch(e){return!1}},"onDrop":function(e){e.preventDefault(),this.onDragLeave();var i=this._extractWidgetToDrop(e);if(i)if(this.widgetConfig.type===h.placeholderWidget)this._doReplaceWidget(i);else{var t=this;csui.require(["csui/dialogs/modal.alert/modal.alert"],function(e){e.confirmQuestion(p.replaceConfirmMsg,p.replaceConfirmTitle,{"buttons":{"showYes":!0,"labelYes":p.replace,"showNo":!0,"labelNo":p.cancel}}).done(function(e){e&&t._doReplaceWidget(i,t.widgetConfig)})})}},"_updateStyles":function(){var e=t.result(this,"className");this.$el.attr("class",e)},"_updateConfigChanges":function(e){this.$el.removeClass(this._getStateClass()),u.setWidgetHidden(this.widgetConfig,e),this._notifyConfigChanges(this.widgetConfig.options,!0,!1),this.$el.addClass(this._getStateClass())},"_onHideShowWidget":function(){var e;return u.isHiddenWidget(this.options.widgetConfig)?(this.perspectiveView.trigger("before:show:widget",this.widgetView),this._updateConfigChanges(!1),this.perspectiveView.trigger("show:widget",this.widgetView),e=p.hideWidget,this.ui.hideShowToggle.attr("aria-label",t.str.sformat(p.hideWidgetAriaLabel,this._getWidgetName())).attr("title",e).text(e)):(this.perspectiveView.trigger("before:hide:widget",this.widgetView),this._updateConfigChanges(!0),this.perspectiveView.trigger("hide:widget",this.widgetView),e=p.showWidget,this.ui.hideShowToggle.attr("aria-label",t.str.sformat(p.showWidgetriaLabel,this._getWidgetName())).attr("title",e).text(e)),this.$el.find(".wrapper-button").attr("aria-label",t.str.sformat(p.personalizeModewidgetFocusLabel,this._getWidgetName(),e)),!1}},{"className":"csui-configure-perspective-widget","perspectiveWidget":"csui/perspective.manage/widgets/perspective.widget",
"placeholderWidget":"csui/perspective.manage/widgets/perspective.placeholder","widgetSizeProperty":"__widgetSize"});return n.Behavior.extend({"defaults":{"perspectiveSelector":".perspective-editing .cs-perspective > div"},"constructor":function(e,i){e||(e={}),e.perspectiveView=e.perspectiveView||i,this.perspectiveView=e.perspectiveView,n.Behavior.prototype.constructor.apply(this,arguments),this.view=i,t.extend(this.perspectiveView,{"getPManPlaceholderWidget":function(){return{"type":h.placeholderWidget,"options":{}}}})},"_ensureWidgetElement":function(){if(t.isObject(this.$widgetEl)||(this.$widgetEl=this.options.el?s(this.options.el):this.view.$el),!this.$widgetEl||0===this.$widgetEl.length)throw new n.Error('An "el" '+this.$widgetEl.selector+" must exist in DOM");return!0},"_checkAndApplyMask":function(){if(this._ensureWidgetElement(),!(this.$widgetEl.children("."+h.className).length>0)){var e=this._resolveWidgetConfiguration();if(!e)throw new n.Error({"name":"NoWidgetConfigurationError","message":'A "widgetConfig" must be specified'});this.maskingView&&this.$widgetEl.has(this.maskingView.$el).length&&t.isEqual(e,this.options.widgetConfig)||(this.maskingView&&this.maskingView.destroy(),this.maskingView=new h(t.extend(this.options,{"widgetView":this.view,"widgetConfig":e})),this.maskingView.render(),this.$widgetEl.append(this.maskingView.el),this.$widgetEl.addClass("csui-pman-editable-widget"),this.$widgetEl.data("pman.widget",{"attributes":{"manifest":e}}),e.type===h.placeholderWidget&&this.$widgetEl.removeClass("csui-draggable-item"))}},"_resolveWidgetConfiguration":function(){return this.view.model&&this.view.model.get("widget")?this.view.model.get("widget"):this.view.getPManWidgetConfig&&t.isFunction(this.view.getPManWidgetConfig)?this.view.getPManWidgetConfig():this.options.widgetConfig?t.result(this.options,"widgetConfig"):void 0},"onRender":function(){this.options.notifyUpdatesImmediatly&&this.view.isUpdating||(this._checkAndApplyMask(),this.maskingView&&this.maskingView._enableorDisableSaveButton())},"onDestroy":function(){this.maskingView&&this.maskingView.destroy(),this.maskingView=void 0}})}),csui.define("csui/perspective.manage/pman.view",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/lib/marionette","csui/utils/base","csui/utils/non-emptying.region/non-emptying.region","csui/perspective.manage/impl/pman.panel.view","csui/utils/perspective/perspective.util","csui/utils/contexts/factories/application.scope.factory","csui/utils/contexts/factories/node","csui/utils/contexts/factories/user","csui/models/perspective/personalization.model","csui/perspectives/mixins/draganddrop.kn.mixin","i18n!csui/perspective.manage/impl/nls/lang","hbs!csui/perspective.manage/impl/pman","i18n","css!csui/perspective.manage/impl/pman","csui/perspective.manage/behaviours/pman.widget.config.behaviour","csui/lib/jquery.ui/js/jquery-ui"],function(e,i,t,s,n,o,a,r,l,c,p,d,u,g,h,m){var f,v=s.ItemView.extend({"className":function(){var i=["pman","pman-container"];return i.push("pman-mode-"+this.options.mode),e.unique(i).join(" ")},"template":h,"templateHelpers":function(){return{"addWidget":g.addWidget,"save":g.save,"saveAriaLabel":g.saveAriaLabel,"cancel":g.cancel,"cancelAriaLabel":g.cancelAriaLabel,"reset":g.reset,"resetAriaLabel":g.resetAriaLabel,"personalizeMode":this.mode===r.MODE_PERSONALIZE&&(this.options.perspective.has("perspective_id")||this.options.perspective.has("id"))}},"ui":{"pmanPanel":".pman-header .pman-pannel-wrapper","cancelEdit":".pman-header .cancel-edit","addIcon":".pman-header .icon-toolbarAdd","saveBtn":".pman-header .icon-save","trashArea":".pman-header .pman-trash-area","resetBtn":".pman-header .icon-reset"},"events":{"click @ui.cancelEdit":"onClickClose","click @ui.addIcon":"togglePannel","click @ui.saveBtn":"onClickSave","click @ui.resetBtn":"onClickReset","keydown":"onKeyDown"},"constructor":function(t){t||(t={}),e.defaults(t,{"applyMasking":this.applyMasking.bind(this),"container":document.body,"mode":r.MODE_EDIT_PERSPECTIVE}),t.container=i(t.container),this.context=t.context,this.applicationScope=this.context.getModel(l),this.mode=t.mode,this._prepareForEdit(t.perspective),s.ItemView.prototype.constructor.call(this,t),this._registerEventHandler()},"_registerEventHandler":function(){this.listenTo(this,"change:layout",function(e){this.perspective.setPerspective({"type":e,"options":{"perspectiveMode":this.mode}},{"silent":!0}),this._triggerEditMode(),this.togglePannel()}),this.listenTo(this,"swap:layout",function(e){this.perspective.setPerspective({"type":e,"options":this.perspective.attributes.perspective.options},{"silent":!0}),this.context.triggerMethod("swap:layout",this.perspective)}),this.listenTo(this.context,"save:perspective",this._savePerspective),this.listenTo(this.context,"change:perspective",this._onChangePerspective),this.listenTo(this.context,"retain:perspective",this._doExitPerspective),this.listenTo(this.context,"finish:exit:edit:perspective",this._doCleanup)},"_prepareForEdit":function(e){if(!e)throw new Error("Missing perspective");this.perspective=this._clonePrespective(e),this.perspective.isNew()&&this.mode===r.MODE_EDIT_PERSPECTIVE&&this.perspective.setPerspective(this._getDefaultPerspectiveConfig())},"_clonePrespective":function(e){var i=e.getPerspective(),t=JSON.parse(JSON.stringify(i));return e.setPerspective(t),e},"show":function(){var e=this.getContainer();return new o({"el":e}).show(this),this},"getContainer":function(){return f&&i.contains(this.options.container,f)||(f=i("<div>",{"class":"binf-widgets"}).appendTo(this.options.container)[0]),f},"_getDefaultPerspectiveConfig":function(){return{"type":"left-center-right","options":{"center":{"type":"csui/widgets/nodestable"}}}},"_savePerspective":function(i){if(i&&i.error)return void this.ui.saveBtn.prop("disabled",!1);this.perspective.update(i),this.perspective.save().then(e.bind(this._onSaveSuccess,this),e.bind(this._onSaveError,this))},"_onSaveSuccess":function(){var i=this;i.mode===r.MODE_EDIT_PERSPECTIVE?this._showMessage("success",g.perspectiveSaveSuccess):this._showMessage("success",g.personalizationSaveSuccess);var t=i.context.perspective.get("perspectiveMode")||r.MODE_EDIT_PERSPECTIVE,s=i._getSourceModel(),n=i.perspective.getPerspective();if(n.id=i.perspective.getPerspectiveId(),i.mode===r.MODE_EDIT_PERSPECTIVE){var o=s.get("perspective");s.set("perspective",e.defaults(n,o))}else{var o=s.get("perspective");s.set("perspective",e.defaults({"personalizations":i.perspective.toJSON()},o))}if(t===i.mode)i.context.perspective.set(n);else if(i.mode===r.MODE_EDIT_PERSPECTIVE){var a=new d({},{"perspective":n});a.setPerspective(i.context.perspective.toJSON()),n=a.getPerspective(),i.context.perspective.set(n)}else if(i.mode===r.MODE_PERSONALIZE){var a=new d({},{"perspective":s.get("perspective")});a.setPerspective(n),n=a.getPerspective(),i.context.perspective.set(n)}i._doExitPerspective()},"_onSaveError":function(e){this.ui.saveBtn.prop("disabled",!1);var t;if(e&&e.responseJSON&&e.responseJSON.error)t=e.responseJSON.error;else{var s=n.MessageHelper.toHtml();n.MessageHelper.reset(),t=i(s).text()}this._showMessage("error",t)},"_showMessage":function(e,i){csui.require(["csui/controls/globalmessage/globalmessage"],function(t){t.showMessage(e,i)})},"onClickSave":function(){this.ui.saveBtn.prop("disabled",!0);var i=this.options.container.find(".binf-popover");i.length?(i.binf_popover("hide"),setTimeout(e.bind(function(){this.context.triggerMethod("serialize:perspective",this.perspective)},this),1500)):this.context.triggerMethod("serialize:perspective",this.perspective)},"onClickReset":function(){var e=this;csui.require(["csui/dialogs/modal.alert/modal.alert"],function(i){i.confirmQuestion(g.resetConfirmMsg,g.reset,{"buttons":{"showYes":!0,"labelYes":g.reset,"showNo":!0,"labelNo":g.cancel}}).done(function(i){i&&e._doReset()})})},"_doReset":function(){var e=this._getSourceModel();originalPerspective=JSON.parse(JSON.stringify(e.get("perspective"))),originalPerspective.options=originalPerspective.options||{},originalPerspective.options.perspectiveMode=this.mode;var i=new t.Model(originalPerspective);this.context.triggerMethod("enter:edit:perspective",i),this.listenToOnce(this.context,"finish:enter:edit:perspective",function(){this._showMessage("success",g.resetSuccessful)})},"_getSourceModel":function(e){var i;return"node"===this.applicationScope.get("id")?i=this.context.getModel(c):this.applicationScope.get("id")||(i=this.context.getModel(p)),i},"onClickClose":function(){this._doExitPerspective()},"togglePannel":function(e){this.ui.pmanPanel.hasClass("binf-active")?(this.$el.find(".csui-layout-tab").attr("tabindex",-1),this.$el.find(".cs-go-back").attr("tabindex",-1),this._closeToolsPanel()):("mouse"!==e.originalEvent.pointerType&&(this.$el.find(".csui-layout-tab").attr("tabindex",0),this.$el.find(".csui-layout-tab").focus()),this._openToolsPanel())},"_openToolsPanel":function(){this.pmanPanelView.trigger("reset:items"),this.ui.addIcon.addClass("binf-active"),this.ui.addIcon.attr("title",g.close),this.ui.pmanPanel.addClass("binf-active"),this.pmanPanelView.triggerMethod("panel:open")},"_closeToolsPanel":function(){this.ui.pmanPanel.removeClass("binf-active"),this.ui.addIcon.attr("title",g.addWidget),this.ui.addIcon.removeClass("binf-active")},"applyMasking":function(){},"_initializeWidgets":function(){this.mode!==r.MODE_PERSONALIZE&&(this.pmanPanelRegion=new s.Region({"el":this.ui.pmanPanel}),this.pmanPanelView=new a({"pmanView":this}),this.pmanPanelRegion.show(this.pmanPanelView),e.isFunction(this.ui.trashArea.droppable)&&this.ui.trashArea.droppable({"tolerance":"pointer","hoverClass":"pman-trash-hover","accept":function(){return!1}}))},"_triggerEditMode":function(){var e=this.perspective.getPerspective();e.options=e.options||{},e.options.perspectiveMode=this.mode;var i=new t.Model(e);this.context.triggerMethod("enter:edit:perspective",i),this.listenToOnce(this.context,"finish:enter:edit:perspective",this._setFocusOnFirstWidget)},"_beforeTransition":function(){var e=this.options.container.find(".cs-perspective");this.options.container.addClass("perspective-editing-transition"),n.onTransitionEnd(e,function(){this.options.container.removeClass("perspective-editing-transition")},this)},"onRender":function(){this._beforeTransition(),this.options.container.addClass("perspective-editing"),this.options.applyMasking(),this._initializeWidgets(),this._triggerEditMode(),i(document).on("click."+this.cid,{"view":this},this._documentClick),("sidepanel-right"===this.perspective.get("type")||"sidepanel-left"===this.perspective.get("type")||"flow"===this.perspective.get("type")||"sidepanel-right"===this.perspective.get("perspective").type||"sidepanel-left"===this.perspective.get("perspective").type||"flow"===this.perspective.get("perspective").type)&&i(document).on("keydown",{"view":this},this.onKeyInView)},"onKeyInView":function(e){var t=m&&m.settings.rtl,s=e.data&&e.data.view,o=!0,a=n.isMacintosh();if(!(i(document.activeElement).parents("#banner").length>0)){if(a&&e.metaKey&&!e.ctrlKey||!a&&!e.metaKey&&e.ctrlKey){var r=i(e.target),l=r.closest(".csui-draggable-item"),c=s.options&&s.options.context&&s.options.context.widgetCollection&&s.options.context.widgetCollection.at(0).columns.models;switch(e.keyCode){case 39:t?s.moveToLeft(l,r,c):s.moveToRight(l,r,c),o=!1;break;case 37:t?s.moveToRight(l,r,c):s.moveToLeft(l,r,c),o=!1}}return o}},"_documentClick":function(e){var i=e.data.view;i.ui.addIcon.is(e.target)||i.ui.addIcon.has(e.target).length||i.ui.pmanPanel.is(e.target)||i.ui.pmanPanel.has(e.target).length||i._closeToolsPanel()},"_onChangePerspective":function(){this._doCleanup()},"_doCleanup":function(){var e=this.options.container.find(".binf-popover");this._beforeTransition(),e.length&&e.binf_popover("destroy"),this.options.container.removeClass("perspective-editing"),i(document).off("click."+this.cid,this._documentClick),i(document).off("keydown",this.onKeyInView),this.trigger("destroy")},"_doExitPerspective":function(){this.context.triggerMethod("exit:edit:perspective",this.perspective)},"_setFocusOnFirstWidget":function(){var e=this.options.container.find(".cs-perspective-panel .cs-perspective .csui-pman-editable-widget").first(),i=e.find(".shortcut-group-wrapper");"0"===i.attr("tabindex")?i[0].focus():e.find(".wrapper-button")[0].focus()},"onKeyDown":function(e){switch(e.keyCode){case 9:if(!e.shiftKey&&i(e.target).is(this.ui.cancelEdit))return this._setFocusOnFirstWidget(),!1}}});return u.mixin(v.prototype),v}),csui.define("csui/perspective.manage/widgets/perspective.placeholder/impl/nls/lang",{"root":!0,"en-us":!1,"en":!1}),csui.define("csui/perspective.manage/widgets/perspective.placeholder/impl/nls/root/lang",{"dndWidgetsHere":"Drag and Drop widgets here","dndHTMLWidgetsHere":"Drag and Drop HTML tiles only"}),csui.define("hbs!csui/perspective.manage/widgets/perspective.placeholder/impl/perspective.placeholder",["module","hbs","nuc/lib/handlebars"],function(e,i,t){var s=t.template({"compiler":[8,">= 4.3.0"],"main":function(e,i,t,s,n){var o,a=e.lookupProperty||function(e,i){if(Object.prototype.hasOwnProperty.call(e,i))return e[i]};return'<div class="csui-placeholder-title" title="'+e.escapeExpression((o=null!=(o=a(t,"dndWidgetsHere")||(null!=i?a(i,"dndWidgetsHere"):i))?o:e.hooks.helperMissing,"function"==typeof o?o.call(null!=i?i:e.nullContext||{},{"name":"dndWidgetsHere","hash":{},"loc":{"start":{"line":1,"column":43},"end":{"line":1,"column":61}}}):o))+'">\r\n  <div class="csui-placeholder-icon"></div>\r\n  <div>'+e.escapeExpression((o=null!=(o=a(t,"dndWidgetsHere")||(null!=i?a(i,"dndWidgetsHere"):i))?o:e.hooks.helperMissing,"function"==typeof o?o.call(null!=i?i:e.nullContext||{},{"name":"dndWidgetsHere","hash":{},"loc":{"start":{"line":3,"column":7},"end":{"line":3,"column":25}}}):o))+"</div>\r\n</div>"}});return t.registerPartial("csui_perspective.manage_widgets_perspective.placeholder_impl_perspective.placeholder",s),s}),csui.define("css!csui/perspective.manage/widgets/perspective.placeholder/impl/perspective.placeholder",[],function(){}),csui.define("csui/perspective.manage/widgets/perspective.placeholder/perspective.placeholder.view",["csui/lib/underscore","csui/lib/backbone","csui/lib/marionette","i18n!csui/perspective.manage/widgets/perspective.placeholder/impl/nls/lang","hbs!csui/perspective.manage/widgets/perspective.placeholder/impl/perspective.placeholder","css!csui/perspective.manage/widgets/perspective.placeholder/impl/perspective.placeholder"],function(e,i,t,s,n){return t.ItemView.extend({"className":"csui-perspective-placeholder","template":n,"templateHelpers":function(){return{"dndWidgetsHere":this.options.widgetContainer&&this.options.widgetContainer.options.grid.allowHTMLTilesOnly?s.dndHTMLWidgetsHere:s.dndWidgetsHere}},"constructor":function(e){t.ItemView.apply(this,arguments)},"onShow":function(){this.$el.parent().addClass("csui-pman-placeholder-container")},"onDestroy":function(){this.$el.parent().removeClass("csui-pman-placeholder-container")}})}),csui.define("csui/perspective.manage/widgets/perspective.widget/impl/nls/lang",{"root":!0,"en-us":!1,"en":!1}),csui.define("csui/perspective.manage/widgets/perspective.widget/impl/nls/root/lang",{"noConfig":"No configuration needed","clickToConfig":"Configuration needed"}),csui.define("hbs!csui/perspective.manage/widgets/perspective.widget/impl/perspective.widget",["module","hbs","nuc/lib/handlebars"],function(e,i,t){var s=t.template({"compiler":[8,">= 4.3.0"],"main":function(e,i,t,s,n){var o,a=e.lookupProperty||function(e,i){if(Object.prototype.hasOwnProperty.call(e,i))return e[i]};return'<div class="tile-header">\r\n  <div class="tile-title">\r\n    <h2 class="csui-heading" title="'+e.escapeExpression((o=null!=(o=a(t,"widgetTitle")||(null!=i?a(i,"widgetTitle"):i))?o:e.hooks.helperMissing,"function"==typeof o?o.call(null!=i?i:e.nullContext||{},{"name":"widgetTitle","hash":{},"loc":{"start":{"line":3,"column":36},"end":{"line":3,"column":51}}}):o))+'">'+e.escapeExpression((o=null!=(o=a(t,"widgetTitle")||(null!=i?a(i,"widgetTitle"):i))?o:e.hooks.helperMissing,"function"==typeof o?o.call(null!=i?i:e.nullContext||{},{"name":"widgetTitle","hash":{},"loc":{"start":{"line":3,"column":53},"end":{"line":3,"column":68}}}):o))+'</h2>\r\n  </div>\r\n</div>\r\n<div>\r\n  <div title="'+e.escapeExpression((o=null!=(o=a(t,"widgetMessage")||(null!=i?a(i,"widgetMessage"):i))?o:e.hooks.helperMissing,"function"==typeof o?o.call(null!=i?i:e.nullContext||{},{"name":"widgetMessage","hash":{},"loc":{"start":{"line":7,"column":14},"end":{"line":7,"column":31}}}):o))+'" class="csui-pman-widget-msg">\r\n    <div class="csui-pman-widget-icon"></div>\r\n    <div>'+e.escapeExpression((o=null!=(o=a(t,"widgetMessage")||(null!=i?a(i,"widgetMessage"):i))?o:e.hooks.helperMissing,"function"==typeof o?o.call(null!=i?i:e.nullContext||{},{"name":"widgetMessage","hash":{},"loc":{"start":{"line":9,"column":9},"end":{"line":9,"column":26}}}):o))+"</div>\r\n  </div>\r\n</div>"}});return t.registerPartial("csui_perspective.manage_widgets_perspective.widget_impl_perspective.widget",s),s}),csui.define("css!csui/perspective.manage/widgets/perspective.widget/impl/perspective.widget",[],function(){}),csui.define("csui/perspective.manage/widgets/perspective.widget/perspective.widget.view",["csui/lib/underscore","csui/lib/backbone","csui/lib/marionette","i18n!csui/perspective.manage/widgets/perspective.widget/impl/nls/lang","hbs!csui/perspective.manage/widgets/perspective.widget/impl/perspective.widget","css!csui/perspective.manage/widgets/perspective.widget/impl/perspective.widget"],function(e,i,t,s,n){return t.ItemView.extend({"className":"csui-pman-widget","template":n,"templateHelpers":function(){var i=this.widget&&this.widget.get("manifest"),t=this.widget&&this.widget.get("title"),n=!i||!i.schema||!i.schema.properties||e.isEmpty(i.schema.properties);return{"widgetTitle":t||s.noTitle,"widgetMessage":n?s.noConfig:s.clickToConfig}},"constructor":function(i){i||(i={}),i=e.defaults(i,{"data":{}}),t.ItemView.apply(this,arguments),this.widget=i.data.widget}})}),csui.define("json!csui/perspective.manage/widgets/perspective.placeholder/perspective.placeholder.manifest.json",{"$schema":"http://opentext.com/cs/json-schema/draft-04/schema#","title":"{{title}}","description":"{{description}}","kind":"tile","schema":{"type":"object","properties":{}}}),csui.define("json!csui/perspective.manage/widgets/perspective.widget/perspective.widget.manifest.json",{"$schema":"http://opentext.com/cs/json-schema/draft-04/schema#","title":"{{title}}","description":"{{description}}","kind":"tile","schema":{"type":"object","properties":{}}}),csui.define("csui/perspective.manage/widgets/perspective.placeholder/impl/nls/perspective.placeholder.manifest",{"root":!0,"en-us":!1,"en":!1}),csui.define("csui/perspective.manage/widgets/perspective.placeholder/impl/nls/root/perspective.placeholder.manifest",{"dndWidgetsHere":"Drag and Drop widgets here"}),csui.define("csui/perspective.manage/widgets/perspective.widget/impl/nls/perspective.widget.manifest",{"root":!0,"en-us":!1,"en":!1}),csui.define("csui/perspective.manage/widgets/perspective.widget/impl/nls/root/perspective.widget.manifest",{"noConfig":"No configuration needed","clickToConfig":"Configuration needed"}),csui.define("bundles/csui-perspective",["csui/perspective.manage/pman.view","csui/perspective.manage/behaviours/pman.widget.config.behaviour","csui/perspective.manage/widgets/perspective.placeholder/perspective.placeholder.view","csui/perspective.manage/widgets/perspective.widget/perspective.widget.view","json!csui/perspective.manage/widgets/perspective.placeholder/perspective.placeholder.manifest.json","json!csui/perspective.manage/widgets/perspective.widget/perspective.widget.manifest.json","i18n!csui/perspective.manage/widgets/perspective.placeholder/impl/nls/perspective.placeholder.manifest","i18n!csui/perspective.manage/widgets/perspective.widget/impl/nls/perspective.widget.manifest"],{}),csui.require(["require","css"],function(e,i){i.styleLoad(e,"csui/bundles/csui-perspective",!0)});
//# sourceMappingURL=csui-perspective.js.map