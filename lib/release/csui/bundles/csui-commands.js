csui.define("csui/utils/command.error",["module","csui/lib/jquery","csui/lib/underscore","csui/lib/backbone","csui/utils/log","csui/utils/base"],function(e,i,t,n,o,s){function r(e,i){function o(){if(i&&t.isString(i))this.errorDetails=i;else if(i instanceof n.Model)this.node=i;else if(i&&t.isObject(i)&&(i.errorDetails&&t.isString(i.errorDetails)&&(this.errorDetails=i.errorDetails),i.node instanceof n.Model&&(this.node=i.node),i.requestError&&t.isObject(i.requestError))){var e=new s.RequestErrorMessage(i.requestError);this.message?this.errorDetails||(this.errorDetails=e.message):(this.message=e.message,this.errorDetails||(this.errorDetails=e.errorDetails))}}if(!e)throw new Error("No argument passed");if(e instanceof Error)this.message=e.message,e.stack&&(this.stack=e.stack);else if(t.isString(e))this.message=e;else{var r=new s.RequestErrorMessage(e);this.message=r.message,this.errorDetails=r.errorDetails,this.statusCode=r.statusCode}o.call(this),this.name="CommandError"}return r.prototype=Object.create(Error.prototype),r}),csui.define("csui/utils/commands/nls/localized.strings",{"root":!0,"en-us":!1,"en":!1}),csui.define("csui/utils/commands/nls/root/localized.strings",{"ShortcutPickerTitle":"Select target for Shortcut","CommandNameAddItemMetadata":"Add Item with metadata","CommandNameAddVersion":"AddVersion","AddVersionNotAllowed":"Unable to add version. Please try again when the current operation is finished","CommandTitleCopy":"Copy items","CommandNameCopy":"Copy","CommandVerbCopy":"copy","DialogTitleSingleCopy":"Copy {0} item","DialogTitleCopy":"Copy {0} items","SomeFilesNotCopiedSuccessfully":"Some items were not successfully copied.","CopyingNodes":"Copying {0} nodes","CopyingNode":"Copying 1 node","CopyPageLeavingWarning":"If you leave the page now, pending items will not be copied.","CopyingOneItem":'Copying "{0}"',"CopyItems":"Copying {0} items","CopySomeItems":"Copying {0} items","CopyItemsNoneMessage":"No items copied.","CopyOneItemSuccessMessage":'"{0}" copied',"CopySomeItemsSuccessMessage":"{0} items successfully copied.","CopyManyItemsSuccessMessage":"{0} items successfully copied.","CopyOneItemFailMessage":'"{0}" failed to copy',"CopyManyItemsOneFailMessage":"1 item failed to copy.","CopySomeItemsFailMessage":"{0} items failed to copy.","CopyManyItemsFailMessage":"{0} items failed to copy.","CopySomeItemsFailMessage2":"{2} items failed to copy.","CopyManyItemsFailMessage2":"{2} items failed to copy.","CopyingLocationLabel":'Copying to "{0}"',"CopiedLocationLabel":'Copied to "{0}"',"CopyNotAllowed":"Unable to copy. Please try again when the current operation is finished","DeleteCommandConfirmDialogTitle":"Delete","DeleteButtonLabel":"Delete","DeleteCommandConfirmDialogHtml":"<span class='msgIcon WarningIcon'><%- message %></span>","DeleteCommandConfirmDialogSingleMessage":'Do you want to delete "{0}"?',"DeleteCommandConfirmDialogMultipleMessage":"Do you want to delete {0} items?","CommandTitleDelete":"Delete items","CommandNameDelete":"Delete","CommandVerbDelete":"delete","DeletePageLeavingWarning":"If you leave the page now, pending items will not be deleted.","DeleteItemFailed":'Deleting item "{0}" failed.',"DeleteItems":"Deleting {0} items","DeletingOneItem":'Deleting "{0}"',"DeletingSomeItems":"Deleting {0} items","DeleteItemsNoneMessage":"No items deleted.","DeleteOneItemSuccessMessage":'"{0}" deleted.',"DeleteSomeItemsSuccessMessage":"{0} items successfully deleted.","DeleteManyItemsSuccessMessage":"{0} items successfully deleted.","DeleteOneItemFailMessage":'"{0}" failed to delete.',"DeleteManyItemsOneFailMessage":"1 item failed to delete.","DeleteSomeItemsFailMessage":"{0} items failed to delete.","DeleteManyItemsFailMessage":"{0} items failed to delete.","DeleteSomeItemsFailMessage2":"{2} items failed to delete.","DeleteManyItemsFailMessage2":"{2} items failed to delete.","deletingLocationLabel":'Deleting from "{0}"',"deletedLocationLabel":'Deleted from "{0}"',"DeleteNotAllowed":"Unable to delete. Please try again when the current operation is finished","ApplyingManyItemsSuccessMessage":"Applied successfully to {0} items.","ApplyingOneItemFailMessage":"Failed to apply to 1 item.","ApplyingManyItemsFailMessage2":"Failed to apply to {0} items.","CommandNameDownload":"Download","CommandVerbDownload":"download","CommandNameZipDownload":"Download","CommandVerbZipDownload":"Download","VerifyZipAndDownloadPrefetch":"Verifying items","ExtractingZipAndDownload":"Extracting items","CompressingZipAndDownload":"Compressing items","CleanUpZipAndDownload":"Cleaning up","PreFlightDialogBtnContinue":"Continue","DownloadDialogBtnDownload":"Download","DialogBtnCancel":"Cancel","InvalidArchiveCharacters":'Special characters cannot be used in archive name: *\\?:<>|"/&',"InvalidArchiveName":"Invalid archive name.","TheArchiveNameCannotBeEmpty":"Archive name cannot be empty.","TheArchiveNameMaxLength":"Archive name is greater than the maximum length (248)","CommandTitleMove":"Move items","CommandNameMove":"Move","CommandNameVerbMove":"move","DialogTitleSingleMove":"Move {0} item","DialogTitleMove":"Move {0} items","SomeFilesNotMovedSuccessfully":"Some items were not successfully moved.","MovePageLeavingWarning":"If you leave the page now, pending items will not be moved.","MovingNodes":"Moving {0} nodes","MovingNode":"Moving 1 node","MovingOneItem":'Moving "{0}"',"MovingItems":"Moving {0} items","MovingSomeItems":"Moving {0} items","MoveItemsNoneMessage":"No items moved.","MoveOneItemSuccessMessage":'"{0}" moved',"MoveSomeItemsSuccessMessage":"{0} items successfully moved.","MoveManyItemsSuccessMessage":"{0} items successfully moved.","MoveManyItemsOneFailMessage":"1 item failed to move.","MoveOneItemFailMessage":'"{0}" failed to move',"MoveSomeItemsFailMessage":"{0} items failed to move.","MoveManyItemsFailMessage":"{0} items failed to move.","MoveSomeItemsFailMessage2":"{2} items failed to move.","MoveManyItemsFailMessage2":"{2} items failed to move.","MovingLocationLabel":'Moving to "{0}"',"MovedLocationLabel":'Moved to "{0}"',"MoveNotAllowed":"Unable to move. Please try again when the current operation is finished","CommandNamePaste":"Paste","CommandNameReserve":"Reserve","CommandVerbReserve":"reserve","ReservePageLeavingWarning":"If you leave the page now, pending items will not be reserved.","ReserveItemsNoneMessage":"No items reserved.","ReserveOneItemSuccessMessage":"1 item successfully reserved.","ReserveSomeItemsSuccessMessage":"{0} items successfully reserved.","ReserveManyItemsSuccessMessage":"{0} items successfully reserved.","ReserveOneItemFailMessage":"1 item failed to reserve.","ReserveSomeItemsFailMessage":"{0} items failed to reserve.","ReserveManyItemsFailMessage":"{0} items failed to reserve.","CommandNameFavorite":"Add Favorite","CommandVerbFavorite":"update Favorites","CommandDoneVerbFavorite":"added to Favorites","CommandRemovedVerbFavorite":"removed from Favorites","updateFavoriteFailTitle":"Update Favorite","updateFavoriteFailMessage":'Failed to update Favorite for node "{0}". \n\n{1}',"CommandDescriptionToggle":"Description Toggle","CommandHideDescription":"Hide description","CommandShowDescription":"Show description","CommandNameEmailLink":"Send to","CommandVerbEmailLink":"send","EmailLinkSubject":"I want to share the following links with you","EmailLinkDesktop":"Link for Desktop and Android","EmailAppleLinkFormat":"Link for iOS Mobile","EmailLinkCommandFailedWithTooMuchItemsErrorMessage":"Mail as link failed. Too many items were selected.","SignOutCommandName":"Sign Out","SwitchToClassicCommandName":"Classic View","ContentServerAdministrationCommandName":"Administration","CommandNameUnreserve":"Unreserve","CommandVerbUnreserve":"unreserve","UnreservePageLeavingWarning":"If you leave the page now, pending items will not be unreserved.","UnreserveItemsNoneMessage":"No items unreserved.","UnreserveOneItemSuccessMessage":"1 item successfully unreserved.","UnreserveSomeItemsSuccessMessage":"{0} items successfully unreserved.","UnreserveManyItemsSuccessMessage":"{0} items successfully unreserved.","UnreserveOneItemFailMessage":"1 item failed to unreserve.","UnreserveSomeItemsFailMessage":"{0} items failed to unreserve.","UnreserveManyItemsFailMessage":"{0} items failed to unreserve.","UserProfileCommandName":"Profile","CommandTitleUpload":"Upload documents","UploadNotAllowed":"Unable to upload. Please try again when the current operation is finished","CommandVerbRename":"rename","CommandNameSaveFilter":"Save As","CommandVerbSaveFilter":"Save As","DialogTitleSaveFilter":"Save as","SaveFilterCommandSuccessfully":"{0} virtual folder created successfully.","NoEditUrl":"Web page for editing of this document is not available.","CommandNameCopyLink":"Copy link","CommandVerbCopyLink":"copy link","CopyLinkSuccessMessage":"Link copied to clipboard.","CopyLinkFailMessage":"Copy link has failed to copy the link to clipboard.","DeletePermissionCommandRemoveOwner":"Remove owner","DeletePermissionCommandRemoveGroup":"Remove owner group","DeletePermissionCommandRemovePublicAccess":"Remove Public Access","DeletePermissionCommandRemoveOther":"Remove from list","DeletePermissionCommandConfirmDialogTitle":"Remove {0}","DeletePermissionCommandConfirmDialogSingleMessage":"Do you want to remove {0} from this permissions list?","DeletePermissionCommandConfirmDialogPublicAccessMessage":"Are you sure you want to remove {0} from this permissions list?","DeletePermissionCommandSuccessMessage":"{0} was removed from the permissions list.","DeletePermissionCommandSuccessMessageWithCount":"{0} was removed from the permissions list of {1}.","DeletePermissionCommandFailMessage":"Failed to remove {0} from the permissions list.","publicAccess":"Public Access","RestorePublicAccessSuccessMessage":"{0} restored","RestorePublicAccessSuccessMessageWithCount":"{0} restored to the permission list of {1}","undefinedCollection":"Collection is undefined","EditPermissionCommandFailMessage":"Failed to edit {0} from the permissions list.","Owner":"owner","CommandNameAddOwnerOrOwnerGroup":"Add Owner Or Owner Group","AddOwnerOrGroup":"Add owner or owner group","AddOwner":"Add owner","AddOwnerGroup":"Add owner group","CommandNameAddUserorGroup":"Add user or group","CommandNameRestorePublicAccess":"Restore public access","AddButtonLabel":"Add","AddOwnerOrGroupDialogTitle":"Add Owner or Owner group","AddOwnerDialogTitle":"Add Owner","AddOwnerGroupDialogTitle":"Add Owner group","ChangeOwnerPermissionCommand":"Change owner","ChangeOwnerGroupPermissionCommand":"Change owner group","AddUserOrGroupSuccess":"{0} added successfully","AddUserOrGroupFailure":"{0} failed to add","AddUserOrGroupSuccessWithCount":"{0} was added to the permissions list of {1}.","formatForNone":"{0} items","formatForOne":"{0} item","formatForTwo":"{0} items","formatForFive":"{0} items","AppliedPermissions":"Permissions applied selected item","AppliedPermissionsOneSuccess":"Permissions applied to {0} item","AppliedPermissionsOnlySuccess":"Permissions applied to {0} items","AppliedPermissionsOneFailure":"Permissions failed to apply {0} item","AppliedPermissionsOnlyFailure":"Permissions failed to apply {0} items","AppliedPermissionsSuccessAndFailure":"Permissions applied to {0} items and failed to apply {1} items","CommandSuccessfullySingular":"{0} item successfully {1}.","CommandFailedSingular":"{0} item failed to {1}.","CommandSuccessfullyPlural":"{0} items successfully {1}.","CommandFailedPlural":"{0} items failed to {1}.","CommandFailedPartial":"{0} of {1} items failed to {2}.","NoConnectivity":"No connectivity","GoToOffline":"Go to offline files?","viewTypeUnsupported":"This content type is not currently supported on a mobile device.","MobileIOS":"iOS Mobile","DesktopAndroid":"Desktop and Android","Close":"Close","addButton":"Add","otheruser":"other user","addDocument":"Add Document","allUsersAndGroups":"Users and Groups","addUsersAndGroups":"Add users or groups","addGroups":"Add Groups","allGroups":"Groups","cancelButtonLabel":"Cancel","applyButtonLabel":"Apply","ThumbnailTitle":"Grid view","ListViewTitle":"Browse view","DensityLabel":"Density","error":"Error","EditPerspective":"Edit page","editPerspectiveErrorMessage":"The page cannot be edited. It is used as template for multiple pages","editPageDialogMessage":"Who will see the page edits?","editPageButton":"Everyone","personalizePageButton":"Only you","editPageCancelButton":"Cancel","editPageTitle":"Edit page","CreatePerspective":"Create new perspective","searchButtonMessage":"Search","personalizePage":"Personalize page","BackButtonToolItem":"Go Back","MissingNodeId":"invalid node or missing node id.","revision":"Revision ","currentRevision":"Current revision","newRevision":"New revision","revisionName":"Revision name","createRevisionHeaderTitle":"Create revision","submitButton":"Submit","cancelButton":"Cancel","revisionSuccessMsg":"Created new revision \u2018{0}\u2019 successfully.","GotoLocationLinkLabel":"Go to location","release":"Release ","currentRelease":"Current release","newRelease":"New release","releaseName":"Release name","createReleaseHeaderTitle":"Create release","releaseSuccessMsg":"Created new release \u2018{0}\u2019 successfully.","noneLabel":"<None>","CommandNameViewReleases":"View Releases","compoundDocumentHeaderTitle":"Compound document","Reorganize":"Reorganize","ReorganizeSuccessMsg":"Reorganization of items completed successfully.","brandTitle":"opentext | ","CommandNameSaveQuery":"Save As query","CommandVerbSaveQuery":"Save As query","DialogTitleSaveQuery":"Save search as","SaveQueryCommandSuccessfully":"{0} created successfully.","saveButtonLabel":"Save","CommandNameUpdateQuery":"Update query","CommandVerbUpdateQuery":"Update query","UpdateQueryCommandSuccessfully":"{0} updated successfully.","CommandNameRestructure":"Restructure","RestructureDialogTitle":"Restructure","Restructure":"Restructure","confirmationRestructure":"Restructuring will start as scheduled. Assigned users will be notified about the progress.","errorRestructure":"Unable to start restructuring.","files":"files","CommandTitleRestructure":"Restructure items","DialogTitleSingleRestructure":"Restructure {0} item","DialogTitleRestructure":"Restructure {0} items","RestructuringNodes":"Restructure {0} nodes","RestructuringNode":"Restructure 1 node","RestructureNotAllowed":"Unable to Restructure. Please try again when the current operation is finished"}),csui.define("csui/utils/commands/versions/nls/localized.strings",{"root":!0,"en-us":!1,"en":!1}),csui.define("csui/utils/commands/versions/nls/root/localized.strings",{"CommandNameVersionDelete":"Delete Version","CommandVerbVersionDelete":"delete","DeleteCommandConfirmDialogTitle":"Delete","VersionDeleteCommandConfirmDialogSingleMessage":'Do you want to delete version {0} from "{1}"?',"VersionDeleteCommandConfirmDialogMultipleMessage":"Do you want to delete {0} versions?","DeleteVersionPageLeavingWarning":"If you leave the page now, pending versions will not be deleted.","DeleteVersions":"Deleting {0} versions","DeletingSomeVersions":"Deleting {0} versions","DeletingOneVersion":"Deleting version","DeleteVersionItemsNoneMessage":"No versions deleted.","DeleteVersionOneItemSuccessMessage":"1 version succeeded to delete.","DeleteVersionSomeItemsSuccessMessage":"{0} versions succeeded to delete.","DeleteVersionManyItemsSuccessMessage":"{0} versions succeeded to delete.","DeleteVersionOneItemFailMessage":"1 version failed to delete.","DeleteVersionSomeItemsFailMessage":"{0} versions failed to delete.","DeleteVersionManyItemsFailMessage":"{0} versions failed to delete.","DeleteVersionSomeItemsFailMessage2":"{2} versions failed to delete.","DeleteVersionManyItemsFailMessage2":"{2} versions failed to delete.","CommandNamePromoteVersion":"Promote to Major Version","CommandVerbPromoteVersion":"Promote to Major Version","MessageVersionPromoted":"Version successfully promoted","DialogPromoteVersion":"version {0} promoting to {1}","CommandSuccessfullySingular":"{0} version successfully {1}.","CommandFailedSingular":"{0} version failed to {1}.","CommandSuccessfullyPlural":"{0} versions successfully {1}.","CommandFailedPlural":"{0} versions failed to {1}.","CommandFailedPartial":"{0} of {1} versions failed to {2}.","MissingVersionInfo":"invalid version or missing required version info."}),csui.define("csui/utils/commandhelper",["require","module","csui/lib/jquery","csui/lib/underscore","csui/lib/backbone","csui/utils/base","csui/utils/command.error","i18n!csui/utils/commands/nls/localized.strings","i18n!csui/utils/commands/versions/nls/localized.strings","csui/models/version","csui/lib/jquery.when.all"],function(e,i,t,n,o,s,r,a,c,l){"use strict";var u=i.config(),d=n.clone(a),m=function(){};return n.extend(m.prototype,o.Events,{"checkNodeTypesAndRights":function(e,i,t){n.isArray(e)||e&&(e=[e]);var o=n.contains(i,-1);return e&&e.length&&n.all(e,function(e){return(n.contains(i,e.get("type"))||o&&e.get("container"))&&n.all(t,function(i){return e.get("perm_"+i)})})},"checkNodeTypes":function(e,i){n.isArray(e)||e&&(e=[e]);var t=n.contains(i,-1);return e&&e.length&&n.all(e,function(e){var o=s.isBackbone(e)?e.attributes:e;return n.contains(i,o.type)||t&&o.container})},"checkNodeRights":function(e,i){return n.isArray(e)||e&&(e=[e]),e&&e.length&&n.all(e,function(e){var t=s.isBackbone(e)?e.attributes:e;return n.all(i,function(e){return t["perm_"+e]})})},"getJustOneNode":function(e){return e.nodes&&1===e.nodes.length&&e.nodes.at(0)},"getAtLeastOneNode":function(e){return e.nodes?e.nodes:new(o.Collection.extend(e.collection?{"model":e.collection.model}:{}))},"updateNode":function(e,i){return e.save(i,{"wait":!0,"patch":!0,"silent":!0}).then(function(){return e.fetch({"force":!0})}).then(function(){return e},function(i){var n=new r(i,e);return t.Deferred().reject(n)})},"handleExecutionResults":function(e,i){var o=t.Deferred(),s=t.Deferred();return csui.require(["csui/controls/globalmessage/globalmessage"],function(e){s.resolve(e)},s.reject),t.whenAll(s,e).always(function(e){var t=e[0],s=e[1];n.isArray(s)||(s=[s]);var r=0,m=0;if(n.each(s,function(e){void 0===e||e.cancelled||(e instanceof Error?m++:r++)}),0===m&&0===r)return void o.reject();var g=s[0];if(g instanceof l?n.extend(d,c):n.extend(d,a),1===s.length)if(1===r)i.suppressSuccessMessage||t.showMessage("success",n.str.sformat(d.CommandSuccessfullySingular,r,i.command.get("doneVerb")));else{var p=g.errorDetails||g.message;u.offlineSupport&&0===g.statusCode?o.reject(g):i.suppressFailMessage||g.suppressFailMessage||t.showMessage("error",n.str.sformat(d.CommandFailedSingular,m,i.command.get("verb")),p)}else 0===m?i.suppressSuccessMessage||t.showMessage("success",n.str.sformat(d.CommandSuccessfullyPlural,r,i.command.get("doneVerb"))):0===r?u.offlineSupport&&0===g.statusCode?o.reject(g):i.suppressFailMessage||g.suppressFailMessage||t.showMessage("error",n.str.sformat(d.CommandFailedPlural,m,i.command.get("verb"))):i.suppressFailMessage||g.suppressFailMessage||(i.customError?t.showMessage("error",s[1]):t.showMessage("error",n.str.sformat(d.CommandFailedPartial,m,s.length,i.command.get("verb"))));o.resolve(s)}),o.promise()},"_getErrorMessageFromResponse":function(e){var i;if(e&&e.responseJSON&&e.responseJSON.error)i=e.responseJSON.error;else{var n=s.MessageHelper.toHtml();s.MessageHelper.reset(),i=t(n).text()}return i},"refreshModelAttributesFromServer":function(e,i){var t=e.clone();return t.collection=i||e.collection,t.fetch().then(function(){return e.set(t.attributes),t.original&&(e.original=t.original),e})},"showOfflineMessage":function(e,i,t){if(e&&0===e.statusCode&&u.offlineSupport){var n=this;return csui.require(["csui/dialogs/modal.alert/modal.alert"],function(e){e.showInformation(d.GoToOffline,d.NoConnectivity,{"buttons":e.buttons.YesNo}).always(function(e){e?i?i():window.location.href="#offline.list":t?t():n.trigger("offline:refused")})}),!0}}}),new m}),csui.define("csui/models/command",["csui/lib/underscore","csui/lib/backbone","csui/utils/commandhelper"],function(e,i,t){return i.Model.extend({"idAttribute":"signature","constructor":function(e,t){i.Model.prototype.constructor.apply(this,arguments)},"getCommandKey":function(){var e=this.get("command_key");return e?Array.isArray(e)?e:[e]:[]},"enabled":function(e,i){var t=this.get("scope"),n=this._getNodesByScope(e,t);if(t&&(!n||!n.length))return!1;var o=this.get("types")||[];if(o.length&&!this.checkTypes(n,o))return!1;var s=this.get("openable");if(s&&this.checkOpenability(n))return!0;var r=this.getCommandKey&&this.getCommandKey()||this.get("command_key")||[];return!(s&&!r.length)&&(!r.length||this.checkPermittedActions(n,r))},"isNonPromoted":function(i){var t=this.get("scope"),n=this._getNodesByScope(i,t),o=this.getCommandKey&&this.getCommandKey()||this.get("command_key")||[],s=!1;if(n&&n.length){var r=this._getNonPromotedCheckFunctionsForSignatures(o);r&&e.find(n,function(e){var i=r(e);if(i&&!0===i.get("csuiNonPromotedAction"))return s=!0,!0})}return s},"_getNodesByScope":function(e,i){var n;switch(i){case"single":n=t.getJustOneNode(e),n&&(n=[n]);break;default:n=t.getAtLeastOneNode(e).models}return n},"_getCheckFunctionsForSignatures":function(i){if(i&&i.length)return e.isArray(i)?function(t){return e.any(i,function(e){return t.actions&&t.actions.findRecursively(e)})}:function(e){return e.actions&&e.actions.findRecursively(i)}},"_getNonPromotedCheckFunctionsForSignatures":function(i){var t;return i&&(e.isArray(i)&&i.length?t=function(t){var n;return e.find(i,function(e){return!!(n=t.actions&&t.actions.findRecursively(e))}),n}:e.isString(i)&&(t=function(e){return e.actions&&e.actions.findRecursively(i)})),t},"checkTypes":function(i,t){return!(!i||(e.isArray(i)||(i=[i]),!i.length))&&i.every(function(e){return t.indexOf(e.get("type"))>=0})},"checkOpenability":function(i){return!(!i||(e.isArray(i)||(i=[i]),!i.length))&&i.every(function(e){return e.get("openable")})},"checkPermittedActions":function(i,t){if(i&&(e.isArray(i)||(i=[i]),i.length)){t||(t=this.getCommandKey&&this.getCommandKey()||this.get("command_key")||[]);var n=this._getCheckFunctionsForSignatures(t);return!n||e.all(i,n)}return!1},"_getNodeActionForSignature":function(e,i){var t;if(e){var n=this._getCheckFunctionsForSignatures(i);n&&(t=n.call(this,e))}return t}})}),csui.define("csui/utils/commands/back.to.last.fragment",["module","require","csui/lib/jquery","csui/lib/underscore","csui/models/command","i18n!csui/utils/commands/nls/localized.strings"],function(e,i,t,n,o,s){"use strict";return o.extend({"defaults":{"signature":"BackToLastFragment","name":s.GoBack},"enabled":function(i,t){var o=n.extend({"enabled":!1},e.config()),s=i.context||t&&t.context;if(!s||!o.enabled)return!1;var r=s&&s.viewStateModel;return r?!!r.getLastHistoryEntry():void 0},"execute":function(e,i){var n=e.context||i&&i.context,o=n&&n.viewStateModel;return o&&(o.set("browsing",!0),o.restoreLastFragment()),t.Deferred().resolve().promise()}})}),csui.define("csui/integration/folderbrowser/commands/nls/localized.strings",{"root":!0,"en-us":!1,"en":!1}),csui.define("csui/integration/folderbrowser/commands/go.to.node.history",["module","require","csui/lib/jquery","csui/lib/underscore","csui/models/command","csui/integration/folderbrowser/commands/nls/localized.strings"],function(e,i,t,n,o,s){"use strict";var r={};return o.extend({"defaults":{"signature":"Back","name":s.GoToHistory},"enabled":function(i,t){var o,s=n.extend({"enabled":!1},e.config()),a=i.context||t&&t.context;return!!a&&(s.enabled&&this._ensureGoBackList(a),o=r[a.cid]||[],s.enabled&&o.length>1)},"execute":function(e,i){var n=t.Deferred();return csui.require(["csui/utils/contexts/factories/next.node"],function(t){var o=e.context||i&&i.context,s=o.getModel(t),a=r[o.cid]||[];a.length>1&&(a.pop(),s.set("id",a[a.length-1])),n.resolve()},function(e){n.reject(e)}),n.promise()},"clearHistory":function(e){delete r[e.cid]},"_ensureGoBackList":function(e){var i=r[e.cid];i||(i=r[e.cid]=[],csui.require(["csui/utils/contexts/factories/node","csui/utils/contexts/factories/next.node"],function(t,n){function o(t){var n=e.getModel(t),o=n.get("id");o&&i[i.length-1]!==o&&i.push(o)}var s=e.getModel(n);o(t),e.on("request",function(){o(t)}),s.on("change:id",function(){o(n)})}))}})}),csui.define("csui/integration/folderbrowser/commands/nls/root/localized.strings",{"GoToHistory":"Go Back","OpenFullPageContainer":"Open Full Page Container"}),csui.define("csui/integration/folderbrowser/commands/open.full.page.container",["module","require","csui/lib/jquery","csui/lib/underscore","csui/models/command","i18n!csui/integration/folderbrowser/commands/nls/localized.strings"],function(e,i,t,n,o,s){"use strict";return o.extend({"defaults":{"signature":"Page","name":s.OpenFullPageContainer},"enabled":function(i,t){return n.extend({"enabled":!1},e.config()).enabled&&!!i.container},"execute":function(e,i){var n=t.Deferred();return csui.require(["csui/utils/node.links/node.links"],function(i){window.open(i.getUrl(e.container)),n.resolve()},n.reject),n.promise()}})}),csui.define("csui/integration/folderbrowser2/commands/nls/localized.strings",{"root":!0,"en-us":!1,"en":!1}),csui.define("csui/integration/folderbrowser2/commands/nls/root/localized.strings",{"OpenFullPageContainer":"Open Full Page Container"}),csui.define("csui/integration/folderbrowser2/commands/open.full.page.container",["module","require","csui/lib/jquery","csui/lib/underscore","csui/models/command","i18n!csui/integration/folderbrowser2/commands/nls/localized.strings"],function(e,i,t,n,o,s){"use strict";return o.extend({"defaults":{"signature":"Page","name":s.OpenFullPageContainer},"enabled":function(i,t){return n.extend({"enabled":!1},e.config()).enabled&&!!i.container},"execute":function(e,i){var n=t.Deferred();return csui.require(["csui/utils/node.links/node.links"],function(i){window.open(i.getUrl(e.container)),n.resolve()},n.reject),n.promise()}})}),csui.define("csui/models/commands",["csui/lib/underscore","csui/lib/backbone","csui/models/command"],function(e,i,t){return i.Collection.extend({"model":t,"constructor":function(e,t){i.Collection.prototype.constructor.apply(this,arguments)},"clone":function(){var i=new this.constructor(this.models,this.options);return i.signatures=e.clone(this.signatures),i},"getSignatures":function(i){var t=[];e.mapObject(i,function(i,n){t=e.union(t,e.without(i.getCollection().pluck("signature"),"disabled"))});var n=this.clone(),o=[];return n.each(function(e){-1===t.indexOf(e.get("signature"))&&o.push(e)}),n.remove(o,{"silent":!0}),n.getAllSignatures()},"getAllSignatures":function(){return e.chain(this.models).invoke("getCommandKey").map(function(e){return"default"===e[0]?["default","open",e[2]]:e}).flatten().compact().invoke("toLowerCase").unique().value()}})}),csui.define("csui/utils/commands",["csui/lib/underscore","csui/models/commands","csui-ext!csui/utils/commands"],function(e,i,t){"use strict";var n=new i;return e.extend(n,{"signatures":{"browse":"Browse","open":"Open","download":"Download","add":"Add","navigate":"Navigate","original":"Original"},"version":"1.0"}),t&&n.add(e.chain(t).flatten(!0).map(function(e){return new e}).value()),n}),csui.define("hbs!csui/dialogs/file.open/impl/file.open",["module","hbs","nuc/lib/handlebars"],function(e,i,t){var n=t.template({"compiler":[8,">= 4.3.0"],"main":function(e,i,t,n,o){var s,r=e.lookupProperty||function(e,i){if(Object.prototype.hasOwnProperty.call(e,i))return e[i]};return'<input type="file" style="display:none" '+e.escapeExpression((s=null!=(s=r(t,"multiple")||(null!=i?r(i,"multiple"):i))?s:e.hooks.helperMissing,"function"==typeof s?s.call(null!=i?i:e.nullContext||{},{"name":"multiple","hash":{},"loc":{"start":{"line":1,"column":40},"end":{"line":1,"column":52}}}):s))+">\r\n"}});return t.registerPartial("csui_dialogs_file.open_impl_file.open",n),n}),csui.define("csui/dialogs/file.open/file.open.dialog",["module","csui/lib/underscore","csui/lib/jquery","csui/lib/marionette","csui/utils/log","csui/utils/base","hbs!csui/dialogs/file.open/impl/file.open"],function(e,i,t,n,o,s,r){"use strict";return o=o(e.id),n.ItemView.extend({"className":"csui-file-open","template":r,"templateHelpers":function(){return{"multiple":this.options.multiple?"multiple":""}},"ui":{"fileInput":"input"},"events":{"change @ui.fileInput":"_processFiles"},"constructor":function(e){this.className=i.result(this,"className");var s=t(document.body).find("> ."+this.className);s.length&&(o.debug("Removing an earlier file-open input element.")&&console.log(o.last),s.remove()),n.ItemView.prototype.constructor.call(this,e)},"onDestroy":function(){this.ui.fileInput.off()},"show":function(){o.debug("Showing a file-open input element.")&&console.log(o.last),this.render(),t(document.body).append(this.el),this.ui.fileInput.trigger("click"),this.ui.fileInput.trigger("focus")},"_processFiles":function(e){var i=e.originalEvent,t=i.target.files||i.dataTransfer&&i.dataTransfer.files;o.debug(t.length+" file(s) selected by a file-open input element.")&&console.log(o.last),this.trigger("add:files",t)}})}),csui.define("csui/utils/commands/add/add.mixin",["require","csui/lib/jquery","csui/lib/underscore","csui/utils/url","i18n!csui/utils/commands/nls/localized.strings","csui/utils/log","csui/utils/base","csui/utils/commandhelper","csui/models/node/node.model","csui/dialogs/file.open/file.open.dialog"],function(e,i,t,n,o,s,r,a,c,l){"use strict";return{"mixin":function(e){return t.extend(e,{"_selectFilesForUpload":function(e,t){var s,r=i.Deferred(),a=e.container||t.container;if(a&&136===a.get("type")&&!a.get("fileOrder")){var c=a.connector.getConnectionUrl().getApiBase("v2"),u=n.combineQueryString({"fields":["properties{order_next}"]}),d={"url":n.combine(c,"nodes",a&&a.get("id"),"?"+u),"type":"GET","contentType":"application/x-www-form-urlencoded"};a&&a.connector.makeAjaxCall(d).always(function(e){e.results&&a.set("order_next",e.results.data.properties.order_next)})}return csui.require(["csui/controls/globalmessage/globalmessage"],function(i){if(i.isActionInProgress(t.actionType,o.UploadNotAllowed,o.CommandTitleAdd))return r.resolve();s=new l({"multiple":!0}),r.resolve(),s.listenTo(s,"add:files",function(i){csui.require(["csui/controls/fileupload/fileupload"],function(n){r.resolve();var o=n.newUpload(e,t);o.addFilesToUpload(i,{"collection":e.collection,"excludeAddVersion":t.excludeAddVersion,"excludeAddVersionforFolders":t.excludeAddVersion}),o.listenTo(o,"destroy",function(){s.destroy()})})}).show()}),r.promise()},"_getAddableTypeName":function(e,i){return i.addableTypeName?i.addableTypeName:e.data.addableTypes.findWhere({"type":i.addableType}).get("type_name")}})}}}),csui.define("csui/utils/commands/add.categories",["require","csui/lib/jquery","csui/lib/underscore","csui/utils/base","csui/utils/log","csui/models/command"],function(e,i,t,n,o,s){return s.extend({"defaults":{"signature":"AddCategory","command_key":["addcategory","AddCategory"],"scope":"single"},"enabled":function(e,i){var t=this.get("scope"),n=this._getNodesByScope(e,t);if(n&&n.length>0){if(void 0===n[0].get("id")){var o=!0;return e.originalFormCollection&&e.originalFormCollection.each(function(e){"categories"===e.get("role_name")&&!1===e.get("schema").additionalProperties&&(o=!1)}),o}return s.prototype.enabled.apply(this,arguments)}},"execute":function(e,t){var n=i.Deferred();return csui.require(["csui/widgets/metadata/metadata.add.categories.controller"],function(e){(new e).AddNewCategory(t).done(function(e){t.addPropertiesCallback&&t.addPropertiesCallback.call(t.parentView,e.catModel),n.resolve()}).fail(function(e){n.reject(e)})},function(e){o.warn("Failed to load MetadataAddCategoriesController. {0}",e)&&console.warn(o.last),n.reject(e)}),n.promise()}})}),csui.define("csui/utils/commands/compound.document/compound.document.util",["csui/lib/underscore"],function(e){function i(i){var t;return t=e.has(i._factories.ancestors.property,"models")&&i._factories.ancestors.property.models,!e.find(t,function(i){return e.contains([138,139],i.attributes.type)})}return{
"verifyNodeAncestors":i}}),csui.define("csui/utils/commands/add",["module","require","csui/lib/jquery","csui/lib/underscore","csui/utils/log","csui/models/command","csui/models/node/node.model","csui/utils/commands/add/add.mixin","csui/utils/commands/compound.document/compound.document.util","i18n!csui/utils/commands/nls/localized.strings"],function(e,i,t,n,o,s,r,a,c,l){"use strict";var u=e.config(),d=[0,1,140,144,298,1307,1308,800,801],m=[144,801,1307],g=[],p=u.extSupportTypes||{},f=u.extNoFormTypes||{},v=u.extAddCommandSignatures||{};d=Array.prototype.concat.apply(d,n.values(p)),m=Array.prototype.concat.apply(m,n.values(f)),g=Array.prototype.concat.apply(g,n.values(v));var w=s.extend({"defaults":{"signature":"Add"},"enabled":function(e){if(e||(e={}),e.container&&e.container.get("container")){if(298===e.container.get("type")||136===e.container.get("type")&&!c.verifyNodeAncestors(e.context))return!1;e.data||(e.data={});var i=e.data.addableTypes;return i&&n.any(d,function(e){return!!i.get(e)})}return!1},"execute":function(e,i){if(i&&void 0===i.addableType)throw new Error("Missing options.addableType");var n,o,s=this._getAddableTypeName(e,i);switch(i.addableType){case 0:case 298:case 1308:case 800:case 136:e.forwardToTable=!0,n=new r({"type":i.addableType,"type_name":s,"container":!0,"name":""},{"connector":e.container.connector,"collection":e.collection}),o=t.Deferred().resolve(n).promise();break;case 140:e.forwardToTable=!0,n=new r({"type":i.addableType,"type_name":s,"container":!1,"name":""},{"connector":e.container.connector,"collection":e.collection}),o=t.Deferred().resolve(n).promise();break;case 1:e.forwardToTable=!0,o=this._selectShortcutTarget(e,i);break;case 144:case 1307:case 801:e.suppressSuccessMessage=!0,i.actionType="UPLOAD",o=this._selectFilesForUpload(e,i);break;default:o=this._executeExtCommands(e,i)}return o},"_executeExtCommands":function(e,i){var o=t.Deferred(),s=this;return csui.require(["csui/utils/commands"],function(t){for(var r=0;r<g.length;r++){var a=t.get(g[r]);if(a.supportTypes&&n.indexOf(a.supportTypes,i.addableType)>-1){a.execute(e,i).done(o.resolve).fail(o.reject);break}}r===g.length&&s.noAddCommandMessage(i).fail(o.reject)}),o.promise()},"noAddCommandMessage":function(e){var i='The "Add" action for the addableType '+e.addableType+" is not implemented";return o.debug(i)&&console.log(o.last),t.Deferred().reject({"error":i,"commandSignature":this.signature}).promise()},"_selectShortcutTarget":function(e,i){var n=this,o=t.Deferred();return csui.require(["csui/dialogs/node.picker/node.picker"],function(t){var s={"dialogTitle":l.ShortcutPickerTitle,"connector":e.container.connector,"context":i.context,"initialContainer":e.container,"globalSearch":!0,"startLocation":"recent.containers","startLocations":["enterprise.volume","current.location","personal.volume","favorites","recent.containers"],"unselectableTypes":[141,142,133],"resolveShortcuts":!0,"resultOriginalNode":!0},a=n._getAddableTypeName(e,i);return n.nodePicker=new t(s),n.nodePicker.show().then(function(i){var t=i.nodes[0];return new r({"type":1,"type_name":a,"container":!1,"name":t.get("name"),"original_id":t.get("id"),"original_id_expand":t.attributes},{"connector":e.container.connector,"collection":e.collection})}).done(function(){o.resolve.apply(o,arguments)}).fail(function(){o.reject.apply(o,arguments)})},function(e){o.reject(e)}),o.promise()}},{"isAddableTypeWithoutInlineForm":function(e){return-1!==m.indexOf(e)}});return a.mixin(w.prototype),w}),csui.define("csui/utils/commands/add.item.metadata",["module","require","csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/utils/log","csui/utils/commandhelper","csui/models/command"],function(e,i,t,n,o,s,r,a){var c=a.extend({"defaults":{"signature":"AddItemMetadata","command_key":"Add_Item","scope":"single"},"execute":function(e,i){var t=n.Deferred();return csui.require(["csui/widgets/metadata/metadata.add.item.controller"],function(n){(new n).displayForm(e,i).done(function(){t.resolve.apply(t,arguments)}).fail(function(){t.reject.apply(t,arguments)})},function(e){t.reject(e)}),t.promise()}});return c.version="1.0",c}),csui.define("csui/utils/commands/add.version",["module","require","csui/lib/jquery","csui/lib/underscore","i18n!csui/utils/commands/nls/localized.strings","csui/models/command","csui/utils/commandhelper","csui/dialogs/file.open/file.open.dialog"],function(e,i,t,n,o,s,r,a){"use strict";var c=e.config();n.defaults(c,{"actionType":"ADD_VERSION","hideWarningAlert":!1});var l;return s.extend({"defaults":{"signature":"AddVersion","command_key":"addversion","name":o.CommandNameAddVersion,"scope":"single"},"execute":function(e,i){e||(e={});var n=t.Deferred(),s=this;return this.trigger("close:dialogView:form"),csui.require(["csui/controls/globalmessage/globalmessage"],function(){if(l=arguments[0],l.isActionInProgress(c.actionType,o.AddVersionNotAllowed,o.CommandNameAddVersion))return n.resolve();e.tableView&&(e.tableView.lockedForOtherContols=!1),s._pickFileAndUpload(e,i).done(n.resolve),e.suppressSuccessMessage=!0;var t=e.file;t&&s._addVersionController(t,e).done(n.resolve).fail(n.reject)}),n.promise()},"_pickFileAndUpload":function(e,i){var n=new a({"multiple":!1}),o=t.Deferred(),s=this;return o.resolve(),n.listenTo(n,"add:files",function(i){s._addVersionController(i[0],e).done(o.resolve).fail(o.reject).always(function(){n.destroy()})}).show(),o.promise()},"_addVersionController":function(e,i){var n=t.Deferred();return csui.require(["csui/controls/fileupload/impl/addversion.controller"],function(t){var o=r.getJustOneNode(i);return new t({"status":i,"view":i.originatingView,"selectedNode":o}).uploadFile(e,c).done(n.resolve)},function(e){n.reject(e)}),n.promise()}})}),csui.define("csui/utils/commands/open.node.perspective",["require","csui/lib/jquery","csui/lib/underscore","csui/models/command","csui/utils/commandhelper","i18n!csui/utils/commands/nls/localized.strings"],function(e,i,t,n,o,s){"use strict";return n.extend({"execute":function(e,n){var r=i.Deferred();return n&&n.originatingView&&n.originatingView.trigger("destroy:gallery"),csui.require(["csui/utils/contexts/factories/next.node"],function(i){var a=e.context||n&&n.context,c=a.getModel(i),l=o.getJustOneNode(e);if(!l||!l.get("id"))return void r.reject({"message":s.MissingNodeId});var u=a.viewStateModel.get("state");u&&a.viewStateModel.set("state",t.omit(u,"filter"),{"silent":!0}),c.trigger("before:change:id",l,n&&n.originatingView);var d=l.get("id");c.unset("id",{"silent":!0}).set("id",d),r.resolve()},function(e){r.reject(e)}),r.promise()}})}),csui.define("csui/utils/commands/browse",["csui/utils/commands/open.node.perspective","csui/utils/commandhelper"],function(e,i){"use strict";return e.extend({"defaults":{"signature":"Browse","command_key":["default","open","browse","Browse"],"scope":"single"},"enabled":function(e){var t=i.getJustOneNode(e);return t&&t.get("container")&&(t.get("openable")||this.checkPermittedActions(t))}})}),csui.define("csui/utils/commands/collection/nls/lang",{"root":!0,"en-us":!1,"en":!1}),csui.define("csui/utils/commands/collection/nls/root/lang",{"collectCommandSignature":"Collect","addItemsToolTip":"Add Items","collectItemsDialogTitle":"Add items","selectCollectionDialogTitle":"Select collection","selectButtonLabel":"Add","selectCollectButtonLabel":"Collect","conflictsItemsHeader":"Listed items will not be added","conflictsDialogCloseLabel":"Close","CollectItemsNoneMessage":"No items added.","CollectOneItemSuccessMessage":"1 new item was successfully added","CollectManyItemsSuccessMessage":"{0} new items were successfully added","CollectOneItemFailMessage":"1 of your collected items already added","CollectManyItemsFailMessage":"{0} of your collected items are already added","RemoveCollectItemsCommandConfirmDialogHtml":"<span class='msgIcon WarningIcon'><%- message %></span>","RemoveCommandConfirmDialogSingleMessage":'Do you want to remove "{0}" from collection?',"RemoveCommandConfirmDialogMultipleMessage":"Do you want to remove {0} items from collection?","RemoveCommandConfirmDialogTitle":"Remove from collection","RemoveItemsNoneMessage":"No items removed from collection.","RemoveOneItemSuccessMessage":"1 item successfully removed from collection.","RemoveSomeItemsSuccessMessage":"{0} items successfully removed from collection.","RemoveManyItemsSuccessMessage":"{0} items successfully removed from collection.","RemoveOneItemFailMessage":"1 item failed to remove from collection.","RemoveSomeItemsFailMessage":"{0} items failed to remove from collection.","RemoveManyItemsFailMessage":"{0} items failed to remove from collection.","RemoveSomeItemsFailMessage2":"{2} items failed to remove from collection.","RemoveManyItemsFailMessage2":"{2} items failed to remove from collection.","RemoveItems":"Removing {0} items from collection","RemovingOneItem":"Removing item from collection","RemovingSomeItems":"Removing {0} items from collection","CollectingOneItem":"Collecting item","CollectingItems":"Collecting {0} items","CollectManyItemsFailMessage2":"{2} items failed to Collecting.","removefromCollection":"Remove from collection"}),csui.define("csui/utils/commands/collection/collect.items",["module","require","csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/utils/url","csui/utils/command.error","csui/models/command","i18n!csui/utils/commands/collection/nls/lang","csui/utils/base","csui/models/nodes","csui/lib/underscore.string"],function(e,i,t,n,o,s,r,a,c,l,u){"use strict";var d=e.config();t.defaults(d,{"parallelism":3});var m,g,p,f,v,w,h=a.extend({"defaults":{"signature":"CollectionCanCollect","name":c.addItemsToolTip,"command_key":["collectionCanCollect"],"scope":"single","successMessages":{"formatForOne":c.CollectOneItemSuccessMessage,"formatForTwo":c.CollectManyItemsSuccessMessage,"formatForMany":c.CollectManyItemsSuccessMessage,"formatForFive":c.CollectManyItemsSuccessMessage},"errorMessages":{"formatForOne":c.CollectOneItemFailMessage,"formatForTwo":c.CollectManyItemsFailMessage,"formatForMany":c.CollectManyItemsFailMessage,"formatForFive":c.CollectManyItemsFailMessage}},"enabled":function(e){var i=!1;if(298===e.container.get("type")&&(e.nodes=new u([e.container]),i=h.__super__.enabled.apply(this,arguments))){var t=e.container.commands;t&&(t.indexOf("Collect")>0||t.indexOf("collect")>0)&&(i=!(!e.container.actions.get("Collect")&&!e.container.actions.get("collect")))}return i},"execute":function(e,i){var o=n.Deferred(),s=this;return csui.require(["csui/controls/globalmessage/globalmessage","csui/controls/conflict.resolver/impl/collection.conflicts/collection.conflicts.view","csui/utils/taskqueue","csui/models/fileuploads","csui/utils/page.leaving.blocker","csui/utils/contexts/factories/next.node"],function(){m=arguments[0],w=arguments[1],g=arguments[2],p=arguments[3],f=arguments[4],v=arguments[5],s._addToCollection(e,i).done(function(i){var n=i.nodes,r=t.map(n,function(e){return{"name":e.get("name"),"state":"pending","count":0,"total":1,"node":e}}),a=e.container,c=new p(r,{"connector":l}),l=e.container&&e.container.connector;e.container.collection=e.collection,s._announceOperationStart(e),c.each(function(e){var i=e.get("node");e.node=i,e.unset("node"),e.set("mime_type",i.get("mime_type"))}),s._addSelectedNodesToCollection(c,l,a,e.collection).then(function(e){m.hideFileUploadProgress();var i=s._checkPromises(e);i.failedNodes.length?s._showDialog(i.failedNodes).then(function(e,t){t.kill(),i.successNodes.length&&s._showGlobalMessage(i.successNodes.length)}):i.successNodes.length&&s._showGlobalMessage(i.successNodes.length)}),s._announceOperationEnd(e),o.resolve()}).fail(function(e){e&&!e.cancelled&&s.showError(e),o.reject()})}),o.promise()},"_addToCollection":function(e,i){var o=this,s=n.Deferred();return csui.require(["csui/dialogs/node.picker/node.picker"],function(n){var r=t.extend({"selectableTypes":[],"showAllTypes":!0,"orderBy":"type asc","dialogTitle":c.collectItemsDialogTitle,"selectButtonLabel":c.selectButtonLabel,"globalSearch":!0,"selectMultiple":!0,"context":i?i.context:e.context,"startLocations":["enterprise.volume","current.location","personal.volume","favorites","recent.containers"],"resolveShortcuts":!0},e);o.nodePicker=new n(r),o.nodePicker.show().done(function(){s.resolve.apply(s,arguments)}).fail(function(){s.reject.apply(s,arguments)})},function(e){s.reject(e)}),s.promise()},"_addSelectedNodesToCollection":function(e,i,o,s){var r=this,a=new g({"parallelism":d.parallelism}),l=0,u=t.map(e.models,function(e){var t=n.Deferred();return a.pending.add({"worker":function(){var n=e.node,a=n.get("id"),c=o.get("id");return r._collectNode(i,c,a).done(function(){e.set("count",1),e.deferred.resolve(e),r._addToCurrentTable(e.node,s,c),t.resolve(e)}).fail(function(i){t.resolve(e)}),t.promise()}}),l++,t.promise(u)});return m.showFileUploadProgress(e,{"oneFileTitle":c.CollectingOneItem,"oneFileSuccess":c.CollectOneItemSuccessMessage,"multiFileSuccess":c.CollectManyItemsSuccessMessage,"oneFilePending":c.CollectingOneItem,"multiFilePending":c.CollectingItems,"oneFileFailure":c.CollectOneItemFailMessage,"multiFileFailure":c.CollectManyItemsFailMessage2,"someFileSuccess":c.CollectManyItemsSuccessMessage,"someFilePending":c.CollectingItems,"someFileFailure":c.CollectManyItemsFailMessage2,"enableCancel":!1}),n.whenAll.apply(n,u)},"_collectNode":function(e,i,t){var o=n.Deferred(),r={"collection_id":i},a={"url":s.combine(e.getConnectionUrl().getApiBase("v2"),"/nodes/"+t),"type":"PUT","data":r,"contentType":"application/x-www-form-urlencoded"};return e.makeAjaxCall(a).done(function(e){o.resolve(e)}).fail(function(e){o.reject(e)}),o.promise()},"_getListView":function(e){return new w(t.extend({},{"collection":e}))},"_showDialog":function(e){var i=n.Deferred(),t=[{"id":"close","close":!0,"label":c.conflictsDialogCloseLabel,"toolTip":c.conflictsDialogCloseLabel,"click":function(e){i.resolve("close",e.dialog)}}];return this._showConflictDialog(e,t),i},"_showConflictDialog":function(e,i){var t=this;n.Deferred();csui.require(["csui/controls/dialog/dialog.view"],function(n){var o=l.formatMessage(e.length,t.get("errorMessages")),s=new n({"title":o,"midSize":!0,"iconLeft":"csui-icon-notification-information","className":"csui-collection-conflicts-dialog","view":t._getListView(e),"buttons":i});return s.show(),s})},"_checkPromises":function(e){t.isArray(e)||(e=[e]);var i=new o.Collection,n=new o.Collection;return t.each(e,function(e){void 0!==e&&(e.cancelled||void 0===e.get("count")||(e.get("count")?i.push(e):n.push(e)))}),{"successNodes":i,"failedNodes":n}},"_addToCurrentTable":function(e,i,t){e.refernce_id=t,e.fetch({"collection":i}).then(function(){var t=e.clone();t.isLocallyCreated=!0,i.unshift(t)})},"_showGlobalMessage":function(e){var i=l.formatMessage(e,this.get("successMessages"));m.showMessage("success",i)},"_announceOperationStart":function(e){var i=e.originatingView;i.blockActions&&i.blockActions(),f.enable(this.get("pageLeavingWarning"))},"_announceOperationEnd":function(e){f.disable();var i=e.originatingView;i.unblockActions&&i.unblockActions()}});return h}),csui.define("csui/utils/commands/multiple.items",["module","require","csui/lib/underscore","csui/lib/jquery","csui/utils/base","csui/utils/commandhelper","csui/utils/command.error"],function(e,i,t,n,o,s,r){"use strict";var a=e.config();t.defaults(a,{"parallelism":3});var c;return{"execute":function(e,i){return e.suppressFailMessage=!0,e.suppressSuccessMessage=!0,this._performActions(e,i)},"_performActions":function(e,i){var o,r=n.Deferred(),l=this;return csui.require(["csui/utils/taskqueue","csui/utils/page.leaving.blocker"],function(u){c=arguments[1],i=i||{},i.context||(i.context=e.context),l._announceStart(e);var d=s.getAtLeastOneNode(e),m=new u({"parallelism":i.parallelism||a.parallelism});o=d.map(function(e,t){var o=n.Deferred();return m.pending.add({"worker":function(){return l._performAction(e,i).done(o.resolve).fail(function(e){o.reject(e)}),o.promise()}}),o.promise()}),n.whenAll.apply(n,o).always(t.bind(l._announceFinish,l,e)).done(function(){e.suppressMultipleSuccessMessage||l.showSuccess(o),r.resolve.apply(r,arguments)}).fail(function(){e.suppressMultipleFailMessage||l.showError(o),r.reject.apply(r,arguments)})},function(e){r.reject(e)}),r.promise()},"showError":function(e){var i,t,n=this._checkPromises(e);if(n){var o=n.countFailed,s=n.countOk;i=this._getErrorMessage(o);var r;s>0?(t=this._getSuccessMessage(s),r=t+" "+i):r=i,csui.require(["csui/controls/globalmessage/globalmessage"],function(e){e.showMessage("error",r,void 0,{})})}},"showSuccess":function(e){var i,t=this._checkPromises(e);if(t){var n=t.countOk;i=this._getSuccessMessage(n),csui.require(["csui/controls/globalmessage/globalmessage"],function(e){e.showMessage("success",i,void 0,{})})}},"showSuccessWithLink":function(e,i){var t,n=this._checkPromises(e);if(n){var o=n.countOk;t=this._getSuccessMessage(o),csui.require(["csui/controls/globalmessage/globalmessage"],function(e){e.showMessage("success_with_link",t,void 0,i)})}},"_getErrorMessage":function(e){var i=this.get("errorMessages");return o.formatMessage(e,i)},"_getSuccessMessage":function(e){var i=this.get("successMessages");return o.formatMessage(e,i)},"_checkPromises":function(e){t.isArray(e)||(e=[e]);var i=0,n=0;return t.each(e,function(e){void 0!==e&&(e.cancelled||(e instanceof r?n++:void 0!==e.state&&"function"==typeof e.state?e.state()&&"resolved"===e.state().toLowerCase()?i++:n++:i++))}),{"countOk":i,"countFailed":n}},"_setViewStateModelMultiItemOperationStatus":function(e,i){var t=e&&e.viewStateModel;t&&t.set("multiItemOperationRunning",i)},"_announceStart":function(e){if(!e.deleteBlockAction){var i=e.originatingView;i&&i.blockActions&&i.blockActions();var t=this.get("pageLeavingWarning");t&&c.enable(t)}this._setViewStateModelMultiItemOperationStatus(e.context,!0)},"_announceFinish":function(e){this._setViewStateModelMultiItemOperationStatus(e.context,!1),this.get("pageLeavingWarning")&&c.disable();var i=e.originatingView;i&&i.unblockActions&&i.unblockActions()}}}),csui.define("csui/utils/commands/confirmable",["csui/lib/underscore","csui/lib/jquery","require","csui/utils/commands/multiple.items"],function(e,i,t,n){var o={"execute":function(e,t){var n=this;return this._confirmAction(e,t).then(function(){return n._performActions(e,t)},function(e){return i.Deferred().reject().promise()})},"_confirmAction":function(t,n){var o=i.Deferred();if(this._getConfirmTemplate){var s=this._getConfirmData(t,n),r=this._getConfirmTemplate(t,n)(s);csui.require(["csui/dialogs/modal.alert/modal.alert"],e.bind(function(t){var n=e.isFunction(this._getButtons)?this._getButtons():{};t.confirmQuestion(i(r).text(),s.title,n).done(function(e){o.resolve(e)}).fail(function(e){o.reject(e)})},this))}else o.resolve();return o.promise()}};return e.extend(o,e.omit(n,"execute")),o}),csui.define("csui/utils/commands/collection/remove.collected.items",["module","require","csui/lib/underscore","csui/lib/jquery","csui/models/command","csui/utils/commandhelper","csui/utils/url","i18n!csui/utils/commands/collection/nls/lang","csui/utils/commands/confirmable","csui/utils/commands/multiple.items","csui/utils/command.error"],function(e,i,t,n,o,s,r,a,c,l,u){"use strict";var d=e.config();t.defaults(d,{"parallelism":1});var m,g=o.extend({"defaults":{"signature":"RemoveCollectedItems","command_key":"removefromcollection","name":a.removefromCollection,"pageLeavingWarning":a.DeletePageLeavingWarning,"scope":"multiple","successMessages":{"formatForNone":a.RemoveItemsNoneMessage,"formatForOne":a.RemoveOneItemSuccessMessage,"formatForTwo":a.RemoveSomeItemsSuccessMessage,"formatForFive":a.RemoveManyItemsSuccessMessage},"errorMessages":{"formatForNone":a.RemoveItemsNoneMessage,"formatForOne":a.RemoveOneItemFailMessage,"formatForTwo":a.RemoveSomeItemsFailMessage,"formatForFive":a.RemoveManyItemsFailMessage}},"allowCollectionRefetch":!1,"_getConfirmTemplate":function(e,i){return t.template(a.RemoveCollectItemsCommandConfirmDialogHtml)},"_getConfirmData":function(e,i){var n=s.getAtLeastOneNode(e),o=1===n.length?t.str.sformat(a.RemoveCommandConfirmDialogSingleMessage,n.at(0).get("name")):t.str.sformat(a.RemoveCommandConfirmDialogMultipleMessage,n.length);return{"title":a.RemoveCommandConfirmDialogTitle,"message":o}},"_performAction":function(e,i){var t=e.node,o=n.Deferred(),s={"collection_id":i.container.get("id"),"operation":"remove"},a=i.container.connector,c=i.containerCollection,l={"url":r.combine(a.getConnectionUrl().getApiBase("v2"),"/nodes/"+t.get("id")),"type":"PUT","data":s,"contentType":"application/x-www-form-urlencoded"},d=a.makeAjaxCall(l).done(function(i){e.set("count",1),c.remove(t),e.deferred.resolve(e),o.resolve(e)}).fail(function(i){var t=i?new u(i,e):i;e.deferred.reject(e,t),i||d.abort(),o.reject(t)});return o.promise()},"startGlobalMessage":function(e){m.showFileUploadProgress(e,{"oneFileTitle":a.RemovingOneItem,"oneFileSuccess":a.RemoveOneItemSuccessMessage,"multiFileSuccess":a.RemoveManyItemsSuccessMessage,"oneFilePending":a.RemovingOneItem,"multiFilePending":a.RemoveItems,"oneFileFailure":a.RemoveOneItemFailMessage,"multiFileFailure":a.RemoveManyItemsFailMessage2,"someFileSuccess":a.RemoveSomeItemsSuccessMessage,"someFilePending":a.RemovingSomeItems,"someFileFailure":a.RemoveSomeItemsFailMessage2,"enableCancel":!1})}});return t.extend(g.prototype,c,{"execute":function(e,i){var t=n.Deferred(),o=this;return e.suppressFailMessage=!0,e.suppressSuccessMessage=!0,csui.require(["csui/controls/globalmessage/globalmessage"],function(n){m=n,o._executeRemoveCollectionItems(e,i).then(t.resolve,t.reject)},t.reject),t.promise()},"_executeRemoveCollectionItems":function(e,i){var o=this;i||(i={});var r=s.getAtLeastOneNode(e),a=(1===r.length&&r.first(),n.Deferred()),l=e.data||{};e.context||i.context;i.parallelism||(i.parallelism=d.parallelism);var g=null==l.showProgressDialog||l.showProgressDialog;return c.execute.apply(this,arguments).done(function(t){g&&m.hideFileUploadProgress(),i.infiniteScroll&&e.collection.fetch({"reset":!1,"remove":!1,"merge":!0}),o.allowCollectionRefetch=!0,a.resolve(t)}).fail(function(e){var i=e&&t.find(e,function(e){return!(e instanceof u)}),n=i||e;a.reject(n)}),a.promise()},"_performActions":function(e,i){i||(i={});var o=this,s=n.Deferred(),r=e.data||{},a=null==r.showProgressDialog||r.showProgressDialog;return i.container||(i.container=e.container),i.containerCollection=e.collection,csui.require(["csui/models/fileuploads"],function(n){var r=e.nodes.models,c=t.map(r,function(e){return{"name":e.get("name"),"state":"pending","count":0,"total":1,"node":e}}),u=r&&r[0]&&r[0].connector,d=new n(c,{"connector":u}),g=t.defaults({"nodes":d},e);d.each(function(e){var i=e.get("node");e.node=i,e.unset("node"),e.set("mime_type",i.get("mime_type"))}),a&&o.startGlobalMessage(d),g.suppressMultipleSuccessMessage=!0,g.suppressMultipleFailMessage=!0,l._performActions.call(o,g,i).done(function(e){a&&m.hideFileUploadProgress(),o.showSuccess(e),s.resolve(e)}).fail(function(e){return a||o.showError(e),s.reject(e)})},s.reject),s.promise()}}),g}),csui.define("csui/utils/commands/copy.move",["module","require","csui/lib/underscore","csui/utils/base","csui/lib/jquery","csui/utils/log","csui/utils/url","i18n!csui/utils/commands/nls/localized.strings","csui/models/command","csui/utils/commandhelper","csui/utils/commands/multiple.items"],function(e,i,t,n,o,s,r,a,c,l,u){"use strict";var d,m,g,p,f,v,w,h,b=c.extend({"constructor":function(e){c.prototype.constructor.call(this,e)}});return t.extend(b.prototype,u),b.extend({"execute":function(e,i){var s=this,r=o.Deferred(),c=e.context||i&&i.context,u=s.get("labels");return w=s.get("command"),e.suppressSuccessMessage=!0,e.suppressFailMessage=!0,csui.require(["csui/controls/globalmessage/globalmessage","csui/controls/conflict.resolver/conflict.resolver","csui/dialogs/node.picker/impl/header/apply.properties.selector/apply.properties.selector.view","csui/models/fileuploads","csui/utils/page.leaving.blocker","csui/utils/node.links/node.links","csui/utils/contexts/factories/application.scope.factory"],function(){if(d=arguments[0],m=arguments[1],g=arguments[2],p=arguments[3],f=arguments[4],v=arguments[5],h=arguments[6],d.isActionInProgress(w,u.titleNotAllowed,u.commandTitle))return r.resolve();s._selectActionOptions(e,i,u).done(function(i){var o=e.nodes,d=i.nodes[0],m=i.applyProperties,g=(new Date).getTime(),f=!!e.container&&d.get("id")===e.container.get("id");s._announceOperationStart(e);var w=o.map(function(e){var i={"id":e.get("id"),"name":e.get("name"),"container":e.get("container"),"mime_type":e.get("mime_type"),"original_id":e.get("original_id"),"original":e.original,"type":e.get("type"),"size":e.get("size"),"type_name":e.get("type_name"),"state":"pending","count":0,"total":1,"enableCancel":!1,"bundleNumber":g},t=e.get("type");return 144===t||749===t||736===t||30309===t?i.size_formatted=e.get("size_formatted"):140===t&&(i.url=e.get("url")),i.actions=e.actions,i.targetLocation={"id":d.get("id"),"url":v.getUrl(d)},n.getMetadataLanguageInfo().enabled&&(i.multilingual_provided=!0,!!e.has("name_multilingual")&&(i.name_multilingual=e.get("name_multilingual")),!!e.has("description_multilingual")&&(i.description_multilingual=e.get("description_multilingual"))),i}),b=t.map(w,function(e){return t.clone(e)});s._resolveNamingConflicts(d,b,u).done(function(n){t.each(n,function(e){void 0===e.id&&(e.id=t.findWhere(w,{"name":e.name}).id)}),s._metadataHandling(n,u,t.extend(i,{"context":c,"targetFolder":d})).done(function(){var i=new p(n,{"container":d?d.clone():void 0});u.commandName===a.CommandNameMove?i.each(function(e){e.node=o.findWhere({"id":e.get("id")})}):i.each(function(e){var i=o.findWhere({"id":e.get("id")});e.node.set(t.omit(i.attributes,"id"))});var g=e.container&&e.container.connector;if(void 0===g){var v=l.getAtLeastOneNode(e).first();v&&(g=v.connector)}var w=e.originatingView&&e.originatingView.context&&e.originatingView.context.getModel(h),b={"uploadCollection":i,"connector":g,"targetFolder":d,"applyProperties":m,"status":e,"context":c,"copyToCurrentFolder":f,"collection":e.collection,"applicationScopeId":w&&w.id};s._doActionSelectedNodes(b).done(function(){r.resolve(s._doPostExecute(b))}).always(function(){s._announceOperationEnd(e),u.commandName===a.CommandNameMove&&b.context.trigger("current:folder:changed")}).fail(function(){r.reject()})}).fail(function(){s._announceOperationEnd(e),r.reject()})}).fail(function(i){i&&i.userAction&&"cancelResolveNamingConflicts"===i.userAction?s.trigger("resolve:naming:conflicts:cancelled"):i&&!i.cancelled&&s.showError(i),s._announceOperationEnd(e),r.reject()})}).fail(function(e){e&&!e.cancelled&&s.showError(e),r.reject()})},r.reject),r.promise()},"_announceOperationStart":function(e){var i=e.originatingView;i.blockActions&&i.blockActions(),f.enable(this.get("pageLeavingWarning"))},"_announceOperationEnd":function(e){f.disable(),this._unblockPageActions(e)},"_unblockPageActions":function(e){var i=e.originatingView;i.unblockActions&&i.unblockActions()},"_selectActionOptions":function(e,i,n){var s=this,r=o.Deferred();return csui.require(["csui/dialogs/node.picker/node.picker"],function(o){var a=!!e.container&&e.container.get("id")===e.nodes.models[0].get("id"),c=e.nodes.length,l=t.str.sformat(c>1?n.dialogTitle:n.dialogTitleSingle,c),u=t.extend({"command":w,"selectableTypes":[-1],"unselectableTypes":[899],"addableTypes":[0],"showAllTypes":!0,"orderBy":"type asc","dialogTitle":l,"initialContainer":e.container||e.nodes.models[0].parent,"initialSelection":e.nodes,"startLocation":a?"recent.containers":"","includeCombineProperties":1===c,"propertiesSeletor":!0,"globalSearch":!0,"disableSearchFromHere":!0,"context":i?i.context:e.context,"startLocations":["enterprise.volume","current.location","personal.volume","favorites","recent.containers"],"resolveShortcuts":!0,"resultOriginalNode":!0,"includeResources":["show_hidden"]},e);s.nodePicker=new o(u),s.originatingView=e.originatingView,s.nodePicker.show().done(function(){r.resolve.apply(r,arguments)}).fail(function(){r.reject.apply(r,arguments)})},function(e){r.reject(e)}),r.promise()},"_resolveNamingConflicts":function(e,i,n){var o=1===i.length?n.actionNode:t.str.sformat(n.actionName,i.length);return new m({"h1Label":o,"actionBtnLabel":n.commandName,"excludeAddVersion":!0,"container":e,"files":i,"originatingView":this.originatingView}).run()},"_metadataHandling":function(e,i,t){var n=o.Deferred();return this.originatingView&&0===this.originatingView._blockingCounter&&this.originatingView.blockActions(),csui.require(["csui/widgets/metadata/metadata.copy.move.items.controller"],function(i){var o,s=t.openSelectedProperties,r=t.applyProperties,a=new i;if(s)o=a.CopyMoveItemsWithMetadata;else{if(r!==g.APPLY_DESTINATION_PROPERTIES&&r!==g.COMBINE_ALL_PROPERTIES)return n.resolve();o=a.CopyMoveItemsRequiredMetadata}r===g.KEEP_ORIGINAL_PROPERTIES?t.inheritance="original":r===g.APPLY_DESTINATION_PROPERTIES?t.inheritance="destination":r===g.COMBINE_ALL_PROPERTIES&&(t.inheritance="merged"),t.action=w,o.call(a,e,t).done(function(){n.resolve()}).fail(function(e){n.reject(e)})},function(e){s.warn("Failed to load MetadataCopyMoveItemsController. {0}",e)&&console.warn(s.last),n.reject(e)}),n.promise()},"_addToCurrentTable":function(e,i){e.isLocallyCreated=!0,e.fetch({"collection":i}).then(function(){i.unshift(e)})},"checkMultilingualInfo":function(e,i){e.multilingual_provided&&(t.extend(i,{"name_multilingual":e.name_multilingual}),e.description_multilingual&&t.extend(i,{"description_multilingual":e.description_multilingual}))}})}),csui.define("csui/utils/commands/copy",["module","require","csui/lib/underscore","csui/lib/jquery","i18n!csui/utils/commands/nls/localized.strings","csui/utils/commands/copy.move","csui/utils/command.error"],function(e,i,t,n,o,s,r){"use strict";var a=t.extend({},e.config());return t.defaults(a,{"actionType":"copy","parallelism":3,"allowMultipleInstances":!0}),s.extend({"defaults":{"signature":"Copy","command_key":["copy","Copy"],"name":o.CommandNameCopy,"verb":o.CommandVerbCopy,"pageLeavingWarning":o.CopyPageLeavingWarning,"allowMultipleInstances":a.allowMultipleInstances,"scope":"multiple","successMessages":{"formatForNone":o.CopyItemsNoneMessage,"formatForOne":o.CopyOneItemSuccessMessage,"formatForTwo":o.CopySomeItemsSuccessMessage,"formatForFive":o.CopyManyItemsSuccessMessage},"errorMessages":{"formatForNone":o.CopyItemsNoneMessage,"formatForOne":o.CopyOneItemFailMessage,"formatForTwo":o.CopySomeItemsFailMessage,"formatForFive":o.CopyManyItemsFailMessage},"labels":{"actionName":o.CopyingNodes,"actionNode":o.CopyingNode,"commandTitle":o.CommandTitleCopy,"commandName":o.CommandNameCopy,"dialogTitle":o.DialogTitleCopy,"dialogTitleSingle":o.DialogTitleSingleCopy,"titleNotAllowed":o.CopyNotAllowed},"command":a.actionType},"_doActionSelectedNodes":function(e){var i=n.Deferred();return csui.require(["csui/utils/contexts/factories/next.node","csui/controls/globalmessage/globalmessage","csui/utils/taskqueue"],t.bind(function(s,c,l){var u=this,d=new l({"parallelism":a.parallelism}),m=t.map(e.uploadCollection.models,function(i){var t=n.Deferred();return d.pending.add({"worker":function(){var n=i.attributes,o=e.targetFolder.get("id");return u._getCategories(n,e.connector,o,e.applyProperties).done(function(s){u._copyNode(s,n,e.connector,o,i.node).done(function(){i.set("count",1),i.deferred.resolve(i),e.copyToCurrentFolder&&u._addToCurrentTable(i.node,e.collection),t.resolve(n)}).fail(function(e){var n=new r(e);i.deferred.reject(i,n),t.reject(n)})}).fail(function(e){var n=new r(e);i.deferred.reject(i,n),t.reject(n)}),t.promise()}}),t.promise(m)});return c.showProgressPanel(e.uploadCollection,{"oneFileTitle":o.CopyingOneItem,"oneFileSuccess":o.CopyOneItemSuccessMessage,"multiFileSuccess":o.CopyManyItemsSuccessMessage,"oneFilePending":o.CopyingOneItem,"multiFilePending":o.CopyItems,"multiFileOneFailure":o.CopyManyItemsOneFailMessage,"oneFileFailure":o.CopyOneItemFailMessage,
"multiFileFailure":o.CopyManyItemsFailMessage,"someFileSuccess":o.CopySomeItemsSuccessMessage,"someFilePending":o.CopySomeItems,"someFileFailure":o.CopySomeItemsFailMessage2,"locationLabelPending":o.CopyingLocationLabel,"locationLabelCompleted":o.CopiedLocationLabel,"enableCancel":!1,"actionType":a.actionType,"allowMultipleInstances":a.allowMultipleInstances,"context":e.context,"nextNodeModelFactory":s}),this._unblockPageActions(e.status),n.whenAll.apply(n,m).then(i.resolve,i.reject)},this),i.reject),i.promise()},"_doPostExecute":function(e){var i;return e.status.collection&&e.status.originatingView&&e.status.originatingView.findNodeFromCollection?i=e.status.originatingView.findNodeFromCollection(e.status.collection,e.targetFolder):e.status.collection&&(i=e.status.collection.get(e.targetFolder.get("id"))||e.status.collection.findWhere({"id":e.targetFolder.get("id")})),!e.copyToCurrentFolder&&i&&i.fetch(),e.uploadCollection},"_copyNode":function(e,i,n,o,s){var r={"original_id":i.id,"parent_id":o,"name":i.newName?i.newName:i.name,"roles":e};return t.extend(r,i.extended_data),t.isFunction(this.checkMultilingualInfo)&&this.checkMultilingualInfo(i,r),s.connector||n.assignTo(s),s.save(void 0,{"data":r,"url":n.connection.url+"/nodes"})},"_getCategories":function(e,i,t,o){var s=n.Deferred();if(e.extended_data&&e.extended_data.roles)s.resolve(e.extended_data.roles);else if(o&&1===o)s.resolve({});else{var r={"url":i.connection.url+"/forms/nodes/copy?"+n.param({"id":e.id,"parent_id":t})};i.makeAjaxCall(r).then(function(e){var i,t=e.forms[1],n=t&&t.data||{};i={},csui.require(["csui/dialogs/node.picker/impl/header/apply.properties.selector/apply.properties.selector.view"],function(e){i[e.KEEP_ORIGINAL_PROPERTIES]="original",i[e.APPLY_DESTINATION_PROPERTIES]="destination",i[e.COMBINE_ALL_PROPERTIES]="merged";var t=n[i[o]];s.resolve({"categories":t})})}).fail(function(e){s.reject(e)})}return s.promise()}})}),csui.define("csui/utils/routing",["module","csui/lib/underscore"],function(e,i){"use strict";function t(e){if(void 0===n){var i=window.csui.requirejs.s.contexts._.config.config[e]||{};n=i.developmentPage}}var n=e.config().developmentPage;return t("csui/pages/start/perspective.routing"),t("csui/pages/start/impl/perspective.router"),{"routesWithSlashes":function(){return/\/app(?:\/.*)?$/.test(location.pathname)||!n}}}),csui.define("csui/utils/node.links/node.links",["csui/lib/underscore","csui/lib/backbone","csui/utils/url","csui/models/mixins/rules.matching/rules.matching.mixin","csui/utils/routing","csui-ext!csui/utils/node.links/node.links"],function(e,i,t,n,o,s){"use strict";var r=o.routesWithSlashes(),a=i.Model.extend({"defaults":{"sequence":100,"url":null},"constructor":function(e,t){i.Model.prototype.constructor.apply(this,arguments),this.makeRulesMatching(t)}});n.mixin(a.prototype);var c=i.Collection.extend({"model":a,"comparator":"sequence","constructor":function(e,t){i.Collection.prototype.constructor.call(this,e,t)},"getUrl":function(e,i){1===e.get("type")&&e.original&&e.original.get("id")>0&&(e=e.original);var t=this.find(function(i){return i.matchRules(e,i.attributes)});if(t){var n=t.get("getUrl")(e,i);return this.completeUrl(e,n,i)}},"completeUrl":function(e,i,n){if(!i)return location.href;var o=e.connector||n&&n.connector,s=new t(o&&o.connection.url||location.href),r=s.makeAbsoluteUrl(i,this._getApplicationUrlPrefix(s)),a=n&&n.context,c=a&&a.viewStateModel,l=c&&c.get("activeRouterInstance"),u=l&&l.nextNode&&l.nextNode.get("id")===e.get("id")&&l.buildUrlParams();return u&&(r+="?"+u),r},"_getApplicationUrlPrefix":function(e){return this.getHomeUrl(e)},"getHomeUrl":function(e){var i;if(r)i=t.combine(e.getCgiScript(),"/app/");else{i=(location.origin&&location.origin.indexOf("://")>0?location.origin:new t(location.href).getOrigin())+location.pathname+location.search+"#"}return i}}),l=new c;return s&&l.add(e.flatten(s,!0)),l}),csui.define("csui/utils/commands/copy.link",["module","require","csui/lib/underscore","csui/lib/jquery","csui/models/command","csui/utils/commandhelper","csui/utils/node.links/node.links","i18n!csui/utils/commands/nls/localized.strings"],function(e,i,t,n,o,s,r,a){"use strict";t.extend({},e.config());return o.extend({"defaults":{"signature":"CopyLink","name":a.CommandNameCopyLink},"enabled":function(e){return!!s.getJustOneNode(e)},"execute":function(e,i){var t=n.Deferred(),o=s.getJustOneNode(e),c={"context":e.context},l=e.url?r.completeUrl(o,e.url,c):r.getUrl(o,c),u=this._copyToClipboard(l);return csui.require(["csui/controls/globalmessage/globalmessage"],function(e){u?(t.resolve(),e.showMessage("success",a.CopyLinkSuccessMessage)):(t.reject(),e.showMessage("error",a.CopyLinkFailMessage))},t.reject),t.promise()},"_copyToClipboard":function(e){if(window.clipboardData)return window.clipboardData.setData("Text",e),!0;var i=!1,t=document.createTextNode(e),n=document.createElement("span");if(n.style.color="black",n.style.background="tranparent",n.style.backgroundColor="white",n.appendChild(t),document.body.appendChild(n),window.getSelection){var o=window.getSelection();o.removeAllRanges();var s=document.createRange();s.selectNodeContents(t),o.addRange(s),i=document.execCommand("copy"),o.removeAllRanges()}return document.body.removeChild(n),i}})}),csui.define("csui/models/perspective/perspective.model",["module","csui/lib/underscore","csui/lib/backbone","csui/models/mixins/uploadable/uploadable.mixin","csui/models/mixins/connectable/connectable.mixin","csui/utils/log","csui/utils/base","csui/utils/url"],function(e,i,t,n,o,s,r,a){"use strict";var c=i.extend({"idAttribute":null},e.config()),l=t.Model.extend({"idAttribute":c.idAttribute,"constructor":function(e,n){t.Model.prototype.constructor.call(this,e,n),this.options=i.pick(n,["connector"]),this.makeUploadable(n).makeConnectable(n)},"getPerspectiveId":function(){return this.get("id")},"getPerspective":function(){return this.get("perspective")},"setPerspective":function(e,i){this.set("perspective",e,i)},"update":function(e){this.set.apply(this,arguments)},"isNew":function(){return!this.get("id")||0===this.get("id")},"urlBase":function(){var e=this.get("id"),t=this.connector.connection.url;if(e){if(i.isNumber(e)&&!(e>0))throw new Error("Unsupported id value");t=a.combine(t,"perspectives",e)}else t=a.combine(t,"perspectives");return t},"url":function(){return this.urlBase()},"prepareFormData":function(e,i){return{"pData":JSON.stringify(e)}}});return n.mixin(l.prototype),o.mixin(l.prototype),l}),csui.define("csui/utils/commands/create.perspective",["module","require","csui/lib/underscore","csui/lib/jquery","csui/models/command","csui/utils/commandhelper","csui/utils/url","csui/models/perspective/perspective.model","i18n!csui/utils/commands/nls/localized.strings"],function(e,i,t,n,o,s,r,a,c){"use strict";var l=window.csui.requirejs.s.contexts._.config.config["csui/utils/contexts/perspective"]||{};l=t.extend({"enableInlinePerspectiveEditing":!0},l,e.config());var u,d,m;return o.extend({"defaults":{"signature":"CreatePerspective","name":c.CreatePerspective},"enabled":function(e,i){var t=e.context||i&&i.context,n=t.perspective.attributes;return!(void 0!==n.id||!n.canEditPerspective||"node"!==t._applicationScope.attributes.id)},"execute":function(e,i){var t=e.context||i&&i.context;return i&&i.inlinePerspectiveEditing||l.enableInlinePerspectiveEditing?this._editInline(e,i,t):this._editInClassicPMan(e,i,t)},"_preparePerspectiveConfig":function(e){var i={"perspective":{"type":"flow","options":{"widgets":[{"type":"csui/widgets/nodestable"}]}},"overrideType":"genericContainer","scope":"local","containerType":"-1","cascading":"false"},t=s.getJustOneNode(status)||e.getModel(d),n=e.getCollection(m);return i.nodepath=this._getNodePath(n),i.node=t.get("id"),i.containerType=t.get("type"),i.title=t.get("name"),i},"_editInline":function(e,i,t){var o=n.Deferred(),s=this;return csui.require(["csui/utils/contexts/factories/node","csui/utils/contexts/factories/connector","csui/utils/contexts/factories/ancestors","csui/perspective.manage/pman.view"],function(){d=arguments[0],u=arguments[1],m=arguments[2];var e=arguments[3],i=s._preparePerspectiveConfig(t,d,m);i.title=i.title+" "+(new Date).getTime();var n=new a(i,{"connector":t.getObject(u)});new e({"context":t,"perspective":n}).show(),o.resolve()},o.reject),o.promise()},"_editInClassicPMan":function(e,i,t){var o=n.Deferred(),s=this;return csui.require(["csui/utils/contexts/factories/connector","csui/utils/contexts/factories/node","csui/utils/contexts/factories/ancestors"],function(){u=arguments[0],d=arguments[1],m=arguments[2];var i=s._getForm(t,e);i.submit(),i.remove(),o.resolve()},o.reject),o.promise()},"_getForm":function(e,i){var t=n("<form target='_blank' method='POST' style='display:none;'></form>").attr({"action":this._getUrl(e,i)}).appendTo(document.body),o=this._getUrlQueryParameters(e,i);for(var s in o)o.hasOwnProperty(s)&&n('<input type="hidden" />').attr({"name":s,"value":o[s]}).appendTo(t);return t},"_getUrl":function(e,i){var t=e.getObject(u);return new r(t.connection.url).getCgiScript().toString()+"/perspectivemgr"},"_getUrlQueryParameters":function(e,i){var t=this._preparePerspectiveConfig(e,d,m);return t.ui={"elements":{"btn-mode-code":!0,"btn-view-general":!0,"btn-view-rules":!1,"btn-view-layout":!0,"btn-view-widgets":!0,"view-perspective-action":!0,"perspective-action-create":!0,"perspective-action-edit":!0,"perspective-action-copy":!0,"view-perspective-form":!0,"perspective-title":!0,"perspective-type":!0,"perspective-scope":!0,"perspective-nodetypes":!0,"perspective-node":!0,"perspective-cascading":!0,"display-size-msg":!1,"rules-code":!0,"layout-flow":!0,"layout-left-center-right":!0,"layout-grid":!1,"layout-tabbed":!1},"widgetGroupsBlacklist":[],"widgetsWhitelist":[],"disableGrouping":!1},{"config":JSON.stringify(t)}},"_getNodePath":function(e){var i="";return e.each(function(e){i+=i?":":"",i+=e.get("name")}),i}})}),csui.define("csui/utils/commands/node",["csui/lib/underscore","csui/models/command","csui/utils/commands/multiple.items"],function(e,i,t){var n=i.extend({"_performAction":function(e,i){throw new Error("Method not implemented in the descendant command.")}});return e.extend(n.prototype,t),n}),csui.define("csui/utils/commands/delete",["module","require","csui/lib/underscore","csui/lib/jquery","i18n!csui/utils/commands/nls/localized.strings","csui/utils/log","csui/utils/commandhelper","csui/utils/commands/node","csui/utils/commands/multiple.items","csui/utils/commands/confirmable","csui/utils/command.error"],function(e,i,t,n,o,s,r,a,c,l,u){"use strict";var d=e.config();t.defaults(d,{"parallelism":1,"actionType":"DELETE","allowMultipleInstances":!0,"deleteSelfHandler":null});var m,g,p,f=a.extend({"defaults":{"signature":"Delete","command_key":["delete","Delete"],"name":o.CommandNameDelete,"verb":o.CommandVerbDelete,"pageLeavingWarning":o.DeletePageLeavingWarning,"allowMultipleInstances":d.allowMultipleInstances,"scope":"multiple","successMessages":{"formatForNone":o.DeleteItemsNoneMessage,"formatForOne":o.DeleteOneItemSuccessMessage,"formatForTwo":o.DeleteSomeItemsSuccessMessage,"formatForFive":o.DeleteManyItemsSuccessMessage},"errorMessages":{"formatForNone":o.DeleteItemsNoneMessage,"formatForOne":o.DeleteOneItemFailMessage,"formatForTwo":o.DeleteSomeItemsFailMessage,"formatForFive":o.DeleteManyItemsFailMessage}},"allowCollectionRefetch":!1,"_getConfirmTemplate":function(e,i){return t.template(o.DeleteCommandConfirmDialogHtml)},"_getConfirmData":function(e,i){var n=r.getAtLeastOneNode(e),s=1===n.length?t.str.sformat(o.DeleteCommandConfirmDialogSingleMessage,n.at(0).get("name")):t.str.sformat(o.DeleteCommandConfirmDialogMultipleMessage,n.length);return{"title":o.DeleteCommandConfirmDialogTitle,"message":s}},"_getButtons":function(){return{"buttons":{"labelYes":o.DeleteButtonLabel,"labelNo":o.DialogBtnCancel}}},"_performAction":function(e,i){var t=e.node,o=n.Deferred();t.trigger("before:delete",t);var s=t.destroy({"wait":!0}).done(function(){t.trigger("delete",t),e.set("count",1),e.deferred.resolve(e),o.resolve(t)}).fail(function(i){var n=i?new u(i,t):i;e.deferred.reject(e,n),i||s.abort(),o.reject(n)}),r=i.originatingView;return r&&r.unblockActions&&r.unblockActions(),o.promise()},"startGlobalMessage":function(e,i){p.showProgressPanel(e,{"oneFileTitle":o.DeletingOneItem,"oneFileSuccess":o.DeleteOneItemSuccessMessage,"multiFileSuccess":o.DeleteManyItemsSuccessMessage,"oneFilePending":o.DeletingOneItem,"multiFilePending":o.DeleteItems,"multiFileOneFailure":o.DeleteManyItemsOneFailMessage,"oneFileFailure":o.DeleteOneItemFailMessage,"multiFileFailure":o.DeleteManyItemsFailMessage,"someFileSuccess":o.DeleteSomeItemsSuccessMessage,"someFilePending":o.DeletingSomeItems,"someFileFailure":o.DeleteSomeItemsFailMessage,"enableCancel":!1,"originatingView":i.originatingView,"locationLabelPending":o.deletingLocationLabel,"locationLabelCompleted":o.deletedLocationLabel,"allowMultipleInstances":d.allowMultipleInstances,"actionType":d.actionType})}});return t.extend(f.prototype,l,{"execute":function(e,i){var t=n.Deferred(),s=this;return e.suppressFailMessage=!0,e.suppressSuccessMessage=!0,e.deleteBlockAction=!0,csui.require(["csui/models/fileuploads","csui/utils/contexts/factories/next.node","csui/controls/globalmessage/globalmessage"],function(n,r,a){if(m=n,g=r,p=a,p.isActionInProgress(d.actionType,o.DeleteNotAllowed,o.CommandTitleDelete))return t.resolve();s._executeDelete(e,i).then(t.resolve,t.reject)},t.reject),t.promise()},"_executeDelete":function(e,o){var s=this;o||(o={});var a=r.getAtLeastOneNode(e),c=1===a.length&&a.first(),m=n.Deferred();e.context||o.context;return o.parallelism||(o.parallelism=d.parallelism),o.originatingView=e.originatingView,l.execute.call(this,e,o).done(function(n){if(c&&c===e.container){var r=d.deleteSelfHandler||"csui/utils/commands/delete/delete.self.handler";i([r],function(i){i(c,t.extend({},e,o)),m.resolve()},m.reject)}else o.infiniteScroll&&e.collection.fetch({"reset":!1,"remove":!1,"merge":!0});s.allowCollectionRefetch=!0,m.resolve(n)}).fail(function(e){var i=e&&t.find(e,function(e){return!(e instanceof u)}),n=i||e;m.reject(n)}),m.promise()},"_performActions":function(e,i){var o=this,s=n.Deferred(),r=e.data||{},a=null==r.showProgressDialog||r.showProgressDialog,l=e.nodes.models,u=t.map(l,function(e){return{"name":e.get("name"),"state":"pending","count":0,"total":1,"node":e}}),d=l&&l[0]&&l[0].connector,g=new m(u,{"connector":d,"container":e.container?e.container.clone():void 0}),p=t.defaults({"nodes":g},e),f=(new Date).getTime();g.each(function(e){var i=e.get("node");e.node=i,e.unset("node"),e.set("bundleNumber",f),e.set("mime_type",i.get("mime_type"))}),a&&this.startGlobalMessage(g,i);var v=e.originatingView;return v&&v.unblockActions&&v.unblockActions(),p.suppressMultipleSuccessMessage=!0,p.suppressMultipleFailMessage=!0,c._performActions.call(this,p,i).done(function(e){s.resolve(e)}).fail(function(e){return a||o.showError(e),s.reject(e)}),s.promise()}}),f}),csui.define("csui/utils/commands/delete/delete.self.handler",["csui/lib/jquery","csui/lib/underscore"],function(e,i){function t(e,i){var t=i.viewStateModel;if(t){var n=t.getLastHistoryEntry();if(n&&n.fragment==="nodes/"+e)return t.restoreLastFragment(),!0}}return function(e,i){var n=i&&i.context;if(n&&n.hasModel("nextNode")){var o=n.getModel("nextNode"),s=e.get("parent_id");if(s){var r=s.id||s;t(r,n)||o.set("id",r)}}}}),csui.define("csui/utils/commands/preview.plugins/preview.plugins",["csui/lib/underscore","csui/lib/backbone","csui/models/mixins/rules.matching/rules.matching.mixin","csui-ext!csui/utils/commands/preview.plugins/preview.plugins"],function(e,i,t,n){"use strict";var o=i.Model.extend({"defaults":{"sequence":100,"plugin":null},"constructor":function(e,t){i.Model.prototype.constructor.apply(this,arguments),this.makeRulesMatching(t)}});t.mixin(o.prototype);var s=i.Collection.extend({"model":o,"comparator":"sequence","constructor":function(e,t){i.Collection.prototype.constructor.call(this,e,t)},"findByNode":function(e,i){var t=this.find(function(t){return t.matchRules(e,t.attributes,i)});return t&&t.get("plugin")}}),r=new s;return n&&r.add(e.chain(n).flatten(!0).map(function(i){return e.defaults({"plugin":new i.plugin},i)}).value()),r}),csui.define("csui/utils/commands/doc.preview",["require","csui/lib/underscore","csui/lib/jquery","csui/models/command","csui/utils/commandhelper","csui/utils/commands/preview.plugins/preview.plugins","i18n!csui/utils/commands/nls/localized.strings"],function(e,i,t,n,o,s,r){"use strict";function a(e,i,t){var n=e.collection;if(n){var o=n.get(e.delegatableOpenCommand);if(o){var s=o.getDelegatedCommand(i,t);return s&&s.get("signature")}}}var c={"includeContainers":!0,"ifNotOpenDelegate":!0,"fullView":!1};return n.extend({"defaults":{"signature":"DocPreview","command_key":["docpreview","DocPreview"],"scope":"multiple","name":r.DocumentPreview},"delegatableOpenCommand":"OpenDocument","enabled":function(e,t){if(e.originatingView&&e.originatingView.disablePreview)return!1;var n=o.getAtLeastOneNode(e),s=!0;return n&&n.length?n.each(i.bind(function(i){s&&this._validateCurrentNode(i,e,t)||(s=!1)},this)):s=!1,s},"_getData":function(e){var t=e&&e.data?e.data:{};return i.defaults(t,c)},"_validateCurrentNode":function(e,i,t){var n=i.context||t&&t.context,o=s.findByNode(e,{"context":n}),r=this._getData(i);return!!o&&(!(!r.includeContainers&&e.get("container"))&&(!!(o.validateNode||this.validateNode)(e,i)&&!(r&&r.ifNotOpenDelegate&&a(this,i,t)===this.get("signature"))))},"validateNode":function(e,i){return!1},"execute":function(e,n){var r=o.getAtLeastOneNode(e),a=e.context||n&&n.context,c=e.originatingView||n.originatingView,l=this._getData(e);if(l&&l.fullView||n&&n.fullView||e.originatingView&&e.originatingView.previewInFullMode){var u=r.models[0],d=s.findByNode(u,{"context":a}),m=d.widgetView,g=t.Deferred();return csui.require(["csui/utils/commands/impl/full.page.modal/full.page.modal.view",m],function(e,i){var n=new i({"context":a,"model":u}),o=new e({"view":n});o.on("destroy",function(){g.resolve()}).show(),o.$el.on("shown.binf.modal",function(){var e=t(o.$el.find("button")[0]);e&&e.trigger("focus")})},g.reject),g.promise()}c=c.options&&c.options.originatingView||c;var p=c.collection&&c.collection.length?i.filter(c.collection.models,function(e){var i=e.get("id");if(r.find(i))return e}):r.models[0],f=p.length?i.intersection(c.collection.models,r.models)[0]:r.models[0];if(f=f||r.models[0],c.ensureSidePanel||this.docPreviewView&&this.docPreviewView.openSidePanel)this.docPreviewView.trigger("open:new:doc:preview",f,c);else{c.ensureSidePanel=!0;var v=s.findByNode(f,{"context":a});this._openInSidepanel(f,v,c,a)}return t.Deferred().resolve().promise()},"_openInSidepanel":function(e,i,n,o){var s=this;csui.require(["csui/controls/side.panel/side.panel.view","csui/controls/doc.preview/doc.preview.view"],function(r,a){var c=new a({"model":e,"plugin":i,"originatingView":n,"context":o,"resizableWrapperClass":".csui-sidepanel-container"}),l=new r({"slides":[{"content":c}],"sidePanelClassName":"csui-sidepanel-doc-preview","layout":{"header":!1,"footer":!1,"mask":!1,"resize":!0,"size":"medium"},"contentView":c,"thresholdWidth":95,"context":o,"keyboard":!1});l.show(),c.openSidePanel=!0,s.docPreviewView=c;var u=o.viewStateModel,d=function(){l.stopListening(u,"change:"+u.CONSTANTS.STATE),n.ensureSidePanel=!1,c.openSidePanel=!1,t(".csui-doc-preview-state").removeClass("csui-doc-preview-state"),s.docPreviewView.trigger("destroy"),s.docPreviewView=void 0,l.hide(),l.destroy(),n&&n.trigger("doc:preview:closed")};l.listenTo(c,"before:destroy",d),u&&l.listenTo(u,"change:"+u.CONSTANTS.STATE,d)})}})}),csui.define("csui/utils/commands/download",["csui/lib/underscore","csui/lib/jquery","csui/utils/base","i18n!csui/utils/commands/nls/localized.strings","csui/utils/url","csui/utils/commandhelper","csui/models/command","csui/models/version"],function(e,i,t,n,o,s,r,a){"use strict";window.csui.requirejs.s.contexts._.config.config["csui/utils/commands/open"];return r.extend({"defaults":{"signature":"Download","command_key":["download","Download"],"name":n.CommandNameDownload,"verb":n.CommandVerbDownload,"doneVerb":n.CommandDoneVerbDownload,"scope":"single"},"execute":function(e,i){var n=this._getNode(e);return t.isAppleMobile()?this._openContent(n,i):this._downloadContent(n,i)},"_getNode":function(i){var t=s.getJustOneNode(i),n=t.get("type"),o=t.get("version_number");t.original&&t.original.get("id")>0&&(1!==n&&2!==n||(t=t.original),2===n&&void 0!==o&&t.set("version_number",o,{"silent":!0}));var r=t.get("versions"),c=!(r&&!1===r.current_version);if(!(t instanceof a)&&2!==n&&c){var l=t.clone();return["version_number","version_number_major","version_number_minor","version_number_name"].forEach(function(i){l.unset(i,{"silent":!0}),l.attributes.versions&&e.isObject(l.attributes.versions)&&delete l.attributes.versions[i]}),l}return t},"_downloadContent":function(e,i){return this._downloadContentWithPage(e,i)},"_downloadContentWithPage":function(e,t){var n=i.Deferred();return t||(t={}),t.openInNewTab=!!t.openInNewTab,csui.require(["csui/utils/open.authenticated.page"],function(i){var s=new o(e.connector.connection.url).getCgiScript(),r={"func":"doc.fetchcsui","nodeid":e.get("id"),"action":"download"},a=e.get("version_number");null!=a&&(r.vernum=a);var c=o.appendQuery(s,o.combineQueryString(r));return i(e.connector,c,t).then(n.resolve,n.reject)},n.reject),n.promise()},"_openContent":function(t,n){n||(n={});var o=window.open(""),s={"window":o};return o&&o.location||(s={"window":parent.window},o=null),this._downloadContentWithPage(t,e.extend(n,s)).then(function(){return o&&o.focus(),i.Deferred().resolve()},function(){return o&&o.close(),i.Deferred().reject()})}})}),csui.define("csui/utils/commands/open.base",["csui/lib/underscore","csui/models/command","csui/utils/commandhelper"],function(e,i,t){"use strict";return i.extend({"openDelegates":null,"getCommandKey":function(){if(!this.openDelegates)return[];var i=this.openDelegates.map(function(e){var i=e.get("command");return i.getCommandKey&&i.getCommandKey()||i.get("command_key")||[]});return e.chain(i).flatten().invoke("toLowerCase").unique().value()},"enabled":function(i,n){if(!this.openDelegates)return!1;var o=t.getJustOneNode(i);if(!o)return!1;var s=o.get("type");return!(!s||!e.contains(["144","749","736","801"],s.toString()))&&this.openDelegates.last().get("command").enabled(i,n)},"execute":function(e,i){return this.getDelegatedCommand(e,i).execute(e,i)},"getDelegatedCommand":function(e,i){var n=t.getJustOneNode(e);return n&&this.openDelegates.findByNode(n,e,i)}})}),csui.define("csui/utils/commands/open.document/delegates/open.document.delegates",["csui/lib/underscore","csui/lib/backbone","csui/models/mixins/rules.matching/rules.matching.mixin","csui-ext!csui/utils/commands/open.document/delegates/open.document.delegates"],function(e,i,t,n){"use strict";var o=i.Model.extend({"defaults":{"sequence":100,"command":null},"constructor":function(e,t){i.Model.prototype.constructor.apply(this,arguments),this.makeRulesMatching(t)},"enabled":function(e,i,t){var n=i.context||t&&t.context,o={"context":n};return this.matchRules(e,this.attributes,o)&&this.get("command").enabled(i,t)}});t.mixin(o.prototype);var s=i.Collection.extend({"model":o,"comparator":"sequence","constructor":function(e,t){i.Collection.prototype.constructor.call(this,e,t)},"findByNode":function(e,i,t){var n=this.find(function(n){return n.enabled(e,i,t)});return n&&n.get("command")}}),r=new s;return n&&r.add(e.chain(n).flatten(n).map(function(i){return e.defaults({"command":new i.command},i)}).value()),r}),csui.define("csui/utils/commands/open.document/open.document",["csui/lib/underscore","csui/utils/commands/open.base","csui/utils/commands/open.document/delegates/open.document.delegates"],function(e,i,t){"use strict";return i.extend({"defaults":{"signature":"OpenDocument"},"openDelegates":t})}),csui.define("csui/utils/commands/zipanddownload",["module","require","csui/lib/underscore","csui/lib/jquery","i18n!csui/utils/commands/nls/localized.strings","csui/utils/command.error","csui/utils/commandhelper","csui/models/command","csui/utils/url"],function(e,i,t,n,o,s,r,a,c){"use strict";var l,u,d,m;t.extend({},e.config());return a.extend({"defaults":{"signature":"ZipAndDownload","command_key":["ZipAndDownload","zipanddownload"],"name":o.CommandNameZipDownload,"verb":o.CommandVerbZipDownload,"doneVerb":o.CommandDoneVerbDownload,"scope":"multiple","selfBlockOnly":!0},"enabled":function(e){var i=!1;if(!e.nodes||!e.nodes.models)return!1;if(1===e.nodes.models.length){for(var n,o=r.getJustOneNode(e),s=0;s<e.nodes.models.length;s++)n=t.filter(e.nodes.models&&e.nodes.models[s].actions&&e.nodes.models[s].actions.models,function(e){return"zipanddownload"===e.id});o.get("container")&&n.length>0&&(i=!0)}else if(e.nodes.models.length>1){for(var a=0,c=0;c<e.nodes.models.length;c++){var l=t.filter(e.nodes.models&&e.nodes.models[c].actions&&e.nodes.models[c].actions.models,function(e){return"zipanddownload"===e.id});l.length>0&&a++}a>0&&a===e.nodes.models.length&&(i=!0)}return i},"execute":function(e,i){this.set("isExecuting",!0),this.stagesModel&&delete this.stagesModel;var t=r.getAtLeastOneNode(e),o=this;return this.options=i||{},this._deferred=n.Deferred(),this.connector=this.options.connector||e.collection&&e.collection.connector||e.container&&e.container.connector||t.models&&t.models[0].connector,csui.require(["csui/controls/globalmessage/globalmessage","csui/models/zipanddownload/zipanddownload.preflight","csui/models/zipanddownload/zipanddownload.stages","csui/dialogs/modal.alert/modal.alert"],function(){l=arguments[0],u=arguments[1],d=arguments[2],m=arguments[3],o.stageAndPrepareDownload(e,t,{})}),this._deferred.always(function(){o.set("isExecuting",!1)}),this._deferred.promise()},"_preFlightCheck":function(e,i){var t=n.Deferred(),r=this,a={"id_list":i.pluck("id"),"type":"ZipAndDownload"},c=new u(a,e);c.preflight=!0;var d=c.save(a,{"silent":!0,"wait":!0}).done(function(){t.resolve(c)}).fail(function(e){var i=e?new s(e,c):e;"abort"!==e.statusText&&m.showError(i.message,o.error),r._deferred.reject({"cancelled":!0}),t.reject(c,i)});return l.showLoader(d,{"label":o.VerifyZipAndDownloadPrefetch}),t.promise()},"_getJobId":function(e,i){var t=this.connector.getConnectionUrl().getApiBase("v2"),n={"id_list":i.pluck("id"),"type":"ZipAndDownload"},o={"url":c.combine(t,"zipanddownload"),"type":"POST","data":n,"contentType":"application/x-www-form-urlencoded"};return this.connector.makeAjaxCall(o)},"changeStageMessage":function(e){var i=this.stagesModel&&this.stagesModel.get("current_stage")||0,t=0===i?o.ExtractingZipAndDownload:1===i?o.CompressingZipAndDownload:o.CleanUpZipAndDownload;l.changeLoaderMessage(t,e)},"_checkStage":function(e,i,t){t=t||n.Deferred(),this.stagesModel||(this.stagesModel=new d(i,{"connector":this.connector}));var o=this,s=t.promise(),r=this.stagesModel.fetch();return this.changeStageMessage(r),r.done(function(){o.stagesModel.get("complete")?t.resolve(o.stagesModel):o.stagesModel.get("stage_summary").some(function(e){return!e.complete})?o.stageCheckTimeout=setTimeout(function(){clearTimeout(o.stageCheckTimeout),o.stageCheckTimeout=void 0,o._checkStage(e,i,t)},2e3):t.resolve(o.stagesModel)}),s.abort=r.abort,s},"_showDialogBox":function(e,i,n,o){var s=this;s._dialog=new e(t.extend(o,{"status":i,"nodes":n,"iconLeft":"notification_warning"})),s._dialog.listenTo(s._dialog,"hide",t.bind(s.onHideDialog,s)),s._dialog.show()},"onHideDialog":function(){this._deferred&&"pending"===this._deferred.state()&&this._deferred.reject({"cancelled":!0})},"stageAndPrepareDownload":function(e,i,s){var r=this,a=n.Deferred(),u=r.stagesModel&&r.stagesModel.get("current_stage")||0;r._getJobId(e,i).done(function(n){n=n.results.data.jobs;var s=r._checkStage(e,n);l.showLoader(s,{"label":0===u?o.ExtractingZipAndDownload:1===u?o.CompressingZipAndDownload:o.CleanUpZipAndDownload,"onDestroy":function(e){r.stageCheckTimeout&&clearTimeout(r.stageCheckTimeout),e?r._deferred.resolve():r._deferred.reject()}}),s.done(function(n){a.resolve(),n&&n.get("complete")&&n.get("current_stage")===n.get("stage_summary").length?csui.require(["csui/controls/zipanddownload/impl/download.dialog/download.dialog.view","csui/utils/base","csui/utils/open.authenticated.page","csui/controls/zipanddownload/impl/dialog.header/dialog.header.view"],function(s,l,u,d){a.resolve();var m={"model":n,"status":e,"headerView":new d({"title":o.downloadDialogTitle,"describedBy":"download-zip-file","source":"downloadZip"}),"buttons":[{"id":"zipDownload","label":o.DownloadDialogBtnDownload,"click":t.bind(function(){var e=this._dialog.ui.fileName.val(),i=!1;/^[\W]+/.test(e)&&/[^\u0000-\u007F]/g.test(e)&&(i=!0);var t="";if(0===e.trim().length)t=o.TheArchiveNameCannotBeEmpty;else if(e.trim().length>248)t=o.TheArchiveNameMaxLength;else if(-1!==e.search(/[\?\:<>\*\|\"\\\/\\&]/g))t=o.InvalidArchiveCharacters;else if(/^[\W]+/.test(e)&&!i)t=o.InvalidArchiveName;else{if(this._dialog.options.status&&this._dialog.options.status.originatingView){var s=this._dialog.options.status.originatingView.$el.find("[data-csui-command="+this.get("signature").toLowerCase()+"] a.binf-disabled");s.length>0&&s.removeClass("binf-disabled")}/(.)+(.zip)$/i.test(e)||(e+=".zip");var r=c.appendQuery(c.combine(this.connector.connection.url.replace(/\/api\/v[1|2]/gi,""),n.get("link")),"downloadName="+encodeURIComponent(e));u(this.connector,r,{"openInNewTab":!1}).then(a.resolve,a.reject),this._dialog.destroy(),delete this._dialog}if(t.length){this._dialog.ui.errorEl.html(t).attr("role","alert");var l=this._dialog.ui.errorEl.attr("id");this._dialog.ui.fileName.attr({"aria-invalid":!0,"aria-describedby":l})}},r),"default":!0,"disabled":0===n.get("total_completed")},{"label":o.DialogBtnCancel,"close":!0,"click":t.bind(r.onClickCancelButton,r)}]};r._showDialogBox(s,e,i,m)}):m.showError(n.get("status_formatted"))}).fail(function(e){l.showMessage("error",e.statusText),a.reject(e)})}),this._dialog&&(this._dialog.destroy(),delete this._dialog)},"onClickCancelButton":function(){if(this._dialog.options.status&&this._dialog.options.status.originatingView){var e=this._dialog.options.status.originatingView.$el.find("[data-csui-command="+this.get("signature").toLowerCase()+"] a.binf-disabled");e.length>0&&e.removeClass("binf-disabled")}this._dialog.destroy(),delete this._dialog}})}),csui.define("csui/utils/commands/open.classic.page",["module","require","csui/lib/underscore","csui/lib/jquery","csui/utils/url","csui/utils/commandhelper","csui/models/command","i18n!csui/utils/commands/nls/localized.strings"],function(e,i,t,n,o,s,r,a){"use strict";var c=t.extend({"openInNewTab":!0},e.config());return r.extend({"execute":function(e,i){if(c.classicUnsupported)return this._classicUnsupported(e);var n=s.getJustOneNode(e);return this._navigateTo(n,t.extend({},e,i))},"getUrl":function(e,i){var s=e.connector||i.connector,r=new o(s.connection.url).getCgiScript(),a=this.getUrlQueryParameters(e,i);return a&&!t.isString(a)&&(a=n.param(a)),a&&(r+="?"+a),r},"getUrlQueryParameters":function(e,i){},"openInNewTab":function(){return c.openInNewTab},"shouldCloseTabAfterRedirect":!1,"_classicUnsupported":function(e){var i=n.Deferred();return e.suppressFailMessage=!0,csui.require(["csui/dialogs/modal.alert/modal.alert"],function(e){e.showInfo(a.viewTypeUnsupported)}),i.reject()},"_navigateTo":function(i,s){var r,a,c,l,u;try{r=this.getUrl(i,s)}catch(e){return n.Deferred().reject(e).promise()}return a=this.openInNewTab,t.isFunction(a)&&(a=a.call(this)),c=this.shouldCloseTabAfterRedirect,t.isFunction(c)&&(c=c.call(this)),c&&(a?(u=(i.connector||s.connector).connection,l=e.config().closeUrl||o.appendQuery(new o(u.url).getCgiScript(),"func=csui.closewindow"),new o(l).isAbsolute()||(l="/"!==l[0]?o.appendQuery(new o(u.url).getCgiScript(),l):o.combine(new o(u.url).getOrigin(),l))):l=location.href,r=o.appendQuery(r,o.combineQueryString({"nextURL":l
}))),a?window.open(r,"_blank").focus():location.href=r,n.Deferred().resolve().promise()}},{"openInNewTab":c.openInNewTab})}),csui.define("csui/utils/commands/edit",["csui/lib/jquery.parse.param","csui/utils/commandhelper","csui/utils/url","csui/utils/commands/open.classic.page","i18n!csui/utils/commands/nls/localized.strings"],function(e,i,t,n,o){"use strict";return n.extend({"defaults":{"signature":"Edit","command_key":"edit","scope":"single"},"shouldCloseTabAfterRedirect":!0,"getUrlUnavailableError":function(){return o.NoEditUrl},"getUrl":function(e,i){var n,o,s=this.get("command_key"),r=this._getNodeActionForSignature(e,s);if(r&&(n=r.get("href")))return new t(n).isAbsolute()||(o=(e.connector||i.connector).connection,n="/"!==n[0]?t.appendQuery(new t(o.url).getCgiScript(),n):t.combine(new t(o.url).getOrigin(),n)),n;throw new Error(this.getUrlUnavailableError())}})}),csui.define("csui/utils/commands/editactivex",["csui/lib/jquery.parse.param","csui/utils/commandhelper","csui/utils/url","csui/utils/commands/open.classic.page"],function(e,i,t,n,o){"use strict";return n.extend({"defaults":{"signature":"EditActiveX","command_key":"editactivex","scope":"single"},"shouldCloseTabAfterRedirect":!0,"enabled":function(e,t){var n=i.getJustOneNode(e),o=this.get("command_key"),s=this._getNodeActionForSignature(n,o);if(s){var r=e.toolItem||t&&t.toolItem;if(r){var a=s.get("name");if(a)return r.set("name",a),!0}}return!1},"getUrl":function(e,i){var n,s,r=this.get("command_key"),a=this._getNodeActionForSignature(e,r);if(a&&(n=a.get("href")))return new t(n).isAbsolute()||(s=(e.connector||i.connector).connection,n="/"!==n[0]?t.appendQuery(new t(s.url).getCgiScript(),n):t.combine(new t(s.url).getOrigin(),n)),n;throw new Error(o.NoEditUrl)}})}),csui.define("csui/utils/commands/editofficeonline",["csui/lib/jquery.parse.param","csui/utils/commandhelper","csui/utils/url","csui/utils/commands/open.classic.page"],function(e,i,t,n,o){"use strict";return n.extend({"defaults":{"signature":"EditOfficeOnline","command_key":"editofficeonline","scope":"single"},"shouldCloseTabAfterRedirect":!0,"enabled":function(e,t){var n=i.getJustOneNode(e),o=this.get("command_key"),s=this._getNodeActionForSignature(n,o);if(s){var r=e.toolItem||t&&t.toolItem;if(r){var a=s.get("name");if(a)return r.set("name",a),!0}}return!1},"getUrl":function(e,i){var n,s,r=this.get("command_key"),a=this._getNodeActionForSignature(e,r);if(a&&(n=a.get("href")))return new t(n).isAbsolute()||(s=(e.connector||i.connector).connection,n="/"!==n[0]?t.appendQuery(new t(s.url).getCgiScript(),n):t.combine(new t(s.url).getOrigin(),n)),n;throw new Error(o.NoEditUrl)}})}),csui.define("csui/models/perspective/server.adaptor.mixin",["csui/lib/underscore","csui/lib/jquery","csui/utils/url"],function(e,i,t){"use strict";return{"mixin":function(i){return e.extend(i,{"makeServerAdaptor":function(e){return this},"isFetchableDirectly":function(){return this.get("id")>0},"urlBase":function(){var i=this.get("id"),n=this.connector.connection.url;if(i){if(e.isNumber(i)&&!(i>0))throw new Error("Unsupported id value");n=t.combine(n,"perspectives",i)}else n=t.combine(n,"perspectives");return n},"url":function(){return this.urlBase()},"parse":function(i){var t=i.perspectives;return t?0===t.length?{}:(t=e.each(t,function(e){e.cascading=e.cascading+"",e.containerType=e.container_type,e.constantData=e.constant_data,e.overrideType=e.override_type,e.overrideId=e.override_id,e.nodepath=e.node_path,e.rules=e.rule_data,e.perspective=JSON.parse(e.perspective),e.constant_extraction_mode=e.container_type,e.pnodepath=e.perspective_node_path}),{"perspectives":t}):i}})}}}),csui.define("csui/models/perspective/perspective.template.model",["module","csui/lib/underscore","csui/lib/backbone","csui/models/perspective/server.adaptor.mixin","csui/models/mixins/uploadable/uploadable.mixin","csui/models/mixins/connectable/connectable.mixin","csui/models/perspective/perspective.model","csui/utils/log","csui/utils/base"],function(e,i,t,n,o,s,r,a,c){"use strict";var l=i.extend({"idAttribute":null},e.config()),u=t.Model.extend({"idAttribute":l.idAttribute,"constructor":function(e,n){t.Model.prototype.constructor.call(this,e,n),this.options=i.pick(n,["connector"]),this.makeUploadable(n).makeConnectable(n).makeServerAdaptor(n)},"isNew":function(){return!this.get("id")||0===this.get("id")},"isFetchable":function(){return!!this.get("id")},"set":function(e,n,o){var s;if(null==e)return this;if("object"==typeof e?(s=e,o=n):(s={})[e]=n,s.perspectives){e="perspectives";var a=new t.Collection;o=i.pick(this.options,["connector"]),i.each(s.perspectives,function(e){a.add(new r(e,o))}),n=a,(s={})[e]=n}return t.Model.prototype.set.call(this,s,o)}});return o.mixin(u.prototype),s.mixin(u.prototype),n.mixin(u.prototype),u}),csui.define("csui/utils/commands/edit.perspective",["module","require","csui/lib/underscore","csui/lib/jquery","csui/models/command","csui/utils/commandhelper","csui/utils/url","csui/models/perspective/perspective.template.model","csui/models/perspective/perspective.model","csui/utils/perspective/perspective.util","i18n!csui/utils/commands/nls/localized.strings"],function(e,i,t,n,o,s,r,a,c,l,u){"use strict";var d=window.csui.requirejs.s.contexts._.config.config["csui/utils/contexts/perspective"]||{};d=t.extend({"enableInlinePerspectiveEditing":!0,"enablePersonalization":!0},d,e.config());var m,g,p;return o.extend({"defaults":{"signature":"EditPerspective","name":u.EditPerspective},"enabled":function(e,i){var t=e.context||i&&i.context,n=t.perspective;return!!n&&(this._enablePersonalizePage(n,i,t)||this._enableEditPerspective(n)||this._enableCreatePerspective(n,t))},"_enablePersonalizePage":function(e,i,n){var o=(d.enablePersonalization||i.enablePersonalization)&&!n._applicationScope.get("id")&&("flow"===e.get("type")||"sidepanel-right"===e.get("type")||"sidepanel-left"===e.get("type"));if(!o)return o;var s=e.get("options");return s&&t.every(s.widgets,l.hasWidgetId)},"_enableEditPerspective":function(e){return(e.has("id")||e.has("perspective_id"))&&e.get("canEditPerspective")},"_enableCreatePerspective":function(e,i){return!(e.has("id")||e.has("perspective_id"))&&e.get("canEditPerspective")&&"node"===i._applicationScope.get("id")},"execute":function(e,i){var o=n.Deferred(),s=e.context||i&&i.context,r=s.perspective;return r.has("id")?this._fetchPerspective(s,r).then(t.bind(function(t){t&&this._continueExecution(e,i,o,t)},this),o.reject):this._continueExecution(e,i,o),o.promise()},"_continueExecution":function(e,i,t,n){var o=e.context||i&&i.context,s=o.perspective,r=this._enablePersonalizePage(s,i,o),a=this._enableEditPerspective(s),c=this._enableCreatePerspective(s,o);r?a||c?this._promptToChooseEditPage(e,i,o,t,n):this._doPersonalizePage(e,i,o,t):this._doEditPage(e,i,o,t,n)},"_fetchPerspective":function(e,i){var o=n.Deferred(),s=i.get("id")||i.get("perspective_id");return csui.require(["csui/utils/contexts/factories/connector","csui/dialogs/modal.alert/modal.alert"],t.bind(function(i,n){var r=new a({"id":s},{"connector":e.getObject(i)});r.fetch().then(t.bind(function(){var e=r.get("perspectives");e&&1!=e.length?n.showError(u.editPerspectiveErrorMessage).done(function(){o.resolve()}).fail(o.reject):o.resolve(e.at(0))},this),o.reject)},this)),o.promise()},"_doPersonalizePage":function(e,i,n,o){csui.require(["csui/perspective.manage/pman.view","csui/utils/contexts/factories/node","csui/models/perspective/personalization.model","csui/utils/contexts/factories/connector","csui/utils/contexts/factories/application.scope.factory","csui/utils/contexts/factories/user"],function(i,r,a,c,u,d){var m,g=n.getModel(u);m="node"==g.id?s.getJustOneNode(e)||n.getModel(r):n.getModel(d);var p=m.get("perspective"),f=p.override,v=t.pick(p,"type","options","perspective_version","perspective_id");v=t.defaults(v,t.pick(f,"perspective_version","perspective_id")),v.perspective_id=v.perspective_id||p.id;var w=new a({},{"context":n,"connector":n.getObject(c),"sourceModel":m,"perspective":p});w.setPerspective(v),a.loadPersonalization(m,n).then(function(e){e&&w.setPerspective(e),new i({"context":n,"perspective":w,"mode":l.MODE_PERSONALIZE}).show(),o.resolve()})},o.reject)},"_doEditPage":function(e,i,t,n,o){this._enableEditPerspective(t.perspective)?this._doEditPerspective(e,i,t,n,o):this._enableCreatePerspective(t.perspective,t)&&this._doCreatePerspective(e,i,t,n)},"_doCreatePerspective":function(e,i,t,n){i&&i.inlinePerspectiveEditing||d.enableInlinePerspectiveEditing?this._createInline(e,i,t,n):this._createInClassicPMan(e,i,t,n)},"_doEditPerspective":function(e,i,t,n,o){i&&i.inlinePerspectiveEditing||d.enableInlinePerspectiveEditing?this._editInline(o,t,n):this._editInClassicPMan(e,i,t,n)},"_promptToChooseEditPage":function(e,i,t,n,o){var s=this;csui.require(["csui/dialogs/modal.alert/modal.alert"],function(r){s.dialog=r.confirmQuestion(u.editPageDialogMessage,u.editPageTitle,{"buttons":{"showYes":!0,"labelYes":u.editPageButton,"showNo":!0,"labelNo":u.personalizePageButton,"showCancel":!0,"labelCancel":u.editPageCancelButton}}).then(function(r){!0===r&&s._doEditPage(e,i,t,n,o)},function(o){!1===o?s._doPersonalizePage(e,i,t,n):n.resolve()})},n.reject)},"_editInline":function(e,i,t){csui.require(["csui/perspective.manage/pman.view"],function(n){var o=i.perspective.get("id")||i.perspective.get("perspective_id"),s=e;s.set("id",o),new n({"context":i,"perspective":s}).show(),t.resolve()},t.reject)},"_editInClassicPMan":function(e,i,t,n){var o=this;csui.require(["csui/utils/contexts/factories/connector"],function(){m=arguments[0];var i=o._getEditForm(t,e);i.submit(),i.remove(),n.resolve()},n.reject)},"_getEditForm":function(e,i){var t=n("<form target='_blank' method='POST' style='display:none;'></form>").attr({"action":this._getUrl(e,i)}).appendTo(document.body),o=this._getEditUrlQueryParameters(e);for(var s in o)o.hasOwnProperty(s)&&n('<input type="hidden" />').attr({"name":s,"value":o[s]}).appendTo(t);return t},"_getUrl":function(e,i){var t=e.getObject(m);return new r(t.connection.url).getCgiScript().toString()+"/perspectivemgr"},"_getEditUrlQueryParameters":function(e){var i=e.perspective.attributes.id;return void 0!==i&&i>0?{"perspective_id":i}:{}},"_preparePerspectiveConfig":function(e){var i={"perspective":{"type":"flow","options":{"widgets":[{"type":"csui/widgets/nodestable"}]}},"overrideType":"genericContainer","scope":"local","containerType":"-1","cascading":"false"},t=s.getJustOneNode(status)||e.getModel(g),n=e.getCollection(p);return i.nodepath=this._getNodePath(n),i.node=t.get("id"),i.containerType=t.get("type"),i.title=t.get("name"),i},"_createInline":function(e,i,t,n){var o=this;csui.require(["csui/utils/contexts/factories/node","csui/utils/contexts/factories/connector","csui/utils/contexts/factories/ancestors","csui/perspective.manage/pman.view"],function(){g=arguments[0],m=arguments[1],p=arguments[2];var e=arguments[3],i=o._preparePerspectiveConfig(t,g,p);i.title=i.title+" "+(new Date).getTime();var s=new c(i,{"connector":t.getObject(m)});new e({"context":t,"perspective":s}).show(),n.resolve()},n.reject)},"_createInClassicPMan":function(e,i,t,n){var o=this;csui.require(["csui/utils/contexts/factories/connector","csui/utils/contexts/factories/node","csui/utils/contexts/factories/ancestors"],function(){m=arguments[0],g=arguments[1],p=arguments[2];var i=o._getCreateForm(t,e);i.submit(),i.remove(),n.resolve()},n.reject)},"_getCreateForm":function(e,i){var t=n("<form target='_blank' method='POST' style='display:none;'></form>").attr({"action":this._getUrl(e,i)}).appendTo(document.body),o=this._getCreateUrlQueryParameters(e,i);for(var s in o)o.hasOwnProperty(s)&&n('<input type="hidden" />').attr({"name":s,"value":o[s]}).appendTo(t);return t},"_getCreateUrlQueryParameters":function(e,i){var t=this._preparePerspectiveConfig(e,g,p);return t.ui={"elements":{"btn-mode-code":!0,"btn-view-general":!0,"btn-view-rules":!1,"btn-view-layout":!0,"btn-view-widgets":!0,"view-perspective-action":!0,"perspective-action-create":!0,"perspective-action-edit":!0,"perspective-action-copy":!0,"view-perspective-form":!0,"perspective-title":!0,"perspective-type":!0,"perspective-scope":!0,"perspective-nodetypes":!0,"perspective-node":!0,"perspective-cascading":!0,"display-size-msg":!1,"rules-code":!0,"layout-flow":!0,"layout-left-center-right":!0,"layout-grid":!1,"layout-tabbed":!1},"widgetGroupsBlacklist":[],"widgetsWhitelist":[],"disableGrouping":!1},{"config":JSON.stringify(t)}},"_getNodePath":function(e){var i="";return e.each(function(e){i+=i?":":"",i+=e.get("name")}),i}})}),csui.define("csui/utils/commands/editwebdav",["csui/lib/jquery.parse.param","csui/utils/commandhelper","csui/utils/url","csui/utils/commands/open.classic.page"],function(e,i,t,n,o){"use strict";return n.extend({"defaults":{"signature":"EditWebDAV","command_key":"editwebdav","scope":"single"},"shouldCloseTabAfterRedirect":!0,"enabled":function(e,t){var n=i.getJustOneNode(e),o=this.get("command_key"),s=this._getNodeActionForSignature(n,o);if(s){var r=e.toolItem||t&&t.toolItem;if(r){var a=s.get("name");if(a)return r.set("name",a),!0}}return!1},"getUrl":function(e,i){var n,s,r=this.get("command_key"),a=this._getNodeActionForSignature(e,r);if(a&&(n=a.get("href")))return new t(n).isAbsolute()||(s=(e.connector||i.connector).connection,n="/"!==n[0]?t.appendQuery(new t(s.url).getCgiScript(),n):t.combine(new t(s.url).getOrigin(),n)),n;throw new Error(o.NoEditUrl)}})}),csui.define("csui/utils/commands/nls/lang",{"root":!0,"en-us":!1,"en":!1}),csui.define("csui/utils/commands/nls/root/lang",{"FilterCollapseTooltip":"Hide filters","TreeBrowseCollapseTooltip":"Hide navigation tree","EmailLinkSubject":"I want to share the following links with you","EmailLinkDesktop":"Link for Desktop and Android","EmailAppleLinkFormat":"Link for iOS Mobile","CommandNameReserve":"Reserve","CommandVerbReserve":"reserve","ReservePageLeavingWarning":"If you leave the page now, pending items will not be reserved.","ReserveItemsNoneMessage":"No items reserved.","ReserveOneItemSuccessMessage":"1 item successfully reserved.","ReserveSomeItemsSuccessMessage":"{0} items successfully reserved.","ReserveManyItemsSuccessMessage":"{0} items successfully reserved.","ReserveOneItemFailMessage":"1 item failed to reserve.","ReserveSomeItemsFailMessage":"{0} items failed to reserve.","ReserveManyItemsFailMessage":"{0} items failed to reserve.","CommandNameUnreserve":"Unreserve","CommandVerbUnreserve":"unreserve","UnreservePageLeavingWarning":"If you leave the page now, pending items will not be unreserved.","UnreserveItemsNoneMessage":"No items unreserved.","UnreserveOneItemSuccessMessage":"1 item successfully unreserved.","UnreserveSomeItemsSuccessMessage":"{0} items successfully unreserved.","UnreserveManyItemsSuccessMessage":"{0} items successfully unreserved.","UnreserveOneItemFailMessage":"1 item failed to unreserve.","UnreserveSomeItemsFailMessage":"{0} items failed to unreserve.","UnreserveManyItemsFailMessage":"{0} items failed to unreserve.","CommandNameLock":"Lock","CommandVerbLock":"lock","LockPageLeavingWarning":"If you leave the page now, pending items will not be locked.","LockItemsNoneMessage":"No items locked.","LockOneItemSuccessMessage":"1 item successfully locked.","LockSomeItemsSuccessMessage":"{0} items successfully locked.","LockManyItemsSuccessMessage":"{0} items successfully locked.","LockOneItemFailMessage":"1 item failed to lock.","LockSomeItemsFailMessage":"{0} items failed to lock.","LockManyItemsFailMessage":"{0} items failed to lock.","CommandNameUnlock":"Unlock","CommandVerbUnlock":"unlock","UnlockPageLeavingWarning":"If you leave the page now, pending items will not be unlocked.","UnlockItemsNoneMessage":"No items unlocked.","UnlockOneItemSuccessMessage":"1 item successfully unlocked.","UnlockSomeItemsSuccessMessage":"{0} items successfully unlocked.","UnlockManyItemsSuccessMessage":"{0} items successfully unlocked.","UnlockOneItemFailMessage":"1 item failed to unlock.","UnlockSomeItemsFailMessage":"{0} items failed to unlock.","UnlockManyItemsFailMessage":"{0} items failed to unlock."}),csui.define("csui/utils/commands/email.link",["module","require","csui/lib/underscore","csui/lib/jquery","csui/utils/url","csui/utils/command.error","csui/models/command","csui/utils/commandhelper","csui/models/version","i18n!csui/utils/commands/nls/lang","i18n!csui/utils/commands/nls/localized.strings","csui/utils/node.info.sprites","csui/lib/underscore.string"],function(e,i,t,n,o,s,r,a,c,l,u,d){"use strict";var m,g,p=t.extend({"rewriteApplicationURL":!1,"enableAppleSupport":!1,"appleNodeLinkBase":"x-otm-as-cs16://?launchUrl=nodes/"},e.config());return r.extend({"defaults":{"signature":"EmailLink","name":u.CommandNameEmailLink,"verb":u.CommandVerbEmailLink},"enabled":function(e){var i=a.getAtLeastOneNode(e);return i&&i.length},"execute":function(e,i){var t=this,o=n.Deferred();return e.suppressFailMessage=!0,csui.require(["csui/utils/node.links/node.links","csui/controls/globalmessage/globalmessage"],function(){m=arguments[0],g=arguments[1],e.originatingView&&e.originatingView.blockActions&&e.originatingView.blockActions();var n=e.context||i&&i.context;setTimeout(function(){var i=a.getAtLeastOneNode(e),s=t._getApplicationUrl(i,n),r=t._getNodesLinks(i,s,n),c="mailto:?subject="+t._getEMailSubject(i)+"&body="+encodeURIComponent(r),l=t._openNewHref(c);if(l){var u=l.errorDetails||l.message;g.showMessage("error",u),o.reject(l)}else o.resolve();e.originatingView&&e.originatingView.unblockActions&&e.originatingView.unblockActions()},100)},o.reject),o.promise()},"_getEMailSubject":function(e){var i=" ";return e&&1===e.length&&(i=e.first().get("name")),encodeURIComponent(i)},"_getApplicationUrl":function(e){var i=e.first().connector;return o.combine(new o(i.connection.url).getCgiScript(),"/app")},"_openNewHref":function(e){if(e.length>2048)return new s(u.EmailLinkCommandFailedWithTooMuchItemsErrorMessage);window.location.href=e},"isiOSEnabled":function(e){return p.enableAppleSupport&&!(e.first()instanceof c)},"_getNodesLinks":function(e,i,t){var o=this.isiOSEnabled(e),s=u.EmailAppleLinkFormat,r=l.EmailLinkDesktop+"\n",a=e.map(function(e){var r=e.get("name")+":",a=m.getUrl(e,{"context":t}),l="";if(p.rewriteApplicationURL){var u=a.lastIndexOf("#");u>=0&&(a=i+"/"+a.substr(u+1))}if(o){var g=1===e.get("type")?e.original.get("id"):e.get("id");s+="\n"+r+"\n"+p.appleNodeLinkBase+g}return l=r+"\n"+a,!d||e instanceof c||d.each(function(i){var o={"NEW_LINE":"\n","context":t,"node":e},s="";try{s=n.trim(i.get("getCustomUrl")(o))}catch(e){console.error(e)}l+=s.length?"\n"+s+"\n":""}),l}).join("\n");return o?r+a+"\n\n"+s:a}})}),csui.define("csui/utils/commands/execute.saved.query",["require","csui/lib/jquery","csui/utils/commandhelper","csui/models/command","i18n!csui/utils/commands/nls/localized.strings"],function(e,i,t,n,o){"use strict";return n.extend({"defaults":{"signature":"ExecuteSavedQuery","scope":"single"},"enabled":function(e){var i=t.getJustOneNode(e);return i&&258===i.get("type")&&!1!==i.get("openable")},"execute":function(e,i){var n=t.getJustOneNode(e),o=e.context||i&&i.context;if(n.get("custom_view_search"))return this._openFormInSidepanel(n,o);this._triggerSearchResults(n,o)},"_triggerSearchResults":function(e,t){var n=i.Deferred();return csui.require(["csui/utils/contexts/factories/search.query.factory"],function(i){var o=t.getModel(i);o.clear({"silent":!0}),o.set("query_id",e.get("id")),n.resolve()},n.reject),n.promise()},"_openFormInSidepanel":function(e,t){var n=i.Deferred();return csui.require(["csui/controls/side.panel/side.panel.view","csui/widgets/search.custom/impl/search.object.view","csui/widgets/search.custom/impl/search.customquery.factory"],function(i,s,r){var a=t.getCollection(r,{"attributes":{"id":e.get("id")}});a.ensureFetched().then(function(){var r=a.get("schema"),c=r.title?r.title:e.get("name"),l=new s({"context":t,"model":a,"savedSearchQueryId":e.get("id"),"hideSearchButton":!0,"showInSearchResultsNewPerspective":!0}),u=new i({"slides":[{"title":c,"content":l,"footer":{"buttons":[{"label":o.searchButtonMessage,"type":"action","id":"search-btn","className":"binf-btn binf-btn-primary","disabled":!1}]}}],"sidePanelClassName":"cvs-in-sidepanel"});l.listenTo(l,"render:form",function(){u.triggerMethod("set:focus")}),u.show(),u.listenTo(l,"button:click",function(e){"search-btn"===e.id&&l.loadCustomSearch(),u.hide()}),u.listenTo(l,"enable:search",function(e){l.trigger("update:button","search-btn",{"disabled":!e})}),u.listenTo(l,"click:search",function(){u.hide()}),n.resolve()}).fail(function(){n.reject()})},n.reject),n.promise()}})}),csui.define("csui/utils/commands/execute.search.form.query",["require","csui/lib/jquery","csui/utils/commandhelper","csui/models/command","i18n!csui/utils/commands/nls/localized.strings"],function(e,i,t,n,o){"use strict";return n.extend({"defaults":{"signature":"ExecuteSearchForm","scope":"single"},"enabled":function(e){var i=t.getJustOneNode(e);return i&&292===i.get("type")},"execute":function(e,i){var n=t.getJustOneNode(e),o=e.context||i&&i.context;if(n.get("type"))return this._openFormInSidepanel(n,o);this._triggerSearchResults(n,o)},"_triggerSearchResults":function(e,t){var n=i.Deferred();return csui.require(["csui/utils/contexts/factories/search.formquery.factory"],function(i){var o=t.getModel(i);o.clear({"silent":!0}),o.set("query_id",e.get("id")),n.resolve()},n.reject),n.promise()},"_openFormInSidepanel":function(e,t){var n=i.Deferred();return csui.require(["csui/controls/side.panel/side.panel.view","csui/widgets/search.forms/search.form.view","csui/widgets/search.forms/search.form.factory"],function(i,s,r){var a=t.getCollection(r,{"attributes":{"id":e.get("id")}});a.ensureFetched().then(function(){var r=a.get("schema"),c=r.title?r.title:e.get("name"),l=new s({"context":t,"model":a,"searchFormId":e.get("id"),"hideSearchButton":!0,"showInSearchResultsNewPerspective":!0}),u=new i({"slides":[{"title":c,"content":l,"footer":{"buttons":[{"label":o.searchButtonMessage,"type":"action","id":"search-btn","className":"binf-btn binf-btn-primary","disabled":!1}]}}],"sidePanelClassName":"cvs-in-sidepanel"});l.listenTo(l,"render:form",function(){u.triggerMethod("set:focus")}),u.show(),u.listenTo(l,"button:click",function(e){"search-btn"===e.id&&l.loadCustomSearch(),u.hide()}),u.listenTo(l,"enable:search",function(e){l.trigger("update:button","search-btn",{"disabled":!e})}),u.listenTo(l,"click:search",function(){u.hide()}),n.resolve()}).fail(function(){n.reject()})},n.reject),n.promise()}})}),csui.define("csui/utils/commands/favorite.add",["require","csui/lib/jquery","csui/utils/base","csui/lib/underscore","i18n!csui/utils/commands/nls/localized.strings","csui/utils/commandhelper","csui/utils/commands/node","csui/utils/command.error"],function(e,i,t,n,o,s,r,a){"use strict";return r.extend({"defaults":{"signature":"Favorite","command_key":["favorite","favorite"],"scope":"single","name":o.CommandNameFavorite,"verb":o.CommandVerbFavorite,"doneVerb":o.CommandDoneVerbFavorite},"enabled":function(e,i){if(i&&i.data&&i.data.useContainer)return e.container&&!e.container.get("favorite");var t=s.getAtLeastOneNode(e);return t&&1===t.length&&!t.models[0].get("favorite")},"execute":function(e,t){var n=i.Deferred(),o=e.originatingView;return csui.require(["csui/models/favorite.model","csui/dialogs/modal.alert/modal.alert"],function(i,t){var s;s=e.data&&e.data.useContainer?e.container:e.nodes.models[0];var r=s.get("id");new i({"node":s,"id":r,"selected":!1},{"connector":s.connector}).addToFavorites().done(function(e){s.set("favorite",!0),o.trigger("fav:change"),n.resolve(e)}).fail(function(e){n.reject(new a(e))})},function(e){n.reject(e)}),n.promise()}})}),csui.define("csui/utils/commands/favorite.remove",["require","csui/lib/jquery","csui/utils/base","csui/lib/underscore","i18n!csui/utils/commands/nls/localized.strings","csui/utils/commandhelper","csui/utils/commands/node","csui/utils/command.error"],function(e,i,t,n,o,s,r,a){"use strict";return r.extend({"defaults":{"signature":"NonFavorite","command_key":["nonfavorite","NonFavorite"],"scope":"single","verb":o.CommandVerbFavorite,"doneVerb":o.CommandRemovedVerbFavorite},"enabled":function(e,i){if(i&&i.data&&i.data.useContainer)return e.container&&e.container.get("favorite");var t=s.getAtLeastOneNode(e);return t&&1===t.length&&t.models[0].get("favorite")},"execute":function(e,t){var n=i.Deferred(),o=e.originatingView;return csui.require(["csui/models/favorite.model","csui/dialogs/modal.alert/modal.alert"],function(i,t){var s;s=e.data&&e.data.useContainer?e.container:e.nodes.models[0];var r=s.get("id");new i({"node":s,"id":r,"selected":!1},{"connector":s.connector}).removeFromFavorites().done(function(e){s.set("favorite",!1),o.trigger("fav:change"),n.resolve(e)}).fail(function(e){n.reject(new a(e))})},function(e){n.reject(e)}),n.promise()}})}),csui.define("csui/utils/commands/inlineedit",["require","csui/lib/underscore","csui/lib/jquery","csui/models/command","csui/utils/commandhelper"],function(e,i,t,n,o){"use strict";var s=n.extend({"defaults":{"signature":"InlineEdit","command_key":["rename","Rename"],"scope":"single"},"execute":function(e,i){var n=t.Deferred();return csui.require(["csui/controls/table/inlineforms/inlineform.factory"],function(i){var t=e.nodes&&1===e.nodes.length&&e.nodes.at(0),o=i.getInlineFormView(t.get("type"));o||(o=i.getInlineFormView(-1)),o&&(t.inlineFormView=o,t.set("csuiInlineFormErrorMessage","dummy",{"silent":!0}),t.unset("csuiInlineFormErrorMessage")),n.resolve()},function(e){n.reject(e)}),n.promise()}});return i.extend(s,{"version":"1.0"}),s}),csui.define("csui/utils/commands/move",["module","require","csui/lib/underscore","csui/lib/jquery","i18n!csui/utils/commands/nls/localized.strings","csui/utils/commands/copy.move","csui/utils/url","csui/utils/command.error","csui-ext!csui/utils/commands/move"],function(e,i,t,n,o,s,r,a,c){"use strict";var l=t.extend({},e.config());return t.defaults(l,{"actionType":"move","parallelism":3,"allowMultipleInstances":!0}),s.extend({"defaults":{"signature":"Move","command_key":["move","Move"],"name":o.CommandNameMove,"verb":o.CommandNameVerbMove,"pageLeavingWarning":o.MovePageLeavingWarning,"allowMultipleInstances":l.allowMultipleInstances,"scope":"multiple","successMessages":{"formatForNone":o.MoveItemsNoneMessage,"formatForOne":o.MoveOneItemSuccessMessage,"formatForTwo":o.MoveSomeItemsSuccessMessage,"formatForFive":o.MoveManyItemsSuccessMessage},"errorMessages":{"formatForNone":o.MoveItemsNoneMessage,"formatForOne":o.MoveOneItemFailMessage,"formatForTwo":o.MoveSomeItemsFailMessage,"formatForFive":o.MoveManyItemsFailMessage},"labels":{"actionName":o.MovingNodes,"actionNode":o.MovingNode,"commandTitle":o.CommandTitleMove,"commandName":o.CommandNameMove,"dialogTitle":o.DialogTitleMove,"dialogTitleSingle":o.DialogTitleSingleMove,"titleNotAllowed":o.MoveNotAllowed},"command":l.actionType},"allowCollectionRefetch":!1,"_doActionSelectedNodes":function(e){var i=n.Deferred();return csui.require(["csui/utils/contexts/factories/next.node","csui/controls/globalmessage/globalmessage","csui/utils/taskqueue"],t.bind(function(s,r,c){var u=this,d=new c({"parallelism":l.parallelism}),m=e.status&&e.status.nodes&&e.status.nodes.models.map(function(e){return e.get("id")});this.getExternalBodyParams(e.connector,m).then(function(o){var s=t.map(e.uploadCollection.models,function(i){var t=n.Deferred();return d.pending.add({"worker":function(){var n,s=i.attributes;return i.node.trigger("before:move",i.node),n=s.extended_data&&s.extended_data.roles?u._actionNodeWithMetadata(s,e.connector,e.targetFolder.get("id"),e.status,o):u._moveNode(s,e.connector,e.targetFolder.get("id"),e.applyProperties,e.status,o),n.done(function(){i.node.trigger("move",i.node),i.set("count",1),i.deferred.resolve(i),t.resolve(i)}).fail(function(e){var n=new a(e);i.deferred.reject(i,n),t.reject(n)}),t.promise()}}),t.promise(s)});return n.whenAll.apply(n,s).then(i.resolve,i.reject)}),r.showProgressPanel(e.uploadCollection,{"oneFileTitle":o.MovingOneItem,"oneFileSuccess":o.MoveOneItemSuccessMessage,"multiFileSuccess":o.MoveManyItemsSuccessMessage,"oneFilePending":o.MovingOneItem,"multiFilePending":o.MovingItems,"multiFileOneFailure":o.MoveManyItemsOneFailMessage,"oneFileFailure":o.MoveOneItemFailMessage,"multiFileFailure":o.MoveManyItemsFailMessage,"someFileSuccess":o.MoveSomeItemsSuccessMessage,"someFilePending":o.MovingSomeItems,"someFileFailure":o.MoveSomeItemsFailMessage,"locationLabelPending":o.MovingLocationLabel,"locationLabelCompleted":o.MovedLocationLabel,"enableCancel":!1,"actionType":l.actionType,"allowMultipleInstances":l.allowMultipleInstances,"context":e.context,"nextNodeModelFactory":s}),this._unblockPageActions(e.status)},this),i.reject),i.promise()},"_moveNode":function(e,i,o,s,a,c){var l=this,u=n.Deferred();return this._getCategories(i,e.id,o,s).then(function(n){var a,d,m;return a={},csui.require(["csui/dialogs/node.picker/impl/header/apply.properties.selector/apply.properties.selector.view"],function(g){a[g.KEEP_ORIGINAL_PROPERTIES]="original",a[g.APPLY_DESTINATION_PROPERTIES]="destination",a[g.COMBINE_ALL_PROPERTIES]="merged",d={"parent_id":o,"name":e.newName?e.newName:e.name,"roles":{"categories":n[a[s]]}},t.extend(d,e.extended_data),t.isFunction(l.checkMultilingualInfo)&&l.checkMultilingualInfo(e,d),d=t.extend({},c,d),m={"url":r.combine(i.getConnectionUrl().getApiBase("v2"),"/nodes/",e.id),"method":"PUT","data":d,"contentType":i.getAjaxContentType()},i.makeAjaxCall(m).then(function(e){u.resolve(e)}).fail(function(e){u.reject(e)})}),u.promise()})},"externalBodyParams":{},"getExternalBodyParams":function(e,i){return n.Deferred().resolve(this.externalBodyParams).promise()},"_doPostExecute":function(e){var i=this,n=[],o=["recentlyaccessed","favorites","searchresults"],s=-1!==o.indexOf(e.applicationScopeId);if(e.uploadCollection.models&&e.uploadCollection.models.length>0&&t.each(e.uploadCollection.models,function(i){s&&(i.node.attributes.parent_id_expand=e.targetFolder.attributes),n.push(i.node)}),i.nodePicker&&i.nodePicker._dialog&&i.nodePicker._dialog.isDestroyed)return s&&e.status.collection?n.forEach(function(i){var t=e.status.collection.findIndex(i);e.status.collection.remove(i),e.status.collection.add(i,{"at":t})}):(e.status.collection&&e.status.collection.remove(n),i.allowCollectionRefetch=!0),n},"_getCategories":function(e,i,t,o){if(o&&1===o)return n.Deferred().resolve({}).promise();var s={"url":e.connection.url+"/forms/nodes/move?"+n.param({"id":i,"parent_id":t})};return e.makeAjaxCall(s).then(function(e){var i=e.forms[1];return i&&i.data||{}})},"_actionNodeWithMetadata":function(e,i,n,o,s){var a=t.extend({},s,{"parent_id":n,"name":e.newName?e.newName:e.name}),c={"url":r.combine(i.getConnectionUrl().getApiBase("v2"),"/nodes/",e.id),"method":"PUT","data":a,"contentType":i.getAjaxContentType()};return t.extend(a,e.extended_data),i.makeAjaxCall(c)}})}),csui.define("csui/utils/commands/navigate",["module","csui/lib/underscore","csui/lib/jquery","csui/utils/base","csui/utils/commandhelper","csui/models/command","csui/models/node/node.model","csui/utils/node.links/node.links"],function(e,i,t,n,o,s,r,a){"use strict";var c=i.extend({"openInNewTab":!0},e.config());return s.extend({"defaults":{"signature":"Navigate"},"enabled":function(e){var i=o.getJustOneNode(e);return i&&140===i.get("type")},"execute":function(e,i){var t=o.getJustOneNode(e);return this._navigateTo(t,i)},"_navigateTo":function(e,i){function o(){s||(s=window),s.location.href=a.completeUrl(e,l),s.focus(),u.resolve()}var s,l=e.get("url"),u=t.Deferred();return c.openInNewTab&&((s=window.open("","_blank"))&&s.location||(s=null)),l?o():(e=new r({"id":e.get("id")},{"connector":e.connector,"fields":{"properties":["url"]}}),e.fetch().done(function(){l=e.get("url"),l?o():s&&s.close()}).fail(function(e){s&&s.close(),u.reject(new n.Error(e))})),u.promise()}})}),
csui.define("csui/utils/commands/open.plugins/open.plugins",["csui/lib/underscore","csui/lib/backbone","csui/models/mixins/rules.matching/rules.matching.mixin","csui-ext!csui/utils/commands/open.plugins/open.plugins"],function(e,i,t,n){"use strict";var o=i.Model.extend({"defaults":{"sequence":100,"plugin":null},"constructor":function(e,t){i.Model.prototype.constructor.apply(this,arguments),this.makeRulesMatching(t)}});t.mixin(o.prototype);var s=i.Collection.extend({"model":o,"comparator":"sequence","constructor":function(e,t){i.Collection.prototype.constructor.call(this,e,t)},"findByNode":function(e,i){var t,n;i&&(t=i.openInNewTab,n=i.widgetOnly);var o=this.find(function(i){var o=i.get("plugin");return(!0!==n&&(o.openWindow||o.getUrl||o.getUrlQuery)||!1!==n&&!0!==t&&(o.openWidget||o.createWidget))&&i.matchRules(e,i.attributes)});return o&&o.get("plugin")}}),r=new s;return n&&r.add(e.chain(n).flatten(!0).map(function(i){return e.defaults({"plugin":new i.plugin},i)}).value()),r}),csui.define("csui/utils/commands/open",["module","require","csui/lib/underscore","csui/lib/jquery","csui/utils/url","csui/models/node.actions","csui/utils/commandhelper","csui/utils/commands/download","csui/utils/commands/open.plugins/open.plugins"],function(e,i,t,n,o,s,r,a,c){"use strict";var l=t.extend({"openInNewTab":null,"forceDownload":!1,"extSupportTypes":{}},e.config()),u=[144,749,736,2];u=Array.prototype.concat.apply(u,t.values(l.extSupportTypes));var d,m;return a.extend({"defaults":{"signature":"Open","command_key":["default","open","download","Download"],"scope":"single","openable":!0,"types":u},"execute":function(e,i){var n=this._getNode(e);return this.checkPermission(n).then(t.bind(function(e){if(!e)return this._showOverview(n,i);if(l.forceDownload)return this._downloadContent(n,i,"download");var t=c.findByNode(n,{"openInNewTab":l.openInNewTab});return t?this._openContent(n,i,t):this._downloadContent(n,i,"download")},this))},"_openContent":function(e,i,t){if(l.openInNewTab)return this._openWindow(t,e,window.open(""),i);if(t.widgetView)return this._openWidget(t.widgetView,e,i);var n=!1===l.openInNewTab?window:window.open("");return this._openWindow(t,e,n,i)},"_openWidget":function(e,i,t){var o=n.Deferred();return csui.require(["csui/utils/commands/impl/full.page.modal/full.page.modal.view",e],function(e,n){new e({"view":new n({"context":t.context,"model":i})}).on("destroy",function(){o.resolve()}).show()},o.reject),o.promise()},"_openWindow":function(e,i,t,o){var s=n.Deferred(),r=this;return csui.require(["csui/utils/open.authenticated.page"],function(){d=arguments[0];var a=!0;t&&t.location||(t=parent.window,a=!1),(e.getUrl&&e.getUrl(i)||e.getUrlQuery(i)).then(function(n){return r._openURL(e,i,t,n,o)},function(e){return a&&t!==window&&t.close(),s.reject(e),n.Deferred().reject()}).then(function(){a&&t.focus(),s.resolve()})},s.reject),s.promise()},"_openURL":function(e,i,t,s,r){var a=i.connector||r.connector;return e.getUrl||(s=o.appendQuery(new o(a.connection.url).getCgiScript(),o.combineQueryString(s))),e.needsAuthentication&&e.needsAuthentication(i)?d(a,s,{"window":t,"openInNewTab":l.openInNewTab}):(t.location.href=s,n.Deferred().resolve().promise())},"checkPermission":function(e){function i(){return!!e.actions.get("download")}if(e.actions.length)return n.Deferred().resolve(i()).promise();var t=new s(void 0,{"connector":e.connector,"nodes":[e.get("id")],"commands":["download"]}),o=n.Deferred();return t.fetch().then(function(){var n=e.get("id"),s=t.get(n);e.actions.add(s.actions.models);var r=i();o.resolve(r)}),o},"_showOverview":function(e,i){var t=n.Deferred();return csui.require(["csui/utils/contexts/factories/next.node"],function(){m=arguments[0];var t=i.context.getModel(m),n=e.get("id");t.set("id",n)},t.reject),t.promise()}})}),csui.define("csui/utils/commands/open.discussion",["csui/utils/commandhelper","csui/utils/commands/open.classic.page"],function(e,i){return i.extend({"defaults":{"signature":"OpenDiscussion"},"enabled":function(i){var t=e.getJustOneNode(i);return t&&215===t.get("type")},"getUrlQueryParameters":function(e,i){return{"func":"ll","objAction":"view","objId":e.get("id"),"nexturl":location.href}}})}),csui.define("csui/utils/commands/open.milestone",["csui/utils/commandhelper","csui/utils/commands/open.classic.page"],function(e,i){return i.extend({"defaults":{"signature":"OpenMilestone"},"enabled":function(i){var t=e.getJustOneNode(i);return t&&212===t.get("type")},"getUrlQueryParameters":function(e,i){return{"func":"ll","objAction":"BrowseMilestone","objId":e.get("id"),"nexturl":location.href}}})}),csui.define("csui/utils/commands/open.channel",["csui/utils/commandhelper","csui/utils/commands/open.classic.page"],function(e,i){return i.extend({"defaults":{"signature":"OpenChannel"},"enabled":function(i){var t=e.getJustOneNode(i);return t&&207===t.get("type")},"getUrlQueryParameters":function(e,i){return{"func":"ll","objAction":"ViewChannel","objId":e.get("id"),"nexturl":location.href}}})}),csui.define("csui/utils/commands/open.news",["csui/utils/commandhelper","csui/utils/commands/open.classic.page"],function(e,i){return i.extend({"defaults":{"signature":"OpenNews"},"enabled":function(i){var t=e.getJustOneNode(i);return t&&208===t.get("type")},"getUrlQueryParameters":function(e,i){return{"func":"ll","objAction":"ViewNews","objId":e.get("id"),"nexturl":location.href}}})}),csui.define("csui/utils/commands/open.poll",["csui/utils/commandhelper","csui/utils/commands/open.classic.page"],function(e,i){return i.extend({"defaults":{"signature":"OpenPoll"},"enabled":function(i){var t=e.getJustOneNode(i);return t&&218===t.get("type")},"getUrlQueryParameters":function(e,i){return{"func":"ll","objAction":"OpenPoll","objId":e.get("id"),"nexturl":location.href}}})}),csui.define("csui/utils/commands/open.prospector",["csui/utils/commandhelper","csui/utils/commands/open.classic.page"],function(e,i){return i.extend({"defaults":{"signature":"OpenProspector"},"enabled":function(i){var t=e.getJustOneNode(i);return t&&384===t.get("type")},"getUrlQueryParameters":function(e,i){return{"func":"ll","objAction":"ProspectorBrowse","objId":e.get("id"),"order":"-SCORE","summaries":1,"nexturl":location.href}}})}),csui.define("csui/utils/commands/open.specific.classic.page",["csui/utils/commands/open.classic.page","csui/utils/commandhelper","csui/utils/classic.nodes/classic.nodes"],function(e,i,t){"use strict";return e.extend({"defaults":{"signature":"OpenSpecificClassicPage"},"enabled":function(e){var n=i.getJustOneNode(e);return n&&!1!==n.get("openable")&&t.isSupported(n)},"getUrl":function(e,i){return t.getUrl(e)}})}),csui.define("csui/utils/commands/open.specific.node.perspective",["csui/utils/commands/open.node.perspective","csui/utils/commandhelper","csui/utils/smart.nodes/smart.nodes"],function(e,i,t){"use strict";return e.extend({"defaults":{"signature":"OpenSpecificNodePerspective"},"enabled":function(e){var n=i.getJustOneNode(e);return n&&!1!==n.get("openable")&&t.isSupported(n)}})}),csui.define("csui/utils/commands/open.task",["csui/utils/commandhelper","csui/utils/commands/open.classic.page"],function(e,i){return i.extend({"defaults":{"signature":"OpenTask"},"enabled":function(i){var t=e.getJustOneNode(i);return t&&206===t.get("type")},"getUrlQueryParameters":function(e,i){return{"func":"ll","objAction":"BrowseTask","objId":e.get("id"),"nexturl":location.href}}})}),csui.define("csui/utils/commands/open.taskgroup",["csui/utils/commandhelper","csui/utils/commands/open.classic.page"],function(e,i){return i.extend({"defaults":{"signature":"OpenTaskGroup"},"enabled":function(i){var t=e.getJustOneNode(i);return t&&205===t.get("type")},"getUrlQueryParameters":function(e,i){return{"func":"ll","objAction":"BrowseTaskGroup","objId":e.get("id"),"nexturl":location.href}}})}),csui.define("csui/utils/commands/open.tasklist",["csui/utils/commandhelper","csui/utils/commands/open.classic.page"],function(e,i){return i.extend({"defaults":{"signature":"OpenTaskList"},"enabled":function(i){var t=e.getJustOneNode(i);return t&&204===t.get("type")},"getUrlQueryParameters":function(e,i){return{"func":"ll","objAction":"BrowseTaskList","objId":e.get("id"),"nexturl":location.href}}})}),csui.define("csui/utils/commands/open.topic",["csui/utils/commandhelper","csui/utils/commands/open.classic.page"],function(e,i){return i.extend({"defaults":{"signature":"OpenTopic"},"enabled":function(i){var t=e.getJustOneNode(i),n=t&&t.get("type");return 130===n||134===n},"getUrlQueryParameters":function(e,i){return{"func":"ll","objAction":"view","objId":e.get("id"),"show":1,"nexturl":location.href}}})}),csui.define("csui/utils/commands/permissions",["module","require","csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/lib/marionette","csui/utils/command.error","csui/utils/commandhelper","csui/models/command","csui/models/nodes"],function(e,i,t,n,o,s,r,a,c,l){"use strict";return c.extend({"defaults":{"signature":"permissions","command_key":["permissions","Permissions"],"scope":"multiple","commands":"csui/utils/commands"},"_executeWithSaveState":function(e,i){var t,o=n.Deferred(),s=e.nodes,r=e.container,a=!0;e.originatingView&&e.originatingView.$el.closest(".cs-metadata-navigation-wrapper");s&&s.first()===r?(s=r,a=!1):(t=this._getAtLeastOneNode(e),s=s.first());var c=e.context||i&&i.context;return csui.require(["csui/widgets/metadata/impl/metadatanavigation/metadatanavigation.view",this.get("commands"),"csui/utils/contexts/factories/metadata.factory"],function(n,o,r){var l,u=s.get("id");if(e.originatingView instanceof n){e.originatingView.mdv&&e.originatingView.mdv.model.get("shortcutNode")&&(s.attributes.shortcutNode=e.originatingView.mdv.model.get("shortcutNode"));var d=e.originatingView.mdv.model.get("shortcutNode");d&&(u=d.get("id")),l=c.getModel(r);var m=l.get("metadata_info")||{};l.set("metadata_info",{"id":u,"model":s,"navigationView":a,"originatingView":e.originatingView,"targetView":e.originatingView,"collection":m.collection,"navigator":m.navigator,"commands":o,"showCloseIcon":!e.originatingView,"showBackIcon":!!e.originatingView,"selectedTab":e.selectedTab,"showPermissionView":!0})}else a&&e.collection&&e.collection.models&&e.collection.models.length>0?(l=c.getModel(r),l.set("metadata_info",{"id":u,"navigator":!0,"model":s,"containerCollection":e.collection,"collection":t,"selected":s,"originatingView":e.originatingView,"commands":o,"isExpandedView":e.originatingView&&!!e.originatingView.options.isExpandedView,"nameAttribute":i?i.nameAttribute:void 0,"showCloseIcon":!e.originatingView,"selectedTab":e.selectedTab,"showPermissionView":!0})):(e.originatingView&&void 0===e.originatingView.supportOriginatingView&&(e.originatingView.supportOriginatingView=!0),l=c.getModel(r),l.set("metadata_info",{"id":u,"model":s,"navigationView":a,"originatingView":e.originatingView,"targetView":e.originatingView,"commands":o,"showCloseIcon":!e.originatingView,"showBackIcon":!!e.originatingView,"selectedTab":e.selectedTab,"showPermissionView":!0}))}),o.promise()},"_executeWithoutSaveState":function(e,i){var o,r=this,a=n.Deferred(),c=e.nodes,l=e.container,u=!0,d=e.originatingView?e.originatingView.$el.closest(".cs-metadata-navigation-wrapper"):[];c&&c.first()===l?(c=l,u=!1):(o=this._getAtLeastOneNode(e),c=c.first());var m=e.context||i&&i.context;return csui.require(["csui/widgets/metadata/impl/metadatanavigation/metadatanavigation.view","csui/widgets/metadata/metadata.view","csui/controls/dialog/dialog.view","csui/widgets/permissions/permissions.view",this.get("commands")],function(g,p,f,v,w){var h,b=(c.get("id"),e.data&&!!e.data.dialogView);if(e.originatingView instanceof g?(e.originatingView.mdv&&e.originatingView.mdv.model.get("shortcutNode")&&(c.attributes.shortcutNode=e.originatingView.mdv.model.get("shortcutNode")),h=new p({"model":c,"originatingView":e.originatingView,"containerCollection":e.collection,"context":m,"commands":w,"showCloseIcon":!e.originatingView,"showBackIcon":!e.originatingView,"activeTab":e.originatingView.mdv&&e.originatingView.mdv.metadataTabView&&e.originatingView.mdv.metadataTabView.options.activeTab,"selectedTab":e.originatingView.mdv&&e.originatingView.mdv.metadataTabView&&e.originatingView.mdv.metadataTabView.tabLinks.selected,"showPermissionView":!0})):u&&e.collection&&e.collection.models&&e.collection.models.length>0?h=new g({"container":l,"containerCollection":e.collection,"collection":o,"selected":c,"originatingView":e.originatingView,"context":m,"commands":w,"isExpandedView":e.originatingView&&!!e.originatingView.options.isExpandedView,"nameAttribute":i?i.nameAttribute:void 0,"showCloseIcon":!e.originatingView,"selectedTab":e.selectedTab,"showPermissionView":!0}):(e.originatingView&&void 0===e.originatingView.supportOriginatingView&&(e.originatingView.supportOriginatingView=!0),h=new p({"model":c,"originatingView":e.originatingView,"targetView":e.originatingView,"context":m,"commands":w,"showCloseIcon":!e.originatingView,"showBackIcon":!!e.originatingView,"selectedTab":e.selectedTab,"showPermissionView":!0}),e.originatingView&&(e.originatingView.permissionsView=h)),e.originatingView instanceof g)e.originatingView.mdv&&e.originatingView.mdv.metadataTabView&&(r.listenTo(h,"metadata:close:without:animation",function(){if(e.originatingView.originatingView){var i=e.originatingView.originatingView.$el,t=n(i.parent().find(".cs-properties-wrapper")[0]);i.show(),e.originatingView.triggerMethod("dom:refresh"),!!e.collection&&(e.collection.requireSwitched=!1),h.destroy(),t.remove(),a.resolve()}}),e.originatingView.mdv.destroy(),e.originatingView.showPermissionView=!0,h.render(),s.triggerMethodOn(h,"before:show"),e.originatingView.$el.find(".metadata-content").append(h.el),s.triggerMethodOn(h,"show"));else if(e.originatingView&&!b){var y,_,M=e.originatingView.$el;M.width();M.parent().append("<div class='cs-permissions-wrapper'></div>"),_=n(M.parent().find(".cs-permissions-wrapper")[0]),_.hide(),h.render(),t.isFunction(e.originatingView.unblockActions)&&e.originatingView.unblockActions(),s.triggerMethodOn(h,"before:show"),_.append(h.el),M=M.parent().find(".cs-properties-wrapper").length>0?M.parent().find(".cs-properties-wrapper"):M,M.hide(),_.show(),e.originatingView.metadataView&&(M.parent().find(".cs-properties-wrapper").remove(),e.originatingView.metadataView&&e.originatingView.metadataView.destroy()),s.triggerMethodOn(h,"show"),M.promise().done(function(){e.originatingView.isDisplayed=!1}),y=function(){d.length>0&&d.removeClass("cs-metadata-no-bg-color"),_.hide(),e.originatingView.$el.show(),e.originatingView.metadataView&&e.originatingView.metadataView.destroy(),e.originatingView.permissionsView&&e.originatingView.permissionsView.destroy(),e.originatingView.triggerMethod("dom:refresh"),e.originatingView.isDisplayed=!0,!!e.collection&&(e.collection.requireSwitched=!1),e.originatingView.trigger("permissions:view:destroyed"),h.destroy(),_.remove(),a.resolve()},r.listenTo(h,"metadata:close",t.bind(y,r)),r.listenTo(h,"metadata:close:without:animation",function(){M.show(),e.originatingView.triggerMethod("dom:refresh"),!!e.collection&&(e.collection.requireSwitched=!1),h.destroy(),_.remove(),a.resolve()})}else h.metadataTabView&&(h.metadataTabView.options.isExpandedView=!0),r.dialog=new f({"className":"cs-permissions","largeSize":!0,"view":h}),r.dialog.show(),r.dialog.ui.header.hide(),r.dialog.listenTo(h,"metadata:close",function(){r.dialog.destroy(),a.resolve()}),r.dialog.listenTo(h,"metadata:close:without:animation",function(){r.dialog.destroy(),a.resolve()})}),a.promise()},"execute":function(e,i){var t,o=n.Deferred(),s=e.nodes,r=e.container,a=!0;e.originatingView&&e.originatingView.$el.closest(".cs-metadata-navigation-wrapper");s&&s.first()===r?(s=r,a=!1):(t=this._getAtLeastOneNode(e),s=s.first());var c=e.context||i&&i.context;return csui.require(["csui/widgets/metadata/impl/metadatanavigation/metadatanavigation.view",this.get("commands"),"csui/utils/contexts/factories/metadata.factory"],function(n,o,r){var l,u=s.get("id");if(e.originatingView instanceof n){e.originatingView.mdv&&e.originatingView.mdv.model.get("shortcutNode")&&(s.attributes.shortcutNode=e.originatingView.mdv.model.get("shortcutNode"));var d=e.originatingView.mdv.model.get("shortcutNode");d&&(u=d.get("id")),l=c.getModel(r);var m=l.get("metadata_info")||{};l.set("metadata_info",{"id":u,"model":s,"navigationView":a,"originatingView":e.originatingView,"targetView":e.originatingView,"collection":m.collection,"navigator":m.navigator,"commands":o,"showCloseIcon":!e.originatingView,"showBackIcon":!!e.originatingView,"selectedTab":e.selectedTab,"showPermissionView":!0})}else a&&e.collection&&e.collection.models&&e.collection.models.length>0?(l=c.getModel(r),l.set("metadata_info",{"id":u,"navigator":!0,"model":s,"containerCollection":e.collection,"collection":t,"selected":s,"originatingView":e.originatingView,"commands":o,"isExpandedView":e.originatingView&&!!e.originatingView.options.isExpandedView,"nameAttribute":i?i.nameAttribute:void 0,"showCloseIcon":!e.originatingView,"selectedTab":e.selectedTab,"showPermissionView":!0})):(e.originatingView&&void 0===e.originatingView.supportOriginatingView&&(e.originatingView.supportOriginatingView=!0),l=c.getModel(r),l.set("metadata_info",{"id":u,"model":s,"navigationView":a,"originatingView":e.originatingView,"targetView":e.originatingView,"commands":o,"showCloseIcon":!e.originatingView,"showBackIcon":!!e.originatingView,"selectedTab":e.selectedTab,"showPermissionView":!0}))}),o.promise()},"_getAtLeastOneNode":function(e){return e.nodes?1===e.nodes.length&&e.collection?e.collection:e.nodes:new l}})}),csui.define("csui/utils/commands/properties",["module","require","csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/lib/marionette","csui/utils/command.error","csui/utils/commandhelper","csui/models/command","csui/models/nodes"],function(e,i,t,n,o,s,r,a,c,l,u){"use strict";return c.extend({"defaults":{"signature":"Properties","command_key":["properties","Properties"],"openable":!0,"scope":"multiple","commands":"csui/utils/commands"},"_executeWithSaveState":function(e,i){var t=n.Deferred();return csui.require(["csui/utils/contexts/factories/metadata.factory","csui/widgets/metadata/header.dropdown.menu.items",this.get("commands")],function(n,o,s){var r,c=e.context||i&&i.context,l=c.getModel(n),u=a.getJustOneNode(e)||e.nodes&&e.nodes.at(0),d=e.container,m=e.nodes,g=e.originatingView,p=!0,f=l.get("metadata_info")||{},v=r;if(f&&f.navigator?(p=!0,v=f.collection):m&&m.first()===d||e.noMetadataNavigation||f&&!1===f.navigationView?p=!1:r=v=this._getAtLeastOneNode(e),!p&&g&&g.options.refetchNodeActions&&r){var w=s.getSignatures(o);r.each(function(e){e.refetchNodeActions&&(e.nonPromotedActionCommands=w,e.set({"csuiLazyActionsRetrieved":!1},{"silent":!0}))})}var h=u.get("id"),b=u.get("shortcutNode");b&&(h=b.get("id")),l.set("metadata_info",{"id":h,"model":u,"navigator":p,"collection":v,"selectedTab":e.selectedTab,"selectedProperty":e.selectedProperty,"isThumbnailView":e.originatingView&&e.originatingView.thumbnailView}),t.resolve()}.bind(this),function(e){t.reject(e)}),t.promise()},"_isInMetadataPerspective":function(e){var i=n.Deferred();return csui.require(["csui/utils/contexts/factories/metadata.factory"],function(n){var o=e.getModel(n),s=o.get("metadata_info");s&&t.keys(s).length>0?i.resolve():i.reject()}.bind(this),function(e){i.reject(e)}),i.promise()},"_executeWithoutSaveState":function(e,i){var o,a=e.context||i&&i.context,c=this,l=n.Deferred(),u=e.nodes,d=e.container,m=!0;u&&u.first()===d?(u=d,m=!1):o=this._getAtLeastOneNode(e);var g=e.originatingView||i&&i.originatingView;return csui.require(["csui/widgets/metadata/impl/metadatanavigation/metadatanavigation.view","csui/widgets/metadata/metadata.view","csui/controls/dialog/dialog.view","csui/models/nodeversions",this.get("commands")],function(r,p,f,v,w){var h,b=e.data&&!!e.data.dialogView;if(m?e.collection&&e.collection.models&&e.collection.models.length>0?h=new r({"container":d,"containerCollection":e.collection,"collection":o,"selected":u,"originatingView":g,"context":a,"commands":w,"nameAttribute":i?i.nameAttribute:void 0,"showCloseIcon":!g,"selectedTab":e.selectedTab,"selectedProperty":e.selectedProperty,"showThumbnails":e.showThumbnails,"enableViewState":!1}):(g&&void 0===g.supportOriginatingView&&(g.supportOriginatingView=!0),h=new p({"model":u.get("id")?u:u.models[0],"navigationView":!1,"originatingView":g,"targetView":g,"context":a,"commands":w,"showCloseIcon":!g,"showBackIcon":!!g,"selectedTab":e.selectedTab,"selectedProperty":e.selectedProperty,"enableViewState":!1}),g&&(g.metadataView=h)):(g&&void 0===g.supportOriginatingView&&(g.supportOriginatingView=!0),h=new p({"model":u,"navigationView":!1,"originatingView":g,"targetView":g,"context":a,"commands":w,"showCloseIcon":!g,"showBackIcon":!!g,"selectedTab":e.selectedTab,"selectedProperty":e.selectedProperty,"enableViewState":!1}),g&&(g.metadataView=h)),g instanceof r&&!(e.collection instanceof v))g.mdv&&g.mdv.metadataTabView&&(h=null,g.showPermissionView=!1,a.viewStateModel&&a.viewStateModel.setSessionViewState("permissions",!1),g._showNode(u.get("id")?u:u.models[0]));else if(g&&!b){g.triggerMethod("metadata:created",h);var y,_,M=g.$el;M.width();M.parent().append("<div class='cs-properties-wrapper'></div>"),M.parent().addClass("csui-node-properties-wrapper"),_=n(M.parent().find(".cs-properties-wrapper")[0]),_.hide(),h.render(),s.triggerMethodOn(h,"before:show"),_.append(h.el),t.isFunction(g.unblockActions)&&g.unblockActions(),M=M.parent().find(".cs-permissions-wrapper").length>0?M.parent().find(".cs-permissions-wrapper"):M,M.hide(),_.show(),g.permissionsView&&(M.parent().find(".cs-permissions-wrapper").remove(),g.permissionsView&&g.permissionsView.destroy()),s.triggerMethodOn(h,"show"),M.promise().done(function(){g.isDisplayed=!1}),y=function(){_.hide(),g.$el.show(),g.metadataView&&g.metadataView.destroy(),g.permissionsView&&g.permissionsView.destroy(),g.triggerMethod("dom:refresh"),g.isDisplayed=!0,!!e.collection&&(e.collection.requireSwitched=!1),g.trigger("properties:view:destroyed"),M.parent().removeClass("csui-node-properties-wrapper"),h.destroy(),_.remove(),l.resolve()},c.listenTo(h,"metadata:close",t.bind(y,c)),c.listenTo(h,"metadata:close:without:animation",function(){M.show(),g.triggerMethod("dom:refresh"),!!e.collection&&(e.collection.requireSwitched=!1),h.destroy(),_.remove(),l.resolve()})}else c.dialog=new f({"className":"cs-properties","largeSize":!0,"view":h}),c.dialog.show(),c.dialog.ui.header.hide(),c.dialog.listenTo(h,"metadata:close",function(){c.dialog.destroy()}),c.dialog.listenTo(h,"metadata:close:without:animation",function(){c.dialog.destroy()}),c.dialog.listenTo(c.dialog,"before:hide",function(){l.resolve()})},function(e){l.reject(new r(e))}),l.promise()},"execute":function(e,i){var t=e.context||i&&i.context;return t&&t.viewStateModel&&t.viewStateModel.get("history")&&t.viewStateModel.get("enabled")?this._executeWithSaveState(e,i):this._executeWithoutSaveState(e,i)},"_getAtLeastOneNode":function(e){var i=new l;return e.nodes?1===e.nodes.length&&e.collection?e.collection.findWhere({"id":e.nodes.models[0].get("id")})?e.collection:(i.add(e.nodes.models[0]),i.add(e.collection.models),i):e.nodes:i}})}),csui.define("csui/utils/commands/rename",["csui/models/command"],function(e){"use strict";return e.extend({"defaults":{"signature":"Rename","command_key":["rename","Rename"],"scope":"single"},"rename":function(e,i){return e.save({"name":i},{"wait":!0,"patch":!0})}})}),csui.define("csui/utils/commands/rename.favorite",["require","csui/lib/underscore","csui/lib/jquery","csui/models/command","csui/utils/commandhelper"],function(e,i,t,n,o){"use strict";var s=n.extend({"defaults":{"signature":"FavoriteRename","command_key":["favorite_rename"],"scope":"single"},"execute":function(e,i){var n=t.Deferred();return csui.require(["csui/controls/table/inlineforms/favorite/favorite.view"],function(i){var t=e.nodes&&1===e.nodes.length&&e.nodes.at(0);t.inlineFormView=i,t.set("csuiInlineFormErrorMessage","dummy",{"silent":!0}),t.unset("csuiInlineFormErrorMessage"),n.resolve()},function(e){n.reject(e)}),n.promise()}});return i.extend(s,{"version":"1.0"}),s}),csui.define("csui/utils/commands/reserve",["require","module","csui/lib/underscore","csui/lib/jquery","i18n!csui/utils/commands/nls/lang","i18n!csui/utils/commands/nls/localized.strings","csui/utils/commandhelper","csui/utils/commands/node","csui/models/command"],function(e,i,t,n,o,s,r,a,c){"use strict";var l=i.config();return t.defaults(l,{"parallelism":2}),a.extend({"defaults":{"signature":"ReserveDoc","command_key":["reserve","ReserveDoc"],"name":o.CommandNameReserve,"verb":s.CommandVerbReserve,"pageLeavingWarning":s.ReservePageLeavingWarning,"scope":"multiple","successMessages":{"formatForNone":o.ReserveItemsNoneMessage,"formatForOne":o.ReserveOneItemSuccessMessage,"formatForTwo":o.ReserveSomeItemsSuccessMessage,"formatForFive":o.ReserveManyItemsSuccessMessage},"errorMessages":{"formatForNone":o.ReserveItemsNoneMessage,"formatForOne":o.ReserveOneItemFailMessage,"formatForTwo":o.ReserveSomeItemsFailMessage,"formatForFive":o.ReserveManyItemsFailMessage}},"enabled":function(e,i){var n=r.getAtLeastOneNode(e);if(t.find(n.models,function(e){return t.contains([138,139],e.get("type"))}))return!1;if(n&&n.length){if(n.some(function(e){return e.has("versions")&&!1===e.get("versions").current_version}))return!1}return c.prototype.enabled.apply(this,arguments)},"_performAction":function(e,i){var t=n.Deferred();return e.isReservedClicked=!0,csui.require(["csui/utils/contexts/factories/user"],function(n){var o=i.context.getModel(n);o.ensureFetched().then(function(){return r.updateNode(e,{"reserved_user_id":o.get("id")})}).then(t.resolve,t.reject)},t.reject),t.promise()}})}),csui.define("csui/utils/commands/compound.document/compound.document",["csui/lib/underscore","i18n!csui/utils/commands/nls/localized.strings","csui/models/command"],function(e,i,t){"use strict";return t.extend({"defaults":{"signature":"CompoundDocument","command_key":["CompoundDocument","compounddocument","createrelease","createrevision","Reorganize","releases"],"name":i.compoundDocumentHeaderTitle,"verb":i.compoundDocumentHeaderTitle,"doneVerb":i.compoundDocumentHeaderTitle,"scope":"multiple"}})}),csui.define("csui/utils/commands/compound.document/create.revision",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","i18n!csui/utils/commands/nls/localized.strings","csui/utils/commandhelper","csui/models/command","csui/utils/url"],function(e,i,t,n,o,s,r){"use strict";return s.extend({"defaults":{"signature":"CreateRevision","command_key":["CreateRevision","createrevision"],"name":n.createRevisionHeaderTitle,"verb":n.createRevisionHeaderTitle,"doneVerb":n.createRevisionHeaderTitle,"scope":"single"},"execute":function(e,t){var n=o.getAtLeastOneNode(e),s=this,r=o.getJustOneNode(e);return this.model=r,this.options=t||{},this.context=e&&e.context,this._deferred=i.Deferred(),this.connector=this.options.connector||e.collection&&e.collection.connector||e.container&&e.container.connector||n.models&&n.models[0].connector,s._showDialogBox(),this._deferred.promise()},"_showDialogBox":function(){var i=this;csui.require(["csui/controls/dialog/dialog.view","csui/controls/compound.document/dialog.view/create.release.revision.view","csui/controls/progressblocker/blocker"],function(t,o,s){var a=i.model.get("id"),c=i.connector.getConnectionUrl().getApiBase("v2"),l={"url":r.combine(c,"nodes/"+a+"/releases"),"type":"GET","contentType":"application/x-www-form-urlencoded"};i.connector.makeAjaxCall(l).done(function(r){var a=0,c=0;e.each(r.results,function(e){a<e.data.properties.release&&(a=e.data.properties.release,c=0),"Revision"===e.data.properties.type_name&&a===e.data.properties.release&&(c=c>e.data.properties.revision?c:e.data.properties.revision)}),i._view=new o({"iconLeft":"notification_warning","currentVersionLabel":n.currentRevision,"currentVersionNumber":0===a&&0===c?n.noneLabel:a+"."+c,"newVersionLabel":n.newRevision,"newVersionNumber":a+"."+(c+1),"versionNameLabel":n.revisionName,"versionNameNumber":n.revision+a+"."+(c+1),"originatingView":i,"arialabel":n.createRevisionHeaderTitle,"className":"csui-create-revision"}),i._dialog=new t({"headerTitle":n.createRevisionHeaderTitle,"view":i._view,"standardHeader":!1,"midSize":!0,"className":"csui-create-revision-dialog","headers":[{"label":n.createRevisionHeaderTitle,"class":"csui-heading"}],"buttons":[{"id":"submit","label":n.submitButton,"click":e.bind(i.onClickSubmitButton,i),"default":!0},{"label":n.cancelButton,"close":!0,"click":e.bind(i.onClickCancelButton,i)}],"dialogTxtAria":n.createRevisionHeaderTitle}),i._view.listenTo(i._view,"after:show",function(){i._view.ui.nameInput.trigger("focus")}),i._dialog.listenTo(i._dialog,"hide",e.bind(i.onHideDialog,i)),s.imbue(i._dialog),i._dialog.show()})})},"onHideDialog":function(){this._deferred&&"pending"===this._deferred.state()&&this._deferred.reject({"cancelled":!0})},"onClickSubmitButton":function(){var i,o,s=this,a=this._view._validate();(a||e.isUndefined(a))&&csui.require(["csui/controls/globalmessage/globalmessage","csui/utils/contexts/factories/next.node","csui/utils/node.links/node.links","csui/models/nodechildren","csui/models/node/node.model"],function(a,c,l,u,d){s._dialog.blockActions();var m=s._dialog.$el.find(".csui-archive-name").val().trim(),g=s.model.get("id"),p=s.connector.getConnectionUrl().getApiBase("v2"),f={"name":m},v={"url":r.combine(p,"nodes/"+g+"/revisions?"),"type":"POST","data":f,"contentType":"application/x-www-form-urlencoded"};i=e.str.sformat(n.revisionSuccessMsg,f.name),s.connector.makeAjaxCall(v).done(function(r){s._dialog.unblockActions(),s._dialog.destroy(),delete s._dialog,s._deferred.resolve();var m,g,p,f,v,w=new d({"id":r.results.data.properties.id},{"connector":s.connector});p=new u(void 0,{"node":w,"autoreset":!0}),p.fetch().done(function(r){f=e.has(r.data[0],"id")&&r.data[0].id,v=f||w,g=new t.Model(r.data[0]),o={"id":v,"url":l.getUrl(g)},m=!(!o||!o.url),a.showMessage("success",i,"",{"gotoLocation":n.GotoLocationLinkLabel,"targetLocation":o,"targetLocationUrl":o&&o.url,"doAutoClose":m,"context":s.context,"nextNodeModelFactory":c})})}).fail(function(e){if(s._dialog.unblockActions(),s._dialog.destroy(),delete s._dialog,s._deferred.reject(),e&&e.responseText){var i=JSON.parse(e.responseText);a.showMessage("error",i.error)}})})},"onClickCancelButton":function(){this._dialog.destroy(),delete this._dialog}})}),csui.define("csui/utils/commands/compound.document/create.release",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","i18n!csui/utils/commands/nls/localized.strings","csui/utils/commandhelper","csui/models/command","csui/utils/url"],function(e,i,t,n,o,s,r){"use strict";return s.extend({"defaults":{"signature":"CreateRelease","command_key":["CreateRelease","createrelease"],"name":n.createReleaseHeaderTitle,"verb":n.createReleaseHeaderTitle,"doneVerb":n.createReleaseHeaderTitle,"scope":"single"},"execute":function(e,t){var n=o.getAtLeastOneNode(e),s=this,r=o.getJustOneNode(e);return this.model=r,this.options=t||{},this.context=e&&e.context,this._deferred=i.Deferred(),this.connector=this.options.connector||e.collection&&e.collection.connector||e.container&&e.container.connector||n.models&&n.models[0].connector,s._showDialogBox(),this._deferred.promise()},"_showDialogBox":function(){var i=this;csui.require(["csui/controls/dialog/dialog.view","csui/controls/compound.document/dialog.view/create.release.revision.view","csui/controls/progressblocker/blocker"],function(t,o,s){var a=i.model.get("id"),c=i.connector.getConnectionUrl().getApiBase("v2"),l={"url":r.combine(c,"nodes/"+a+"/releases"),"type":"GET","contentType":"application/x-www-form-urlencoded"};i.connector.makeAjaxCall(l).done(function(r){var a,c=0;e.each(r.results,function(e){"Release"===e.data.properties.type_name&&(c=c>e.data.properties.release?c:e.data.properties.release)}),a=c+1,
i._view=new o({"iconLeft":"notification_warning","currentVersionLabel":n.currentRelease,"currentVersionNumber":0===c?n.noneLabel:c+".0","newVersionLabel":n.newRelease,"newVersionNumber":a+".0","versionNameLabel":n.releaseName,"versionNameNumber":n.release+a+".0","originatingView":i,"arialabel":n.createReleaseHeaderTitle,"className":"csui-create-release"}),i._dialog=new t({"headerTitle":n.createReleaseHeaderTitle,"view":i._view,"standardHeader":!1,"midSize":!0,"className":"csui-create-release-dialog","headers":[{"label":n.createReleaseHeaderTitle,"class":"csui-heading"}],"buttons":[{"id":"submit","label":n.submitButton,"click":e.bind(i.onClickSubmitButton,i),"default":!0},{"label":n.cancelButton,"close":!0,"click":e.bind(i.onClickCancelButton,i)}],"dialogTxtAria":n.createReleaseHeaderTitle}),i._view.listenTo(i._view,"after:show",function(){i._view.ui.nameInput.trigger("focus")}),s.imbue(i._dialog),i._dialog.listenTo(i._dialog,"hide",e.bind(i.onHideDialog,i)),i._dialog.show()})})},"onHideDialog":function(){this._deferred&&"pending"===this._deferred.state()&&this._deferred.reject({"cancelled":!0})},"onClickSubmitButton":function(){var i,o,s=this,a=this._view._validate();(a||e.isUndefined(a))&&csui.require(["csui/controls/globalmessage/globalmessage","csui/utils/contexts/factories/next.node","csui/utils/node.links/node.links","csui/models/nodechildren","csui/models/node/node.model"],function(a,c,l,u,d){s._dialog.blockActions();var m=s._dialog.$el.find(".csui-archive-name").val().trim(),g=s.model.get("id"),p=s.connector.getConnectionUrl().getApiBase("v2"),f={"name":m},v={"url":r.combine(p,"nodes/"+g+"/releases?"),"type":"POST","data":f,"contentType":"application/x-www-form-urlencoded"};i=e.str.sformat(n.releaseSuccessMsg,f.name),s.connector.makeAjaxCall(v).done(function(r){s._dialog.unblockActions(),s._dialog.destroy(),delete s._dialog,s._deferred.resolve();var m,g,p,f,v,w=new d({"id":r.results.data.properties.id},{"connector":s.connector});p=new u(void 0,{"node":w,"autoreset":!0}),p.fetch().done(function(r){f=e.has(r.data[0],"id")&&r.data[0].id,v=f||w,g=new t.Model(r.data[0]),o={"id":v,"url":l.getUrl(g)},m=!(!o||!o.url),a.showMessage("success",i,"",{"gotoLocation":n.GotoLocationLinkLabel,"targetLocation":o,"targetLocationUrl":o&&o.url,"doAutoClose":m,"context":s.context,"nextNodeModelFactory":c})})}).fail(function(e){if(s._dialog.unblockActions(),s._dialog.destroy(),delete s._dialog,s._deferred.reject(),e&&e.responseText){var i=JSON.parse(e.responseText);a.showMessage("error",i.error)}})})},"onClickCancelButton":function(){this._dialog.destroy(),delete this._dialog}})}),csui.define("csui/utils/commands/compound.document/reorganize",["require","csui/lib/underscore","csui/lib/jquery","i18n!csui/utils/commands/nls/localized.strings","csui/utils/commandhelper","csui/models/command"],function(e,i,t,n,o,s){"use strict";var r;return s.extend({"defaults":{"signature":"Reorganize","command_key":["Reorganize","reorganize"],"name":n.Reorganize,"verb":n.Reorganize,"doneVerb":n.Reorganize,"scope":"single","selfBlockOnly":!0},"execute":function(e,s){this.set("isExecuting",!0),this.stagesModel&&delete this.stagesModel;var a=o.getAtLeastOneNode(e),c=this,l=o.getJustOneNode(e);return this.model=l,this.options=s||{},this._deferred=t.Deferred(),this.originatingView=e.originatingView,this.originatingView.blockActions(),this.connector=this.options.connector||e.collection&&e.collection.connector||e.container&&e.container.connector||a.models&&a.models[0].connector,csui.require(["csui/controls/side.panel/side.panel.view","csui/controls/compound.document/reorganize/reorganize.view","csui/controls/globalmessage/globalmessage","nuc/utils/url"],function(o,s,a,l){r=arguments[0];var u=new s({"context":e.context,"connector":c.connector,"originatingView":c.originatingView,"node":c.model});c.sidePanel=new o({"title":n.Reorganize,"content":u,"footer":{"buttons":[{"label":n.submitButton,"id":"submit","className":"binf-btn binf-btn-primary csui-submit"}]}}),u.options.sidePanel=c.sidePanel,u.listenToOnce(u.collection,"sync",function(){var e=c.sidePanel,o=e.options.content.collection;e.options.footer.buttons[0].disabled=0===o.length,e.show(),e.listenTo(e.footerView,"button:click",function(i){if(t("body .ghostElem").remove(),e.hide(),"submit"===i.id){var s=c,r=s.model.get("id"),u={"order":o.orderedList,"compact":!0},d=s.connector.getConnectionUrl().getApiBase("v2"),m={"url":l.combine(d,"nodes/"+r+"/order"),"type":"PUT","data":u,"contentType":"application/x-www-form-urlencoded"};s.connector.makeAjaxCall(m).done(function(e){s._deferred.resolve(),a.showMessage("success",n.ReorganizeSuccessMsg),s.originatingView.collection.fetched=!1,s.originatingView.collection.fetch()}).fail(function(e){if(s._deferred.reject(),e&&e.responseText){var i=JSON.parse(e.responseText);a.showMessage("error",i.error)}})}}),c.sidePanel.listenTo(c.sidePanel,"before:hide",function(){c._deferred.resolve()}),c.sidePanel.listenTo(c.sidePanel,"after:show",function(){this.options.content.collection.length&&i.contains([1,2,136],this.options.content.collection.models[0].get("type"))&&this.footerView.$el.find(".csui-submit").length&&t(this.footerView.$el.find(".csui-submit")).prop("disabled",!0),c.sidePanel.$el.find(".binf-switch").hasClass("binf-switch-disabled")?(c.sidePanel.$el.find(".binf-switch-container > input").attr("tabindex",-1),c.sidePanel.$el.find(".csui-sidepanel-close").trigger("focus")):c.sidePanel.$el.find(".binf-switch-container > input").trigger("focus")}),c.sidePanel.listenTo(c.sidePanel,"keydown",function(e){if("submit"===e.target.id&&9===e.keyCode&&e.shiftKey){e.preventDefault(),e.stopPropagation(),this.contentHolders[0].reorganizeListView.focusIndex=0,t(this.contentHolders[0].reorganizeListView.$el.find(".csui-reorder-item")).removeClass("active");var i=t(this.contentHolders[0].reorganizeListView.$el.find(".csui-reorder-item")[0]);i.trigger("focus"),i.addClass("active")}})}),c.originatingView.unblockActions()}),this._deferred.always(function(){c.set("isExecuting",!1)}),this._deferred.promise()}})}),csui.define("csui/utils/commands/compound.document/lock",["module","csui/lib/underscore","i18n!csui/utils/commands/nls/lang","i18n!csui/utils/commands/nls/localized.strings","csui/utils/commands/reserve","csui/models/command","csui/utils/commandhelper"],function(e,i,t,n,o,s,r){"use strict";var a=e.config();return i.defaults(a,{"parallelism":2}),o.extend({"defaults":{"signature":"Lock","command_key":["reserve","Lock"],"name":t.CommandNameLock,"verb":n.CommandVerbLock,"pageLeavingWarning":n.LockPageLeavingWarning,"scope":"multiple","successMessages":{"formatForNone":t.LockItemsNoneMessage,"formatForOne":t.LockOneItemSuccessMessage,"formatForTwo":t.LockSomeItemsSuccessMessage,"formatForFive":t.LockManyItemsSuccessMessage},"errorMessages":{"formatForNone":t.LockItemsNoneMessage,"formatForOne":t.LockOneItemFailMessage,"formatForTwo":t.LockSomeItemsFailMessage,"formatForFive":t.LockManyItemsFailMessage}},"enabled":function(e){return!!i.find(r.getAtLeastOneNode(e).models,function(e,t){return i.contains([138,139],e.get("type"))})&&s.prototype.enabled.apply(this,arguments)}})}),csui.define("csui/utils/commands/unreserve",["csui/lib/underscore","i18n!csui/utils/commands/nls/lang","i18n!csui/utils/commands/nls/localized.strings","csui/utils/commandhelper","csui/utils/commands/node","csui/models/command"],function(e,i,t,n,o,s){"use strict";return o.extend({"defaults":{"signature":"UnreserveDoc","command_key":["unreserve","UnreserveDoc"],"name":i.CommandNameUnreserve,"verb":t.CommandVerbUnreserve,"pageLeavingWarning":t.UnreservePageLeavingWarning,"scope":"multiple","successMessages":{"formatForNone":i.UnreserveItemsNoneMessage,"formatForOne":i.UnreserveOneItemSuccessMessage,"formatForTwo":i.UnreserveSomeItemsSuccessMessage,"formatForFive":i.UnreserveManyItemsSuccessMessage},"errorMessages":{"formatForNone":i.UnreserveItemsNoneMessage,"formatForOne":i.UnreserveOneItemFailMessage,"formatForTwo":i.UnreserveSomeItemsFailMessage,"formatForFive":i.UnreserveManyItemsFailMessage}},"enabled":function(i,t){var o=n.getAtLeastOneNode(i);if(e.find(o.models,function(i){return e.contains([138,139],i.get("type"))}))return!1;if(o&&o.length){if(o.some(function(e){return e.has("versions")&&!1===e.get("versions").current_version}))return!1}return s.prototype.enabled.apply(this,arguments)},"_performAction":function(e,i){return e.isUnreservedClicked=!0,n.updateNode(e,{"reserved_user_id":null})}})}),csui.define("csui/utils/commands/compound.document/unlock",["module","csui/lib/underscore","i18n!csui/utils/commands/nls/lang","i18n!csui/utils/commands/nls/localized.strings","csui/utils/commands/unreserve","csui/models/command","csui/utils/commandhelper"],function(e,i,t,n,o,s,r){"use strict";var a=e.config();return i.defaults(a,{"parallelism":2}),o.extend({"defaults":{"signature":"Unlock","command_key":["unreserve","Unlock"],"name":t.CommandNameUnlock,"verb":n.CommandVerbUnlock,"pageLeavingWarning":n.UnlockPageLeavingWarning,"scope":"multiple","successMessages":{"formatForNone":t.UnlockItemsNoneMessage,"formatForOne":t.UnlockOneItemSuccessMessage,"formatForTwo":t.UnlockSomeItemsSuccessMessage,"formatForFive":t.UnlockManyItemsSuccessMessage},"errorMessages":{"formatForNone":t.UnlockItemsNoneMessage,"formatForOne":t.UnlockOneItemFailMessage,"formatForTwo":t.UnlockSomeItemsFailMessage,"formatForFive":t.UnlockManyItemsFailMessage}},"enabled":function(e){return!!i.find(r.getAtLeastOneNode(e).models,function(e,t){return i.contains([138,139],e.get("type"))})&&s.prototype.enabled.apply(this,arguments)}})}),csui.define("csui/utils/commands/compound.document/view.releases",["require","csui/lib/underscore","csui/lib/jquery","i18n!csui/utils/commands/nls/localized.strings","csui/utils/commandhelper","csui/models/command","csui/models/nodes"],function(e,i,t,n,o,s,r){"use strict";return s.extend({"defaults":{"signature":"ViewReleases","command_key":["releases","ViewReleases"],"name":n.CommandNameViewReleases,"scope":"multiple","selfBlockOnly":!0,"commands":"csui/utils/commands"},"execute":function(e,i){var n=e.context||i&&i.context;if(e.originatingView&&n&&n.viewStateModel&&n.viewStateModel.get("history")&&n.viewStateModel.get("enabled")&&!e.showPermissionView){var s=t.Deferred();return csui.require(["csui/utils/contexts/factories/metadata.factory","csui/widgets/metadata/header.dropdown.menu.items",this.get("commands")],function(i,t,r){var a,c=n.getModel(i),l=o.getJustOneNode(e)||e.nodes&&e.nodes.at(0),u=e.container,d=e.nodes,m=e.originatingView,g=!0;if(d&&d.first()===u||e.noMetadataNavigation?g=!1:a=this._getAtLeastOneNode(e),m&&m.options.refetchNodeActions&&a){var p=r.getSignatures(t);a.each(function(e){e.refetchNodeActions&&(e.nonPromotedActionCommands=p,e.set({"csuiLazyActionsRetrieved":!1},{"silent":!0}))})}c.set("metadata_info",{"id":l.get("id"),"model":l,"navigator":g,"collection":a,"selectedTab":"releases"}),s.resolve()}.bind(this),function(e){s.reject(e)}),s.promise()}},"_getAtLeastOneNode":function(e){var i=new r;return e.nodes?1===e.nodes.length&&e.collection?e.collection.findWhere({"id":e.nodes.models[0].get("id")})?e.collection:(i.add(e.nodes.models[0]),i.add(e.collection.models),i):e.nodes:i}})}),csui.define("csui/utils/commands/compound.document/properties",["csui/utils/commands/properties"],function(e){"use strict";return e.extend({"defaults":{"signature":"ReleasesProperties","command_key":["properties","ReleasesProperties"],"scope":"multiple","commands":"csui/utils/commands/compound.document/releases.commands"},"execute":function(e,i){return!e.container&&e.originatingView.collection?(e.originatingView.options.showReleasesView=!1,this._executeWithSaveState(e,i)):(e.originatingView.options.showReleasesView=!1,this._executeWithoutSaveState(e,i))},"_getAtLeastOneNode":function(e){return e.collection&&1===e.nodes.length?e.collection:e.nodes}})}),csui.define("csui/utils/commands/compound.document/releases.commands",["csui/lib/underscore","csui/models/commands","csui/utils/commands/compound.document/properties","csui-ext!csui/utils/commands/compound.document/releases.commands"],function(e,i,t,n){"use strict";var o=new i([new t]);return n&&o.add(e.chain(n).flatten(!0).map(function(e){return new e}).value()),o}),csui.define("csui/utils/commands/run.livereport",["csui/utils/commandhelper","csui/utils/commands/open.classic.page"],function(e,i){return i.extend({"defaults":{"signature":"RunLiveReport"},"enabled":function(i){var t=e.getJustOneNode(i);return t&&299===t.get("type")},"getUrlQueryParameters":function(e,i){return{"func":"ll","objAction":"RunReport","objId":e.get("id"),"nexturl":location.href}}})}),csui.define("csui/utils/commands/sign.out",["module","require","csui/lib/underscore","csui/lib/jquery","csui/models/command","csui/utils/commandhelper","csui/utils/url","i18n!csui/utils/commands/nls/localized.strings"],function(e,i,t,n,o,s,r,a){"use strict";var c,l,u=t.extend({"enabled":!0,"signInPageUrl":"signin.html"},e.config()),d=u.enabled;return o.extend({"defaults":{"signature":"SignOut","name":a.SignOutCommandName},"enabled":function(){return d},"execute":function(e,i){var t=n.Deferred(),o=e.context||i&&i.context,s=this;return csui.require(["csui/utils/contexts/factories/connector","csui/utils/routing"],function(){c=arguments[0],l=arguments[1],s._signOut(o).done(t.resolve).fail(t.reject)},t.reject),t.promise()},"_signOut":function(e){var i=e.getObject(c),t=new r(i.connection.url).getCgiScript();if(l.routesWithSlashes())return i.makeAjaxCall({"url":r.combine(t,"api/v1/auth/logouttoken")}).then(function(e){i.authenticator.unauthenticate({"reason":"logged-out"}),location.href=t+"?func=csui.dologout&secureRequestToken="+encodeURIComponent(e.token)});i.authenticator.unauthenticate({"reason":"logged-out"});var o=u.signInPageUrl,s=location.search;return s+=s?"&":"?",s+="nextUrl="+encodeURIComponent(location.pathname),location.href=o+s+location.hash,n.Deferred().resolve().promise()}})}),csui.define("csui/utils/commands/switch.to.classic",["module","require","csui/lib/underscore","csui/lib/jquery","csui/models/command","csui/utils/commandhelper","csui/utils/url","i18n!csui/utils/commands/nls/localized.strings","csui/utils/commands/open.classic.page","csui/utils/classic.nodes/classic.nodes"],function(e,i,t,n,o,s,r,a,c,l){"use strict";var u,d,m=t.extend({"enabled":!0,"openInNewTab":null},e.config());return null==m.openInNewTab&&(m.openInNewTab=c.openInNewTab),o.extend({"defaults":{"signature":"SwitchToClassic","name":a.SwitchToClassicCommandName},"enabled":function(e,i){if(!m.enabled)return!1;var t=e.context||i&&i.context,n=t.getModel("applicationScope");return""===(n=n&&n.get("id"))||"node"===n},"execute":function(e,i){var t=n.Deferred(),o=e.context||i&&i.context,s=m.openInNewTab&&window.open("","_blank")||window,r=this;return s.focus(),csui.require(["csui/utils/contexts/factories/connector","csui/utils/contexts/factories/node"],function(){u=arguments[0],d=arguments[1],s.location.href=r._getUrl(o,e),t.resolve()},t.reject),t.promise()},"_getUrl":function(e,i){var t=e.getObject(u),n=new r(t.connection.url).getCgiScript(),o=this._getUrlQueryParameters(e,i),s=r.combineQueryString(o);return r.appendQuery(n,s)},"_getUrlQueryParameters":function(e,i){var t,n=s.getJustOneNode(i)||e.getModel(d),o=l.find(function(e){return e.matchRules(n,e.attributes)}),r=o&&o.get("urlQuery");return void 0!==n&&n.get("id")>0?(t={"func":"ll","objId":n.get("id")},r?"string"==typeof r?t=l._replaceParameters(o.get("urlQuery"),n.attributes):"function"==typeof r&&(t=r(n)):n.get("container")?(t.objAction="browse",t.viewType=1):t.objAction="properties"):t={"classicview":""},t}})}),csui.define("csui/utils/commands/user.profile",["require","csui/lib/jquery","csui/models/command","csui/utils/base","i18n!csui/utils/commands/nls/localized.strings"],function(e,i,t,n,o){"use strict";return t.extend({"defaults":{"signature":"UserProfile","name":o.UserProfileCommandName},"enabled":function(e,i){var t=e.toolItem||i&&i.toolItem;if(t){var o=e.context||i&&i.context,s=o.getModel("user"),r=n.formatMemberName(s);t.set("name",r)}return!0},"execute":function(e,t){var n=i.Deferred(),o=e.context||t&&t.context;return csui.require(["csui/utils/contexts/factories/user","esoc/controls/userwidget/userwidget.view","esoc/widgets/userwidget/view/userprofile.view","esoc/widgets/userwidget/view/miniprofile.view","esoc/widgets/userwidget/view/simple.userwidget.view"],function(e,i){var t=o.getModel(e),s=t.get("id");new i({"model":t,"connector":t.connector,"userid":s,"context":o,"baseElement":void 0,"showUserProfileLink":!0,"showMiniProfile":!1,"enableSimpleSettingsModel":!0,"enableUploadProfilePicture":!0,"loggedUserId":s,"showUserSettings":!0,"showUserProfileSessions":!0}).showUserProfileDialog(),n.resolve()},n.reject),n.promise()}})}),csui.define("csui/utils/commands/versions/delete",["require","module","csui/lib/underscore","csui/lib/jquery","i18n!csui/utils/commands/versions/nls/localized.strings","csui/utils/commandhelper","csui/utils/commands/delete"],function(e,i,t,n,o,s,r){"use strict";var a=r.extend({"defaults":{"signature":"VersionDelete","command_key":["versions_delete","Delete"],"name":o.CommandNameVersionDelete,"verb":o.CommandVerbVersionDelete,"pageLeavingWarning":o.DeleteVersionPageLeavingWarning,"scope":"multiple","successMessages":{"formatForNone":o.DeleteVersionItemsNoneMessage,"formatForOne":o.DeleteVersionOneItemSuccessMessage,"formatForTwo":o.DeleteVersionSomeItemsSuccessMessage,"formatForFive":o.DeleteVersionManyItemsSuccessMessage},"errorMessages":{"formatForNone":o.DeleteVersionItemsNoneMessage,"formatForOne":o.DeleteVersionOneItemFailMessage,"formatForTwo":o.DeleteVersionSomeItemsFailMessage,"formatForFive":o.DeleteVersionManyItemsFailMessage}},"enabled":function(e,i){if(!a.__super__.enabled.apply(this,arguments))return!1;var t=s.getAtLeastOneNode(e);return t.length>0&&(e.container&&e.container.versions?e.container.versions.allModels&&t.length<e.container.versions.allModels.length:1==t.length)},"_getConfirmData":function(e,i){var n,r=s.getAtLeastOneNode(e);if(1===r.length){var a=r.at(0).get("version_number_name"),c=e.container&&e.container.get("name")||r.at(0).get("id_expand")&&r.at(0).get("id_expand").name;n=t.str.sformat(o.VersionDeleteCommandConfirmDialogSingleMessage,a,c)}else n=t.str.sformat(o.VersionDeleteCommandConfirmDialogMultipleMessage,r.length);return{"title":o.DeleteCommandConfirmDialogTitle,"message":n}},"startGlobalMessage":function(e){csui.require(["csui/controls/globalmessage/globalmessage"],function(i){i.showFileUploadProgress(e,{"oneFileTitle":o.DeletingOneVersion,"oneFileSuccess":o.DeleteVersionOneItemSuccessMessage,"multiFileSuccess":o.DeleteVersionManyItemsSuccessMessage,"oneFilePending":o.DeletingOneVersion,"multiFilePending":o.DeleteVersions,"oneFileFailure":o.DeleteVersionOneItemFailMessage,"multiFileFailure":o.DeleteVersionManyItemsFailMessage,"someFileSuccess":o.DeleteVersionSomeItemsSuccessMessage,"someFilePending":o.DeletingSomeVersions,"someFileFailure":o.DeleteVersionSomeItemsFailMessage,"enableCancel":!1})})}});return a}),csui.define("csui/utils/commands/versions/download",["csui/utils/commands/download","csui/utils/url","i18n!csui/utils/commands/nls/localized.strings"],function(e,i,t){"use strict";return e.extend({"defaults":{"signature":"VersionDownload","command_key":["versions_download","Open"],"name":t.CommandNameDownload,"verb":t.CommandVerbDownload,"doneVerb":t.CommandDoneVerbDownload,"scope":"single"},"_getContentUrl":function(e,t,n,o){return i.combine(e.connector.connection.url,"nodes",e.get("id"),"versions",e.get("version_number"),"content")+"?action="+n+"&token="+encodeURIComponent(o)}})}),csui.define("csui/utils/commands/versions/open",["csui/lib/jquery","csui/utils/commands/open","csui/utils/url"],function(e,i,t){"use strict";return i.extend({"defaults":{"signature":"VersionOpen","command_key":["versions_open","Open"],"scope":"single"},"checkPermission":function(i){var t=!1;return t=!!i.actions.get("Open"),e.Deferred().resolve(t).promise()},"_showOverview":function(i,t){var n=e.Deferred();return csui.require(["csui/utils/contexts/factories/next.version"],function(e){t.context.getModel(e).set({"id":i.get("id"),"version_number":i.get("version_number")}),n.resolve()},n.reject),n.promise()},"_getContentUrl":function(e,i,n,o){return t.combine(e.connector.connection.url,"nodes",e.get("id"),"versions",e.get("version_number"),"content")+"?action="+n+"&token="+encodeURIComponent(o)}})}),csui.define("csui/utils/commands/versions/properties",["csui/utils/commands/properties","csui/models/version"],function(e,i){"use strict";return e.extend({"defaults":{"signature":"VersionProperties","command_key":["versions_properties","Properties"],"scope":"multiple","commands":"csui/utils/commands/versions"},"execute":function(e,i){return this._executeWithoutSaveState(e,i)},"_getAtLeastOneNode":function(e){return e.collection&&1===e.nodes.length?e.collection:e.nodes}})}),csui.define("csui/utils/commands/versions/promote.version",["csui/lib/underscore","csui/lib/jquery","i18n!csui/utils/commands/versions/nls/localized.strings","csui/utils/commandhelper","csui/models/command","csui/models/version","csui/utils/base","csui/utils/url"],function(e,i,t,n,o,s,r,a){"use strict";return o.extend({"defaults":{"signature":"PromoteVersion","command_key":["versions_promote","Promote"],"name":t.CommandNamePromoteVersion,"verb":t.CommandVerbPromoteVersion,"scope":"single"},"enabled":function(e,i){var t=n.getAtLeastOneNode(e);if(t&&1===t.length){if(e.container)return e.container.get("advanced_versioning");var o=t.first();if(o.get("id_expand"))return o.get("id_expand").advanced_versioning}return!1},"execute":function(e,t){var n=i.Deferred();return this._confirmAction(e,t).done(function(){n.resolve()}).fail(function(){n.reject()}),n.promise()},"_confirmAction":function(e,o){function s(e,i){var t=[];(e.actions.findRecursively("download")||e.actions.findRecursively("Download"))&&t.push({"signature":"versions_download"},{"signature":"versions_open"}),(e.actions.findRecursively("delete")||e.actions.findRecursively("Delete"))&&t.push({"signature":"versions_delete"}),(e.actions.findRecursively("properties")||e.actions.findRecursively("Properties"))&&t.push({"signature":"versions_properties"}),i.actions.reset(t)}var c=i.Deferred(),l=e.container,u=n.getJustOneNode(e).clone(),d=e.container&&e.container.connector||u.connector;return csui.require(["csui/controls/globalmessage/globalmessage"],function(e){var i={};u.save(void 0,{"data":i,"type":"POST","wait":!0,"url":a.combine(d.getConnectionUrl().getApiBase("v2"),"/nodes/"+u.get("id")+"/versions/"+u.get("version_number")+"/promote")}).done(function(){l?u.fetch().done(function(){(l.versions||l.attributes&&l.attributes.versions)&&(u.isLocallyCreated=!0,s(l,u),!!l.versions&&l.versions.add(u,{"at":0}),Array.isArray(l.get("versions"))&&!!l.attributes&&!!l.attributes.versions&&l.attributes.versions.push(u.attributes)),c.resolve(),e.showMessage("success",t.MessageVersionPromoted)}):(c.resolve(),e.showMessage("success",t.MessageVersionPromoted))}).fail(function(i){if(c.reject(),i){var t=new r.Error(i);e.showMessage("error",t.message)}})}),c.promise()}})}),csui.define("csui/utils/commands/versions/doc.version.preview",["csui/utils/commands/doc.preview"],function(e){"use strict";return e.extend({"defaults":{"signature":"DocVersionPreview"},"delegatableOpenCommand":"OpenVersionDelegate"})}),csui.define("csui/utils/commands/versions/open.version/delegates/open.version.delegates",["csui/lib/underscore","csui/lib/backbone","csui/models/mixins/rules.matching/rules.matching.mixin","csui-ext!csui/utils/commands/versions/open.version/delegates/open.version.delegates"],function(e,i,t,n){"use strict";var o=i.Model.extend({"defaults":{"sequence":100,"command":null},"constructor":function(e,t){i.Model.prototype.constructor.apply(this,arguments),this.makeRulesMatching(t)},"enabled":function(e,i,t){var n=i.context||t&&t.context,o={"context":n};return this.matchRules(e,this.attributes,o)&&this.get("command").enabled(i,t)}});t.mixin(o.prototype);var s=i.Collection.extend({"model":o,"comparator":"sequence","constructor":function(e,t){i.Collection.prototype.constructor.call(this,e,t)},"findByNode":function(e,i,t){var n=this.find(function(n){return n.enabled(e,i,t)});return n&&n.get("command")}}),r=new s;return n&&r.add(e.chain(n).flatten(n).map(function(i){return e.defaults({"command":new i.command},i)}).value()),r}),csui.define("csui/utils/commands/versions/open.version/open.version.delegate",["csui/lib/underscore","csui/utils/commands/open.base","csui/utils/commands/versions/open.version/delegates/open.version.delegates"],function(e,i,t){"use strict";return i.extend({"defaults":{"signature":"OpenVersionDelegate"},"openDelegates":t})}),csui.define("csui/utils/commands/versions/open.version.perspective",["csui/lib/jquery","csui/lib/underscore","csui/models/command","csui/utils/commandhelper","i18n!csui/utils/commands/versions/nls/localized.strings"],function(e,i,t,n,o){"use strict";return t.extend({"defaults":{"signature":"OpenVersionPerspective"},"enabled":function(e){var i=n.getJustOneNode(e);return i&&i.get("id")&&i.get("version_number")},"execute":function(i,t){var s=e.Deferred(),r=i.context||t&&t.context,a=r.getModel("nextVersion"),c=n.getJustOneNode(i);return c&&c.get("id")&&c.get("version_number")?(a.set({"id":c.get("id"),"version_number":c.get("version_number")}),s.resolve(),s.promise()):void s.reject({"message":o.MissingVersionInfo})}})}),csui.define("csui/utils/commands/versions",["csui/lib/underscore","csui/models/commands","csui/utils/commands/versions/delete","csui/utils/commands/versions/download","csui/utils/commands/versions/open","csui/utils/commands/versions/properties","csui/utils/commands/versions/promote.version","csui/utils/commands/versions/doc.version.preview","csui/utils/commands/versions/open.version/open.version.delegate","csui/utils/commands/versions/open.version.perspective","csui/utils/commands/copy.link","csui/utils/commands/email.link","csui-ext!csui/utils/commands/versions"],function(e,i,t,n,o,s,r,a,c,l,u,d,m){"use strict";var g=new i([new t,new n,new o,new s,new r,new a,new c,new l,new u,new d]);return m&&g.add(e.chain(m).flatten(!0).map(function(e){return new e}).value()),g}),csui.define("csui/utils/commands/filter",["module","csui/lib/underscore","csui/lib/jquery","csui/utils/log","csui/utils/base","csui/utils/commandhelper","csui/models/command","i18n!csui/utils/commands/nls/lang"],function(e,i,t,n,o,s,r,a){"use strict";return r.extend({"defaults":{"signature":"Filter"},"enabled":function(i){return!1!==e.config().enabled&&(!0===(i&&i.originatingView&&i.originatingView.showFilter)&&i.toolItem&&i.toolItem.set({"title":a.FilterCollapseTooltip,"toolItemAriaExpand":!0,"stateIsOn":!0}),!(!i.container||!i.container.get("container"))&&this._isSupported(i))},"_isSupported":function(e){var i=e.container,n=[136,298];return e.collection&&0===e.collection.length&&899===i.get("type")&&n.push(899),-1===t.inArray(i.get("type"),n)}})}),csui.define("csui/utils/accessibility",["module"],function(e){"use strict";var i=e.config().enabled||!1,t=e.config().accessibleTable||!1,n=e.config().enforceDescriptionColumn;return{"isAccessibleMode":function(){return i},"isAccessibleTable":function(){return i||t},"shouldEnforceDescriptionColumn":function(){return void 0===n||n}}}),csui.define("csui/utils/commands/description.toggle",["require","csui/lib/jquery","csui/utils/base","csui/lib/underscore","i18n!csui/utils/commands/nls/localized.strings","csui/utils/commandhelper","csui/utils/commands/node","csui/utils/command.error","csui/utils/accessibility"],function(e,i,t,n,o,s,r,a,c){"use strict";var l=c.isAccessibleTable();return r.extend({"defaults":{"signature":"ToggleDescription","command_key":["description","description"],"scope":"single","name":o.CommandDescriptionToggle},"enabled":function(e,i){return!(l||!e.collection||e.thumbnailViewState)&&(e.originatingView&&e.originatingView.options.showDescriptions&&(e.toolItem.attributes.name=o.CommandHideDescription,e.toolItem.attributes.stateIsOn=!0,e.originatingView.tableView.trigger("show:descriptions",!0)),void 0!==e.collection.find(function(e){return!!e.get("description")}))},"execute":function(e,i){var t,n=e.originatingView;n.$el.find('li[data-csui-command="toggledescription"]');n.options.showDescriptions?(n.options.showDescriptions=!1,t=o.CommandShowDescription):(n.options.showDescriptions=!0,t=o.CommandHideDescription),e.toolItem.set({"stateIsOn":n.options.showDescriptions,"title":t,"aria-label":t}),n.trigger("csui.description.toggled",{"showDescriptions":n.options.showDescriptions})}})}),csui.define("csui/utils/commands/thumbnail.toggle",["module","require","csui/lib/jquery","csui/lib/backbone","csui/lib/marionette","csui/lib/underscore","csui/models/command","csui/utils/accessibility","i18n!csui/utils/commands/nls/localized.strings"],function(e,i,t,n,o,s,r,a,c){"use strict";var l=e.config();s.defaults(l,{"enableGridView":!1});return r.extend({"defaults":{"signature":"Thumbnail","command_key":["thumbnail","thumbnail"],"scope":"single","name":"Thumbnail"},"enabled":function(e,i){return!(!e.collection||!l.enableGridView||a.isAccessibleMode())&&(e.thumbnailViewState&&(e.toolItem.attributes.iconName="csui_action_switch_list32",e.toolItem.attributes.name=c.ListViewTitle,e.toolItem.attributes.title=c.ListViewTitle),!0)},"execute":function(e,i){var n,o=e.originatingView||i&&i.originatingView;return e.suppressFailMessage=!0,e.suppressSuccessMessage=!0,o.thumbnailViewState?(n=c.ThumbnailTitle,o.$el.find(".binf-glyphicon-th-list").removeClass("binf-glyphicon-th-list").addClass("binf-glyphicon-th-large"),o.$el.find(".binf-glyphicon-th-large").parent().attr("title",n).attr("aria-label",n)):(n=c.ListViewTitle,o.$el.find(".binf-glyphicon-th-large").addClass("binf-glyphicon-th-list").removeClass("binf-glyphicon-th-large"),o.$el.find(".binf-glyphicon-th-list").parent().attr("title",n).attr("aria-label",n)),o.$el.find('.csui-configuration-view .binf-dropdown-menu li[data-csui-command="thumbnail"] a').attr("title",n).contents().first().replaceWith(n),t.Deferred().resolve(e.collection).promise()}})}),csui.define("csui/utils/commands/save.filter",["module","require","csui/lib/underscore","csui/lib/jquery","i18n!csui/utils/commands/nls/localized.strings","csui/utils/url","csui/models/command","csui/models/node/node.model"],function(e,i,t,n,o,s,r,a){"use strict";var c=e.config();t.defaults(c,{"parallelism":3});var l,u,d,m;return r.extend({"defaults":{"signature":"SaveFilter","command_key":["savefilter","SaveFilter"],"name":o.CommandNameSaveFilter,"verb":o.CommandVerbSaveFilter},"execute":function(e,i){var r=this,c=n.Deferred(),g=e.context||i&&i.context;return e.suppressSuccessMessage=!0,csui.require(["csui/controls/globalmessage/globalmessage","csui/utils/contexts/factories/connector","csui/utils/contexts/factories/next.node","csui/utils/node.links/node.links"],function(){l=arguments[0],u=arguments[1],d=arguments[2],m=arguments[3],r._selectSaveFilterOptions(e,i).done(function(i){var r=e.nodes,p=e.facets,f=i.nodes[0],v=i.filterName,w=i.multiLingualData,h=e.connector.getConnectionUrl().getApiBase("v2"),b=[];n.each(p.filters,function(e,i){var t=[],o=[];i.values instanceof Array&&(n.each(i.values,function(e,i){t.push(i.id)}),o.push(i.id),o.push(t),b.push(o))});var y={"type":899,"location_id":r.models[0].get("id"),"name":v,"parent_id":f.get("id"),"selected_facets":b};w&&t.extend(y,{"name_multilingual":w});var _={"url":s.combine(h,"/nodes"),"type":"POST","data":y,"contentType":"application/x-www-form-urlencoded"};e.connector.makeAjaxCall(_).done(function(e){c.resolve(e.results);var i=e.results.data.properties.id,n=new a({"id":i},{"connector":g.getObject(u)}),s=e.results.data.properties.name,r=t.str.sformat(o.SaveFilterCommandSuccessfully,s),p={"context":g,"nextNodeModelFactory":d,"link_url":m.getUrl(n),"targetFolder":n};l.showMessage("success_with_link",r,void 0,p)}).fail(function(e){
if(c.reject(e),e&&e.responseText){var i=JSON.parse(e.responseText);l.showMessage("error",i.error)}})}).fail(function(e){c.reject(e)})},function(e){c.reject(e)}),c.promise()},"_selectSaveFilterOptions":function(e,i){var s=this,r=n.Deferred();return csui.require(["csui/dialogs/node.picker/node.picker"],function(n){var a=e.nodes.length,c=t.extend({"command":"savefilter","selectableTypes":[-1],"showAllTypes":!0,"orderBy":"type asc","dialogTitle":o.DialogTitleSaveFilter,"initialContainer":e.container||e.nodes.models[0].parent,"initialSelection":e.nodes,"startLocation":"","includeCombineProperties":1===a,"propertiesSeletor":!1,"saveFilter":!0,"globalSearch":!0,"context":i?i.context:e.context,"startLocations":["enterprise.volume","current.location","personal.volume","favorites","recent.containers"],"resolveShortcuts":!0,"resultOriginalNode":!0},e);s.nodePicker=new n(c),s.nodePicker.show().done(function(){r.resolve.apply(r,arguments)}).fail(function(e){r.reject.apply(r,arguments)})},function(e){r.reject(e)}),r.promise()}})}),csui.define("csui/utils/commands/save.query",["require","csui/lib/underscore","csui/lib/jquery","i18n!csui/utils/commands/nls/localized.strings","csui/models/command","csui/models/node/node.model"],function(e,i,t,n,o,s){"use strict";var r,a,c,l,u;return o.extend({"defaults":{"signature":"SaveQuery","command_key":["savequery","SaveQuery"],"name":n.CommandNameSaveQuery,"verb":n.CommandVerbSaveQuery},"execute":function(e,o){var d=this,m=t.Deferred(),g=e.context||o&&o.context;return e.context=g,e.suppressSuccessMessage=!0,csui.require(["csui/controls/globalmessage/globalmessage","csui/utils/contexts/factories/connector","csui/utils/contexts/factories/next.node","csui/utils/node.links/node.links","csui/widgets/metadata/metadata.save.query.controller"],function(){r=arguments[0],a=arguments[1],c=arguments[2],l=arguments[3],u=arguments[4],d._selectSaveQueryOptions(e,o).done(function(t){var d=t.nodes[0],p=t.filterName,f=t.multiLingualData,v={"type":258,"name":p,"parent_id":d.get("id")};f&&i.extend(v,{"name_multilingual":f});var w=new s(v,{"connector":e.connector});(new u)._checkForRequiredMetadata(w,e).done(function(t){t&&t.data&&(v=i.extend(v,t.data)),v=i.extend(v,{"search_cache_id":o.searching&&o.searching.cache_id});var u=e.originatingView;w.save(void 0,{"data":v}).done(function(e){u&&(u.previousSavedQuery=e.id),m.resolve(e);var t=new s({"id":d.get("id")},{"connector":g.getObject(a)}),o=v.name,p=i.str.sformat(n.SaveQueryCommandSuccessfully,o),f={"context":g,"nextNodeModelFactory":c,"link_url":l.getUrl(t),"targetFolder":t};r.showMessage("success_with_link",p,void 0,f)}).fail(function(e){if(m.reject(e),e&&e.responseText){var i=JSON.parse(e.responseText);r.showMessage("error",i.error)}})}).fail(function(e){if(m.reject(e),e&&e.responseText){var i=JSON.parse(e.responseText);r.showMessage("error",i.error)}})}).fail(function(e){m.reject(e)})},function(e){m.reject(e)}),m.promise()},"_selectSaveQueryOptions":function(e,o){var s=this,r=t.Deferred();return csui.require(["csui/dialogs/node.picker/node.picker"],function(t){var a=i.extend({"command":"savequery","selectableTypes":[-1],"showAllTypes":!0,"orderBy":"type asc","dialogTitle":n.DialogTitleSaveQuery,"startLocation":"personal.volume","propertiesSeletor":!1,"saveFilter":!0,"globalSearch":!0,"context":o?o.context:e.context,"startLocations":["enterprise.volume","personal.volume","favorites","recent.containers"],"resolveShortcuts":!0,"resultOriginalNode":!0,"selectButtonLabel":n.saveButtonLabel},e);s.nodePicker=new t(a),s.nodePicker.show().done(function(){r.resolve.apply(r,arguments)}).fail(function(e){r.reject.apply(r,arguments)})},function(e){r.reject(e)}),r.promise()}})}),csui.define("csui/utils/commands/update.query",["require","csui/lib/underscore","csui/lib/jquery","i18n!csui/utils/commands/nls/localized.strings","csui/utils/url","csui/models/command","csui/models/node/node.model"],function(e,i,t,n,o,s,r){"use strict";var a,c,l,u;return s.extend({"defaults":{"signature":"UpdateQuery","command_key":["updatequery","UpdateQuery"],"name":n.CommandNameUpdateQuery,"verb":n.CommandVerbUpdateQuery},"execute":function(e,s){var d=t.Deferred(),m=e.context||s&&s.context;return e.suppressSuccessMessage=!0,csui.require(["csui/controls/globalmessage/globalmessage","csui/utils/contexts/factories/connector","csui/utils/contexts/factories/next.node","csui/utils/node.links/node.links"],function(){a=arguments[0],c=arguments[1],l=arguments[2],u=arguments[3];var t=e.connector.getConnectionUrl().getApiBase("v2"),g={"search_cache_id":s.cache_id},p={"url":o.combine(t,"/nodes/",s.queryId),"type":"PUT","data":g,"contentType":"application/x-www-form-urlencoded"};e.connector.makeAjaxCall(p).done(function(e){d.resolve(e.results);var t=new r({"id":e.results.data.properties.parent_id},{"connector":m.getObject(c)}),o=e.results.data.properties.name,s=i.str.sformat(n.UpdateQueryCommandSuccessfully,o),g={"context":m,"nextNodeModelFactory":l,"link_url":u.getUrl(t),"targetFolder":t};a.showMessage("success_with_link",s,void 0,g)}).fail(function(e){if(d.reject(e),e&&e.responseText){var i=JSON.parse(e.responseText);a.showMessage("error",i.error)}})},function(e){d.reject(e)}),d.promise()}})}),csui.define("csui/utils/commands/maximize.widget.view",["require","csui/lib/jquery","csui/utils/base","csui/lib/underscore","i18n!csui/utils/commands/nls/localized.strings","csui/utils/commandhelper","csui/models/command"],function(e,i,t,n,o,s,r){"use strict";return r.extend({"defaults":{"signature":"MaximizeWidgetView","scope":"single"},"enabled":function(e,t){return i("body").hasClass("csui-support-maximize-widget")&&!1===i("body").hasClass("csui-maximized-widget-mode")},"execute":function(e,i){e.context.trigger("maximize:widget",{"widgetView":e.originatingView})}})}),csui.define("csui/utils/commands/restore.widget.size",["require","csui/lib/jquery","csui/utils/base","csui/lib/underscore","i18n!csui/utils/commands/nls/localized.strings","csui/utils/commandhelper","csui/models/command"],function(e,i,t,n,o,s,r){"use strict";return r.extend({"defaults":{"signature":"RestoreWidgetViewSize","scope":"single"},"enabled":function(e,t){return!this.checkMaximizeMode(e)&&(i("body").hasClass("csui-support-maximize-widget")&&!0===i("body").hasClass("csui-maximized-widget-mode"))},"checkMaximizeMode":function(e){return e&&e.context&&e.context.perspective&&e.context.perspective.get("showWidgetInMaxMode")},"execute":function(e,i){e.context.trigger("restore:widget:size",{"widgetView":e.originatingView})}})}),csui.define("csui/utils/commands/permissions/apply.permission",["module","require","csui/lib/underscore","csui/lib/jquery","csui/models/command","csui/utils/commandhelper","i18n!csui/utils/commands/nls/localized.strings"],function(e,i,t,n,o,s,r){"use strict";t.extend({},e.config());return o.extend({"defaults":{"signature":"ApplyPermission"},"enabled":function(e){s.getJustOneNode(e);return!1},"execute":function(e,i){var t=n.Deferred();return csui.require(["csui/controls/globalmessage/globalmessage"],function(e){t.resolve(),e.showMessage("success","Applied permissions to sub-items")},t.reject),t.promise()}})}),csui.define("csui/utils/commands/permissions/permission.util",["module","require","csui/lib/underscore","csui/lib/backbone","csui/lib/jquery","i18n!csui/utils/commands/nls/localized.strings"],function(e,i,t,n,o,s){"use strict";function r(e,i){var o;e.results.success>0&&0===e.results.failure?o=t.str.sformat(1===e.results.success?s.AppliedPermissionsOneSuccess:s.AppliedPermissionsOnlySuccess,e.results.success):e.results.success>0&&e.results.failure>0?o=t.str.sformat(s.AppliedPermissionsSuccessAndFailure,e.results.success,e.results.failure):0===e.results.success&&e.results.failure>0&&(o=t.str.sformat(1===e.results.failure?s.AppliedPermissionsOneFailure:s.AppliedPermissionsOnlyFailure,e.results.failure));for(var r=n.Model.extend({"defaults":{"name":"","state":"pending","commandName":"ViewPermission"}}),a=[],c=n.Collection.extend({"model":r}),l=new c,u=0;e.results.failure>0&&u<e.results.data.length;u++)a[u]=new r({"name":e.results.data[u].name,"mime_type":"","state":"rejected"}),l.add(a[u]);var d=e.results.success>0&&e.results.failure>0?e.results.success:"",m=t.str.sformat(s.ApplyingManyItemsSuccessMessage,d),g=d>0?m:" ";e.results.failure>0&&i.showPermissionApplyingProgress(l,{"oneFileFailure":g+s.ApplyingOneItemFailMessage,"someFileFailure":g+t.str.sformat(s.ApplyingManyItemsFailMessage2,a.length),"multiFileFailure":g+t.str.sformat(s.ApplyingManyItemsFailMessage2,a.length)}),e.results.success>0&&e.results.failure<=0&&i.showMessage("success",o||s.AppliedPermissions)}return{"generateSuccessMessage":r}}),csui.define("csui/utils/commands/permissions/edit.permission",["module","require","csui/lib/underscore","csui/lib/backbone","csui/lib/jquery","csui/utils/base","csui/models/command","csui/utils/commandhelper","csui/utils/command.error","i18n!csui/utils/commands/nls/localized.strings","csui/utils/commands/permissions/permission.util"],function(e,i,t,n,o,s,r,a,c,l,u){"use strict";t.extend({},e.config());return r.extend({"defaults":{"signature":"EditPermission","command_key":["editpermissions","Edit Permissions"]},"enabled":function(e){var i=e.model,t=i&&i.get("right_id_expand")&&i.get("right_id_expand").type,n=i&&i.collection,o=i&&i.get("right_id"),s=i&&i.get("type"),r=e.filterId,a=e.nodeModel||e.originatingView&&e.originatingView.model,c=a&&a.actions&&!!a.actions.get({"signature":"editpermissions"});return!([0,1].indexOf(t)<0&&"custom"===s)&&!r&&s&&(o||"public"===s)&&n&&n.options&&n.options.node&&!!n.options.node.get("id")&&c},"execute":function(e,i){var t=this,n=o.Deferred(),s=e.model,r=s.collection,a=e.targetView;t.targetView=a,e.suppressFailMessage=!0,e.suppressSuccessMessage=!0;var d=this._getMessageWithUserDisplayName(l.EditPermissionCommandFailMessage,s),m=r&&r.options&&r.options.node&&r.options.node.actions.get({"signature":"editpermissions"});return r&&m?(s.nodeId=r.options&&r.options.node&&r.options.node.get("id"),csui.require(["csui/widgets/permissions/edit/edit.permission.helper","csui/utils/contexts/factories/user","csui/controls/globalmessage/globalmessage","csui/utils/permissions/permissions.precheck"],function(i,o,r,a){var l=e.originatingView.context.getModel(o);t.loginUserId=l.get("id"),t.editPermissionHelper=new i({"permissionModel":s,"popoverPlacement":"left","popoverAtBodyElement":!e.originatingView||!e.originatingView.options.isExpandedView,"popoverTargetElement":e.targetView.permissions.$el,"readonly":!1,"originatingView":e.originatingView,"applyTo":e.applyTo}),t.editPermissionHelper._showSelectPermissionLevelPopover(),t.editPermissionHelper.listenTo(t.editPermissionHelper,"permissions:selected",function(i){var o={"permissions":i.permissions,"apply_to":i.apply_to,"include_sub_types":i.apply_to>0?a.includeSubTypes():[]};i.right_id&&(o.right_id=i.right_id),s.save(o,{"patch":!0,"wait":!0,"silent":!0}).done(function(i){s.set(o,{"silent":!0}),e.originatingView.trigger("permission:changed",e),t.editPermissionHelper.destroy(),t.editPermissionHelper.unblockActions(),n.resolve(),"simple"!==e.originatingView.model.get("permissions_model")&&u.generateSuccessMessage(i,r)}).fail(function(e){var i=e?new c(e,s):e;r.showMessage("error",i),n.reject(s,i)})}),t.editPermissionHelper.listenTo(t.editPermissionHelper,"closed:permission:level:popover",function(){n.reject(s)})}),n.promise()):n.reject(new c(d,{"errorDetails":l.undefinedCollection}))},"_getMessageWithUserDisplayName":function(e,i){var n;return i.get("right_id_expand")?n=s.formatMemberName(i.get("right_id_expand")):"public"===i.get("type")&&(n=l.publicAccess),t.str.sformat(e,n)}})}),csui.define("csui/utils/commands/permissions/change.owner.permission",["module","csui/lib/underscore","csui/lib/jquery","csui/lib/marionette","csui/models/command","csui/utils/command.error","i18n!csui/utils/commands/nls/localized.strings"],function(e,i,t,n,o,s,r){"use strict";i.extend({},e.config());return o.extend({"defaults":{"signature":"ChangeOwnerPermission","scope":"single"},"enabled":function(e){var i=e.model,t=i&&i.get("right_id_expand")&&i.get("right_id_expand").type,n=i&&i.get("type"),o=e.nodeModel||e.originatingView&&e.originatingView.model,s=n&&("owner"===n||"group"===n)&&o&&o.actions&&!!o.actions.get({"signature":"editpermissions"}),a=s&&"owner"===n?r.ChangeOwnerPermissionCommand:r.ChangeOwnerGroupPermissionCommand,c=[0,1],l=c.indexOf(t)<0&&"custom"===n;return"group"===n&&e.toolItem.attributes&&e.toolItem.attributes.icon&&(e.toolItem.attributes.icon="icon icon-group-change"),e.toolItem&&e.toolItem.set("name",a),!l&&s},"execute":function(e,o){var a=t.Deferred(),c=e.model,l=c.get("type"),u=c.collection,d=c.get("right_id_expand"),m=e.targetView.$el,g=this;g.targetView=e.originatingView.permissionsContentView;var p=u&&u.options&&u.options.node&&u.options.node.actions.get({"signature":"editpermissions"});if(!u||!p){var f=i.str.sformat(r.EditPermissionCommandFailMessage,r.Owner);return a.reject(new s(f,{"errorDetails":r.undefinedCollection}))}return c.nodeId=u.options&&u.options.node&&u.options.node.get("id"),csui.require(["csui/controls/table/inlineforms/permissions/user.picker/user.picker.view","csui/utils/contexts/factories/member","csui/models/permission/nodepermission.model","csui/utils/contexts/factories/user","csui/utils/permissions/permissions.precheck"],function(i,t,o,r,u){var p=e.originatingView.context.getModel(r);g.loginUserId=p.get("id");var f=e.context.getModel(t),v=new i({"context":e.options?e.options.context:e.context,"userPickerModel":f,"currentRow":m,"connector":e.connector,"memberFilter":{"type":"owner"===l?[0]:[1]}});m.addClass("csui-changeowner-permission"),m.find(".member-info").addClass("binf-hidden");var w=new n.Region({"el":m.find(".csui-inline-owner-change")});w.show(v),v.listenTo(v,"change:completed",function(e){w.currentView.destroy(),a.resolve()}),v.listenTo(v,"member:selected:save",function(e){var i=(o.getReadPermissions(),{"permissions":c.get("permissions"),"right_id":e.get("id"),"include_sub_types":u.includeSubTypes()});c.set({"right_id_expand":e},{"silent":!0}),c.save(i,{"patch":!0,"wait":!0,"silent":!0}).done(function(){c.set(i,{"silent":!0}),w.currentView.destroy(),m.removeClass("csui-changeowner-permission"),m.find(".member-info").removeClass("binf-hidden"),a.resolve()}).fail(function(e){var i=e?new s(e,c):e;c.set({"right_id_expand":d},{"silent":!0}),a.reject(c,i)})})}),a.promise()}})}),csui.define("csui/utils/commands/permissions/delete.permission",["module","require","csui/lib/jquery","csui/lib/underscore","csui/lib/backbone","csui/utils/base","csui/models/command","csui/utils/commandhelper","csui/utils/command.error","csui/utils/commands/confirmable","i18n!csui/utils/commands/nls/localized.strings"],function(e,i,t,n,o,s,r,a,c,l,u){"use strict";var d,m=(n.extend({},e.config()),r.extend({"defaults":{"signature":"DeletePermission","scope":"single"},"allowCollectionRefetch":!1,"_getConfirmTemplate":function(e,i){return n.template(u.DeleteCommandConfirmDialogHtml)},"_getConfirmData":function(e,i){var t=e.model,n=u.DeletePermissionCommandConfirmDialogSingleMessage;"public"===t.get("type")&&(n=u.DeletePermissionCommandConfirmDialogPublicAccessMessage);var o=this._getMessageWithUserDisplayName(n,t);return{"title":this._getMessageWithUserDisplayName(u.DeletePermissionCommandConfirmDialogTitle,t),"message":o}},"_getMessageWithUserDisplayName":function(e,i){var t;i.get("right_id_expand")?t=s.formatMemberName(i.get("right_id_expand")):"public"===i.get("type")&&(t=u.publicAccess);return i.get("results")&&i.get("results").success>0?n.str.sformat(e,t,s.formatMessage(i.get("results").success,u)):n.str.sformat(e,t)},"enabled":function(e){var i=e.model,t=i&&i.get("right_id_expand")&&i.get("right_id_expand").type,n=i&&i.collection,o=i&&i.get("right_id"),s=i&&i.get("type"),r=e.filterId,a=e.nodeModel||n&&n.options&&n.options.node||e.originatingView&&e.originatingView.model,c=!r&&s&&(o||"public"===s)&&a.get("id")&&a.actions&&!!a.actions.get({"signature":"editpermissions"}),l=[0,1],u=l.indexOf(t)<0&&"custom"===s;return c&&this.setCommandTitle(e.toolItem,i),!u&&c},"setCommandTitle":function(e,i){var t,n=i.get("type");t="owner"===n?u.DeletePermissionCommandRemoveOwner:"group"===n?u.DeletePermissionCommandRemoveGroup:"public"===n?u.DeletePermissionCommandRemovePublicAccess:u.DeletePermissionCommandRemoveOther,e.set("name",t)}}));return n.extend(m.prototype,l,{"execute":function(e,i){var n=t.Deferred(),o=this;return i||(i={}),e.suppressFailMessage=!0,e.suppressSuccessMessage=!0,csui.require(["csui/controls/globalmessage/globalmessage","csui/widgets/permissions/impl/edit/apply.permission/apply.permission.view","csui/widgets/permissions/impl/edit/apply.permission/impl/header/apply.permission.header.view","csui/controls/progressblocker/blocker","csui/controls/dialog/dialog.view","csui/utils/permissions/permissions.precheck"],function(t,s,r,a,c,l){d=t,e.originatingView&&e.originatingView.model&&e.originatingView.model.get("container")?(i.removePermission=!0,o._executeDeletePermission(e,i,r,s,a,c,l).then(n.resolve,n.reject)):o._deletePermission(e,i).then(n.resolve,n.reject)},n.reject),n.promise()},"_deletePermission":function(e,i){return i||(i={}),this._performActions(e,i)},"_executeDeletePermission":function(e,i,o,s,r,a,c){i||(i={});var l=t.Deferred();this.originatingView=e.originatingView;var d=new o({"removePermission":!0,"permissionModel":e.model});this._view=new s({"context":e.context,"model":e.originatingView.model,"permissionModel":e.model,"removePermission":!0,"applyTo":e.applyTo,"includeSubTypes":c.includeSubTypes(),"originatingView":e.originatingView});var m=new a({"headerView":d,"view":this._view,"className":"csui-permissions-apply-dialog","midSize":!0,"buttons":[{"id":"apply","label":u.applyButtonLabel,"default":!0,"click":function(e){this._performActions(e).then(l.resolve,l.reject)}.bind(this)},{"label":u.cancelButtonLabel,"close":!0}]});return m.listenTo(m,"hide",n.bind(this.onHideDialog,this)),r.imbue(m),m.show(),l.promise()},"onHideDialog":function(){var e=this.originatingView;e&&e.trigger("unblock:view:actions")},"_performActions":function(e,i){var n=this,o=t.Deferred(),s=e.dialog?e.dialog.options.view.options.permissionModel:e.model,r=s.get("type"),a=s.collection,l=this._getMessageWithUserDisplayName(u.DeletePermissionCommandFailMessage,s);if(s.collection.models.forEach(function(e){e.set("isAddNew",!1)}),a&&a.options&&a.options.node&&a.options.node.actions.get({"signature":"editpermissions"})){s.nodeId=a.options&&a.options.node&&a.options.node.get("id");var m=a.options&&a.options.node&&a.options.node.get("container"),g=a.options&&a.options.node&&a.options.node.get("permissions_model");e.dialog&&(s.apply_to=m&&"advanced"===g&&e.dialog.options.view.subFolderSelected?2:m&&"advanced"===g?3:0,s.include_sub_types=s.apply_to>0?e.dialog&&e.dialog.options.view.options.includeSubTypes:[]),n.originatingView&&n.originatingView.blockActions&&(n.destroyDialog(e),n.originatingView.blockActions());var p=s.destroy({"wait":!0}).done(function(e){s.set("results",e.results),n.originatingView&&n.originatingView.trigger("permission:changed",n),n.originatingView&&n.originatingView.unblockActions&&n.originatingView.unblockActions();var i=n._getMessageWithUserDisplayName(s.get("results")&&s.get("results").success>0?u.DeletePermissionCommandSuccessMessageWithCount:u.DeletePermissionCommandSuccessMessage,s);d.showMessage("success",i),"owner"!==r&&"group"!==r||a.processForEmptyOwner&&a.processForEmptyOwner(),o.resolve(s)}).fail(function(e){var i=e?new c(e,s):e;n.handleFailure(i,l),o.reject(s,i),e||p.abort()}).always(function(){n.originatingView&&n.originatingView.unblockActions&&n.originatingView.unblockActions()});return o.promise()}return n.destroyDialog(e),o.reject(new c(l,{"errorDetails":u.undefinedCollection}))},"handleFailure":function(e,i){var t,n=o.Model.extend({"defaults":{"name":"","state":"pending","commandName":"ViewPermission"}}),s=o.Collection.extend({"model":n}),r=new s;t=new n({"name":e,"mime_type":"","state":"rejected"}),r.add(t),d.showPermissionApplyingProgress(r,{"oneFileFailure":i})},"destroyDialog":function(e){e.dialog&&e.dialog.destroy()}}),m}),csui.define("csui/utils/commands/permissions/add.user.group",["module","require","csui/lib/underscore","csui/lib/jquery","csui/utils/base","i18n!csui/utils/commands/nls/localized.strings","csui/utils/log","csui/models/command","csui/utils/command.error"],function(e,i,t,n,o,s,r,a,c){"use strict";var l,u,d=e.config();return a.extend({"defaults":{"signature":"adduserorgroup","name":s.CommandNameAddUserorGroup},"enabled":function(e){return d&&d.GrantAccessGroupOnly&&e.toolItem&&e.toolItem.set({"name":s.addGroups}),!0},"execute":function(e,i){var o=this,s=n.Deferred();e.context||i&&i.context;return e.suppressSuccessMessage=!0,csui.require(["csui/models/permission/nodepermission.model","csui/utils/permissions/permissions.precheck","csui/controls/globalmessage/globalmessage","csui/dialogs/modal.alert/modal.alert"],function(n,r){l=arguments[2],u=arguments[3],o._selectAddUserOrGroupOptions(e,i).done(function(i){var a=i.members,u=i.permissions,d={"right_id":a.get("id"),"permissions":u,"apply_to":i.apply_to,"include_sub_types":i.apply_to>0?r.includeSubTypes():[]},m=new n(d,e);m.nodeId=e.nodeId,e.originatingView&&e.originatingView.blockActions&&e.originatingView.blockActions(),m.save(d,{"silent":!0,"wait":!0}).done(function(){m.set({"right_id_expand":t.clone(a.attributes),"type":"custom"},{"silent":!0}),l.showMessage("success",o._getMessageWithUserDisplayName(m)),e.originatingView&&e.originatingView.unblockActions&&e.originatingView.unblockActions(),s.resolve(m)}).fail(function(i){var t=i?new c(i,m):i;e.originatingView&&e.originatingView.unblockActions&&e.originatingView.unblockActions(),l.showMessage("error",t),s.reject(m,t)})}).fail(function(e){s.reject(e)})},function(e){s.reject(e)}),s.promise()},"_selectAddUserOrGroupOptions":function(e,i){var o=n.Deferred();return csui.require(["csui/dialogs/members.picker/members.picker.wizard"],function(i){var n=e.originalCollection&&e.originalCollection.models&&e.originalCollection.models.length>0?e.originalCollection.models:e.permissionCollection.models;n=t.filter(n,function(e){return"custom"===e.get("type")});var r=d&&d.GrantAccessGroupOnly;new i({"command":"adduserorgroup","context":e.context,"connector":e.connector,"dialogClass":"cs-permission-group-picker","displayName":r?s.allGroups:s.allUsersAndGroups,"dialogTitle":r?s.allGroups:s.addUsersAndGroups,"startLocation":r?"all.groups":"all.members","adduserorgroup":!0,"nodeModel":e.nodeModel,"addButtonLabel":s.AddButtonLabel,"availablePermissions":e.permissionCollection.availablePermissions,"startLocations":r?["all.groups","member.groups"]:["all.members","member.groups"],"unselectableMembers":n,"applyTo":e.applyTo}).show().done(function(){o.resolve.apply(o,arguments)}).fail(function(e){o.reject.apply(o,arguments)})},function(e){o.reject(e)}),o.promise()},"_getMessageWithUserDisplayName":function(e){var i;e.get("right_id_expand")&&(i=o.formatMemberName(e.get("right_id_expand")));return e.get("results")&&e.get("results").success>0?t.str.sformat(s.AddUserOrGroupSuccessWithCount,i,o.formatMessage(e.get("results").success,s)):t.str.sformat(s.AddUserOrGroupSuccess,i)}})}),csui.define("csui/utils/commands/permissions/add.owner.group",["module","require","csui/lib/underscore","csui/lib/jquery","csui/utils/base","i18n!csui/utils/commands/nls/localized.strings","csui/utils/log","csui/models/command","csui/utils/command.error"],function(e,i,t,n,o,s,r,a,c){"use strict";var l,u,d=e.config();return a.extend({"defaults":{"signature":"addownerorgroup","name":s.CommandNameAddOwnerOrOwnerGroup},"enabled":function(e){var i=e.originalCollection?e.originalCollection:e.permissionCollection,t=i.findWhere({"type":"owner"}),n=t&&null===t.get("permissions"),o=!i.findWhere({"type":"group"}),r=i&&e.nodeModel&&e.nodeModel.actions&&!!e.nodeModel.actions.get({"signature":"editpermissions"})&&(n||o||!t),a=e.authUser&&e.authUser.get("privilege_system_admin_rights");return!a&&d&&(d.AdminRestoreOwner&&d.AdminRestoreOwnerGroup||!n&&o&&d.AdminRestoreOwnerGroup||!n&&!o&&d.AdminRestoreOwner)&&(r=a),r&&e.toolItem&&(n?a?e.toolItem.set("name",s.AddOwnerOrGroup):d&&d.AdminRestoreOwner?d&&!d.AdminRestoreOwnerGroup&&e.toolItem.set("name",s.AddOwnerGroup):d&&d.AdminRestoreOwnerGroup?e.toolItem.set("name",s.AddOwner):e.toolItem.set("name",s.AddOwnerOrGroup):o?e.toolItem.set("name",s.AddOwnerGroup):e.toolItem.set("name",s.AddOwner)),r},"execute":function(e,i){var o=this,s=n.Deferred();e.context||i&&i.context;return e.suppressSuccessMessage=!0,csui.require(["csui/models/permission/nodepermission.model","csui/utils/permissions/permissions.precheck","csui/controls/globalmessage/globalmessage","csui/dialogs/modal.alert/modal.alert"],function(n,r){l=arguments[2],u=arguments[3],o._selectAddOwnerOrOwnerGroupOptions(e,i).done(function(i){var a=i.members,u=i.permissions,d=0===a.get("type")?"owner":"group",m={"type":d,"right_id":a.get("id"),"permissions":u,"apply_to":i.apply_to,"include_sub_type":i.apply_to>0?r.includeSubTypes():[]},g={"right_id":a.get("id"),"apply_to":i.apply_to,"permissions":u},p=new n(m,e);p.nodeId=e.nodeModel?e.nodeModel.get("id"):e.nodeId,e.originatingView&&e.originatingView.blockActions&&e.originatingView.blockActions(),p.save(g,{"patch":!0,"silent":!0,"wait":!0}).done(function(){p.set({"right_id_expand":t.clone(a.attributes),"type":d,"addOwnerGroup":!0},{"silent":!0}),e.originatingView&&e.originatingView.unblockActions&&e.originatingView.unblockActions(),l.showMessage("success",o._getMessageWithUserDisplayName(p)),s.resolve(p)}).fail(function(i){var t=i?new c(i,p):i;e.originatingView&&e.originatingView.unblockActions&&e.originatingView.unblockActions(),l.showMessage("error",t),s.reject(p,t)})}).fail(function(e){s.reject(e)})},function(e){s.reject(e)}),s.promise()},"_selectAddOwnerOrOwnerGroupOptions":function(e,i){var t,o,r,a,c=n.Deferred(),l=e.originalCollection?e.originalCollection.findWhere({"type":"owner"}):e.permissionCollection.findWhere({"type":"owner"}),u=s.allUsersAndGroups,m=e.authUser||e.originatingView.options.authUser||e.context&&e.context._user;return l&&null===l.get("permissions")?(t=[0,1],o=s.AddOwnerOrGroupDialogTitle,r="all.members",a=["all.members","member.groups"],d&&d.AdminRestoreOwner&&!d.AdminRestoreOwnerGroup&&!m.get("privilege_system_admin_rights")?(r="all.groups",u=s.allGroups,t=[1],a=["all.groups","member.groups"]):d&&!d.AdminRestoreOwner&&d.AdminRestoreOwnerGroup&&!m.get("privilege_system_admin_rights")&&(r="all.members",u=s.allUsersAndGroups,t=[0],a=["all.members","member.groups"])):(t=l?[1]:[0],o=l?s.AddOwnerGroupDialogTitle:s.AddOwnerDialogTitle,u=l?s.allGroups:u,r=l?"all.groups":"all.members",a=l?["all.groups","member.groups"]:["all.members","member.groups"]),csui.require(["csui/dialogs/members.picker/members.picker.wizard"],function(i){new i({"command":"addownerorownergroup","context":e.context,"connector":e.connector,"dialogClass":"cs-permission-group-picker","displayName":u,"dialogTitle":o,"startLocation":r,"nodeModel":e.nodeModel,"availablePermissions":e.permissionCollection.availablePermissions,"adduserorgroup":!0,"addButtonLabel":s.AddButtonLabel,"startLocations":a,"selectableTypes":t,"applyTo":e.applyTo}).show().done(function(){c.resolve.apply(c,arguments)}).fail(function(e){c.reject.apply(c,arguments)})},function(e){c.reject(e)}),c.promise()},"_getMessageWithUserDisplayName":function(e){var i;e.get("right_id_expand")&&(i=o.formatMemberName(e.get("right_id_expand")));return e.get("results")&&e.get("results").success>0?t.str.sformat(s.AddUserOrGroupSuccessWithCount,i,o.formatMessage(e.get("results").success,s)):t.str.sformat(s.AddUserOrGroupSuccess,i)}})}),csui.define("csui/utils/commands/permissions/restore.public.access",["module","require","csui/lib/underscore","csui/lib/jquery","i18n!csui/utils/commands/nls/localized.strings","csui/utils/base","csui/utils/log","csui/models/command","csui/utils/command.error"],function(e,i,t,n,o,s,r,a,c){"use strict";var l,u=e.config();return a.extend({"defaults":{"signature":"restorepublicaccess","name":o.CommandNameRestorePublicAccess},"enabled":function(e){var i=e.originalCollection?e.originalCollection:e.permissionCollection,t=e.nodeModel||i&&i.options&&i.options.node,n=t&&t.actions.get({"signature":"editpermissions"}),o=e.authUser||e.context&&e.context._user;return u&&u.AdminRestorePublic&&(n=o&&o.get("privilege_system_admin_rights")),i&&n&&!i.findWhere({"type":"public"})},"execute":function(e){var i,t,s=this,r=n.Deferred(),a=e.permissionCollection,u=e.nodeModel||a.node||e.originatingView&&e.originatingView.model;return csui.require(["csui/models/permission/nodepermission.model","csui/widgets/permissions/impl/edit/apply.permission/apply.permission.view","csui/widgets/permissions/impl/edit/apply.permission/impl/header/apply.permission.header.view","csui/controls/progressblocker/blocker","csui/controls/dialog/dialog.view","csui/controls/globalmessage/globalmessage","csui/utils/permissions/permissions.precheck"],function(n,a,d,m,g,p,f){l=p,u&&u.get("container")?s._executeApplyPermission(e,u,d,a,m,g,n,f).then(r.resolve,r.reject):(i=new n({"type":"public"},e),t={"permissions":n.getReadPermissions()},i.nodeId=e.nodeId,e.originatingView&&e.originatingView.blockActions&&e.originatingView.blockActions(),i.save(t,{"patch":!0,"wait":!0}).done(function(){i.set({"publicAccess":!0},{"silent":!0}),e.originatingView&&e.originatingView.unblockActions&&e.originatingView.unblockActions();var t=s._getMessageWithUserDisplayName(i.get("results")&&i.get("results").success>0?o.RestorePublicAccessSuccessMessageWithCount:o.RestorePublicAccessSuccessMessage,i);l.showMessage("success",t),r.resolve(i)}).fail(function(t){var n=t?new c(t,i):t;e.originatingView&&e.originatingView.unblockActions&&e.originatingView.unblockActions(),l.showMessage("error",n),r.reject(i,n)}))}),r.promise()},"_executeApplyPermission":function(e,i,s,r,a,c,l,u){var d=n.Deferred();this.originatingView=e.originatingView;var m=new s({"restorePublicAccess":!0});this._view=new r({"context":e.context,"model":i,"permissionModel":new l({"type":"public"},e),"permissions":l.getReadPermissions(),"includeSubTypes":u.includeSubTypes(),"collection":e.permissionCollection,"applyTo":e.applyTo,"removePermission":!1,"originatingView":e.originatingView,"restorePublicAccess":!0});var g=new c({"headerView":m,"view":this._view,"className":"csui-permissions-apply-dialog","midSize":!0,"buttons":[{"id":"apply","label":o.applyButtonLabel,"default":!0,"click":function(e){this._performActions(e).then(d.resolve,d.reject)}.bind(this)},{"label":o.cancelButtonLabel,"close":!0}]});return g.listenTo(g,"hide",t.bind(this.onHideDialog,this)),a.imbue(g),g.show(),d.promise()},"onHideDialog":function(){var e=this.originatingView;e&&e.trigger("unblock:view:actions")},"_performActions":function(e){var i,t=this,s=n.Deferred(),r=e.dialog?e.dialog.options.view.options.permissionModel:e.model,a=e.dialog&&e.dialog.options.view.options.permissions,u=e.dialog&&e.dialog.options.view.options.originatingView,d=e.dialog.options.view.model,m=e.dialog&&e.dialog.options.view.options.collection,g=d&&d.get("container"),p=d&&d.get("permissions_model");return t.originatingView=u,r.set("isAddNew",!0),e.dialog&&(r.apply_to=g&&"advanced"===p&&e.dialog.options.view.subFolderSelected?2:g&&"advanced"===p?3:0,r.include_sub_types=r.apply_to>0?e.dialog&&e.dialog.options.view.options.includeSubTypes:[]),i={"permissions":a,"apply_to":r.apply_to,"include_sub_types":r.include_sub_types},r.nodeId=d.get("id"),t.originatingView&&t.originatingView.blockActions&&t.originatingView.blockActions(),r.save(i,{"patch":!0,"wait":!0}).done(function(){r.set({"publicAccess":!0},{"silent":!0}),t.destroyDialog(e),m.addPublicAccess(r),t.originatingView&&t.originatingView.unblockActions&&t.originatingView.unblockActions()
;var i=t._getMessageWithUserDisplayName(r.get("results")&&r.get("results").success>0?o.RestorePublicAccessSuccessMessageWithCount:o.RestorePublicAccessSuccessMessage,r);l.showMessage("success",i),s.resolve(r)}).fail(function(i){var n=i?new c(i,r):i;t.destroyDialog(e),t.originatingView&&t.originatingView.unblockActions&&t.originatingView.unblockActions(),l.showMessage("error",n),s.reject(r,n)}),s.promise()},"_getMessageWithUserDisplayName":function(e,i){var n;"public"===i.get("type")&&(n=o.publicAccess);return i.get("results")&&i.get("results").success>0?t.str.sformat(e,n,s.formatMessage(i.get("results").success,o)):t.str.sformat(e,n)},"destroyDialog":function(e){e.dialog&&e.dialog.destroy()}})}),csui.define("csui/utils/commands/personalize.page",["module","require","csui/lib/underscore","csui/lib/jquery","csui/models/command","csui/utils/commandhelper","i18n!csui/utils/commands/nls/localized.strings"],function(e,i,t,n,o,s,r){"use strict";var a=t.extend({"enablePersonalization":!0},a,e.config());return o.extend({"defaults":{"signature":"PersonalizePage","name":r.personalizePage},"enabled":function(e,i){var t=e.context||i&&i.context,n=t.perspective;return a.enablePersonalization&&n&&("flow"===n.get("type")||"sidepanel-right"===n.get("type")||"sidepanel-left"===n.get("type"))},"execute":function(e,i){var t=e.context||i&&i.context;if(i&&i.enablePersonalization||a.enablePersonalization)return this._initPersonalization(e,i,t)},"_initPersonalization":function(e,i,t){var o=n.Deferred();return csui.require(["csui/perspective.manage/pman.view","csui/utils/contexts/factories/node","csui/models/perspective/personalization.model"],function(i,n,r){var a=s.getJustOneNode(e)||t.getModel(n),c=t.perspective.toJSON(),l=new r(c,{"node":a,"context":t});l.fetch().then(function(){new i({"context":t,"perspective":l,"mode":i.MODE_PERSONALIZE}).show(),o.resolve()})},o.reject),o.promise()}})}),csui.define("csui/utils/commands/version.settings",["csui/models/command"],function(e){"use strict";return e.extend({"defaults":{"signature":"VersionsControl","command_key":["versionscontrol"],"scope":"single","name":"VersionsSettings"}})}),csui.define("csui/controls/treebrowse/navigation.tree",["module","csui/lib/backbone","csui-ext!csui/controls/treebrowse/navigation.tree"],function(e,i,t){"use strict";var n=e.config(),o=!!n.enable;t=t||[];var s=i.Model.extend({"defaults":{"sequence":100,"enabled":function(e,i){return!1},"data":function(e,i){return{}}}}),r=i.Collection.extend({"model":s,"comparator":"sequence"});return{"enabled":function(e,i){if(o)return!0;var n=!1;return new r(t).some(function(t){return n=t.get("enabled")(e,i),n&&(e.originatingView.treeData=t.get("data")(e,i)),n=!!n||n}),n}}}),csui.define("csui/utils/commands/tree.browse",["csui/lib/jquery","csui/lib/underscore","csui/models/command","csui/controls/treebrowse/navigation.tree","i18n!csui/utils/commands/nls/lang"],function(e,i,t,n,o){"use strict";return t.extend({"defaults":{"signature":"TreeBrowse","scope":"single"},"enabled":function(e,i){return!0===(e&&e.originatingView&&e.originatingView.showTree)&&e.toolItem&&e.toolItem.set({"title":o.TreeBrowseCollapseTooltip,"toolItemAriaExpand":!0,"stateIsOn":!0}),n.enabled(e,i)}})}),csui.define("csui/utils/commands/content.server.administration",["module","require","csui/lib/underscore","csui/lib/jquery","csui/models/command","csui/utils/url","csui/utils/commands/open.classic.page","i18n!csui/utils/commands/nls/localized.strings"],function(e,i,t,n,o,s,r,a){"use strict";var c,l=window.csui.requirejs.s.contexts._.config.config["csui/utils/contexts/factories/user"]||{};return l=t.extend({"initialResponse":{"data":{"privilege_system_admin_rights":!1}},"openInNewTab":null},l,e.config()),null===l.openInNewTab&&(l.openInNewTab=r.openInNewTab),o.extend({"defaults":{"signature":"ContentServerAdministration","name":a.ContentServerAdministrationCommandName},"enabled":function(e,i){return l.initialResponse.data.privilege_system_admin_rights},"execute":function(e,i){var t=n.Deferred(),o=e.context||i&&i.context,s=l.openInNewTab&&window.open("","_blank")||window,r=this;return s.focus(),csui.require(["csui/utils/contexts/factories/connector"],function(){c=arguments[0],s.location.href=r._getUrl(o,e),t.resolve()},t.reject),t.promise()},"_getUrl":function(e,i){var t=e.getObject(c),n=new s(t.connection.url).getCgiScript(),o=this._getUrlQueryParameters(e,i),r=s.combineQueryString(o);return s.appendQuery(n,r)},"_getUrlQueryParameters":function(e,i){return{"func":"admin.index"}}})}),csui.define("csui/utils/commands/about.box",["module","csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","i18n!csui/utils/commands/nls/localized.strings","csui/utils/commandhelper","csui/models/command","csui/utils/url"],function(e,i,t,n,o,s,r,a){"use strict";var c=e.config();return i.defaults(c,{"enableAboutBox":!1,"aboutBoxContentView":"csui/controls/about.box/about.box.view"}),r.extend({"defaults":{"signature":"AboutBox","command_key":["AboutBox","AboutBox"],"scope":"single"},"enabled":function(e,i){return c.enableAboutBox},"execute":function(e,i){s.getAtLeastOneNode(e),s.getJustOneNode(e);return this.showAboutBox()},"showAboutBox":function(){var e=t.Deferred(),i=c.aboutBoxContentView;return csui.require(["csui/controls/dialog/dialog.view","i18n!csui/pages/start/nls/lang",i],function(i,t,n){var s=new n,r=new i({"view":s,"midSize":!0,"className":"csui-about-box","title":o.brandTitle+t.ProductName,"headers":[{"class":"csui-logo-image"}]});r.show(),e.resolve(),s&&s.listenToOnce(r,"destroy",function(){s.trigger("destroy")})}),e.promise()}})}),csui.define("csui/utils/commands/restructure.command",["require","module","csui/lib/underscore","csui/lib/jquery","csui/utils/url","csui/utils/base","csui/models/command","csui/utils/command.error","i18n!csui/utils/commands/nls/root/localized.strings"],function(e,i,t,n,o,s,r,a,c){"use strict";var l=t.extend({},i.config());t.defaults(l,{"actionType":"restructure"});var u,d,m,g,p,f,v,w,h=t.once(function(){var e=n.Deferred();return csui.require(["csui/controls/globalmessage/globalmessage","csui/dialogs/restructure/restructure.dialog","csui/controls/dialog/dialog.view","csui/dialogs/modal.alert/modal.alert","csui/controls/side.panel/side.panel.view","csui/utils/node.links/node.links","csui/controls/conflict.resolver/conflict.resolver","csui/dialogs/node.picker/impl/header/apply.properties.selector/apply.properties.selector.view","csui/utils/page.leaving.blocker","csui/utils/contexts/factories/application.scope.factory"],function(i,t,n,o,s,r,a,c){d=i,u=t,m=n,p=o,g=s,f=r,v=a,w=c,e.resolve()},function(i){e.reject(i)}),e.promise()});return r.extend({"defaults":{"signature":"Restructure","command_key":["restructure","restructure"],"name":c.CommandNameRestructure,"scope":"multiple","labels":{"actionName":c.RestructuringNodes,"actionNode":c.RestructuringNode,"commandTitle":c.CommandTitleRestructure,"commandName":c.CommandNameRestructure,"dialogTitle":c.DialogTitleRestructure,"dialogTitleSingle":c.DialogTitleSingleRestructure,"titleNotAllowed":c.RestructureNotAllowed}},"enabled":function(e,i){return r.prototype.enabled.call(this,e,i)},"execute":function(e,i){e.suppressSuccessMessage=!0,e.suppressFailMessage=!0,e.restructureCommand=this,e.connector=this.connector=e.originatingView&&e.originatingView.connector,this.context=e.context||i&&i.context,this.status=e;var n=this;return h().then(function(){var i=new u(e),o=new g({"title":c.RestructureDialogTitle,"subTitle":e.nodes.length+" "+c.files,"content":i,"id":"csui-restructure-Slide-Panel","buttons":[{"id":"restructure","className":"binf-btn binf-btn-primary","label":c.Restructure,"default":!0,"disabled":!0,"click":t.bind(n.onClickRestructureButton,n)}]});n.restructureDialog=o,n.contentView=i,o.show()})},"onClickRestructureButton":function(){var e=this,i=n.Deferred();this._performRestructure().done(function(){p.showInformation(c.confirmationRestructure,{"titleIcon":"csui-icon-notification-information"}),e.restructureDialog.destroy(),i.resolve(),e.status.nodes.reset()}).fail(function(t){e._showError(t),i.reject()}).always(function(){e._unblockActions(e.contentView)})},"_performRestructure":function(){var e=this,i=n.Deferred(),o=this.contentView.selectedNodes,r=this.contentView.restructureFormView.selectedOptions,c=this.contentView.restructureFormView.selectedOptions[0],l=this.contentView.restructureFormView.applyProperties,u=(new Date).getTime(),d=this.get("labels"),m=this.context;r.applyProperties=l,r.openSelectedProperties=this.contentView.restructureFormView.openSelectedProperties,this.restructureDialog.hide();var g=o.map(function(e){var i={"id":e.get("id"),"name":e.get("name"),"container":e.get("container"),"mime_type":e.get("mime_type"),"original_id":e.get("original_id"),"original":e.original,"type":e.get("type"),"size":e.get("size"),"type_name":e.get("type_name"),"state":"pending","count":0,"total":1,"enableCancel":!1,"bundleNumber":u},t=e.get("type");return 144===t||749===t||736===t||30309===t?i.size_formatted=e.get("size_formatted"):140===t&&(i.url=e.get("url")),i.actions=e.actions,i.targetLocation={"id":c.get("id"),"url":f.getUrl(c)},s.getMetadataLanguageInfo().enabled&&(i.multilingual_provided=!0,!!e.has("name_multilingual")&&(i.name_multilingual=e.get("name_multilingual")),!!e.has("description_multilingual")&&(i.description_multilingual=e.get("description_multilingual"))),i}),p=t.map(g,function(e){return t.clone(e)});return this._resolveNamingConflicts(c,p,d).done(function(n){t.each(n,function(e){void 0===e.id&&(e.id=t.findWhere(g,{"name":e.name}).id)});var o=e;e._metadataHandling(n,d,t.extend(r,{"context":m,"targetFolder":c})).done(function(){var e,s,l,u,d,g,p,f,v;g=o.contentView.restructureFormView.getValues(),e=o.status.container&&o.status.container.connector,p=o.status&&o.status.nodes,f=r.applyProperties,v=[],g&&(s=g.startProcessAt,l=g.notifyUsers,u=g.reference,d=g.comment),t.each(p.models,function(e){v.push({"dataid":e.get("id")})});var w={"connector":e,"targetFolder":c,"applyProperties":f?f-1:0,"status":o.status,"context":m,"collection":o.status.collection,"startProcess":s,"notifyUsers":l,"reference":u,"comment":d,"selectedNodeIDs":v};o.getExternalBodyParams(w.connector,w.selectedNodeIDs).then(function(e){o._restructureNodeWithMetadata(n,e,w).done(function(){i.resolve()}).fail(function(e){var t=new a(e);i.reject(t)})})}).fail(function(){i.reject()})}).fail(function(t){t&&t.userAction&&"cancelResolveNamingConflicts"===t.userAction?e.trigger("resolve:naming:conflicts:cancelled"):t&&!t.cancelled&&e.showError(t),i.reject()}),i.promise()},"checkMultilingualInfo":function(e,i){t.each(e,function(e){t.each(i.nodes,function(i){i.dataid===e.id&&e.multilingual_provided&&(e.name_multilingual&&(i.name_multilingual=e.name_multilingual),e.description_multilingual&&(i.description_multilingual=e.description_multilingual))})})},"_resolveNamingConflicts":function(e,i,n){var o=1===i.length?n.actionNode:t.str.sformat(n.actionName,i.length);return new v({"h1Label":o,"actionBtnLabel":n.commandName,"excludeAddVersion":!0,"container":e,"files":i,"originatingView":this.originatingView}).run()},"_metadataHandling":function(e,i,t){var o=n.Deferred();return this.originatingView&&0===this.originatingView._blockingCounter&&this.originatingView.blockActions(),csui.require(["csui/widgets/metadata/metadata.copy.move.items.controller"],function(i){var n,s=t.openSelectedProperties,r=t.applyProperties,a=new i;if(s)n=a.CopyMoveItemsWithMetadata;else{if(r!==w.APPLY_DESTINATION_PROPERTIES&&r!==w.COMBINE_ALL_PROPERTIES)return o.resolve();n=a.CopyMoveItemsRequiredMetadata}r===w.KEEP_ORIGINAL_PROPERTIES?t.inheritance="original":r===w.APPLY_DESTINATION_PROPERTIES?t.inheritance="destination":r===w.COMBINE_ALL_PROPERTIES&&(t.inheritance="merged"),t.action=l.actionType,n.call(a,e,t).done(function(){o.resolve()}).fail(function(e){o.reject(e)})},function(e){o.reject(e)}),o.promise()},"_showError":function(e){if(e&&!e.cancelled){var i=new a(e);d.showMessage("error",c.errorRestructure,i.errorDetails||i.message)}this.restructureDialog.destroy()},"_blockActions":function(e){var i=e&&(e.resultsView||e.tableView);i&&i.blockActions()},"_unblockActions":function(e){var i=e&&(e.resultsView||e.tableView);i&&i.unblockActions()},"getExternalBodyParams":function(e,i){return n.Deferred().resolve(this.externalBodyParams).promise()},"externalBodyParams":{},"_restructureNodeWithMetadata":function(e,i,n){var s,r;r=o.combine(this.connector.getConnectionUrl().getApiBase("v2")+"restructure"),s={"parent_id":n.targetFolder.get("id"),"nodes":n.selectedNodeIDs,"startdate":n.startProcess,"userstobenotified":n.notifyUsers,"subject":n.reference,"message":n.comment,"AttrSourceType":n.applyProperties},t.extend(s,i),t.isFunction(this.checkMultilingualInfo)&&this.checkMultilingualInfo(e,s),t.each(e,function(e){t.each(s.nodes,function(i){i.dataid===e.id&&(i.roles=e.extended_data&&e.extended_data.roles)})});var a=this.connector.extendAjaxOptions({"url":r,"method":"PUT","data":s,"contentType":this.connector.getAjaxContentType()});return this.connector.makeAjaxCall(a)}})}),csui.define("csui/temporary/cop/commands/open.blog",["csui/utils/commandhelper","csui/utils/commands/open.classic.page"],function(e,i){"use strict";return i.extend({"defaults":{"signature":"OpenBlog"},"enabled":function(i){var t=e.getJustOneNode(i),n=t&&t.get("type");return 356===n||357===n},"getUrlQueryParameters":function(e,i){return{"func":"ll","objAction":356===e.get("type")?"view":"viewincontainer","objId":e.get("id"),"nexturl":location.href}}})}),csui.define("csui/temporary/cop/commands/open.faq",["csui/lib/jquery","csui/utils/commandhelper","csui/utils/commands/open.classic.page"],function(e,i,t){"use strict";return t.extend({"defaults":{"signature":"OpenFAQ"},"enabled":function(e){var t=i.getJustOneNode(e),n=t&&t.get("type");return 123475===n||123476===n},"getUrlQueryParameters":function(i,t){var n=123475===i.get("type"),o=e.param({"func":"ll","objAction":"view","objId":n?i.get("id"):i.get("volume_id"),"nexturl":location.href});return n?o:o+"#entry_"+i.get("id")}})}),csui.define("csui/temporary/cop/commands/open.forum",["csui/lib/jquery","csui/utils/commandhelper","csui/utils/commands/open.classic.page"],function(e,i,t){"use strict";return t.extend({"defaults":{"signature":"OpenForum"},"enabled":function(e){var t=i.getJustOneNode(e),n=t&&t.get("type");return 123469===n||123470===n},"getUrlQueryParameters":function(e,i){return{"func":"ll","objAction":123469===e.get("type")?"view":"viewincontainer","objId":e.get("id"),"nexturl":location.href}}})}),csui.define("csui/temporary/cop/commands/open.wiki",["csui/lib/jquery","csui/utils/url","csui/utils/commandhelper","csui/utils/commands/open.classic.page"],function(e,i,t,n){"use strict";return n.extend({"defaults":{"signature":"OpenWiki"},"enabled":function(e){var i=t.getJustOneNode(e),n=i&&i.get("type");return 5573===n||5574===n},"getUrl":function(e,t){var o=n.prototype.getUrl.apply(this,arguments);return 5573===e.get("type")?o:i.combine(o,"open",e.get("id"))},"getUrlQueryParameters":function(e,i){if(5573===e.get("type"))return{"func":"ll","objAction":"browse","objId":e.get("id"),"viewType":1,"nexturl":location.href}}})}),csui.define("csui/temporary/cop/commands/open.mailstore",["csui/utils/commandhelper","csui/utils/commands/open.classic.page"],function(e,i){"use strict";return i.extend({"defaults":{"signature":"OpenMailStore"},"enabled":function(i){var t=e.getJustOneNode(i);return 3030331===(t&&t.get("type"))},"getUrlQueryParameters":function(e,i){if(3030331===e.get("type"))return{"func":"ll","objAction":"browse","objId":e.get("id"),"viewType":1,"nexturl":location.href}}})}),csui.define("csui/utils/commands/open.document/csui.open.document.delegates",["module","csui/lib/underscore","csui/utils/commands/open.specific.node.perspective","csui/utils/commands/open","csui/utils/commands/doc.preview"],function(e,i,t,n,o){"use strict";var s=i.extend({"allowViewContent":!0,"allowPerspective":!1},e.config());return[{"sequence":500,"command":t,"decides":function(e,i){var t=i&&i.context;return!(!t||!t.perspective)&&s.allowPerspective}},{"sequence":750,"command":o},{"sequence":1e3,"command":n,"decides":function(){return s.allowViewContent}},{"sequence":1e4,"command":t}]}),csui.define("csui/utils/commands/versions/open.version/csui.open.version.delegates",["require","csui/lib/underscore","csui/utils/commands/versions/open.version.perspective","csui/utils/commands/versions/open","csui/utils/commands/versions/doc.version.preview"],function(e,i,t,n,o){"use strict";var s=i.extend({"allowViewContent":!0,"allowPerspective":!1},e.moduleConfig("csui/utils/commands/open.document/csui.open.document.delegates"));return[{"sequence":500,"command":t,"decides":function(e,i){var t=i&&i.context;return!(!t||!t.perspective)&&s.allowPerspective}},{"sequence":750,"command":o},{"sequence":1e3,"command":n,"decides":function(){return s.allowViewContent}},{"sequence":1e4,"command":t}]}),csui.define("csui/utils/commands/goto.location",["require","csui/lib/jquery","csui/utils/base","csui/lib/underscore","csui/lib/backbone","i18n!csui/utils/commands/nls/localized.strings","csui/utils/commandhelper","csui/models/command","csui/models/node/node.model","csui-ext!csui/utils/commands/goto.location"],function(e,i,t,n,o,s,r,a,c,l){"use strict";return a.extend({"defaults":{"signature":"goToLocation","scope":"single"},"enabled":function(e,i){var t,n=r.getJustOneNode(e),o=e.context||i&&i.context;o.hasModel("node")&&(t=o.getModel("node"));var s;n.parent&&(s=n.parent);var a=!1;return t&&s&&(a=t.get("id")===s.get("id")),n&&this._isSupported(n)&&!a},"_isSupported":function(e){return e.parent&&e.parent.isFetchable()},"_makeAccessible":function(){return["open"]},"execute":function(e,n){var o,s=i.Deferred(),a=r.getJustOneNode(e),l={"originatingView":e.originatingView,"context":e.context},u=this;if(a&&this._isSupported(a)?o=a.parent:!a.parent&&e.model&&(o=e.model),o)if(o&&void 0===o.get("type")){var d=new c({"id":o.get("id")},{"connector":o.connector,"commands":this._makeAccessible()});d.fetch().done(function(e){o=d,u.navigate(o,l),s.resolve()}).fail(function(e){csui.require(["csui/dialogs/modal.alert/modal.alert"],function(i){var n=new t.Error(e);i.showError(n.message)}),s.reject()})}else this.navigate(o,l),s.resolve();return s.promise()},"executeDefaultAction":function(e,t,n){var s={"node":e};t.trigger("before:defaultAction",s);var a=i.Deferred();s.cancel||csui.require(["csui/utils/commands"],function(i){var c=i.get("Browse");if(!c)throw new Error("Invalid command: Browse");var l={"nodes":new o.Collection([e])},u={"context":n,"originatingView":t};r.handleExecutionResults(c.execute(l,u)).then(function(){t.trigger("executed:defaultAction",s),a.resolve()})},a.reject)},"navigate":function(e,t){if(l){var n=this;return l.reduce(function(i,n){return i.catch(function(i){if(i)throw i;return n.navigate(e,t)})},i.Deferred().reject()).catch(function(i){if(i)throw i;n.executeDefaultAction(e,t.originatingView,t.context)})}return this.executeDefaultAction(e,t.originatingView,t.context),i.Deferred().resolve().promise()}})}),csui.define("csui/utils/commands/collection/collect",["module","require","csui/lib/jquery","csui/lib/backbone","csui/utils/base","csui/utils/url","csui/lib/underscore","i18n!csui/utils/commands/collection/nls/lang","csui/models/command","csui/utils/commands/multiple.items","csui/utils/commandhelper"],function(e,i,t,n,o,s,r,a,c,l,u){"use strict";var d=e.config();r.defaults(d,{"parallelism":3});var m,g,p,f,v,w,h,b=c.extend({});r.extend(b.prototype,l);var y=b.extend({"defaults":{"signature":"Collect","scope":"multiple","command_key":["collect","Collect"],"successMessages":{"formatForOne":a.CollectOneItemSuccessMessage,"formatForTwo":a.CollectManyItemsSuccessMessage,"formatForMany":a.CollectManyItemsSuccessMessage,"formatForFive":a.CollectManyItemsSuccessMessage},"errorMessages":{"formatForOne":a.CollectOneItemFailMessage,"formatForTwo":a.CollectManyItemsFailMessage,"formatForMany":a.CollectManyItemsFailMessage,"formatForFive":a.CollectManyItemsFailMessage}},"enabled":function(e,i){var t=this._isSupported(e.container),n=u.getAtLeastOneNode(e);return t=!!t&&!!n&&n.length,t=t&&y.__super__.enabled.apply(this,arguments)},"_isSupported":function(e){var i=[298];return!e||-1===t.inArray(e.get("type"),i)},"execute":function(e,i){var n=this,o=t.Deferred();return csui.require(["csui/controls/globalmessage/globalmessage","csui/controls/conflict.resolver/impl/collection.conflicts/collection.conflicts.view","csui/utils/taskqueue","csui/models/fileuploads","csui/utils/page.leaving.blocker","csui/utils/contexts/factories/next.node","csui/utils/node.links/node.links"],function(){m=arguments[0],w=arguments[1],g=arguments[2],p=arguments[3],f=arguments[4],v=arguments[5],h=arguments[6],n._addToCollection(e,i).done(function(i){var t=e.nodes.models,o=r.map(t,function(e){return{"name":e.get("name"),"state":"pending","count":0,"total":1,"node":e}}),s=i.nodes,a=new p(o,{"connector":c}),c=e.container&&e.container.connector||e.originatingView&&e.originatingView.connector||e.collection&&e.collection.connector||t[0]&&t[0].connector;n._announceOperationStart(e),a.each(function(e){var i=e.get("node");e.node=i,e.unset("node"),e.set("mime_type",i.get("mime_type"))}),n._addSelectedNodesToCollection(a,c,s[0],e.collection).then(function(i){m.hideFileUploadProgress();var t=n._checkPromisess(i);if(t.failedNodes.length)n._showDialog(t.failedNodes).then(function(i,o){if(o.kill(),t.successNodes.length){var r={"context":e.context,"nextNodeModelFactory":v,"link_url":h.getUrl(s[0]),"targetFolder":s[0]};n.showSuccessWithLink(t.successNodes.models,r)}});else if(t.successNodes.length){var o={"context":e.context,"nextNodeModelFactory":v,"link_url":h.getUrl(s[0]),"targetFolder":s[0]};n.showSuccessWithLink(i,o)}}),n._announceOperationEnd(e);var l;e.collection&&e.originatingView&&e.originatingView.findNodeFromCollection?l=e.originatingView.findNodeFromCollection(e.collection,s[0]):e.collection&&(l=e.collection.get(s[0].get("id"))||e.collection.findWhere({"id":s[0].get("id")})),l&&l.fetch()}),o.resolve()}),o.promise()},"_addToCollection":function(e,i){var n=this,o=t.Deferred();return csui.require(["csui/dialogs/node.picker/node.picker"],function(t){var s=r.extend({"selectableTypes":[298],"addableTypes":[298],"showAllTypes":!0,"orderBy":"type asc","dialogTitle":a.selectCollectionDialogTitle,"selectButtonLabel":a.selectCollectButtonLabel,"globalSearch":!0,"selectMultiple":!1,"context":i?i.context:e.context,"startLocation":"recent.containers","startLocations":["enterprise.volume","current.location","personal.volume","favorites","recent.containers"],"resolveShortcuts":!0,"resultOriginalNode":!0},e);n.nodePicker=new t(s),n.nodePicker.show().done(function(){o.resolve.apply(o,arguments)}).fail(function(){o.reject.apply(o,arguments)})},function(e){o.reject(e)}),o.promise()},"_addSelectedNodesToCollection":function(e,i,n,o){var s=this,c=new g({"parallelism":d.parallelism}),l=0,u=r.map(e.models,function(e){var o=t.Deferred();return c.pending.add({"worker":function(){var t=e.node,r=t.get("id"),a=n.get("id");return s._collectNode(i,a,r).done(function(){e.set("count",1),e.deferred.resolve(e),o.resolve(e)}).fail(function(i){o.resolve(e)}),o.promise()}}),l++,o.promise(u)});return m.showFileUploadProgress(e,{"oneFileTitle":a.CollectingOneItem,"oneFileSuccess":a.CollectOneItemSuccessMessage,"multiFileSuccess":a.CollectManyItemsSuccessMessage,"oneFilePending":a.CollectingOneItem,"multiFilePending":a.CollectingItems,"oneFileFailure":a.CollectOneItemFailMessage,"multiFileFailure":a.CollectManyItemsFailMessage2,"someFileSuccess":a.CollectManyItemsSuccessMessage,"someFilePending":a.CollectingItems,"someFileFailure":a.CollectManyItemsFailMessage2,"enableCancel":!1}),t.whenAll.apply(t,u)},"_collectNode":function(e,i,n){var o=t.Deferred(),r={"collection_id":i},a={"url":s.combine(e.getConnectionUrl().getApiBase("v2"),"/nodes/"+n),"type":"PUT","data":r,"contentType":"application/x-www-form-urlencoded"};return e.makeAjaxCall(a).done(function(e){o.resolve(e)}).fail(function(e){o.reject(e)}),o.promise()},"_checkPromisess":function(e){r.isArray(e)||(e=[e]);var i=new n.Collection,t=new n.Collection;return r.each(e,function(e){void 0!==e&&(e.cancelled||void 0===e.get("count")||(e.get("count")?i.push(e):t.push(e)))}),{"successNodes":i,"failedNodes":t}},"_showDialog":function(e){var i=t.Deferred(),n=[{"id":"close","close":!0,"label":a.conflictsDialogCloseLabel,"toolTip":a.conflictsDialogCloseLabel,"click":function(e){i.resolve("close",e.dialog)}}];return this._showConflictDialog(e,n),i},"_showConflictDialog":function(e,i){var n=this;t.Deferred();csui.require(["csui/controls/dialog/dialog.view"],function(t){var s=o.formatMessage(e.length,n.get("errorMessages")),r=new t({"title":s,"midSize":!0,"iconLeft":"csui-icon-notification-information","className":"csui-collection-conflicts-dialog","view":n._getListView(e),"buttons":i});return r.show(),r})},"_getListView":function(e){return new w(r.extend({},{"collection":e}))},"_announceOperationStart":function(e){var i=e.originatingView;i.blockActions&&i.blockActions(),f.enable(this.get("pageLeavingWarning"))},"_announceOperationEnd":function(e){f.disable();var i=e.originatingView;i.unblockActions&&i.unblockActions()}});return y}),csui.define("bundles/csui-commands",["csui/utils/commands/back.to.last.fragment","csui/integration/folderbrowser/commands/go.to.node.history","csui/integration/folderbrowser/commands/open.full.page.container","csui/integration/folderbrowser2/commands/open.full.page.container","csui/utils/commands","csui/utils/commands/add/add.mixin","csui/utils/commands/add.categories","csui/utils/commands/add","csui/utils/commands/add.item.metadata","csui/utils/commands/add.version","csui/utils/commands/browse","csui/utils/commands/collection/collect.items","csui/utils/commands/collection/remove.collected.items","csui/utils/commands/confirmable","csui/utils/commands/copy","csui/utils/commands/copy.link","csui/utils/commands/create.perspective","csui/utils/commands/delete","csui/utils/commands/delete/delete.self.handler","csui/utils/commands/doc.preview","csui/utils/commands/download","csui/utils/commands/open.base","csui/utils/commands/open.document/open.document","csui/utils/commands/zipanddownload","csui/utils/commands/edit","csui/utils/commands/editactivex","csui/utils/commands/editofficeonline","csui/utils/commands/edit.perspective","csui/utils/commands/editwebdav","csui/utils/commands/email.link","csui/utils/commands/execute.saved.query","csui/utils/commands/execute.search.form.query","csui/utils/commands/favorite.add","csui/utils/commands/favorite.remove","csui/utils/commands/inlineedit","csui/utils/commands/move","csui/utils/commands/multiple.items","csui/utils/commands/navigate","csui/utils/commands/node","csui/utils/commands/open","csui/utils/commands/open.node.perspective","csui/utils/commands/open.classic.page","csui/utils/commands/open.discussion","csui/utils/commands/open.milestone","csui/utils/commands/open.channel","csui/utils/commands/open.news","csui/utils/commands/open.poll","csui/utils/commands/open.prospector","csui/utils/commands/open.specific.classic.page","csui/utils/commands/open.specific.node.perspective","csui/utils/commands/open.task","csui/utils/commands/open.taskgroup","csui/utils/commands/open.tasklist","csui/utils/commands/open.topic","csui/utils/commands/permissions","csui/utils/commands/properties","csui/utils/commands/rename","csui/utils/commands/rename.favorite","csui/utils/commands/reserve","csui/utils/commands/compound.document/compound.document","csui/utils/commands/compound.document/create.revision","csui/utils/commands/compound.document/create.release","csui/utils/commands/compound.document/reorganize","csui/utils/commands/compound.document/lock","csui/utils/commands/compound.document/unlock","csui/utils/commands/compound.document/view.releases","csui/utils/commands/compound.document/releases.commands","csui/utils/commands/compound.document/properties","csui/utils/commands/compound.document/compound.document.util","csui/utils/commands/run.livereport","csui/utils/commands/sign.out","csui/utils/commands/switch.to.classic","csui/utils/commands/unreserve","csui/utils/commands/user.profile","csui/utils/commands/versions","csui/utils/commands/versions/delete","csui/utils/commands/versions/download","csui/utils/commands/versions/open","csui/utils/commands/versions/promote.version","csui/utils/commands/versions/properties","csui/utils/commands/versions/doc.version.preview","csui/utils/commands/versions/open.version.perspective","csui/utils/commands/versions/open.version/open.version.delegate","csui/utils/commands/filter","csui/utils/commands/description.toggle","csui/utils/commands/thumbnail.toggle","csui/utils/commands/save.filter","csui/utils/commands/save.query","csui/utils/commands/update.query","csui/utils/commands/maximize.widget.view","csui/utils/commands/restore.widget.size","csui/utils/commands/permissions/apply.permission","csui/utils/commands/permissions/edit.permission","csui/utils/commands/permissions/change.owner.permission","csui/utils/commands/permissions/delete.permission","csui/utils/commands/permissions/add.user.group","csui/utils/commands/permissions/add.owner.group","csui/utils/commands/permissions/restore.public.access","csui/utils/commands/permissions/permission.util","csui/utils/commands/personalize.page","csui/utils/commands/version.settings","csui/utils/commands/tree.browse","csui/utils/commands/content.server.administration","csui/utils/commands/about.box","csui/utils/commands/restructure.command","i18n!csui/utils/commands/nls/localized.strings","csui/utils/commands/nls/root/localized.strings","i18n!csui/utils/commands/collection/nls/lang","csui/utils/commands/collection/nls/root/lang","csui/temporary/cop/commands/open.blog","csui/temporary/cop/commands/open.faq","csui/temporary/cop/commands/open.forum","csui/temporary/cop/commands/open.wiki","csui/temporary/cop/commands/open.mailstore","csui/dialogs/file.open/file.open.dialog","csui/models/command","csui/models/commands","csui/utils/accessibility","csui/utils/command.error","csui/utils/commandhelper","csui/utils/commands/open.document/csui.open.document.delegates","csui/utils/commands/open.document/delegates/open.document.delegates","csui/utils/commands/versions/open.version/csui.open.version.delegates","csui/utils/commands/versions/open.version/delegates/open.version.delegates","csui/utils/commands/open.plugins/open.plugins","csui/utils/commands/goto.location","csui/utils/commands/collection/collect","csui/utils/node.links/node.links","csui/utils/routing"],{});
//# sourceMappingURL=csui-commands.js.map