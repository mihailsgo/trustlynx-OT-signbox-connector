csui.define("csui/controls/tableheader/comment/comment.button.view",["require","csui/lib/underscore","csui/lib/marionette","csui/controls/mixins/view.events.propagation/view.events.propagation.mixin","csui/behaviors/keyboard.navigation/tabable.region.behavior"],function(e,t,i,o,n){var a=i.View.extend({"className":"csui-comment-button","behaviors":{"TabableRegionBehavior":{"behaviorClass":n}},"constructor":function(e){i.View.call(this,e),this.listenTo(this.model,"change",this.render);var t=this.model.actions;t&&this.listenTo(t,"update",this.render)},"render":function(){var e=this;return csui.require(["esoc/widgets/utils/commentdialog/commentdialog.view"],function(t){var o=new i.Region({"el":e.el});(void 0!==window.require?window.require.s.contexts._.config:window.csui.require.s.contexts._.config).roId=e.model.get("id");var n=new t({"connector":e.model.connector,"nodeid":e.model.get("id"),"CSID":e.model.get("id"),"model":e.model,"context":e.options.context,"originatingView":e.options.originatingView});n.listenTo(n,"before:render",function(){e.triggerMethod("before:render",e)}),n.listenTo(n,"render",function(){e.triggerMethod("render",e)}),e.propagateEventsToViews(n),o.show(n)},function(){}),this}});return t.extend(a.prototype,o),a}),csui.define("csui/widgets/metadata/versions.toolbaritems",["csui/lib/underscore","i18n!csui/widgets/metadata/impl/nls/lang","csui/controls/toolbar/toolitems.factory","csui-ext!csui/widgets/metadata/versions.toolbaritems","csui/controls/toolbar/toolitem.model"],function(e,t,i,o,n){var a={"tableHeaderToolbar":new i({"info":[{"signature":"VersionProperties","name":t.ToolbarItemVersionInfo,"iconName":"csui_action_properties32"},{"signature":"DocVersionPreview","name":t.ToolbarItemDocVersionPreview,"commandData":{"ifNotOpenDelegate":!0}},{"signature":"CopyLink","name":t.ToolbarItemCopyLink}],"main":[{"signature":"EmailLink","name":t.ToolbarItemEmailLink},{"signature":"VersionDownload","name":t.ToolbarItemVersionDownload},{"signature":"VersionDelete","name":t.ToolbarItemVersionDelete},{"signature":"PromoteVersion","name":t.ToolbarItemPromoteVersion}]},{"maxItemsShown":10,"dropDownIconName":"csui_action_more32"}),"inlineActionbar":new i({"info":[{"signature":"VersionProperties","name":t.ToolbarItemVersionInfo,"iconName":"csui_action_properties32"},{"signature":"DocVersionPreview","name":t.ToolbarItemDocVersionPreview,"iconName":"csui_action_preview32","commandData":{"ifNotOpenDelegate":!0}},{"signature":"CopyLink","name":t.ToolbarItemCopyLink,"iconName":"csui_action_copy_link32"}],"main":[{"signature":"EmailLink","name":t.ToolbarItemEmailLink,"iconName":"csui_action_email32"},{"signature":"VersionDownload","name":t.ToolbarItemVersionDownload,"iconName":"csui_action_download32"},{"signature":"VersionDelete","name":t.ToolbarItemVersionDelete,"iconName":"csui_action_delete32"},{"signature":"PromoteVersion","name":t.ToolbarItemPromoteVersion,"iconName":"csui_action_promote32"}]},{"maxItemsShown":5,"dropDownText":t.ToolbarItemMore,"dropDownIconName":"csui_action_more32","addGroupSeparators":!1}),"dropdownMenuList":new i({"info":[{"signature":"VersionProperties","name":t.ToolbarItemVersionInfo},{"signature":"CopyLink","name":t.ToolbarItemCopyLink}],"main":[{"signature":"EmailLink","name":t.ToolbarItemEmailLink},{"signature":"VersionDownload","name":t.ToolbarItemVersionDownload},{"signature":"VersionDelete","name":t.ToolbarItemVersionDelete},{"signature":"PromoteVersion","name":t.ToolbarItemPromoteVersion}]},{"maxItemsShown":0,"dropDownIconName":"csui_action_caret_down32"}),"rightToolbar":new i({"main":[{"signature":"PurgeAllVersions","name":t.ToolbarItemVersionPurgeAll}]},{"hAlign":"right"})};return o&&function(t){e.each(t,function(t){e.each(t,function(t,i){var o=a[i];if(!o)throw new Error("Invalid target toolbar: "+i);e.each(t,function(e){e=new n(e),o.addItem(e)})})})}(o),a}),csui.define("csui/widgets/metadata/impl/metadata.tabcontentcollection.view",["csui/lib/underscore","csui/controls/tab.panel/impl/tab.contents.view","csui/utils/base"],function(e,t,i){return t.extend({"constructor":function(o,n){t.prototype.constructor.apply(this,arguments),e.extend(this,{"currentlyFocusedElement":function(e){for(var t=e&&e.shiftKey,o=this.currentlyFocusedElementInternal(e),n=this.keyboardBehavior.tabableElements.length,a=t?n-1:0;o.hasClass("binf-hidden")&&a>=0&&a<n;)e.elementCursor=a+=t?-1:1,o=this.currentlyFocusedElementInternal(e);return i.isElementVisibleInParent(o,this.$el,1,1)||this.$el.scrollTop(o.offset().top),o}})}})}),csui.define("csui/widgets/metadata/impl/header/rightbar/toolbaritems",["csui/lib/underscore","csui/utils/base","i18n!csui/controls/tabletoolbar/impl/nls/localized.strings","csui/controls/toolbar/toolitems.factory","csui/controls/toolbar/toolitem.model","csui-ext!csui/widgets/metadata/impl/header/rightbar/toolbaritems"],function(e,t,i,o,n,a){"use strict";var s={"rightToolbar":new o({"main":[]})};return a&&function(t){e.each(t,function(t){e.each(t,function(t,i){var o=s[i];if(!o)throw new Error("Invalid target toolbar: "+i);e.each(t,function(e){e=new n(e),o.addItem(e)})})})}(a),s}),csui.define("csui/widgets/metadata/impl/header/rightbar/toolbaritems.masks",["module","csui/lib/underscore","csui/controls/toolbar/toolitems.mask","csui/utils/toolitem.masks/global.toolitems.mask"],function(e,t,i,o){"use strict";function n(){var n=e.config(),s=new o;this.toolbars=t.reduce(a,function(e,o){var a=new i(s,{"normalize":!1});return t.each(n,function(e,t){(e=e[o])&&a.extendMask(e)}),a.storeMask(),e[o]=a,e},{})}var a=["rightToolbar"];return n.toolbars=a,n}),csui.define("csui/utils/versions.default.action.items",["module","csui/lib/underscore","csui/models/actionitems","csui-ext!csui/utils/versions.default.action.items"],function(e,t,i,o){"use strict";var n=t.extend({"openVersionContentOnly":!1},e.config()),a=new i([{"type":144,"signature":n.openVersionContentOnly?"OpenVersionDelegate":"VersionOpen","sequence":10}]);return o&&a.add(t.flatten(o,!0)),a}),csui.define("hbs!csui/widgets/metadata/impl/header/item.name/metadata.item.name",["module","hbs","nuc/lib/handlebars"],function(e,t,i){var o=i.template({"1":function(e,t,i,o,n){return'  <div class="title-edit-icon-div"></div>\r\n'},"3":function(e,t,i,o,n){return'  <div class="csui-metadata-item-name-dropdown"></div>\r\n'},"5":function(e,t,i,o,n){var a,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'    <span class="csui-multilingual-icon-label">\r\n      <button  class="icon csui-multilingual-icon">\r\n        '+(null!=(a=(s(i,"icon-v2")||t&&s(t,"icon-v2")||e.hooks.helperMissing).call(null!=t?t:e.nullContext||{},{"name":"icon-v2","hash":{"states":"true","size":"small","iconName":"csui_action_language_switcher24"},"loc":{"start":{"line":31,"column":8},"end":{"line":31,"column":91}}}))?a:"")+"\r\n      </button>\r\n   </span>\r\n"},"7":function(e,t,i,o,n){var a,s,r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'    <button type="button" class="csui-undo csui-edit-save inline-edit-icon" disabled title="'+e.escapeExpression((s=null!=(s=r(i,"save_edit_name_tooltip")||(null!=t?r(t,"save_edit_name_tooltip"):t))?s:e.hooks.helperMissing,"function"==typeof s?s.call(null!=t?t:e.nullContext||{},{"name":"save_edit_name_tooltip","hash":{},"loc":{"start":{"line":36,"column":92},"end":{"line":36,"column":118}}}):s))+'">\r\n      '+(null!=(a=(r(i,"icon-v2")||t&&r(t,"icon-v2")||e.hooks.helperMissing).call(null!=t?t:e.nullContext||{},{"name":"icon-v2","hash":{"states":"true","size":"normal","iconName":"csui_action_confirm32"},"loc":{"start":{"line":37,"column":6},"end":{"line":37,"column":80}}}))?a:"")+'\r\n    </button>\r\n    <button type="button" class="csui-undo csui-edit-cancel inline-edit-icon" title="'+e.escapeExpression((s=null!=(s=r(i,"cancel_edit_name_tooltip")||(null!=t?r(t,"cancel_edit_name_tooltip"):t))?s:e.hooks.helperMissing,"function"==typeof s?s.call(null!=t?t:e.nullContext||{},{"name":"cancel_edit_name_tooltip","hash":{},"loc":{"start":{"line":39,"column":85},"end":{"line":39,"column":113}}}):s))+'">\r\n      '+(null!=(a=(r(i,"icon-v2")||t&&r(t,"icon-v2")||e.hooks.helperMissing).call(null!=t?t:e.nullContext||{},{"name":"icon-v2","hash":{"states":"true","size":"normal","iconName":"csui_action_cancel32"},"loc":{"start":{"line":40,"column":6},"end":{"line":40,"column":79}}}))?a:"")+"\r\n    </button>\r\n"},"compiler":[8,">= 4.3.0"],"main":function(e,t,i,o,n){var a,s,r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="cs-metadata-item-name">\r\n<span class="csui-toggle-wrapper binf-hidden">\r\n  <span class="icon circular1 arrow_back cs-go-back binf-hidden1" style="display:none;"\r\n        aria-label="'+e.escapeExpression((s=null!=(s=r(i,"goBack")||(null!=t?r(t,"goBack"):t))?s:e.hooks.helperMissing,"function"==typeof s?s.call(null!=t?t:e.nullContext||{},{"name":"goBack","hash":{},"loc":{"start":{"line":4,"column":20},"end":{"line":4,"column":30}}}):s))+'" title="'+e.escapeExpression((s=null!=(s=r(i,"goBack")||(null!=t?r(t,"goBack"):t))?s:e.hooks.helperMissing,"function"==typeof s?s.call(null!=t?t:e.nullContext||{},{"name":"goBack","hash":{},"loc":{"start":{"line":4,"column":39},"end":{"line":4,"column":49}}}):s))+'" tabindex="0"></span>\r\n  <span class="csui-icon csui-metadata-listview csui-metadata-listview-expand-icon" role="button" title="'+e.escapeExpression((s=null!=(s=r(i,"sidebarToggleTitle")||(null!=t?r(t,"sidebarToggleTitle"):t))?s:e.hooks.helperMissing,"function"==typeof s?s.call(null!=t?t:e.nullContext||{},{"name":"sidebarToggleTitle","hash":{},"loc":{"start":{"line":5,"column":105},"end":{"line":5,"column":127}}}):s))+'"\r\n        aria-label="'+e.escapeExpression((s=null!=(s=r(i,"sidebarToggleTitle")||(null!=t?r(t,"sidebarToggleTitle"):t))?s:e.hooks.helperMissing,"function"==typeof s?s.call(null!=t?t:e.nullContext||{},{"name":"sidebarToggleTitle","hash":{},"loc":{"start":{"line":6,"column":20},"end":{"line":6,"column":42}}}):s))+'" tabindex="0"></span>\r\n</span><span class="csui-type-icon"></span>\r\n<div role="heading" aria-level="2" class="title-header">\r\n<span class="title binf-line-clamp" tabindex="0" title="'+e.escapeExpression((s=null!=(s=r(i,"name")||(null!=t?r(t,"name"):t))?s:e.hooks.helperMissing,"function"==typeof s?s.call(null!=t?t:e.nullContext||{},{"name":"name","hash":{},"loc":{"start":{"line":9,"column":56},"end":{"line":9,"column":64}}}):s))+'" aria-label="'+e.escapeExpression((s=null!=(s=r(i,"nameAria")||(null!=t?r(t,"nameAria"):t))?s:e.hooks.helperMissing,"function"==typeof s?s.call(null!=t?t:e.nullContext||{},{"name":"nameAria","hash":{},"loc":{"start":{"line":9,"column":78},"end":{"line":9,"column":90}}}):s))+'" role="button"\r\n      aria-expanded="false">\r\n    '+e.escapeExpression((s=null!=(s=r(i,"name")||(null!=t?r(t,"name"):t))?s:e.hooks.helperMissing,"function"==typeof s?s.call(null!=t?t:e.nullContext||{},{"name":"name","hash":{},"loc":{"start":{"line":11,"column":4},"end":{"line":11,"column":12}}}):s))+"\r\n</span>\r\n</div>\r\n\r\n"+(null!=(a=r(i,"unless").call(null!=t?t:e.nullContext||{},null!=t?r(t,"read_only"):t,{"name":"unless","hash":{},"fn":e.program(1,n,0),"inverse":e.noop,"loc":{"start":{"line":15,"column":0},"end":{"line":17,"column":11}}}))?a:"")+"\r\n"+(null!=(a=r(i,"if").call(null!=t?t:e.nullContext||{},null!=t?r(t,"show_dropdown_menu"):t,{"name":"if","hash":{},"fn":e.program(3,n,0),"inverse":e.noop,"loc":{"start":{"line":19,"column":0},"end":{"line":21,"column":7}}}))?a:"")+'\r\n<div class="title-edit-div">\r\n  <label id="'+e.escapeExpression((s=null!=(s=r(i,"edit_name_id")||(null!=t?r(t,"edit_name_id"):t))?s:e.hooks.helperMissing,"function"==typeof s?s.call(null!=t?t:e.nullContext||{},{"name":"edit_name_id","hash":{},"loc":{"start":{"line":24,"column":13},"end":{"line":24,"column":29}}}):s))+'" class="binf-hidden">'+e.escapeExpression((s=null!=(s=r(i,"placeholder_text")||(null!=t?r(t,"placeholder_text"):t))?s:e.hooks.helperMissing,"function"==typeof s?s.call(null!=t?t:e.nullContext||{},{"name":"placeholder_text","hash":{},"loc":{"start":{"line":24,"column":51},"end":{"line":24,"column":71}}}):s))+'</label>\r\n  <span class="cs-icon-required category_required" title="'+e.escapeExpression((s=null!=(s=r(i,"required_tooltip")||(null!=t?r(t,"required_tooltip"):t))?s:e.hooks.helperMissing,"function"==typeof s?s.call(null!=t?t:e.nullContext||{},{"name":"required_tooltip","hash":{},"loc":{"start":{"line":25,"column":58},"end":{"line":25,"column":78}}}):s))+'"></span>\r\n  <input type="text" class="title-input" placeholder="'+e.escapeExpression((s=null!=(s=r(i,"placeholder_text")||(null!=t?r(t,"placeholder_text"):t))?s:e.hooks.helperMissing,"function"==typeof s?s.call(null!=t?t:e.nullContext||{},{"name":"placeholder_text","hash":{},"loc":{"start":{"line":26,"column":54},"end":{"line":26,"column":74}}}):s))+'"\r\n         value="'+e.escapeExpression((s=null!=(s=r(i,"edit_name")||(null!=t?r(t,"edit_name"):t))?s:e.hooks.helperMissing,"function"==typeof s?s.call(null!=t?t:e.nullContext||{},{"name":"edit_name","hash":{},"loc":{"start":{"line":27,"column":16},"end":{"line":27,"column":29}}}):s))+'" aria-labelledby="'+e.escapeExpression((s=null!=(s=r(i,"edit_name_id")||(null!=t?r(t,"edit_name_id"):t))?s:e.hooks.helperMissing,"function"==typeof s?s.call(null!=t?t:e.nullContext||{},{"name":"edit_name_id","hash":{},"loc":{"start":{"line":27,"column":48},"end":{"line":27,"column":64}}}):s))+'" aria-required="true">\r\n'+(null!=(a=r(i,"if").call(null!=t?t:e.nullContext||{},null!=t?r(t,"mlDataEnabled"):t,{"name":"if","hash":{},"fn":e.program(5,n,0),"inverse":e.noop,"loc":{"start":{"line":28,"column":2},"end":{"line":34,"column":9}}}))?a:"")+(null!=(a=r(i,"unless").call(null!=t?t:e.nullContext||{},null!=t?r(t,"hideCancelButton"):t,{"name":"unless","hash":{},"fn":e.program(7,n,0),"inverse":e.noop,"loc":{"start":{"line":35,"column":2},"end":{"line":42,"column":13}}}))?a:"")+'</div>\r\n</div>\r\n<div class="title-error-div">\r\n  <span class="title-error"></span>\r\n</div>\r\n'}});return i.registerPartial("csui_widgets_metadata_impl_header_item.name_metadata.item.name",o),o}),csui.define("hbs!csui/widgets/metadata/impl/header/dropdown.menu/dropdown.menu",["module","hbs","nuc/lib/handlebars"],function(e,t,i){var o=i.template({"1":function(e,t,i,o,n){var a,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'  <div class="binf-dropdown">\r\n    <button id="'+e.escapeExpression((a=null!=(a=s(i,"btnId")||(null!=t?s(t,"btnId"):t))?a:e.hooks.helperMissing,"function"==typeof a?a.call(null!=t?t:e.nullContext||{},{"name":"btnId","hash":{},"loc":{"start":{"line":3,"column":16},"end":{"line":3,"column":25}}}):a))+'" type="button" class="binf-btn binf-dropdown-toggle"\r\n            data-binf-toggle="dropdown" aria-haspopup="true" aria-expanded="false"\r\n            aria-label="'+e.escapeExpression((a=null!=(a=s(i,"showMoreAria")||(null!=t?s(t,"showMoreAria"):t))?a:e.hooks.helperMissing,"function"==typeof a?a.call(null!=t?t:e.nullContext||{},{"name":"showMoreAria","hash":{},"loc":{"start":{"line":5,"column":24},"end":{"line":5,"column":40}}}):a))+'" title="'+e.escapeExpression((a=null!=(a=s(i,"showMoreTooltip")||(null!=t?s(t,"showMoreTooltip"):t))?a:e.hooks.helperMissing,"function"==typeof a?a.call(null!=t?t:e.nullContext||{},{"name":"showMoreTooltip","hash":{},"loc":{"start":{"line":5,"column":49},"end":{"line":5,"column":68}}}):a))+'">\r\n      <span class="csui-button-icon icon-expandArrowDown" title="'+e.escapeExpression((a=null!=(a=s(i,"showMoreTooltip")||(null!=t?s(t,"showMoreTooltip"):t))?a:e.hooks.helperMissing,"function"==typeof a?a.call(null!=t?t:e.nullContext||{},{"name":"showMoreTooltip","hash":{},"loc":{"start":{"line":6,"column":65},"end":{"line":6,"column":84}}}):a))+'"></span>\r\n    </button>\r\n    <ul class="binf-dropdown-menu" role="menu"></ul>\r\n  </div>\r\n'},"3":function(e,t,i,o,n){return'  <div class="csui-loading-parent-wrapper binf-disabled binf-hidden">\r\n  <span class="csui-loading-dots-wrapper">\r\n    <span class="csui-loading-dot"></span>\r\n    <span class="csui-loading-dot"></span>\r\n    <span class="csui-loading-dot"></span>\r\n  </span>\r\n  </div>\r\n'},"compiler":[8,">= 4.3.0"],"main":function(e,t,i,o,n){var a,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return(null!=(a=s(i,"if").call(null!=t?t:e.nullContext||{},null!=t?s(t,"hasCommands"):t,{"name":"if","hash":{},"fn":e.program(1,n,0),"inverse":e.program(3,n,0),"loc":{"start":{"line":1,"column":0},"end":{"line":18,"column":7}}}))?a:"")+"\r\n"}});return i.registerPartial("csui_widgets_metadata_impl_header_dropdown.menu_dropdown.menu",o),o}),csui.define("hbs!csui/widgets/metadata/impl/header/dropdown.menu/lazy.loading.template",["module","hbs","nuc/lib/handlebars"],function(e,t,i){var o=i.template({"compiler":[8,">= 4.3.0"],"main":function(e,t,i,o,n){return'<li role="none" class="csui-loading-parent-wrapper binf-disabled">\r\n  <span class="csui-loading-dots-wrapper">\r\n    <span class="csui-loading-dot"></span>\r\n    <span class="csui-loading-dot"></span>\r\n    <span class="csui-loading-dot"></span>\r\n  </span>\r\n</li>'}});return i.registerPartial("csui_widgets_metadata_impl_header_dropdown.menu_lazy.loading.template",o),o}),csui.define("css!csui/widgets/metadata/impl/header/dropdown.menu/dropdown.menu",[],function(){}),csui.define("csui/widgets/metadata/impl/header/dropdown.menu/dropdown.menu.view",["module","csui/lib/jquery","csui/lib/underscore","csui/utils/log","csui/lib/backbone","csui/lib/marionette","csui/utils/commands","csui/utils/commandhelper","csui/controls/toolbar/toolitem.view","csui/controls/toolbar/flyout.toolitem.view","csui/models/nodes","csui/controls/toolbar/toolitems.filtered.model","hbs!csui/widgets/metadata/impl/header/dropdown.menu/dropdown.menu","csui/behaviors/keyboard.navigation/tabable.region.behavior","csui/behaviors/dropdown.menu/dropdown.menu.behavior","csui/controls/tile/behaviors/perfect.scrolling.behavior","i18n!csui/widgets/metadata/impl/nls/lang","hbs!csui/widgets/metadata/impl/header/dropdown.menu/lazy.loading.template","csui/utils/base","csui/controls/globalmessage/globalmessage","css!csui/widgets/metadata/impl/header/dropdown.menu/dropdown.menu","csui/lib/binf/js/binf"],function(e,t,i,o,n,a,s,r,l,d,c,u,m,h,p,g,f,w,b,v){"use strict";return o=o(e.id),a.CompositeView.extend({"className":"cs-dropdown-menu","template":m,"getChildView":function(e){return e.get("flyout")?d:l},"childViewContainer":"ul.binf-dropdown-menu","childViewOptions":function(e){return{"role":"none","command":this.collection.commands&&this.collection.commands.findWhere({"signature":e.get("signature")})}},"templateHelpers":function(){return{"hasCommands":!!this.collection.length,"btnId":i.uniqueId("dropdownMenuButton"),"showMoreTooltip":f.showMore,"showMoreAria":i.str.sformat(f.showMoreAria,this.model.get("name"))}},"ui":{"dropdownToggle":".binf-dropdown-toggle","dropdownMenu":".binf-dropdown-menu","loadingIconsDiv":".csui-loading-parent-wrapper"},"behaviors":{"TabableRegionBehavior":{"behaviorClass":h},"DropdownMenuBehavior":{"behaviorClass":p},"PerfectScrolling":{"behaviorClass":g,"contentParent":".binf-dropdown-menu","suppressScrollX":!0,"includePadding":!0}},"constructor":function(e){var o={"nodes":new c([e.model]),"container":e.container,"containerCollection":e.containerCollection,"context":e.context};e.status=o,this.commands=e.commands||s,e.collection=new u(e.toolItems,{"status":o,"commands":this.commands,"delayedActions":e.containerCollection&&e.containerCollection.delayedActions,"mask":e.toolItemsMask}),e.reorderOnSort=!0,a.CompositeView.prototype.constructor.apply(this,arguments),i.defaults(this.options,e.toolItems.options),this.originatingView=e.originatingView,e.el&&t(e.el).addClass(i.result(this,"className")),this.listenTo(this,"childview:toolitem:action",this._triggerMenuItemAction).listenTo(this.model,"sync",this.render).listenTo(n,"closeToggleAction",this._closeToggle).listenTo(this.model,"change",this.render),this.model.delayedActions&&this.listenTo(this.model.delayedActions,"request",this._hide).listenTo(this.model.delayedActions,"sync error",this._show)},"_updateMenuItems":function(){this.collection.silentFetch=!0,this.fetchingNonPromotedActions=!1,this.collection.refilter(),this.render()},"onRender":function(){if(this.model.delayedActions&&this.model.delayedActions.fetching&&this._hide(),this.collection.length){this.fetchingNonPromotedActions=!1,this.ui.dropdownToggle.binf_dropdown(),this.ui.dropdownMenu.find("> li > a.binf-hidden").removeClass("binf-hidden");var e=i.bind(function(){this.trigger("update:scrollbar"),this.ui.dropdownMenu.removeClass("adjust-dropdown-menu");var e=this.ui.dropdownMenu.offset().left,t=this.options.originatingView.$el.offset().left,i=this.ui.dropdownMenu.outerWidth(),o=this.options.originatingView.$el.width(),n=(window.innerWidth-o)/2,a=o-(e+i-n);(e+i>t+o||a+i>o)&&this.ui.dropdownMenu.addClass("adjust-dropdown-menu")},this),o=i.bind(function(){var e,t=this,o=this.options.model?this.options.model:this.model,n=!!o&&!!o.get("csuiLazyActionsRetrieved"),a=!!o&&!!o.isLocallyCreated;o&&!n&&o.nonPromotedActionCommands&&o.nonPromotedActionCommands.length&&!a&&(this.fetchingNonPromotedActions=!0,this.ui.dropdownMenu.append(w),e=o.delayedActions.fetching?o.delayedActions.fetching:o.setEnabledLazyActionCommands(!0),e.done(function(e){t.fetchingNonPromotedActions=!1;var o=new u(t.options.toolItems,{"status":t.options.status,"commands":t.commands,"delayedActions":t.options.containerCollection&&t.options.containerCollection.lazyActions,"lazyActions":t.options.containerCollection&&t.options.containerCollection.lazyActions,"mask":t.options.toolItemsMask}),n=t.ui.dropdownMenu.find(".csui-loading-parent-wrapper");n.animate("width: 0",300,function(){n.remove(),i.filter(o.models,function(e){if(!0===t.isDestroyed||t._isDestroyed)t.children=void 0;else{var i=e.get("signature");if(t.collection.find({"signature":i})){var o=t.collection.find({"signature":i});e.get("flyout")&&o.toolItems.length!==e.toolItems.length&&o.toolItems.reset(e.toolItems.models)}else{t.collection.models.push(e);t.addChild(e,l).renderTextOnly()}}})})}).fail(function(e){t.fetchingNonPromotedActions=!1;var i=t.ui.dropdownMenu.find(".csui-loading-parent-wrapper"),o=new b.Error(e);i.length&&i.remove(),v.showMessage("error",o.message)}))},this);this.ui.dropdownToggle.on("binf.dropdown.after.show",e),this.ui.dropdownToggle.on("binf.dropdown.before.show",o),t(window).on("resize.metadata.header.dropdown.menu",i.debounce(e,100)),this.delegateEvents()}else{var n=this.options.model?this.options.model:this.model,a=!!n&&!!n.get("csuiLazyActionsRetrieved"),s=!!n&&!!n.isLocallyCreated;n&&!a&&n.nonPromotedActionCommands&&n.nonPromotedActionCommands.length&&!s&&(this.$el.find(".binf-dropdown").addClass("binf-hidden"),this.ui.loadingIconsDiv.removeClass("binf-hidden"),this.fetchingNonPromotedActions=!0,n.setEnabledLazyActionCommands(!0).done(i.bind(function(){this.fetchingNonPromotedActions=!1;var e=this.$el.find(".csui-loading-parent-wrapper");e.animate("width: 0",300,i.bind(function(){e.addClass("binf-hidden"),this.$el.find(".binf-dropdown").removeClass("binf-hidden"),this._updateMenuItems()},this))},this)))}},"onRenderCollection":function(){if(this.collection.length&&this.fetchingNonPromotedActions){var e=this.ui.dropdownMenu.find(".csui-loading-parent-wrapper");e.length&&e.remove(),this.ui.dropdownMenu.append(w)}},"onDestroy":function(){this.undelegateEvents(),t(window).off("resize.metadata.header.dropdown.menu")},"currentlyFocusedElement":function(){return t(this.ui.dropdownToggle)},"_hide":function(){this.$el.addClass("binf-invisible")},"_show":function(){this.$el.removeClass("binf-invisible")},"_closeToggle":function(){var e=this.$el.find(".binf-dropdown-toggle");e.parent().hasClass("binf-open")&&e.binf_dropdown("toggle")},"_triggerMenuItemAction":function(e,t){this._closeToggle();var n=t.toolItem,a=n.get("signature"),s=this.commands.get(a),l={"context":this.options.context,"nodes":new c([this.model]),"container":this.options.container,"collection":this.options.containerCollection,"originatingView":this.options.targetView?this.options.targetView:this.originatingView,"showPermissionView":!!this.options.showPermissionView,"noMetadataNavigation":this.options.noMetadataNavigation,"toolItem":n,"data":n.get("commandData")||{}};try{if(!s)throw new Error('Command "'+a+'" not found.');if(i.isFunction(s.execute)){var d=s.execute(l);r.handleExecutionResults(d,{"command":s,"suppressSuccessMessage":l.suppressSuccessMessage,"suppressFailMessage":l.suppressFailMessage})}else this.trigger(a.toLowerCase(),this)}catch(e){o.warn('Executing the command "{0}" failed.\n{1}',s.get("signature"),e.message)&&console.warn(o.last)}}})}),csui.define("csui/widgets/metadata/versions.toolbaritems.mask",["module","csui/lib/underscore","csui/controls/toolbar/toolitems.mask","csui/utils/toolitem.masks/global.toolitems.mask","csui-ext!csui/widgets/metadata/versions.toolbaritems.mask"],function(e,t,i,o,n){"use strict";return n||(n=[]),i.extend({"constructor":function(n){var a=e.config(),s=new o;i.prototype.constructor.call(this,s,{"normalize":!1}),t.each(a,function(e,t){this.extendMask(e)},this),this.storeMask(),this.context=n.context,this.node=n.node?n.node:n.model,this._updateMask(),this.listenTo(this.node,"change:id",this._updateMask)},"_updateMask":function(){var e=this.restoreMask({"silent":!0});n.forEach(function(t){(t=t({"context":this.context,"node":this.node}))&&(e=this.extendMask(t,{"silent":!0})||e)},this),e&&this.trigger("update",this)}})}),csui.define("csui/widgets/metadata/header.dropdown.menu.items",["csui/lib/underscore","i18n!csui/controls/tabletoolbar/impl/nls/localized.strings","csui/controls/toolbar/toolitems.factory","csui/controls/toolbar/toolitem.model","csui-ext!csui/widgets/metadata/header.dropdown.menu.items","csui-ext!csui/widgets/metadata/header.item.name/menuitems"],function(e,t,i,o,n,a){"use strict";function s(t){e.each(t,function(t){e.each(t,function(t,i){var n=r[i];if(!n)throw new Error("Invalid target toolbar: "+i);e.each(t,function(e){e=new o(e),n.addItem(e)})})})}var r={"dropdownMenuList":new i({"info":[{"signature":"Properties","name":t.ToolbarItemInfo},{"signature":"DocPreview","name":t.ToolbarItemDocPreview,"commandData":{"ifNotOpenDelegate":!0,"fullView":!0,"includeContainers":!1}},{"signature":"CopyLink","name":t.ToolbarItemCopyLink}],"edit":[{"signature":"Edit","name":t.ToolbarItemEdit,"flyout":"edit","promoted":!0},{"signature":"EditActiveX","name":"EditActiveX","flyout":"edit"},{"signature":"EditOfficeOnline","name":"EditOfficeOnline","flyout":"edit"},{"signature":"EditWebDAV","name":"EditWebDAV","flyout":"edit"}],"share":[{"signature":"Share","name":t.MenuItemShare,"flyout":"share"}],"main":[{"signature":"SendTo","name":t.ToolbarItemSendTo,"flyout":"sendto"},{"signature":"EmailLink","name":t.ToolbarItemEmailLinkShort,"flyout":"sendto"},{"signature":"permissions","name":t.ToolbarItemPermissions},{"signature":"Rename","name":t.ToolbarItemRename},{"signature":"Download","name":t.ToolbarItemDownload},{"signature":"ReserveDoc","name":t.ToolbarItemReserve},{"signature":"UnreserveDoc","name":t.ToolbarItemUnreserve},{"signature":"Lock","name":t.ToolbarItemLock},{"signature":"Unlock","name":t.ToolbarItemUnlock},{"signature":"Copy","name":t.ToolbarItemCopy},{"signature":"Move","name":t.ToolbarItemMove},{"signature":"AddVersion","name":t.ToolbarItemAddVersion},{"signature":"Delete","name":t.ToolbarItemDelete},{"signature":"Collect","name":t.ToolbarCollect},{"signature":"ZipAndDownload","name":t.MenuItemZipAndDownload},{"signature":"CompoundDocument","name":t.compoundDocument,"flyout":"CompoundDocument"},{"signature":"CreateRelease","name":t.CreateRelease,"subItemOf":"CompoundDocument","flyout":"CompoundDocument"},{"signature":"CreateRevision","name":t.CreateRevision,"subItemOf":"CompoundDocument","flyout":"CompoundDocument"},{"signature":"Reorganize","name":t.Reorganize,"subItemOf":"CompoundDocument","flyout":"CompoundDocument"}],"shortcut":[{"signature":"OriginalCopyLink","name":t.ToolbarItemOriginalCopyLink},{"signature":"OriginalEdit","name":t.ToolbarItemOriginalEdit},{"signature":"OriginalEmailLink","name":t.ToolbarItemOriginalShare},{"signature":"OriginalReserveDoc","name":t.ToolbarItemOriginalReserve},{"signature":"OriginalUnreserveDoc","name":t.ToolbarItemOriginalUnreserve},{"signature":"OriginalCopy","name":t.ToolbarItemOriginalCopy},{"signature":"OriginalMove","name":t.ToolbarItemOriginalMove},{"signature":"OriginalAddVersion","name":t.ToolbarItemAddVersion},{"signature":"OriginalDownload","name":t.ToolbarItemOriginalDownload},{"signature":"OriginalDelete","name":t.ToolbarItemOriginalDelete}]},{"maxItemsShown":0,"dropDownIconName":"csui_action_caret_down32"})};return a&&s(a),n&&s(n),r}),csui.define("csui/widgets/metadata/header.dropdown.menu.items.mask",["module","csui/lib/underscore","csui/controls/toolbar/toolitems.mask","csui/utils/toolitem.masks/global.toolitems.mask"],function(e,t,i,o){"use strict";return i.extend({"constructor":function(){var n=e.config(),a=new o;i.prototype.constructor.call(this,a,{"normalize":!1}),t.each(n,function(e,t){this.extendMask(e)},this),this.storeMask()}})}),csui.define("css!csui/widgets/metadata/impl/metadata",[],function(){}),csui.define("css!csui/widgets/metadata/impl/header/item.name/metadata.item.name",[],function(){}),csui.define("csui/widgets/metadata/impl/header/item.name/metadata.item.name.view",["require","csui/lib/jquery","csui/lib/underscore","csui/lib/backbone","csui/lib/marionette","csui/controls/node-type.icon/node-type.icon.view","csui/utils/base","hbs!csui/widgets/metadata/impl/header/item.name/metadata.item.name","i18n!csui/widgets/metadata/impl/nls/lang","csui/widgets/metadata/impl/header/dropdown.menu/dropdown.menu.view","csui/utils/commands/versions","csui/widgets/metadata/versions.toolbaritems","csui/widgets/metadata/versions.toolbaritems.mask","csui/widgets/metadata/header.dropdown.menu.items","csui/widgets/metadata/header.dropdown.menu.items.mask","csui/models/version","csui/behaviors/item.name/item.name.behavior","csui/behaviors/keyboard.navigation/tabable.region.behavior","csui/controls/mixins/view.events.propagation/view.events.propagation.mixin","i18n","css!csui/widgets/metadata/impl/metadata","css!csui/widgets/metadata/impl/header/item.name/metadata.item.name"],function(e,t,i,o,n,a,s,r,l,d,c,u,m,h,p,g,f,w,b,v){"use strict";var y=n.ItemView.extend({"className":"cs-metadata-item-name-container","template":r,"templateHelpers":function(){return{"name":this.modelHasEmptyName?this.readonly?this.placeHolderName:"":this.options.model.get("name"),"edit_name":this.modelHasEmptyName?"":this.options.model.get("name"),"edit_name_id":i.uniqueId("cs-metadata-edit-name"),"placeholder_text":this.placeHolderName,"nameAria":this.options.model.get("name")||l.emptyObjectNameAria,"cancel_edit_name_tooltip":l.cancelEditNameTooltip,"save_edit_name_tooltip":l.saveEditNameTooltip,"switch_language_tooltip":l.switchLanguageTooltip,"show_dropdown_menu":!!this.options.showDropdownMenu,"read_only":this.readonly,"goBack":l.goBackTooltip,"sidebarToggleTitle":l.expand,"hideCancelButton":this.options.mode&&"create"===this.options.mode,"mlDataEnabled":this.metadataLanguages.enabled}},"ui":{"name":".title","contextMenuDiv":".csui-metadata-item-name-dropdown","nameEditDiv":".title-edit-div","nameInput":".title-input","nameEditCancelIcon":".csui-edit-cancel","titleError":".title-error","toggleIcon":".csui-metadata-listview","toggleWrapper":".csui-toggle-wrapper","backEle":".arrow_back","titleHeader":".title-header","saveButtonInEditMode":".csui-edit-save","mlGlobeIcon":".csui-multilingual-icon"},"modelEvents":{"change":"render"},"events":{"keydown":"onKeyInView","mouseenter":"onMouseEnterName","mouseleave":"onMouseLeaveName",
"keydown @ui.nameInput":"onKeyDown","input @ui.nameInput":"onChangeName","click @ui.toggleIcon":"toggleSideBar","click @ui.backEle":"goBack","keydown @ui.toggleIcon":"toggleSideBar","keydown @ui.backEle":"goBack","keydown @ui.toggleWrapper":"_onKeyInView","click @ui.mlGlobeIcon":"onClickGlobeIcon","keydown @ui.mlGlobeIcon":"onKeyDownGlobeIcon","paste @ui.nameInput":"onKeyDown"},"behaviors":function(){return{"ItemName":{"behaviorClass":f,"nameSchema":this._nameSchema,"mode":this.options.mode,"autoSave":this.options.autoSave}}},"toggleSideBar":function(e){!e||13!==e.keyCode&&32!==e.keyCode&&"click"!==e.type||(this.toggleSideBarEvent(),e.preventDefault(),e.stopPropagation())},"setToggleIconTabIndex":function(){this.ui.toggleIcon.attr("tabindex",0)},"onChangeName":function(e){if(this.ui.saveButtonInEditMode.length){this.ui.nameInput.val().trim();this.enableAddButton=!1,this.enableAddButton=this.isSaveEnabled(e.target.value),this.ui.saveButtonInEditMode.prop("disabled",!this.enableAddButton),i.isFunction(this.updateMLdata)&&this.updateMLdata(e)}this.refreshTabableElements()},"isSaveEnabled":function(e){return e=e.trim(),!(!e.length||e===this.model.get("name")&&!this.saveMldata)},"refreshTabableElements":function(){this.tabableElements=this.$el.find("input:not([disabled]),  button:not([disabled])").filter(":visible").toArray()},"_moveTab":function(e){this.currentlyFocusedElementIndex=this.tabableElements.indexOf(e.target),e.shiftKey?this.currentlyFocusedElementIndex>0?(this.currentlyFocusedElementIndex-=1,t(this.tabableElements[this.currentlyFocusedElementIndex]).trigger("focus")):(this.currentlyFocusedElementIndex=this.tabableElements.length-1,t(this.tabableElements[this.currentlyFocusedElementIndex]).trigger("focus")):this.currentlyFocusedElementIndex<this.tabableElements.length-1?(this.currentlyFocusedElementIndex+=1,t(this.tabableElements[this.currentlyFocusedElementIndex]).trigger("focus")):(this.currentlyFocusedElementIndex=0,t(this.tabableElements[this.currentlyFocusedElementIndex]).trigger("focus")),e.stopPropagation(),e.preventDefault()},"toggleSideBarEvent":function(){if(this.leftBar&&this.leftBar.length>0){var e=this.leftBar.closest(".metadata-navigation");if(e&&e.length>0){var i=this.leftBar;if(i.length>0){if(e.hasClass("csui-hide-side-bar"))e.toggleClass("csui-hide-side-bar"),t(i).show("blind",{"direction":this.direction},"200",function(){t(window).trigger("resize.tableview")}),t(this.ui.backEle).hide(),t(this.ui.toggleIcon).attr("title",l.collapse).attr("aria-label",l.collapse),t(this.ui.toggleIcon).addClass("csui-metadata-listview-collapse-icon").removeClass("csui-metadata-listview-expand-icon"),this.sideBarHidden=!1;else{var o=this;t(i).hide("blind",{"direction":this.direction},"200",function(){e.toggleClass("csui-hide-side-bar"),t(window).trigger("resize.tableview")}),t(o.ui.backEle).show().trigger("focus"),this.sideBarHidden=!0,t(this.ui.toggleIcon).attr("title",l.expand).attr("aria-label",l.expand),t(this.ui.toggleIcon).addClass("csui-metadata-listview-expand-icon").removeClass("csui-metadata-listview-collapse-icon")}t(i).promise().done(function(){var e=t.Event("toggled:navigationbar");this.closest(".metadata-navigation").find(".cs-metadata").trigger(e)})}}}},"ensureTitleLabelIcon":function(){if(this.leftBar&&this.leftBar.length>0){var e=this.leftBar.closest(".metadata-navigation");if(e&&e.length>0){this.leftBar.length>0&&(e.hasClass("csui-hide-side-bar")?(t(this.ui.toggleIcon).attr("title",l.expand).attr("aria-label",l.expand),t(this.ui.toggleIcon).addClass("csui-metadata-listview-expand-icon").removeClass("csui-metadata-listview-collapse-icon")):(t(this.ui.toggleIcon).attr("title",l.collapse).attr("aria-label",l.collapse),t(this.ui.toggleIcon).addClass("csui-metadata-listview-collapse-icon").removeClass("csui-metadata-listview-expand-icon")))}}},"constructor":function(e){e||(e={}),this._nameSchema=i.extend({"required":!0,"readonly":!1},e.nameSchema);var o=!1;"create"===e.mode&&(o=!0),e.autoSave=o,this.listenTo(e.model,"change:name",this._updateName),this.direction=v.settings.rtl?"right":"left",n.ItemView.prototype.constructor.call(this,e),this.readonly=this._nameSchema.readonly,this.placeHolderName=l.addItemPlaceHolderName;var a=this.model.get("name");this.modelHasEmptyName=!a,this.options.showDropdownMenu&&this._createDropdownMenu(),t(window).on("resize."+this.cid,{"view":this},this._onWindowResize);var r=this;this.metadataLanguages=s.getMetadataLanguageInfo(),this.saveMldata="",this.listenTo(this,"ml:value:updated",function(e){r.saveMldata=e,r.enableAddButton=!0,r.ui.saveButtonInEditMode.prop("disabled",!r.enableAddButton),void 0===r.model.get("id")&&(r.model.set("name",e.value,{"silent":!0}),this.inputBoxNameChange=!0,this.ui.nameInput.removeClass("csui-empty-with-placeholder"),this.trigger("update:button",{"disabled":!1})),r.model.set("name_multilingual",e.value_multilingual,{"silent":!0}),r.targetElement.val(e.value),r.refreshTabableElements()}),this.listenTo(this.model.actions,"reset update",function(){this._checkAndEnableOrDisableEditing()})},"goBack":function(e){13!==e.keyCode&&32!==e.keyCode&&"click"!==e.type||(this.options.originatingView.triggerMethod("metadata:close"),e.preventDefault(),e.stopPropagation())},"_checkAndEnableOrDisableEditing":function(){var e=t(this.ui.name);if(e.length&&this.ItemNameBehavior._isEditingEnabled()){var o=i.str.sformat(l.itemTitleAria,this.model.get("name"));e.attr("aria-label",o),e.attr("title",o),e.attr("tabindex",0),e.removeClass("csui-disabled")}else e.removeAttr("aria-label"),e.removeAttr("title"),e.removeAttr("tabindex"),e.addClass("csui-disabled")},"_applyToggle":function(){this.sideBarHidden||(this.ui.toggleWrapper instanceof Object&&this.ui.toggleWrapper.removeClass("binf-hidden"),this.$el.addClass("csui-metadata-header-with-toggle"),this.options.originatingView&&this.options.originatingView.mdn&&this.options.originatingView.mdn.$el.is(":visible")&&this.ui.backEle instanceof Object&&this.ui.backEle.hide())},"_removeToggle":function(){this.ui.toggleWrapper instanceof Object&&(this.ui.toggleWrapper.addClass("binf-hidden"),this.$el.removeClass("csui-metadata-header-with-toggle")),this.sideBarHidden&&this.toggleSideBarEvent()},"onDestroy":function(){this._destroyDropdownMenu(),t(window).off("resize."+this.cid).off("resize.tableview."+this.cid)},"_updateName":function(){var e=this.model.get("name");this.modelHasEmptyName=!e,this.render();var i=t(this.ui.nameInput).is(":focus");this._toggleEditMode(i||this.modelHasEmptyName||!1,!1),this.validate()},"_destroyDropdownMenu":function(){this.dropdownMenuView&&(this.cancelEventsToViewsPropagation(this.dropdownMenuView),this.dropdownMenuView.destroy())},"_createDropdownMenu":function(){var e,t=this.options.originatingView,o=this.options.model instanceof g,n=this.options.toolbarItemsMask;e=t&&t.options&&t.options.toolbarItems&&t.options.toolbarItems.dropdownMenuListInProperties?t.options.toolbarItems.dropdownMenuListInProperties:o?u.dropdownMenuList:h.dropdownMenuList,n||(n=o?new m(this.options):new p),this.options.showPermissionView?e=e.collection.filter(function(e){return"permissions"!=e.get("signature")}):!0!==this.options.showPropertiesCommand&&(e=e.collection.filter(function(e){return"Properties"!=e.get("signature")&&"VersionProperties"!=e.get("signature")})),this._destroyDropdownMenu();var a=this.dropdownMenuView=new d({"model":this.options.model,"container":this.options.container,"containerCollection":this.options.collection||this.options.containerCollection,"toolItems":e,"toolItemsMask":n,"originatingView":this.options.originatingView,"targetView":this.options.targetView,"context":this.options.context,"commands":o?c:this.options.commands,"metadataScenario":this.options.metadataScenario,"showPermissionView":this.options.showPermissionView,"noMetadataNavigation":this.options.noMetadataNavigation});this.listenTo(a,"rename",i.bind(this._toggleEditMode,this,!0)),a.$el.on("keydown",i.bind(function(e){9===e.keyCode&&e.shiftKey&&(this.ui.backEle.is(":visible")||this.ui.toggleIcon.is(":visible"))&&(this.ui.name.prop("tabindex",0),e.stopPropagation())},this)),this.propagateEventsToViews(this.dropdownMenuView)},"_onWindowResize":function(e){if(e&&e.data&&e.data.view){var t=e.data.view;t.resizeTimer&&clearTimeout(t.resizeTimer),t.resizeTimer=setTimeout(function(){t._setHideShowToggleButton()},200)}},"_setHideShowToggleButton":function(e){var i=window.matchMedia("(orientation: landscape)").matches,o=window.matchMedia("(orientation: portrait)").matches,n=e&&e.data&&e.data.view?e.data.view:this;if(n.leftBar=n.options.originatingView&&n.options.originatingView.$el.find(".metadata-sidebar"),n.leftBar&&n.leftBar.length>0){var a=n.leftBar.closest(".metadata-navigation");i?window.innerWidth<=1280?n.sideBarHidden?(n.ui.toggleWrapper instanceof Object&&n.ui.toggleWrapper.removeClass("binf-hidden"),n.ui.backEle instanceof Object&&(n.ui.backEle.css({"display":"inline-block","position":"relative"}),n.ui.backEle.attr("tabindex",0)),this.ensureTitleLabelIcon()):(n._applyToggle(e),n.leftBar.removeClass("binf-hidden"),a.hasClass("csui-hide-side-bar")&&(n.leftBar.show(),a.toggleClass("csui-hide-side-bar"),n.ui.backEle instanceof Object&&n.ui.backEle.hide(),t(window).trigger("resize.tableview")),this.ensureTitleLabelIcon()):(this.sideBarHidden=!1,n._removeToggle(e),a.hasClass("csui-hide-side-bar")&&(n.leftBar.show(),a.toggleClass("csui-hide-side-bar"),n.ui.backEle instanceof Object&&n.ui.backEle.hide()),t(window).trigger("resize.tableview"),this.ensureTitleLabelIcon()):o&&(n._applyToggle(e),n.leftBar.length>0&&(a.hasClass("csui-hide-side-bar")||(n.leftBar.hide(),a.toggleClass("csui-hide-side-bar"),t(window).trigger("resize.tableview")),n.ui.backEle instanceof Object&&(n.ui.backEle.css({"display":"inline-block","position":"relative"}),n.ui.backEle.attr("tabindex",0))),this.ensureTitleLabelIcon())}},"currentlyFocusedElement":function(e){if(this.ui.backEle&&t(this.ui.backEle).is(":visible"))return this.ui.backEle;if(this.ui.toggleIcon&&t(this.ui.toggleIcon).is(":visible"))return this.ui.toggleIcon;if(this.options.mode&&"create"===this.options.mode){var i=t(this.ui.mlGlobeIcon);return e&&e.shiftKey&&i.is(":visible")?i:t(this.ui.nameInput)}return t(this.ui.name)},"onRender":function(){this.editing=!1,this.ui.nameEditDiv.addClass("binf-hidden"),this._nodeIconView&&this._nodeIconView.destroy(),this._nodeIconView=new a({"el":this.$(".csui-type-icon").get(0),"node":this.options.model,"displayThumbnailIcon":!1}),1===this.model.get("type")&&this._nodeIconView.$el.addClass("csui-metadata-shortcut-overlay"),this._nodeIconView.render(),this.dropdownMenuView&&(this.dropdownMenuView.render(),n.triggerMethodOn(this.dropdownMenuView,"before:show",this.dropdownMenuView,this),this.ui.contextMenuDiv.append(this.dropdownMenuView.el),n.triggerMethodOn(this.dropdownMenuView,"show",this.dropdownMenuView,this)),this.modelHasEmptyName&&(this.ui.nameInput.addClass("csui-empty-with-placeholder"),this.ui.nameInput.attr("placeholder",this.placeHolderName),this.readonly&&this.ui.name.addClass("csui-empty-with-placeholder")),this._setHideShowToggleButton(),this._checkAndEnableOrDisableEditing();var e=this,t=e.ui.nameInput,i=e.ui.mlGlobeIcon;this.metadataLanguages.enabled&&!this.model.get("version_id")&&(this.ui.nameInput.addClass("csui-multilingual-input"),e.$el.addClass("binf-hidden"),csui.require(["csui/controls/multilingual.text.picker/multilingual.popover.mixin"],function(o){o.mixin(y.prototype),e.targetElement=t,e.requiredInfoAvilable("name_multilingual").then(function(){e.multiLingualForm&&e.targetElement.binf_popover("destroy");var o={"parentView":e,"targetElement":t,"mlGlobeIcon":i,"validationRequired":!0,"multilingualData":e.model.get("name_multilingual")};e._loadMultiLingualPopover(o),e.$el.removeClass("binf-hidden")})}))},"onMouseEnterName":function(e){this.readonly||(e.preventDefault(),e.stopPropagation())},"onMouseLeaveName":function(e){this.readonly||(e.preventDefault(),e.stopPropagation())},"onKeyDown":function(e){if(this.$el.parents(".cs-item-action-metadata").find("div[class='load-container']").length>0)return!1;this.readonly||this.modelHasEmptyName&&!0!==this.inputBoxNameChange&&(this.setInputBoxValue(""),this.inputBoxNameChange=!0,this.ui.nameInput.removeClass("csui-empty-with-placeholder"))},"_validateAndSave":function(){var e=this.getValue().trim(),t=this.getInputBoxValue();if(t=t.trim(),0===t.length||e!==t||this.model.changed.name_multilingual){if(!0===this.validate(t)){var o=this;this.setInputBoxValue(t),this.setValue(t),this.modelHasEmptyName=!1,this.trigger("metadata:item:name:save",{"sender":this,"success":function(){o._toggleEditMode(!1,!1)},"error":function(t){var n=i.clone(o.prevMultilingualVal);o.setValue(e),o._toggleEditMode(!0),o.showInlineError(t),o.saveMldata&&o.model.set({"name_multilingual":o.prevMultilingualVal}),n&&(o.prevMultilingualVal=i.clone(n))}})}}else this.clearInlineError(),this._toggleEditMode(!1,!1);this.saveMldata=""},"onKeyInView":function(e){if(!this.readonly){if(this.options.mode&&"create"===this.options.mode){var i=t(e.target);return 9===e.keyCode&&this.$el.find(".csui-multilingual-icon").length&&(e.shiftKey&&i.is(this.ui.mlGlobeIcon)||i.is(this.ui.nameInput)&&!e.shiftKey)&&this.ItemNameBehavior.onKeyInView(e),!0}return 9===e.keyCode&&e.shiftKey&&e.stopPropagation(),this.ItemNameBehavior.onKeyInView(e)}},"_toggleEditMode":function(e,t){if("create"!=this.options.mode)return this.ItemNameBehavior._toggleEditMode(e,t)},"getValue":function(){return this.ItemNameBehavior.getValue()},"setValue":function(e){return this.ItemNameBehavior.setValue(e)},"getInputBoxValue":function(){return this.ItemNameBehavior.getInputBoxValue()},"setInputBoxValue":function(e){return this.ItemNameBehavior.setInputBoxValue(e)},"validate":function(e){return this.ItemNameBehavior.validate(e)},"setEditModeFocus":function(){return this.ItemNameBehavior.setEditModeFocus()},"showInlineError":function(e){var t=e;return e instanceof Object&&(t=this._getErrorMessageFromResponse(e)),this.ItemNameBehavior.showInlineError(t)},"clearInlineError":function(){return this.ItemNameBehavior.clearInlineError()},"_getErrorMessageFromResponse":function(e){return this.ItemNameBehavior._getErrorMessageFromResponse(e)},"setReadOnly":function(e){e=!!e;var i;!!this.readonly!==e?(this.readonly=e,this.render(),i=t(this.ui.nameInput).is(":focus"),this._toggleEditMode(i||this.modelHasEmptyName||!1,!1),this.validate()):(i=t(this.ui.nameInput).is(":focus"))||this.validate()},"setPlaceHolder":function(e){e||(e=l.addItemPlaceHolderName),this.placeHolderName!==e&&(this.placeHolderName=e,this.render())},"updateNameSchema":function(e){this.modelHasEmptyName&&""===this.ui.nameInput.val()&&!e.readonly&&(e.required=!0),this._nameSchema=i.extend({"required":!0,"readonly":!1},e),this.readonly=this._nameSchema.readonly,this.render(),this.ui.nameInput[0].placeholder=this.placeHolderName;var o=t(this.ui.nameInput).is(":focus");return this._toggleEditMode(o||this.modelHasEmptyName||!1,!1),this.ItemNameBehavior.updateNameSchema(e)},"onKeyDownGlobeIcon":function(e){13!==e.keyCode&&32!==e.keyCode||this.multiLingualForm&&this.keyDownOnGlobeIcon(e)},"onClickGlobeIcon":function(){this._showLanguagePopover()}});return i.extend(y.prototype,b),y}),csui.define("hbs!csui/widgets/metadata/impl/header/leftbar/header.leftbar",["module","hbs","nuc/lib/handlebars"],function(e,t,i){var o=i.template({"1":function(e,t,i,o,n){var a,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'  <span class="icon arrow_back cs-go-back" aria-label="'+e.escapeExpression((a=null!=(a=s(i,"goBackTooltip")||(null!=t?s(t,"goBackTooltip"):t))?a:e.hooks.helperMissing,"function"==typeof a?a.call(null!=t?t:e.nullContext||{},{"name":"goBackTooltip","hash":{},"loc":{"start":{"line":2,"column":55},"end":{"line":2,"column":72}}}):a))+'"\r\n        title="'+e.escapeExpression((a=null!=(a=s(i,"goBackTooltip")||(null!=t?s(t,"goBackTooltip"):t))?a:e.hooks.helperMissing,"function"==typeof a?a.call(null!=t?t:e.nullContext||{},{"name":"goBackTooltip","hash":{},"loc":{"start":{"line":3,"column":15},"end":{"line":3,"column":32}}}):a))+'"\r\n        role="link"></span>\r\n'},"compiler":[8,">= 4.3.0"],"main":function(e,t,i,o,n){var a,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(a=s(i,"if").call(null!=t?t:e.nullContext||{},null!=t?s(t,"back_button"):t,{"name":"if","hash":{},"fn":e.program(1,n,0),"inverse":e.noop,"loc":{"start":{"line":1,"column":0},"end":{"line":5,"column":7}}}))?a:""}});return i.registerPartial("csui_widgets_metadata_impl_header_leftbar_header.leftbar",o),o}),csui.define("css!csui/widgets/metadata/impl/header/leftbar/header.leftbar",[],function(){}),csui.define("csui/widgets/metadata/impl/header/leftbar/header.leftbar.view",["csui/lib/underscore","csui/lib/jquery","csui/lib/marionette","hbs!csui/widgets/metadata/impl/header/leftbar/header.leftbar","i18n!csui/widgets/metadata/impl/nls/lang","csui/behaviors/keyboard.navigation/tabable.region.behavior","css!csui/widgets/metadata/impl/header/leftbar/header.leftbar"],function(e,t,i,o,n,a){"use strict";return i.ItemView.extend({"className":"metadata-header-left-bar","template":o,"templateHelpers":function(){return{"back_button":this.options.showBackIcon,"goBackTooltip":n.goBackTooltip}},"behaviors":function(){return this.options.showBackIcon?{"TabableRegionBehavior":{"behaviorClass":a}}:{}},"ui":{"back":".cs-go-back"},"events":{"keydown":"onKeyInView","click @ui.back":"onClickClose"},"onKeyInView":function(e){var i=e||window.event,o=i.target||i.srcElement;13!==i.keyCode&&32!==i.keyCode||(i.preventDefault(),i.stopPropagation(),t(o).trigger("click"))},"constructor":function(e){e||(e={}),this.options=e,this.node=this.options.model,i.ItemView.prototype.constructor.call(this,e)},"currentlyFocusedElement":function(){if(this.options.showBackIcon)return t(this.ui.back)},"onClickClose":function(e){e.preventDefault(),e.stopPropagation(),this.trigger("metadata:close")}})}),csui.define("hbs!csui/widgets/metadata/impl/header/rightbar/header.rightbar",["module","hbs","nuc/lib/handlebars"],function(e,t,i){var o=i.template({"1":function(e,t,i,o,n){var a,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'  <div class="binf-row shortcut-div">\r\n    <a href="#" class="shortcut-switch" title="'+e.escapeExpression((a=null!=(a=s(i,"right_label")||(null!=t?s(t,"right_label"):t))?a:e.hooks.helperMissing,"function"==typeof a?a.call(null!=t?t:e.nullContext||{},{"name":"right_label","hash":{},"loc":{"start":{"line":3,"column":47},"end":{"line":3,"column":62}}}):a))+'">'+e.escapeExpression((a=null!=(a=s(i,"right_label")||(null!=t?s(t,"right_label"):t))?a:e.hooks.helperMissing,"function"==typeof a?a.call(null!=t?t:e.nullContext||{},{"name":"right_label","hash":{},"loc":{"start":{"line":3,"column":64},"end":{"line":3,"column":79}}}):a))+"</a>\r\n  </div>\r\n"},"3":function(e,t,i,o,n){var a,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'  <div class="metadata-header-floating-rightbar">\r\n    <span class="icon close cs-metadata-close" title="'+e.escapeExpression((a=null!=(a=s(i,"close_metadata_button_tooltip")||(null!=t?s(t,"close_metadata_button_tooltip"):t))?a:e.hooks.helperMissing,"function"==typeof a?a.call(null!=t?t:e.nullContext||{},{"name":"close_metadata_button_tooltip","hash":{},"loc":{"start":{"line":9,"column":54},"end":{"line":9,"column":87}}}):a))+'"></span>\r\n  </div>\r\n'},"compiler":[8,">= 4.3.0"],"main":function(e,t,i,o,n){var a,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return(null!=(a=s(i,"if").call(null!=t?t:e.nullContext||{},null!=t?s(t,"is_shortcut"):t,{"name":"if","hash":{},"fn":e.program(1,n,0),"inverse":e.noop,"loc":{"start":{"line":1,"column":0},"end":{"line":5,"column":7}}}))?a:"")+'<div class="csui-extra-header-wrapper"></div>\r\n'+(null!=(a=s(i,"if").call(null!=t?t:e.nullContext||{},null!=t?s(t,"show_close_icon"):t,{"name":"if","hash":{},"fn":e.program(3,n,0),"inverse":e.noop,"loc":{"start":{"line":7,"column":0},"end":{"line":11,"column":7}}}))?a:"")}});return i.registerPartial("csui_widgets_metadata_impl_header_rightbar_header.rightbar",o),o}),csui.define("css!csui/widgets/metadata/impl/header/rightbar/header.rightbar",[],function(){}),csui.define("csui/widgets/metadata/impl/header/rightbar/header.rightbar.view",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/lib/marionette","csui/utils/commands","csui/controls/tabletoolbar/tabletoolbar.view","csui/widgets/metadata/impl/header/rightbar/toolbaritems","csui/widgets/metadata/impl/header/rightbar/toolbaritems.masks","csui/controls/mixins/view.events.propagation/view.events.propagation.mixin","hbs!csui/widgets/metadata/impl/header/rightbar/header.rightbar","i18n!csui/widgets/metadata/impl/nls/lang","csui/utils/contexts/factories/application.scope.factory","csui/controls/form/fields/booleanfield.view","csui/behaviors/keyboard.navigation/tabable.region.behavior","css!csui/widgets/metadata/impl/header/rightbar/header.rightbar"],function(e,t,i,o,n,a,s,r,l,d,c,u,m,h){var p=o.LayoutView.extend({"className":"metadata-header-right-bar","template":d,"templateHelpers":function(){var t={"show_close_icon":this.options.showCloseIcon,"close_metadata_button_tooltip":c.closeMetadataButtonTooltip};if(this.options.showShortcutSwitch&&this.options.shortcutNode){var i=c.viewOriginalMessage;return this.options.shortcutNode.original===this.node&&(i=c.viewShortcutMessage),e.extend(t,{"is_shortcut":!0,"right_label":i})}return t},"regions":{"extraToolbarRegion":".csui-extra-header-wrapper"},"behaviors":{"TabableRegion":{"behaviorClass":h}},"ui":{"shortcutSwitchLabel":"a.shortcut-switch","closeIcon":".cs-metadata-close"},"events":{"keydown":"onKeyInView","click @ui.shortcutSwitchLabel":"onClickShortcutSwitch","click @ui.closeIcon":"onClickClose"},"constructor":function(e){e||(e={}),this.options=e,this.node=this.options.model,e.toolbarItemsMasks||(e.toolbarItemsMasks=new r),e.toolbarItems||(e.toolbarItems=s),o.LayoutView.prototype.constructor.call(this,e)},"onRender":function(){this.options.showExtraRightActionBar&&(this.options.parent.$el.addClass("extended-headers"),this._showExtraRightActionBar())},"_showExtraRightActionBar":function(e){var t=this.collection||this.options.model.collection,i=(this.options.container||t)&&t.node?t.node:this.options.model,o=this.options.context&&this.options.context.getModel(u),n=!1;o&&"search"===o.get("id")&&(n=!0),this.toolbarView=new a({"toolbarItems":this.options.toolbarItems,"toolbarItemsMasks":this.options.toolbarItemsMasks,"collection":t,"model":this.options.model,"originatingView":this.options.originatingView,"context":this.options.context,"container":i,"removeContainer":n}),this.extraToolbarRegion.show(this.toolbarView)},"onKeyInView":function(e){var i=e||window.event,o=i.target||i.srcElement;13!==i.keyCode&&32!==i.keyCode||(i.preventDefault(),i.stopPropagation(),setTimeout(function(){t(o).trigger("click")},200))},"currentlyFocusedElement":function(e){var i=this.$("*[tabindex]");return i.length&&i.prop("tabindex",0),t(e&&e.shiftKey?i[i.length-1]:i[0])},"onClickShortcutSwitch":function(e){e.preventDefault(),e.stopPropagation(),this.trigger("shortcut:switch")},"onClickClose":function(e){e.preventDefault(),e.stopPropagation(),this.trigger("metadata:close")}});return e.extend(p.prototype,l),p}),csui.define("hbs!csui/widgets/metadata/impl/header/metadata.header",["module","hbs","nuc/lib/handlebars"],function(e,t,i){var o=i.template({"1":function(e,t,i,o,n){return'\r\n  <div class="metadata-header-left-bar-container"></div>\r\n  <div class="metadata-header with-right-bar"></div>\r\n\r\n'},"3":function(e,t,i,o,n){var a,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"\r\n"+(null!=(a=s(i,"if").call(null!=t?t:e.nullContext||{},null!=t?s(t,"back_button"):t,{"name":"if","hash":{},"fn":e.program(4,n,0),"inverse":e.program(9,n,0),"loc":{"start":{"line":8,"column":2},"end":{"line":26,"column":9}}}))?a:"")+"\r\n"},"4":function(e,t,i,o,n){var a,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'\r\n    <div class="metadata-header-left-bar-container"></div>\r\n\r\n'+(null!=(a=s(i,"if").call(null!=t?t:e.nullContext||{},null!=t?s(t,"show_only_required_fields_switch"):t,{"name":"if","hash":{},"fn":e.program(5,n,0),"inverse":e.program(7,n,0),"loc":{"start":{"line":12,"column":4},"end":{"line":16,"column":11}}}))?a:"")+"\r\n"},"5":function(e,t,i,o,n){return'      <div class="metadata-header with-back-button with-right-bar"></div>\r\n'},"7":function(e,t,i,o,n){return'      <div class="metadata-header with-back-button"></div>\r\n'},"9":function(e,t,i,o,n){var a,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"\r\n"+(null!=(a=s(i,"if").call(null!=t?t:e.nullContext||{},null!=t?s(t,"show_only_required_fields_switch"):t,{"name":"if","hash":{},"fn":e.program(10,n,0),"inverse":e.program(12,n,0),"loc":{"start":{"line":20,"column":4},"end":{"line":24,"column":11}}}))?a:"")+"\r\n"},"10":function(e,t,i,o,n){return'      <div class="metadata-header with-right-bar"></div>\r\n'},"12":function(e,t,i,o,n){return'      <div class="metadata-header"></div>\r\n'},"14":function(e,t,i,o,n){return'  <div class="metadata-header-right-bar-container"></div>\r\n'},"compiler":[8,">= 4.3.0"],"main":function(e,t,i,o,n){var a,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return(null!=(a=s(i,"if").call(null!=t?t:e.nullContext||{},null!=t?s(t,"is_shortcut"):t,{"name":"if","hash":{},"fn":e.program(1,n,0),"inverse":e.program(3,n,0),"loc":{"start":{"line":1,"column":0},"end":{"line":28,"column":7}}}))?a:"")+"\r\n"+(null!=(a=(s(i,"xif")||t&&s(t,"xif")||e.hooks.helperMissing).call(null!=t?t:e.nullContext||{},"this.show_close_icon || this.show_only_required_fields_switch || this.is_shortcut",{"name":"xif","hash":{},"fn":e.program(14,n,0),"inverse":e.noop,"loc":{"start":{"line":30,"column":0},"end":{"line":32,"column":8}}}))?a:"")}});return i.registerPartial("csui_widgets_metadata_impl_header_metadata.header",o),o}),csui.define("css!csui/widgets/metadata/impl/header/metadata.header",[],function(){}),csui.define("csui/widgets/metadata/impl/header/metadata.header.view",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/lib/marionette","csui/widgets/metadata/impl/header/item.name/metadata.item.name.view","csui/controls/mixins/view.events.propagation/view.events.propagation.mixin","csui/widgets/metadata/impl/header/leftbar/header.leftbar.view","csui/widgets/metadata/impl/header/rightbar/header.rightbar.view","hbs!csui/widgets/metadata/impl/header/metadata.header","i18n!csui/widgets/metadata/impl/nls/lang","csui/utils/log","csui/controls/form/fields/booleanfield.view","css!csui/widgets/metadata/impl/header/metadata.header","csui/lib/handlebars.helpers.xif"],function(e,t,i,o,n,a,s,r,l,d,c,u){var m=o.ItemView.extend({"className":"metadata-content-header","template":l,"templateHelpers":function(){var t={"back_button":this.options.showBackIcon,"show_close_icon":this.options.showCloseIcon,"close_metadata_button_tooltip":d.closeMetadataButtonTooltip,"show_only_required_fields_switch":this.options.showRequiredFieldsSwitch,"only_required_fields_label":d.onlyRequiredFieldsLabel};if(this.options.showShortcutSwitch&&this.options.shortcutNode){var i=d.viewOriginalMessage;return this.options.shortcutNode.original===this.node&&(i=d.viewShortcutMessage),e.extend(t,{"is_shortcut":!0,"right_label":i})}return t},"ui":{"leftbar":".metadata-header-left-bar-container","header":".metadata-header","rightbar":".metadata-header-right-bar-container"},"events":{"click .metadata-header":"onClickHeader"},"constructor":function(e){e||(e={}),this.options=e,this.node=this.options.model,this.originatingView=e.originatingView,o.ItemView.prototype.constructor.call(this,e),this._createMetadataHeaderLeftBarView(),this._createMetadataItemNameView(),this._createMetadataHeaderRightBarView()},"_createMetadataHeaderLeftBarView":function(){this.leftbarView&&(this.cancelEventsToViewsPropagation(this.leftbarView),this.leftbarView.destroy());var e=this.leftbarView=new s(this.options);this.listenTo(e,"metadata:close",function(e){this.trigger("metadata:close",e)}),this.propagateEventsToViews(this.leftbarView)},"_createMetadataItemNameView":function(t){this.metadataItemNameView&&(this.cancelEventsToViewsPropagation(this.metadataItemNameView),this.metadataItemNameView.destroy());var i=t||this.node,o=this.metadataItemNameView=new n({"model":i,"container":this.options.container,"containerCollection":this.options.containerCollection,"collection":this.options.collection,"context":this.options.context,"nameSchema":this._getNameSchema(),"commands":this.options.commands,"originatingView":this.options.originatingView,"showDropdownMenu":this.options.showDropdownMenu,"metadataScenario":this.options.metadataScenario,"showPermissionView":this.options.showPermissionView,"mode":this.options.action,"targetView":this.options.targetView});this.listenTo(o,"metadata:item:name:save",function(e){this.trigger("metadata:item:name:save",e)}),this.listenTo(o,"update:button",e.bind(function(e){this.trigger("update:button",e)},this)),this.propagateEventsToViews(this.metadataItemNameView)},"_createMetadataHeaderRightBarView":function(t){this.rightbarView&&(this.cancelEventsToViewsPropagation(this.rightbarView),this.rightbarView.destroy());var i=t||this.node,o=this.rightbarView=new r(e.extend({},this.options,{"model":i,"parent":this,"showExtraRightActionBar":this.options.showExtraRightActionBar}));this.listenTo(o,"shortcut:switch",this.onClickShortcutSwitch),this.listenTo(o,"metadata:close",function(e){this.trigger("metadata:close",e)}),this.propagateEventsToViews(this.rightbarView)},"onRender":function(){var e=this.leftbarView.render();o.triggerMethodOn(e,"before:show",e,this),this.ui.leftbar.append(e.el);var t=this.metadataItemNameView.render();o.triggerMethodOn(t,"before:show",t,this),this.ui.header.append(t.el);var i=this.rightbarView.render();o.triggerMethodOn(i,"before:show",i,this),this.ui.rightbar.append(i.el),this.options.showCloseIcon&&this.$el.addClass("with-close-icon"),this.options.showShortcutSwitch&&this.options.shortcutNode&&this.$el.addClass("shortcut-object"),o.triggerMethodOn(e,"show",e,this),o.triggerMethodOn(t,"show",t,this),o.triggerMethodOn(i,"show",i,this)},"onBeforeDestroy":function(){this.leftbarView&&(this.cancelEventsToViewsPropagation(this.leftbarView),this.leftbarView.destroy()),this.metadataItemNameView&&(this.cancelEventsToViewsPropagation(this.metadataItemNameView),this.metadataItemNameView.destroy()),this.requiredFieldSwitchView&&this.requiredFieldSwitchView.destroy()},"onClickHeader":function(e){e.preventDefault(),e.stopPropagation()},"onClickShortcutSwitch":function(){var e=this.model;e=this.options.shortcutNode&&this.options.shortcutNode.original===this.node?this.node=this.options.shortcutNode:this.node=this.node.original,this._createMetadataItemNameView(e);var t=this.metadataItemNameView.render();o.triggerMethodOn(t,"before:show",t,this),this.ui.header.append(t.el),o.triggerMethodOn(t,"show",t,this),this._createMetadataHeaderRightBarView(e);var i=this.rightbarView.render();o.triggerMethodOn(i,"before:show",i,this),this.ui.rightbar.append(i.el),o.triggerMethodOn(i,"show",i,this);var n=i.currentlyFocusedElement();n&&n.trigger("focus"),this.trigger("shortcut:switch",{"node":e})},"getNameInputBoxValue":function(){return this.metadataItemNameView.getInputBoxValue()},"validateName":function(){var e=this.metadataItemNameView.getInputBoxValue();return this.metadataItemNameView.validate(e)},"getNameValue":function(){return this.metadataItemNameView.getValue()},"setNameEditModeFocus":function(){
this.metadataItemNameView.setEditModeFocus()},"showBackIcon":function(e,t){this.options.showBackIcon=e,this.leftbarView.options.showBackIcon=e,!this.isDestroyed&&t&&this.render()},"_getNameSchema":function(){var e=this.options.collection&&this.options.collection.first(),t=e&&e.get("schema"),i=t&&t.properties&&t.properties.name;return this.options.collection&&t&&!i&&c.warn("Form collection lacks name field in the first form."),i||{}}});return e.extend(m.prototype,a),m}),csui.define("csui/widgets/metadata/property.panels/categories/impl/category.form.view",["module","csui/lib/underscore","csui/lib/jquery","csui/utils/base","csui/utils/url","csui/utils/log","csui/controls/form/form.view","csui/controls/globalmessage/globalmessage","csui/models/appliedcategories/category"],function(e,t,i,o,n,a,s,r,l){"use strict";return a=a(e.id),s.extend({"constructor":function(e){s.prototype.constructor.call(this,e),this.node=this.options.node,this.listenTo(this,"change:field",this._saveField),this.listenTo(this,"disable:active:item",this._disableItem)},"onRequestProcessing":function(e){this.propagatedView=e},"_disableItem":function(e){this.options.metadataView&&this.options.metadataView.trigger("disable:active:item")},"_saveField":function(e){if("create"!==this.mode){var t=this.getValues();this._saveChanges(t)}},"_saveChanges":function(e){if(!this.node)throw new Error("Missing node to save the categories to.");if(this.isDataUpdating=!0,t.keys(e).length){if(this._validate(e)){this._removeInternalProperties(e),this._blockActions();return new l({},{"connector":this.node.connector,"node":this.node,"id":this.model.get("id")}).save(e,{"type":"PUT","processData":!1,"contentType":!1}).done(t.bind(function(t){this._updateMetadataToken(t,e),this.model.set("data",e,{"silent":!0}),this.trigger("forms:sync");var o=i.Event("tab:content:field:changed");this.options.metadataView&&this.options.metadataView.trigger("enable:active:item"),this.$el.trigger(o)},this)).fail(t.bind(function(e){var t=this.model.get("data");this.form.children.forEach(function(e){e.setValue(t[e.propertyId]),e.refresh()});var i=new o.Error(e);r.showMessage("error",i.message),this.trigger("forms:error")},this)).always(t.bind(function(){this.isDataUpdating=!1,this.options.metadataView&&this.options.metadataView.unblockActions&&this.options.metadataView.unblockActions(),this.trigger("request:completed",this.propagatedView),this._unblockActions()},this))}return i.Deferred().reject().promise()}return i.Deferred().resolve().promise()},"_removeInternalProperties":function(e){var t=this.model.get("id"),i=t+"_1",o=this.model.get("schema")||{},n=o.properties&&o.properties[i];if(n){n=n.properties||(n.properties={});var s=e[i]||{};Object.keys(n).forEach(function(e){"metadata_token"===e&&a.debug('Metadata token "{1}" detected in the category "{0}".',t,s[e])&&console.log(a.last),n[e].readonly&&delete s[e]})}},"_updateMetadataToken":function(e,t){var i=this.model.get("id"),o=i+"_1",n=this.model.get("schema")||{},s=n.properties&&n.properties[o];if(s&&(s=s.properties||(s.properties={}),s.metadata_token))try{var r=e.state.categories[0][i].metadata_token;this.form.childrenByPropertyId[o].childrenByPropertyId.metadata_token.setValue(r),t&&(t[o]=r),a.debug('Metadata token in the category "{0}" updated to "{1}".',i,r)&&console.log(a.last)}catch(e){a.warn('Updating metadata token the category "{0}" failed.',i)&&console.log(a.last)}}})}),csui.define("csui/widgets/metadata/metadata.general.form.fields",["csui/lib/underscore","csui/lib/backbone","csui-ext!csui/widgets/metadata/metadata.general.form.fields"],function(e,t,i){var o=t.Model.extend({"defaults":{"sequence":100,"controller":null,"controllerOptions":null},"constructor":function(e,i){t.Model.prototype.constructor.apply(this,arguments)}}),n=t.Collection.extend({"model":o,"comparator":"sequence","constructor":function(e,i){t.Collection.prototype.constructor.apply(this,arguments)}}),a=new n;return i&&(i=e.flatten(i,!0),e.each(i,function(){var e=i.sequence;if(e<10||e>100)throw new Error("Sequence must be greater or equal to 10 and less or equal to 100.")}),a.add(i)),a}),csui.define("css!csui/widgets/metadata/general.form.fields/impl/general.form.fields.view",[],function(){}),csui.define("csui/widgets/metadata/general.form.fields/impl/general.form.fields.view",["csui/lib/underscore","csui/lib/marionette","csui/controls/form/form.view","css!csui/widgets/metadata/general.form.fields/impl/general.form.fields.view"],function(e,t,i){"use strict";return t.CollectionView.extend({"className":"csui-general-form-fields","getChildView":function(t){var o=e.findWhere(this.options.fieldDescriptors,{"formModel":t});return o&&o.formView||i},"childViewOptions":function(t){var i={"context":this.options.context,"node":this.options.node,"mode":this.options.mode,"generalFormView":this.view,"fetchedModels":this.options.fetchedModels,"displayedModels":this.options.displayedModels,"originatingView":this.options.originatingView,"metadataView":this.options.metadataView,"layoutMode":"singleCol"},o=e.findWhere(this.options.fieldDescriptors,{"formModel":t});return o&&e.extend(i,o.formViewOptions),i},"constructor":function(e){t.CollectionView.prototype.constructor.call(this,e),this.listenTo(this,"render",this._triggerRenderForms)},"_triggerRenderForms":function(){var t=this.children.map(function(i){var o=i.cid;return i.once("render:form",function(){t=e.without(t,o),t.length||this.triggerMethod("render:forms",this)},this),i.cid},this)}})}),csui.define("csui/widgets/metadata/general.form.fields/general.form.field.behavior",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/lib/marionette","csui/widgets/metadata/metadata.general.form.fields","csui/widgets/metadata/general.form.fields/impl/general.form.fields.view","csui/dialogs/modal.alert/modal.alert"],function(e,t,i,o,n,a,s){"use strict";return o.Behavior.extend({"constructor":function(t,i){o.Behavior.prototype.constructor.apply(this,arguments),this.view=i,this.listenTo(this.view,"render",this._insertFieldExtensions).listenTo(this.view,"destroy",this._emptyExtensionRegion);var n=this;i.getGeneralFormFieldValues=function(){var t={};return n.fieldRegion&&n.fieldRegion.currentView.children.each(function(i){var o,n,a=i.getValues(),s=i.model.get("role_name");a&&(s?(o=t.roles||(t.roles={}),n=o[s]||(o[s]={}),e.extend(n,a)):e.extend(t,a))}),t}},"_insertFieldExtensions":function(){var t=this.getOption("fieldParent");if(e.isFunction(t)&&(t=t.call(this.view)),t&&(t=this.view.$(t)[0]),t){var n=this.getOption("fieldDescriptors");if(e.isFunction(n)&&(n=n.call(this.view)),n&&n.length){this.fieldRegion=new o.Region({"el":t});var s=this.getOption("fieldViewOptions");e.isFunction(s)&&(s=s.call(this.view));var r=new i.Collection(e.pluck(n,"formModel")),l=new a(e.extend({"context":this.view.options.context,"fieldDescriptors":n,"collection":r,"node":this.view.options.node,"mode":this.view.options.mode,"generalFormView":this.view,"fetchedModels":this.view.options.fetchedModels,"displayedModels":this.view.options.displayedModels,"originatingView":this.view.options.originatingView,"metadataView":this.view.options.metadataView},s));this.listenTo(l,"render:forms",function(){this.view.triggerMethod("render:general:form:fields",l)}),this.fieldRegion.show(l)}}},"_emptyExtensionRegion":function(){this.fieldRegion&&this.fieldRegion.empty()}},{"getFieldDescriptors":function(i){var o,a;"create"===i.action?(o="getGeneralFormFieldsForCreate",a=[{"forms":i.forms}]):"copy"===i.action?(o="getGeneralFormFieldsForCopy",a=[{"forms":i.forms}]):"move"===i.action?(o="getGeneralFormFieldsForMove",a=[{"forms":i.forms}]):"restructure"===i.action?(o="getGeneralFormFieldsForMove",a=[{"forms":i.forms}]):o="getGeneralFormFields";var s=n.chain().map(function(t){var n=t.get("controller"),s=t.get("controllerOptions"),r=new n(e.extend({"context":i.context,"model":i.node,"fetchedModels":i.forms},s)),l=r[o];return l&&l.apply(r,a)}).compact().value();return t.when.apply(t,s).then(function(){return e.flatten(arguments)})}})}),csui.define("csui/widgets/metadata/metadata.general.action.fields",["csui/lib/underscore","csui/lib/backbone","csui-ext!csui/widgets/metadata/metadata.general.action.fields"],function(e,t,i){var o=t.Model.extend({"defaults":{"sequence":100,"controller":null,"controllerOptions":null},"constructor":function(e,i){t.Model.prototype.constructor.apply(this,arguments)}}),n=t.Collection.extend({"model":o,"comparator":"sequence","constructor":function(e,i){t.Collection.prototype.constructor.apply(this,arguments)}}),a=new n;return i&&(i=e.flatten(i,!0),e.each(i,function(){var e=i.sequence;if(e<10||e>100)throw new Error("Sequence must be greater or equal to 10 and less or equal to 100.")}),a.add(i)),a}),csui.define("csui/widgets/metadata/general.action.fields/impl/general.action.fields.view",["csui/lib/underscore","csui/lib/marionette","csui/controls/form/form.view","css!csui/widgets/metadata/general.form.fields/impl/general.form.fields.view"],function(e,t,i){"use strict";return t.CollectionView.extend({"className":"csui-general-action-fields","getChildView":function(t){var o=e.findWhere(this.options.fieldDescriptors,{"formModel":t});return o&&o.formView||i},"childViewOptions":function(t){var i={"context":this.options.context,"node":this.options.node,"mode":this.options.mode,"generalFormView":this.view,"fetchedModels":this.options.fetchedModels,"displayedModels":this.options.displayedModels,"originatingView":this.options.originatingView,"metadataView":this.options.metadataView,"layoutMode":"singleCol"},o=e.findWhere(this.options.fieldDescriptors,{"formModel":t});return o&&e.extend(i,o.formViewOptions),i},"constructor":function(e){t.CollectionView.prototype.constructor.call(this,e),this.listenTo(this,"render",this._triggerRenderForms)},"_triggerRenderForms":function(){var t=this.children.map(function(i){var o=i.cid;return i.once("render:form",function(){t=e.without(t,o),t.length||this.triggerMethod("render:forms",this)},this),i.cid},this)}})}),csui.define("csui/widgets/metadata/general.action.fields/general.action.field.behavior",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/lib/marionette","csui/widgets/metadata/metadata.general.action.fields","csui/widgets/metadata/general.action.fields/impl/general.action.fields.view","csui/dialogs/modal.alert/modal.alert"],function(e,t,i,o,n,a,s){"use strict";return o.Behavior.extend({"constructor":function(t,i){o.Behavior.prototype.constructor.apply(this,arguments),this.view=i,this.listenTo(this.view,"render",this._insertFieldExtensions).listenTo(this.view,"destroy",this._emptyExtensionRegion);var n=this;i.getGeneralActionFieldValues=function(){var t={};return n.fieldRegion&&n.fieldRegion.currentView.children.each(function(i){var o,n,a=i.getValues(),s=i.model.get("role_name");a&&(s?(o=t.roles||(t.roles={}),n=o[s]||(o[s]={}),e.extend(n,a)):e.extend(t,a))}),t}},"_insertFieldExtensions":function(){var t=this.getOption("fieldParent");if(e.isFunction(t)&&(t=t.call(this.view)),t&&(t=this.view.$(t)[0]),t){var n=this.getOption("fieldDescriptors");if(e.isFunction(n)&&(n=n.call(this.view)),n&&n.length){this.fieldRegion=new o.Region({"el":t});var s=this.getOption("fieldViewOptions");e.isFunction(s)&&(s=s.call(this.view));var r=new i.Collection(e.pluck(n,"formModel")),l=new a(e.extend({"context":this.view.options.context,"fieldDescriptors":n,"collection":r,"node":this.view.options.node,"mode":this.view.options.mode,"generalFormView":this.view,"fetchedModels":this.view.options.fetchedModels,"displayedModels":this.view.options.displayedModels,"originatingView":this.view.options.originatingView,"metadataView":this.view.options.metadataView},s));this.listenTo(l,"render:actions",function(){this.view.triggerMethod("render:general:action:fields",l)}),this.fieldRegion.show(l)}}},"_emptyExtensionRegion":function(){this.fieldRegion&&this.fieldRegion.empty()}},{"getFieldDescriptors":function(i){var o,a;"create"===i.action?(o="getGeneralActionFieldsForCreate",a=[{"forms":i.forms}]):"copy"===i.action?(o="getGeneralActionFieldsForCopy",a=[{"forms":i.forms}]):"move"===i.action?(o="getGeneralActionFieldsForMove",a=[{"forms":i.forms}]):"restructure"===i.action?(o="getGeneralActionFieldsForMove",a=[{"forms":i.forms}]):o="getGeneralActionFields";var s=n.chain().map(function(t){var n=t.get("controller"),s=t.get("controllerOptions"),r=new n(e.extend({"context":i.context,"model":i.node,"fetchedModels":i.forms},s)),l=r[o];return l&&l.apply(r,a)}).compact().value();return t.when.apply(t,s).then(function(){return e.flatten(arguments)})}})}),csui.define("csui/widgets/metadata/general.panels/node/server.adaptor.mixin",["csui/lib/underscore","csui/lib/backbone","csui/utils/nodesprites","csui/controls/table/cells/size/size.view","csui/utils/base","csui/utils/url","csui/models/form","csui/models/version","csui/models/mixins/node.resource/node.resource.mixin","i18n!csui/widgets/metadata/impl/nls/lang"],function(e,t,i,o,n,a,s,r,l,d){"use strict";var c={"makeServerAdaptor":function(e){return this},"url":function(){var t,i=this.options.node,o=i.get("id");return t=void 0===o?e.str.sformat("forms/nodes/create?type={0}&parent_id={1}",i.get("type"),i.get("parent_id")):i instanceof r?e.str.sformat("forms/nodes/versions/properties/general?id={0}&version_number={1}",o,i.get("version_number")):e.str.sformat("forms/nodes/properties/general?id={0}",o),a.combine(this.connector.connection.url,t)},"parse":function(t,i){this.node||(this.node=i.node);var o=e.extend({"data":{},"schema":{},"options":{}},i.response||t.form||t.forms&&t.forms[0]||t),n=o.title||this.get("title")||d.general;return o.options=e.omit(o.options,"form"),o.schema.title||(o.schema.title=n),o.title||(o.title=n),this._addCreatorInfo(o,i),this._addOwnerInfo(o,i),this._addCreateDateInfo(o,i),this._addModifyDateInfo(o,i),this._addMimeTypeInfo(o,i),this._addSizeInfo(o,i),this._addItemidInfo(o,i),this._ensurePlaceholder(o,i),this._addReserveInfo(o,i),this._addMimeTypeClassNameInfo(o,i),this._addSystemAttributes(o,i),o},"_addSizeInfo":function(t,i){this.options.node.get("type");this.sizeView=new o({"model":this.options.node,"column":{"name":this.options.node.has("size")?"size":"file_size"}});e.extend(t.data,{"size":this.sizeView.getValueData().formattedValue||this.options.node.get("size_formatted")});e.extend(t.options.fields,{"size":{"hidden":!1,"readonly":!0,"label":d.formFieldSizeLabel,"placeholder":d.alpacaPlaceholderNotAvailable,"type":"text"}}),e.extend(t.schema.properties,{"size":{"hidden":!1,"readonly":!0,"title":d.formFieldSizeLabel,"type":"string"}})},"_addItemidInfo":function(t,i){if(this.node){this.options.node.get("type"),e.extend(t.data,{"itemId":this.node.get("id")});e.extend(t.options.fields,{"itemId":{"hidden":!1,"readonly":!0,"label":d.formFieldItemIdLabel,"placeholder":d.alpacaPlaceholderNotAvailable,"type":"text"}}),e.extend(t.schema.properties,{"itemId":{"hidden":!1,"readonly":!0,"label":d.formFieldItemIdLabel,"placeholder":d.alpacaPlaceholderNotAvailable,"type":"text","tooltip":this.node.get("id")}})}},"_addCreateDateInfo":function(e,t){e.options.fields.create_date&&(e.options.fields.create_date.type="datetime",e.options.fields.create_date.placeholder=d.alpacaPlaceholderNotAvailable,e.schema.properties.create_date.format="datetime")},"_addModifyDateInfo":function(e,t){e.options.fields.modify_date&&(e.options.fields.modify_date.type="datetime",e.options.fields.modify_date.placeholder=d.alpacaPlaceholderNotAvailable,e.schema.properties.modify_date.format="datetime")},"_addOwnerInfo":function(e,t){var i="owner_user_id";if(this.node instanceof r&&(i="owner_id"),e.options.fields[i]){var o=-3===this.node.get("owner_user_id"),a=o?{"id":-3}:this.node.get("owner_user_id_expand")||this.node.get("owner_user_id")||this.node.get("owner_id");a&&a instanceof Object&&(e.data[i]=a.id,e.options.fields[i].type="otcs_user",e.options.fields[i].type_control={"name":o?d.NoOwner:n.formatMemberName(a)},e.options.fields[i].placeholder=d.alpacaPlaceholderNotAvailable)}},"_addCreatorInfo":function(e,t){if(e.options.fields.create_user_id){var i=this.node.get("create_user_id_expand")||this.node.get("create_user_id");i&&i instanceof Object&&(e.data.create_user_id=i.id,e.options.fields.create_user_id.type="otcs_user",e.options.fields.create_user_id.type_control={"name":n.formatMemberName(i)},e.options.fields.create_user_id.placeholder=d.alpacaPlaceholderNotAvailable)}},"_addMimeTypeInfo":function(t,o){var n=(this.options.node.get("type"),this.options.node);e.extend(t.data,{"mime_type":i.findTypeByNode(n)}),e.extend(t.options.fields,{"mime_type":{"hidden":!1,"readonly":!0,"label":d.formFieldTypeLabel,"placeholder":d.alpacaPlaceholderNotAvailable,"type":"text"}}),e.extend(t.schema.properties,{"mime_type":{"hidden":!1,"readonly":!0,"title":d.formFieldTypeLabel,"type":"string"}})},"_addMimeTypeClassNameInfo":function(t,o){var n=(this.options.node.get("type"),this.options.node);e.extend(t.data,{"mimeTypeClassName":i.findClassByNode(n)})},"_ensurePlaceholder":function(e,t){if(e.options.fields.description){var i=e.options.fields.description;void 0!==i.placeholder&&0!==i.placeholder.length||(i.placeholder=d.alpacaPlaceholderDescription)}},"_addReserveInfo":function(t,i){e.extend(t.data,{"reserve_info":this.options.node.get("reserved")?this:void 0});e.extend(t.options.fields,{"reserve_info":{"hidden":!1,"readonly":!0,"label":d.formFieldReservedByLabel,"type":"otcs_reserve_button"}}),e.extend(t.schema.properties,{"reserve_info":{"hidden":!1,"readonly":!0,"type":"otcs_reserve_button"}})},"_addSystemAttributes":function(e,t){var i=this.options.node.systemattributes,o=this;void 0!==i&&(Object.keys(i.data).forEach(function(t){e.data[t]=i.data[t],e.options.fields[t]=i.options.fields[t],e.schema.properties[t]=i.schema.properties[t]}),void 0!==e.data.metadata_token&&e.data.metadata_token.length>0&&o.options.node.state.set("metadata_token",e.data.metadata_token))}};return{"mixin":function(t){return e.extend(t,c)}}}),csui.define("csui/widgets/metadata/general.panels/node/node.general.form.model",["csui/lib/jquery","csui/lib/underscore","csui/models/form","csui/models/mixins/node.resource/node.resource.mixin","csui/widgets/metadata/general.panels/node/server.adaptor.mixin","i18n!csui/widgets/metadata/impl/nls/lang"],function(e,t,i,o,n,a){"use strict";var s=i.extend({"defaults":{"id":"general"},"constructor":function(e,t){i.prototype.constructor.apply(this,arguments),this.makeNodeResource(t).makeServerAdaptor(t)}});return o.mixin(s.prototype),n.mixin(s.prototype),s}),csui.define("csui/widgets/metadata/general.panels/document/document.general.form.model",["csui/lib/underscore","csui/utils/base","csui/controls/table/cells/size/size.view","csui/widgets/metadata/general.panels/node/node.general.form.model","i18n!csui/widgets/metadata/impl/nls/lang"],function(e,t,i,o,n){"use strict";return o.extend({"constructor":function(e,t){o.prototype.constructor.apply(this,arguments)},"parse":function(e,t){var i=o.prototype.parse.apply(this,arguments);return this._addSizeInfo(i,t),i},"_addSizeInfo":function(o,a){var s=(this.options.node.get("type"),this.options.node.has("size")),r=(s?"":"file_")+"size";this.sizeView=new i({"model":this.options.node,"column":{"name":r}});var l=this.sizeView.getValueData().formattedValue;e.extend(o.data,{"size":l||t.getReadableFileSizeString(this.options.node.get("size"))});e.extend(o.options.fields,{"size":{"hidden":!1,"readonly":!0,"label":n.formFieldSizeLabel,"placeholder":n.alpacaPlaceholderNotAvailable,"type":"text"}}),e.extend(o.schema.properties,{"size":{"hidden":!1,"readonly":!0,"title":n.formFieldSizeLabel,"type":"string","tooltip":this.sizeView.getValueData().value}})}})}),csui.define("hbs!csui/widgets/metadata/general.panels/node/impl/node.general.form",["module","hbs","nuc/lib/handlebars"],function(e,t,i){var o=i.template({"compiler":[8,">= 4.3.0"],"main":function(e,t,i,o,n){return'<div class="binf-row">\r\n  {{#if options.label}}\r\n  <div class="binf-col-md-12 alpaca-container-label">\r\n    <h4>{{options.label}}</h4>\r\n  </div>\r\n  {{/if}}\r\n  <div class="metadata-pane-container">\r\n    <div class="metadata-pane-left binf-col-md-6  cs-form-doublecolumn cs-form-leftcolumn">\r\n      {{#if options.showitemId}}\r\n      <div class="owner_section general-information"></div>\r\n      {{/if}}\r\n      <div class="typename_section general-information"></div>\r\n      {{#if options.showSize}}\r\n      <div class="size_section general-information"></div>\r\n      {{/if}}\r\n      <div class="systemattributes_section general-information"></div>\r\n      <div class="reserve_info general-information"></div>\r\n      <div class="csui-extra-general-fields"></div>\r\n      <div class="csui-action-fields"></div>\r\n    </div>\r\n    <div class="metadata-pane-right binf-col-md-6 cs-form-doublecolumn cs-form-rightcolumn">\r\n      <div class="metadata-tab">\r\n        {{#if options.showThumbnail}}\r\n        <div class="thumbnail_section metadata-preview preview-section" title="{{options.title}}">\r\n          <span class="default_thumbnail thumbnail_empty" data-cstabindex="0" role="button"\r\n                aria-label="{{options.aria_label}}"></span>\r\n        </div>\r\n        {{/if}}\r\n        <div class="description_section general-information"></div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n'}});return i.registerPartial("csui_widgets_metadata_general.panels_node_impl_node.general.form",o),o}),csui.define("css!csui/widgets/metadata/general.panels/node/impl/node.general.form",[],function(){}),csui.define("csui/widgets/metadata/general.panels/node/node.general.form.view",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/controls/form/form.view","csui/behaviors/default.action/default.action.behavior","csui/widgets/metadata/general.form.fields/general.form.field.behavior","csui/widgets/metadata/general.action.fields/general.action.field.behavior","csui/models/version","csui/controls/globalmessage/globalmessage","csui/models/appliedcategories/systemattributes.model","hbs!csui/widgets/metadata/general.panels/node/impl/node.general.form","i18n!csui/widgets/metadata/impl/nls/lang","csui/utils/base","i18n","csui/utils/contexts/factories/next.node","csui/utils/commands","csui/utils/commands/versions","csui/utils/url","css!csui/widgets/metadata/general.panels/node/impl/node.general.form"],function(e,t,i,o,n,a,s,r,l,d,c,u,m,h,p,g,f,w){"use strict";return o.extend({"behaviors":{"defaultAction":{"behaviorClass":n},"generalFormFields":{"behaviorClass":a,"fieldParent":".csui-extra-general-fields","fieldDescriptors":function(){return this.options.generalFormFieldDescriptors},"fieldViewOptions":function(){return{"context":this.options.context,"node":this.node,"mode":this.options.mode,"originatingView":this,"metadataView":this.options.metadataView}}},"generalActionFields":{"behaviorClass":s,"fieldParent":".csui-action-fields","fieldDescriptors":function(){return this.options.generalActionFieldDescriptors},"fieldViewOptions":function(){return{"context":this.options.context,"node":this.node,"mode":this.options.mode,"originatingView":this,"metadataView":this.options.metadataView}}}},"className":"cs-form csui-general-form","fieldToRefresh":["modify_date","reserve_info"],"constructor":function(i){o.prototype.constructor.call(this,i),this.node=this.options.node,this.fieldToRefresh=e.union(this.fieldToRefresh,i.fieldToRefresh||[]),this.listenTo(this,"change:field",this._saveField),this.listenTo(this.node,"change",e.bind(function(){"create"!==this.mode&&this.model.fetch();var e=t.Event("tab:content:field:changed");this.$el.trigger(e)},this)),this.listenTo(this,"before:destroy",this._stopListeningToThumbnailClick),this.listenTo(this,"update:scrollbar",this.updateScrollbar),this.defaultActionController.getAction(this.options.node)||(this.noDefaultActionExist=!0),this.mlDataAvailable=m.getMetadataLanguageInfo().enabled},"formTemplate":c,"onRequestProcessing":function(e){this.propagatedView=e},"updateScrollbar":function(){this.$el.closest(".binf-tab-content").scrollTop(0)},"formTemplateHelpers":function(){var t=this.node.get("type_name"),i=this.node.get("name");return{"showThumbnail":"create"!==this.mode,"showitemId":null!==this.model.get("data").itemId&&void 0!==this.model.get("data").itemId&&""!==this.model.get("data").itemId,"showSize":this.model.get("data").size&&""!==this.model.get("data").size||this.model.get("data").size_formatted&&""!==this.model.get("data").size_formatted,"reserved":this.node.get("reserved"),"title":this.noDefaultActionExist?"":e.str.sformat(u.openDoc,t),"showShortcutSection":!(this.options.metadataView.options.model.original&&(void 0===this.options.metadataView.options.model.original.get("type")||this.options.metadataView.options.model.original.get("type")<0)||!this.options.metadataView.options.model.get("original_id")),"aria_label":this.noDefaultActionExist?"":e.str.sformat(u.openDocAria,t,i)}},"_getLayout":function(){return this.alpaca.options.fields.description&&(this.alpaca.options.fields.description.isTextareaAutoHeight=!0,this.mlDataAvailable&&(this.alpaca.options.fields.description.type="otcs_multilingual_textarea",this.alpaca.options.fields.description.keyAttribute="description_multilingual")),{"parent":"bootstrap-csui","layout":{"template":this.getOption("formTemplate").call(this,{"data":this.alpaca.data,"mode":this.mode}),"bindings":this._getBindings()}}},"_getBindings":function(){var t={"name":"name_section","create_date":".owner_section","create_user_id":".owner_section","modify_date":".owner_section","owner_user_id":".owner_section","mime_type":".typename_section","description":".description_section","itemId":".owner_section","size":".size_section"};if(this.node.get("reserved")&&(t=e.extend(t,{"reserve_info":".reserve_info"})),this.node.systemattributes){var i=this.node.systemattributes;Object.keys(i.data).forEach(function(e){t[e]=".systemattributes_section"})}return this.node instanceof r&&(t=e.extend(t,{"version_number_name":".owner_section","owner_id":".owner_section"})),t},"_saveField":function(t){if("create"!==this.mode){var i=t.targetField,o={},n=m.getMetadataLanguageInfo().defaultLanguage;if(o[i.name]=this.mlDataAvailable&&e.isObject(i.value)?i.value[n]:i.value,t&&t.fieldView&&t.fieldView.mlDataChanged&&t.fieldView.alpacaField&&"otcs_multilingual_textarea"===t.fieldView.alpacaField.type){var a=t.fieldView.keyAttribute,s=t.model&&t.model.node&&t.model.node.get(a);a&&(o[a]=s)}this._saveChanges(o)}},"_saveChanges":function(t){var i=this.model.options.node,o=this,n=o.options.metadataView&&o.options.metadataView.thumbnailViewState,a=this._checkSystemAttributeFields(t),s=a?this._systemAttributesSave(t,i):this._nodesave(t,i,n);this.isDataUpdating=!0,s.then(function(){if(a){var n=i.systemattributes,s=e.toArray(Object.keys(t));n.data[s[0]]=o.changes[s[0]]}return i.fetch()}).fail(function(e){var t=o.model.get("data");o.form.children.forEach(function(e){e.setValue(t[e.propertyId]),e.refresh()});var i=new m.Error(e);l.showMessage("error",i.message),o.trigger("forms:error"),o.alpaca.options.fields.description&&o.alpaca.options.fields.description.isTextareaAutoHeight&&o.trigger("update:scrollbar")}).always(e.bind(function(){this.isDataUpdating=!1,this.options.metadataView&&this.options.metadataView.unblockActions&&this.options.metadataView.unblockActions(),this.trigger("request:completed",this.propagatedView),this._unblockActions()},this))},"updateRenderedForm":function(e){this.updateReserveFieldDisplay(),o.prototype.updateRenderedForm.apply(this,arguments),this._showDefaultImage(),this._listenToThumbnailClick(),this.$(".thumbnail_section").on("focusin",function(e){m.checkAndScrollElemToViewport(e.currentTarget)});var t=this.options.generalFormFieldDescriptors;t&&t.length&&this.listenToOnce(this,"render:general:form:fields",e.async())},"setFocus":function(){var e=this.$form.find(".alpaca-field:not(.alpaca-readonly) button");e.length>0&&e.first().trigger("focus")},"updateForm":function(){(this.node.isReservedClicked||this.node.isUnreservedClicked)&&(this.render(),this.node.isReservedClicked=!1,this.node.isUnreservedClicked=!1);var e=this.$el.alpaca("get"),t=!!this.node.collection&&!!this.node.collection.requireSwitched;if(e)for(var i=this.model.get("data"),o=0;o<this.fieldToRefresh.length;o++){var n=e.childrenByPropertyId[this.fieldToRefresh[o]],a=i[this.fieldToRefresh[o]];n&&n.getValue()!==a&&!t&&(n.setValue(a),n.refresh())}return this.thumbnail&&(this.thumbnail.imgUrl||this.thumbnail.node&&this.thumbnail.node.get("csuiThumbnailImageUrl"))||this._showDefaultImage(),this.updateReserveFieldDisplay(),this},"updateReserveFieldDisplay":function(){var e=this.$el.find(".reserve_info");this.node.get("reserved")?e.hasClass("binf-hidden")&&e.removeClass("binf-hidden"):e.hasClass("binf-hidden")||e.addClass("binf-hidden")},"_showDefaultImage":function(){var e=this.$el.find(".default_thumbnail"),i="thumbnail_missing";this.options&&this.options.model.get("data")&&(i=this.options.model.get("data").mimeTypeClassName),e.addClass(i),e.removeClass("thumbnail_empty");var o=t.Event("tab:content:render");this.$el.trigger(o),this.noDefaultActionExist&&this.$el.find(".default_thumbnail").addClass("thumbnail_disabled")},"_listenToThumbnailClick":function(){this._stopListeningToThumbnailClick(),this._thumbnailClickHandler=e.bind(this._handleThumbnailClick,this),this.$(".thumbnail_section").on("click",this._thumbnailClickHandler)},"_stopListeningToThumbnailClick":function(){this._thumbnailClickHandler&&(this.$(".thumbnail_section").off("click",this._thumbnailClickHandler),this._thumbnailClickHandler=void 0)},"_handleThumbnailClick":function(){var e,t=this.options.context,o=this.options.node,n={"nodes":new i.Collection([o])},a={"context":t,"originatingView":this};if(o instanceof r)return e=f.get("VersionOpen"),e.execute(n,a);if(e=g.get("Open"),e.enabled(n,a))return e.execute(n,a);var s=this.options.context.getModel(p);if(o.get("container")&&o.get("id")===s.get("id"))return void(this.options.metadataView&&this.options.metadataView._closeMetadata());this.triggerMethod("execute:DefaultAction",o)},"_checkSystemAttributeFields":function(t){var i=this.node&&this.node.systemattributes,o=i&&i.options&&i.options.fields,n=o&&e.toArray(Object.keys(o)),a=e.toArray(Object.keys(t));return e.contains(n,a[0])},"_nodesave":function(e,t,i){return t.save(e,{"wait":!0,"silent":i,"patch":!0})},"_systemAttributesSave":function(e,i){t.Deferred(),i.connector;return this.changes=e,new d({},{"connector":this.node.connector,"node":this.node,"id":i.get("id")}).save(e,{"type":"PUT","processData":!1,"contentType":!1})}})}),csui.define("hbs!csui/widgets/metadata/general.panels/document/impl/document.general.form",["module","hbs","nuc/lib/handlebars"],function(e,t,i){var o=i.template({"compiler":[8,">= 4.3.0"],"main":function(e,t,i,o,n){
return'<div class="binf-row">\r\n  {{#if options.label}}\r\n  <div class="binf-col-md-12 alpaca-container-label">\r\n    <h4>{{options.label}}</h4>\r\n  </div>\r\n  {{/if}}\r\n  <div class="metadata-pane-container">\r\n\r\n    <div class="metadata-pane-left binf-col-md-6  cs-form-doublecolumn cs-form-leftcolumn">\r\n      {{#if options.showitemId}}\r\n      <div class="owner_section general-information"></div>\r\n      {{/if}}\r\n      <div class="typename_section general-information"></div>\r\n      {{#if options.showSize}}\r\n      <div class="size_section general-information"></div>\r\n      {{/if}}\r\n      <div class="systemattributes_section general-information"></div>\r\n      <div class="reserve_info general-information"></div>\r\n      <div class="csui-extra-general-fields"></div>\r\n    </div>\r\n    <div class="metadata-pane-right binf-col-md-6 cs-form-doublecolumn cs-form-rightcolumn">\r\n      <div class="metadata-tab">\r\n        {{#if options.showThumbnail}}\r\n        <div class="thumbnail_section metadata-preview preview-section" title="{{options.title}}">\r\n          <span class="thumbnail_not_loaded thumbnail_empty" data-cstabindex="0" role="button"\r\n                aria-label="{{options.aria_label}}"></span>\r\n          <img src="{{options.imgSrc}}" class="img-doc-preview binf-hidden"\r\n               alt="{{options.imgAlt}}">\r\n        </div>\r\n        {{/if}}\r\n        <div class="description_section general-information"></div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n'}});return i.registerPartial("csui_widgets_metadata_general.panels_document_impl_document.general.form",o),o}),csui.define("css!csui/widgets/metadata/general.panels/document/impl/document.general.form",[],function(){}),csui.define("csui/widgets/metadata/general.panels/document/document.general.form.view",["csui/lib/underscore","csui/lib/jquery","csui/utils/thumbnail/thumbnail.object","csui/widgets/metadata/general.panels/node/node.general.form.view","hbs!csui/widgets/metadata/general.panels/document/impl/document.general.form","i18n!csui/widgets/metadata/impl/nls/lang","css!csui/widgets/metadata/general.panels/document/impl/document.general.form"],function(e,t,i,o,n,a){"use strict";return o.extend({"constructor":function(e){o.prototype.constructor.call(this,e),this.thumbnail=this.options.thumbnail||new i({"node":this.options.node}),this.listenTo(this.thumbnail,"loadUrl",this._showImage).listenTo(this.thumbnail,"error",this._showDefaultImage).listenTo(this,"destroy",function(){this.thumbnail.destroy()})},"formTemplate":n,"fieldToRefresh":["modify_date","reserve_info","mime_type","size"],"formTemplateHelpers":function(){var t=this.node.get("type_name"),i=this.node.get("name");return{"showThumbnail":"create"!==this.mode,"title":e.str.sformat(a.openDoc,t),"showitemId":null!==this.model.get("data").itemId&&void 0!==this.model.get("data").itemId&&""!==this.model.get("data").itemId,"showSize":this.model.get("data").size&&""!==this.model.get("data").size||this.model.get("data").size_formatted&&""!==this.model.get("data").size_formatted,"aria_label":e.str.sformat(a.openDocAria,t,i),"reserved":this.node.get("reserved"),"imgSrc":"data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=","imgAlt":a.docPreviewAlt}},"_getBindings":function(){var t=o.prototype._getBindings.apply(this,arguments);return e.extend(t,{"size":".size_section"})},"updateRenderedForm":function(e){if(o.prototype.updateRenderedForm.apply(this,arguments),"create"!==this.mode){this.thumbnail.imgUrl||this.thumbnail.node.get("csuiThumbnailImageUrl")?this._showImage():this.thumbnail.loadUrl()}},"_showImage":function(){var e=this,i=this.$el.find(".img-doc-preview"),o=this.$el.find(".thumbnail_not_loaded");i.attr("src",this.thumbnail.imgUrl||this.thumbnail.node.get("csuiThumbnailImageUrl")),i.prop("tabindex","0"),i.one("load",function(n){n.target.clientHeight>=n.target.clientWidth?i.addClass("cs-form-img-vertical"):i.addClass("cs-form-img-horizontal"),i.addClass("cs-form-img-border"),o.addClass("binf-hidden"),i.removeClass("binf-hidden");var a=t.Event("tab:content:render");e.$el.trigger(a)})},"_showDefaultImage":function(){var i=this.$el.find(".img-doc-preview"),o=this.$el.find(".thumbnail_not_loaded"),n="thumbnail_missing";this.options&&this.options.model.get("data")&&(n=this.options.model.get("data").mimeTypeClassName),!!o.prop("className")&&o.prop("className").split(" ").forEach(e.bind(function(e){0===e.indexOf("mime")&&o.removeClass(e)},o)),o.addClass(n),o.removeClass("thumbnail_empty"),o.removeClass("csui-icon-notification-error"),o.removeClass("binf-hidden"),i.addClass("binf-hidden");var a=t.Event("tab:content:render");this.$el.trigger(a)}})}),csui.define("csui/widgets/metadata/general.panels/shortcut/shortcut.general.form.model",["csui/lib/underscore","csui/widgets/metadata/general.panels/node/node.general.form.model","csui/models/specificnodemodel","csui/models/mixins/syncable.from.multiple.sources/syncable.from.multiple.sources.mixin"],function(e,t,i,o){"use strict";var n=t.extend({"constructor":function(e,i){t.prototype.constructor.apply(this,arguments),this.makeSyncableFromMultipleSources(i)},"_mergeSources":function(t,i){var o=t[0].forms[0],n=i[0].forms[0];e.extend(n.data,o.data),e.extend(n.options.fields,o.options.fields),e.extend(n.schema.properties,o.schema.properties),n.options=e.omit(n.options,"form"),this.set(n)},"sync":function(){var e=new i(this.node.attributes,{"connector":this.connector,"node":this.node,"context":this.options.context}),o=new t(this.node.attributes,{"connector":this.connector,"node":this.options.node,"context":this.options.context}),n=e.fetch(),a=o.fetch(),s={"parse":!1};return this.syncFromMultipleSources([n,a],this._mergeSources,s)}});return o.mixin(n.prototype),n}),csui.define("hbs!csui/widgets/metadata/general.panels/shortcut/impl/shortcut.general.form",["module","hbs","nuc/lib/handlebars"],function(e,t,i){var o=i.template({"compiler":[8,">= 4.3.0"],"main":function(e,t,i,o,n){return'<div class="binf-row">\r\n  {{#if options.label}}\r\n  <div class="binf-col-md-12 alpaca-container-label">\r\n    <h4>{{options.label}}</h4>\r\n  </div>\r\n  {{/if}}\r\n  <div class="metadata-pane-container">\r\n    <div class="metadata-pane-left binf-col-md-6  cs-form-doublecolumn\r\n    cs-form-leftcolumn">\r\n      {{#if options.showitemId}}\r\n      <div class="owner_section general-information"></div>\r\n      {{/if}}\r\n      <div class="typename_section general-information"></div>\r\n      <div class="systemattributes_section general-information"></div>\r\n      <div class="csui-extra-general-fields"></div>\r\n    </div>\r\n    <div class="metadata-pane-right binf-col-md-6 cs-form-doublecolumn cs-form-rightcolumn">\r\n      <div class="metadata-tab">\r\n        {{#if options.showThumbnail}}\r\n        <div class="thumbnail_section metadata-preview preview-section" title="{{options.title}}">\r\n          <span class="default_thumbnail thumbnail_empty" data-cstabindex="0" role="button"\r\n                aria-label="{{options.title}}"></span>\r\n        </div>\r\n        {{/if}}\r\n        {{#if options.showShortcutSection}}\r\n        <div class="shortcut_section general-information"></div>\r\n        {{/if}}\r\n        <div class="description_section general-information"></div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n'}});return i.registerPartial("csui_widgets_metadata_general.panels_shortcut_impl_shortcut.general.form",o),o}),csui.define("css!csui/widgets/metadata/general.panels/shortcut/impl/shortcut.general.form",[],function(){}),csui.define("csui/widgets/metadata/general.panels/shortcut/shortcut.general.form.view",["csui/lib/underscore","csui/widgets/metadata/general.panels/node/node.general.form.view","csui/utils/contexts/factories/node","hbs!csui/widgets/metadata/general.panels/shortcut/impl/shortcut.general.form","css!csui/widgets/metadata/general.panels/shortcut/impl/shortcut.general.form"],function(e,t,i,o){"use strict";return t.extend({"constructor":function(e){t.prototype.constructor.call(this,e),e.context&&e.node&&e.node.original&&e.node.original.get("id")>0&&e.context.getModel(i,{"attributes":{"id":e.node.original.get("id")},"node":e.node.original,"temporary":!0})},"formTemplate":o,"_getBindings":function(){var i=t.prototype._getBindings.apply(this,arguments);return e.extend(i,{"original_id":".shortcut_section"})}})}),csui.define("csui/widgets/metadata/general.panels/url/url.general.form.model",["csui/lib/jquery","csui/lib/underscore","csui/widgets/metadata/general.panels/node/node.general.form.model","csui/models/specificnodemodel","csui/models/mixins/syncable.from.multiple.sources/syncable.from.multiple.sources.mixin","i18n!csui/widgets/metadata/impl/nls/lang"],function(e,t,i,o,n,a){"use strict";var s=i.extend({"constructor":function(e,t){i.prototype.constructor.apply(this,arguments),this.makeSyncableFromMultipleSources(t)},"_mergeSources":function(e,i){var o=e[0].forms[0],n=i[0].forms[0];t.extend(n.data,o.data),t.extend(n.options.fields,o.options.fields),t.extend(n.schema.properties,o.schema.properties),n.options=t.omit(n.options,"form"),this.set(n)},"sync":function(){var e=new o(this.node.attributes,{"connector":this.connector,"node":this.node,"context":this.options.context}),t=new i(this.node.attributes,{"connector":this.connector,"node":this.options.node,"context":this.options.context}),n=e.fetch(),a=t.fetch(),s={"parse":!1};return this.syncFromMultipleSources([n,a],this._mergeSources,s)}});return n.mixin(s.prototype),s}),csui.define("hbs!csui/widgets/metadata/general.panels/url/impl/url.general.form",["module","hbs","nuc/lib/handlebars"],function(e,t,i){var o=i.template({"compiler":[8,">= 4.3.0"],"main":function(e,t,i,o,n){return'<div class="binf-row">\r\n  {{#if options.label}}\r\n  <div class="binf-col-md-12 alpaca-container-label">\r\n    <h4>{{options.label}}</h4>\r\n  </div>\r\n  {{/if}}\r\n  <div class="metadata-pane-container">\r\n    <div class="metadata-pane-left binf-col-md-6  cs-form-doublecolumn\r\n    cs-form-leftcolumn">\r\n      {{#if options.showitemId}}\r\n      <div class="owner_section general-information"></div>\r\n      {{/if}}\r\n      <div class="typename_section general-information"></div>\r\n      <div class="systemattributes_section general-information"></div>\r\n      <div class="csui-extra-general-fields"></div>\r\n    </div>\r\n    <div class="metadata-pane-right binf-col-md-6 cs-form-doublecolumn cs-form-rightcolumn">\r\n      <div class="metadata-tab">\r\n        {{#if options.showThumbnail}}\r\n        <div class="thumbnail_section metadata-preview preview-section" title="{{options.title}}">\r\n          <span class="default_thumbnail thumbnail_empty" data-cstabindex="0" role="button"\r\n                aria-label="{{options.title}}"></span>\r\n        </div>\r\n        {{/if}}\r\n        <div class="url_section general-information"></div>\r\n        <div class="description_section general-information"></div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n'}});return i.registerPartial("csui_widgets_metadata_general.panels_url_impl_url.general.form",o),o}),csui.define("css!csui/widgets/metadata/general.panels/url/impl/url.general.form",[],function(){}),csui.define("csui/widgets/metadata/general.panels/url/url.general.form.view",["csui/lib/underscore","csui/widgets/metadata/general.panels/node/node.general.form.view","hbs!csui/widgets/metadata/general.panels/url/impl/url.general.form","css!csui/widgets/metadata/general.panels/url/impl/url.general.form"],function(e,t,i){"use strict";return t.extend({"constructor":function(e){t.prototype.constructor.call(this,e)},"formTemplate":i,"_getBindings":function(){var i=t.prototype._getBindings.apply(this,arguments);return e.extend(i,{"url":".url_section"})}})}),csui.define("csui/widgets/metadata/metadata.general.panels",["csui/lib/underscore","csui/lib/backbone","csui/widgets/metadata/general.panels/document/document.general.form.model","csui/widgets/metadata/general.panels/document/document.general.form.view","csui/widgets/metadata/general.panels/node/node.general.form.model","csui/widgets/metadata/general.panels/node/node.general.form.view","csui/widgets/metadata/general.panels/shortcut/shortcut.general.form.model","csui/widgets/metadata/general.panels/shortcut/shortcut.general.form.view","csui/widgets/metadata/general.panels/url/url.general.form.model","csui/widgets/metadata/general.panels/url/url.general.form.view","csui/models/mixins/rules.matching/rules.matching.mixin","csui-ext!csui/widgets/metadata/metadata.general.panels"],function(e,t,i,o,n,a,s,r,l,d,c,u){"use strict";var m=t.Model.extend({"defaults":{"sequence":100,"contentModel":null,"contentView":null,"contentViewOptions":null},"constructor":function(e,i){t.Model.prototype.constructor.apply(this,arguments),this.makeRulesMatching(i)}});c.mixin(m.prototype);var h=t.Collection.extend({"model":m,"comparator":"sequence","constructor":function(e,i){t.Collection.prototype.constructor.apply(this,arguments)},"findByNode":function(e){return this.find(function(t){return t.matchRules(e,t.attributes)})}}),p=new h([{"equals":{"type":[144,749]},"contentModel":i,"contentView":o,"sequence":100},{"equals":{"type":[1,2]},"contentModel":s,"contentView":r,"sequence":100},{"equals":{"type":140},"contentModel":l,"contentView":d,"sequence":100},{"contentModel":n,"contentView":a,"sequence":1e4}]);return u&&p.add(e.flatten(u,!0)),p}),csui.define("csui/widgets/metadata/property.panels/general/metadata.general.property.controller",["csui/lib/underscore","csui/lib/jquery","csui/lib/marionette","csui/models/form","csui/controls/form/form.view","csui/widgets/metadata/metadata.general.panels"],function(e,t,i,o,n,a){"use strict";return i.Controller.extend({"constructor":function(e){i.Controller.prototype.constructor.apply(this,arguments)},"getPropertyPanels":function(i){var o,n,a,s,r={"connector":this.connector,"node":this.options.model,"context":this.options.context};return i.forms&&i.forms.models&&(o=e.find(i.forms.models,function(e){return void 0===e.get("role_name")}))&&(r.response=i.forms.models[0].attributes,r.parse=!0),n=this._getGeneralPanel(),a=new n.model(o,r),s=[{"model":a,"contentView":n.contentView,"contentViewOptions":n.contentViewOptions}],o?t.Deferred().resolve(s).promise():a.fetch().then(function(){return s})},"getPropertyPanelsForCreate":function(e){var i=this._getGeneralPanel(),o=t.Deferred(),n=e.forms.findWhere({"id":"general"});if(!n)throw new Error("General form missing.");return n=new i.model(n.attributes,{"connector":this.connector,"node":this.options.model,"parse":!0}),o.resolve([{"model":n,"contentView":i.contentView,"contentViewOptions":i.contentViewOptions}]).promise()},"getPropertyPanelsForMove":function(e){return this._getPropertyPanelsForMoveAndCopy(e)},"getPropertyPanelsForCopy":function(e){return this._getPropertyPanelsForMoveAndCopy(e)},"_getPropertyPanelsForMoveAndCopy":function(e){var t=this._getGeneralPanel(),i=new t.model(void 0,{"connector":this.connector,"node":this.options.model});return i.fetch().then(function(){return[{"model":i,"contentView":t.contentView,"contentViewOptions":t.contentViewOptions}]})},"_getGeneralPanel":function(){var e=a.findByNode(this.options.model);return{"model":e.get("contentModel")||o,"contentView":e.get("contentView")||n,"contentViewOptions":e.get("contentViewOptions")}}})}),csui.define("csui/widgets/metadata/metadata.property.panels",["csui/lib/underscore","csui/lib/backbone","csui/widgets/metadata/property.panels/general/metadata.general.property.controller","csui-ext!csui/widgets/metadata/metadata.property.panels"],function(e,t,i,o){var n=t.Model.extend({"defaults":{"sequence":100,"controller":null,"controllerOptions":null},"constructor":function(e,i){t.Model.prototype.constructor.apply(this,arguments)}}),a=t.Collection.extend({"model":n,"comparator":"sequence","constructor":function(e,i){t.Collection.prototype.constructor.apply(this,arguments)}}),s=new a([{"sequence":10,"controller":i}]);return o&&(o=e.flatten(o,!0),e.each(o,function(){var e=o.sequence;if(e<10||e>100)throw new Error("Sequence must be greater or equal to 10 and less or equal to 100.")}),s.add(o)),s}),csui.define("hbs!csui/widgets/metadata/impl/add.properties/add.properties.dropdown.menu",["module","hbs","nuc/lib/handlebars"],function(e,t,i){var o=i.template({"compiler":[8,">= 4.3.0"],"main":function(e,t,i,o,n){var a,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="binf-dropdown">\r\n  <button id="'+e.escapeExpression((a=null!=(a=s(i,"btnId")||(null!=t?s(t,"btnId"):t))?a:e.hooks.helperMissing,"function"==typeof a?a.call(null!=t?t:e.nullContext||{},{"name":"btnId","hash":{},"loc":{"start":{"line":2,"column":14},"end":{"line":2,"column":23}}}):a))+'" type="button" class="binf-btn binf-dropdown-toggle"\r\n          data-binf-toggle="dropdown" aria-haspopup="true" aria-expanded="false"\r\n          aria-label="'+e.escapeExpression((a=null!=(a=s(i,"addTitleTooltip")||(null!=t?s(t,"addTitleTooltip"):t))?a:e.hooks.helperMissing,"function"==typeof a?a.call(null!=t?t:e.nullContext||{},{"name":"addTitleTooltip","hash":{},"loc":{"start":{"line":4,"column":22},"end":{"line":4,"column":41}}}):a))+'" title="'+e.escapeExpression((a=null!=(a=s(i,"addTitleTooltip")||(null!=t?s(t,"addTitleTooltip"):t))?a:e.hooks.helperMissing,"function"==typeof a?a.call(null!=t?t:e.nullContext||{},{"name":"addTitleTooltip","hash":{},"loc":{"start":{"line":4,"column":50},"end":{"line":4,"column":69}}}):a))+'">\r\n    <span class="csui-button-icon icon-toolbarAdd" title="'+e.escapeExpression((a=null!=(a=s(i,"addTitleTooltip")||(null!=t?s(t,"addTitleTooltip"):t))?a:e.hooks.helperMissing,"function"==typeof a?a.call(null!=t?t:e.nullContext||{},{"name":"addTitleTooltip","hash":{},"loc":{"start":{"line":5,"column":58},"end":{"line":5,"column":77}}}):a))+'"></span>\r\n  </button>\r\n  <ul class="binf-dropdown-menu" role="menu"></ul>\r\n</div>\r\n<div class="csui-loading-parent-wrapper binf-disabled binf-hidden">\r\n  <span class="csui-loading-dots-wrapper">\r\n    <span class="csui-loading-dot"></span>\r\n    <span class="csui-loading-dot"></span>\r\n    <span class="csui-loading-dot"></span>\r\n  </span>\r\n</div>\r\n'}});return i.registerPartial("csui_widgets_metadata_impl_add.properties_add.properties.dropdown.menu",o),o}),csui.define("css!csui/widgets/metadata/impl/add.properties/add.properties.dropdown.menu",[],function(){}),csui.define("csui/widgets/metadata/impl/add.properties/add.properties.dropdown.menu.view",["module","csui/lib/jquery","csui/lib/underscore","csui/lib/backbone","csui/lib/marionette","csui/utils/log","csui/controls/toolbar/toolitem.view","csui/controls/progressblocker/blocker","csui/models/nodes","csui/controls/toolbar/toolitems.filtered.model","csui/utils/commands","csui/behaviors/dropdown.menu/dropdown.menu.behavior","hbs!csui/widgets/metadata/impl/add.properties/add.properties.dropdown.menu","i18n!csui/widgets/metadata/impl/nls/lang","css!csui/widgets/metadata/impl/add.properties/add.properties.dropdown.menu","csui/lib/binf/js/binf"],function(e,t,i,o,n,a,s,r,l,d,c,u,m,h){"use strict";return a=a(e.id),n.CompositeView.extend({"className":"metadata-add-properties","template":m,"templateHelpers":function(){return{"btnId":i.uniqueId("addPropertiesButton"),"addTitleTooltip":1===this.collection.length?this.collection.at(0).get("name"):h.addNewProperties}},"childView":s,"childViewContainer":"ul.binf-dropdown-menu","childViewOptions":function(e){return{"noMenuRoles":void 0}},"behaviors":{"DropdownMenuBehavior":{"behaviorClass":u}},"constructor":function(e){e||(e={}),this.context=e.context,this.commands=e.commands||c,this.node=e.node,this.container=e.container,this.formCollection=e.collection,this.originalFormCollection=e.formCollection,this.listenTo(this.formCollection,"reset",this._updateMenuItems),this.originatingView=e.originatingView,e.blockingParentView?r.delegate(this,e.blockingParentView):r.imbue(this);var a={"nodes":new l([e.node]),"container":e.container,"formCollection":this.formCollection,"originalFormCollection":this.originalFormCollection,"context":e.context},s=e.toolbarItems.addPropertiesToolbar;e.collection=new d(s,{"status":a,"commands":this.commands,"delayedActions":e.containerCollection&&e.containerCollection.delayedActions,"mask":e.toolbarItemsMask}),n.CompositeView.prototype.constructor.apply(this,arguments),e.el&&t(e.el).addClass(i.result(this,"className")),this.listenTo(this,"childview:toolitem:action",this._triggerMenuItemAction).listenTo(this.node.actions,"sync update",this._reRender).listenTo(o,"closeToggleAction",this._closeToggle),e.containerCollection&&e.containerCollection.delayedActions&&this.listenTo(e.containerCollection.delayedActions,"sync",this._reRender),this.listenTo(this.node,"sync change",function(){this.node.set("csuiAddPropertiesActionsRetrieved",!1,{"silent":!0})})},"_updateMenuItems":function(){this.collection.refilter()},"_reRender":function(){!this._isRendered||this._isRendering||this.isDestroyed||(this._updateMenuItems(),this.render())},"onRender":function(){this._isRendering||(this._isRendering=!0,this._ensureLazyActionsRetrieved().always(i.bind(function(){this._isRendering=!1},this)).done(i.bind(function(){var e=this.$el.find(".binf-dropdown-toggle");if(this.collection.length<1||!0===this.options.suppressAddProperties)this.$el.addClass("binf-hidden"),e.attr("data-cstabindex","-1");else if(this.$el.find(".binf-dropdown").removeClass("binf-hidden"),this.$el.removeClass("binf-hidden"),e.attr("data-cstabindex","0"),1===this.collection.length){var o=this.collection.at(0).get("name");e.attr({"aria-haspopup":!1,"aria-label":o,"title":o}),e.find(".icon-toolbarAdd").attr("title",o)}this.collection.length>1&&e.binf_dropdown(),this.$el.find(".binf-dropdown").off("click."+this.cid).on("click."+this.cid,i.bind(this._onClickAddButton,this)),e.off("click."+this.cid).on("click."+this.cid,i.bind(this._onClickAddButton,this));var n=this;setTimeout(function(){var e=t.Event("tab:content:render");n.$el.trigger(e)},200)},this)).fail(i.bind(function(){this.$el.addClass("binf-hidden"),this.$el.find(".binf-dropdown-toggle").attr("data-cstabindex","-1")},this)))},"_closeToggle":function(){if(!0!==this.options.suppressAddProperties){var e=this.$el.find(".binf-dropdown-toggle");e.parent().hasClass("binf-open")&&e.binf_dropdown("toggle",!1)}},"_onClickAddButton":function(e){1===this.collection.length&&(o.trigger("closeToggleAction"),e.preventDefault(),e.stopPropagation(),this._executeAction(this.collection.at(0)))},"_triggerMenuItemAction":function(e,t){this.$el.find(".binf-dropdown-toggle").binf_dropdown("toggle"),this._executeAction(t.toolItem)},"_executeAction":function(e){var t=e.get("signature"),o=this.commands.get(t),n={"action":this.options.action,"node":this.options.node,"collection":this.formCollection,"container":this.options.container,"inheritance":this.options.inheritance,"context":this.options.context,"parentView":this.options.parentView,"addPropertiesCallback":this.options.addPropertiesCallback},s={"context":this.options.context,"nodes":new l([this.node]),"container":this.options.container,"formCollection":this.formCollection,"originalFormCollection":this.originalFormCollection,"originatingView":this.originatingView};try{if(!o)throw new Error('Command "'+t+'" not found.');var r=this.$el.find(".binf-dropdown");r.addClass("binf-disabled"),o.execute(s,n).done(i.bind(function(e){r.removeClass("binf-disabled"),r.closest(".tab-links").find(".tab-links-bar ul li.binf-active a").trigger("focus")},this)).fail(function(e){r.removeClass("binf-disabled"),e&&e.cancelled&&r.find(".binf-btn.binf-dropdown-toggle").trigger("focus")})}catch(e){a.warn('Executing the command "{0}" failed.\n{1}',o.get("signature"),e.message)&&console.warn(a.last)}},"_ensureLazyActionsRetrieved":function(){var e,o=t.Deferred(),n=this.options.node,a=!!n.get("csuiLazyActionsRetrieved"),s=!!n.get("csuiAddPropertiesActionsRetrieved"),r=!n.get("id"),l=n.nonPromotedActionCommands,d=a&&s;if(this.options.toolbarItems&&l&&!n.lazyActionsDisabled)if(a)s||(e=c.getSignatures(this.options.toolbarItems));else{var u=c.getSignatures(this.options.toolbarItems);u.length&&(e=l=n.nonPromotedActionCommands=i.union(u,n.nonPromotedActionCommands))}if(n&&!r&&!d&&e&&e.length){var m=this;this.$el.find(".binf-dropdown").addClass("binf-hidden"),this.$el.find(".csui-loading-parent-wrapper").removeClass("binf-hidden"),function(){return a?s?t.Deferred().reject().promise():n.getAdditionalActionCommands(e,"csuiAddPropertiesActionsRetrieved"):n.setEnabledLazyActionCommands(!0)}().done(function(){setTimeout(function(){m.$el.find(".csui-loading-parent-wrapper").addClass("binf-hidden"),m._updateMenuItems(),o.resolve()},300)}).fail(function(){m.$el.find(".binf-dropdown").removeClass("binf-hidden"),o.reject()})}else o.resolve();return o.promise()}})}),csui.define("csui/widgets/metadata/add.properties.menuitems",["csui/lib/underscore","csui/utils/base","i18n!csui/widgets/metadata/impl/nls/lang","csui/controls/toolbar/toolitems.factory","csui/controls/toolbar/toolitem.model","csui-ext!csui/widgets/metadata/add.properties.menuitems","csui-ext!csui/widgets/metadata/add.properties/toolbaritems"],function(e,t,i,o,n,a,s){"use strict";function r(t){e.each(t,function(t){e.each(t,function(t,i){var o=l[i];if(!o)throw new Error("Invalid target toolbar: "+i);e.each(t,function(e){e=new n(e),o.addItem(e)})})})}var l={"addPropertiesToolbar":new o({"add":[{"signature":"AddCategory","name":i.addNewCategory}]},{"maxItemsShown":0})};return s&&r(s),a&&r(a),l}),csui.define("csui/widgets/metadata/add.properties.menuitems.mask",["module","csui/lib/underscore","csui/controls/toolbar/toolitems.mask","csui/utils/toolitem.masks/global.toolitems.mask"],function(e,t,i,o){"use strict";return i.extend({"constructor":function(){var n=e.config(),a=new o;i.prototype.constructor.call(this,a,{"normalize":!1}),t.each(n,function(e,t){this.extendMask(e)},this),this.storeMask()}})}),csui.define("hbs!csui/widgets/metadata/impl/tab.contents.header/tab.contents.header",["module","hbs","nuc/lib/handlebars"],function(e,t,i){var o=i.template({"compiler":[8,">= 4.3.0"],"main":function(e,t,i,o,n){var a,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="csui-tab-contents-header-content">\r\n  <div class="csui-tab-contents-header-right">\r\n    <div class="required-field-switch binf-hidden">\r\n        <span id="'+e.escapeExpression((a=null!=(a=s(i,"requiredFieldsLabelId")||(null!=t?s(t,"requiredFieldsLabelId"):t))?a:e.hooks.helperMissing,"function"==typeof a?a.call(null!=t?t:e.nullContext||{},{"name":"requiredFieldsLabelId","hash":{},"loc":{"start":{"line":4,"column":18},"end":{"line":4,"column":43}}}):a))+'" class="only-required-fields-label"\r\n              title="'+e.escapeExpression((a=null!=(a=s(i,"onlyRequiredFieldsLabel")||(null!=t?s(t,"onlyRequiredFieldsLabel"):t))?a:e.hooks.helperMissing,"function"==typeof a?a.call(null!=t?t:e.nullContext||{},{"name":"onlyRequiredFieldsLabel","hash":{},"loc":{"start":{"line":5,"column":21},"end":{"line":5,"column":48}}}):a))+'">'+e.escapeExpression((a=null!=(a=s(i,"onlyRequiredFieldsLabel")||(null!=t?s(t,"onlyRequiredFieldsLabel"):t))?a:e.hooks.helperMissing,"function"==typeof a?a.call(null!=t?t:e.nullContext||{},{"name":"onlyRequiredFieldsLabel","hash":{},"loc":{"start":{"line":5,"column":50},"end":{"line":5,"column":77}}}):a))+'</span>\r\n      <div class="required-fields-switch"></div>\r\n    </div>\r\n  </div>\r\n  <h4>General</h4>\r\n</div>\r\n'}});return i.registerPartial("csui_widgets_metadata_impl_tab.contents.header_tab.contents.header",o),o}),csui.define("css!csui/widgets/metadata/impl/tab.contents.header/tab.contents.header",[],function(){}),csui.define("csui/widgets/metadata/impl/tab.contents.header/tab.contents.header.view",["require","csui/lib/jquery","csui/lib/underscore","csui/lib/backbone","csui/lib/marionette","csui/controls/form/pub.sub","csui/models/version","i18n!csui/widgets/metadata/impl/nls/lang","hbs!csui/widgets/metadata/impl/tab.contents.header/tab.contents.header","css!csui/widgets/metadata/impl/tab.contents.header/tab.contents.header","csui/lib/binf/js/binf"],function(e,t,i,o,n,a,s,r,l){"use strict";return n.ItemView.extend({"tagName":"div","className":"csui-tab-contents-header","template":l,"ui":{"leftTabContentsHeader":".csui-tab-contents-header-content","rightTabContentsHeader":".csui-tab-contents-header-right","tabContentsHeaderTitle":".csui-tab-contents-header-content h4","requiredSwitchEle":".required-field-switch","requiredSwitchIcon":".required-field-switch > div.required-fields-switch"},"events":{"click @ui.requiredSwitchIcon":"onClickRequiredIconDiv","keydown":"onKeyInView"},"constructor":function(){n.ItemView.prototype.constructor.apply(this,arguments),this.pubsubPostFix=(this.options.node instanceof s?"v":"p")+this.options.node.get("id"),this.requiredFieldsLabelId=i.uniqueId("requiredFields");var e="pubsub:tab:contents:header:view:change:tab:title:"+this.pubsubPostFix;a.off(e),this.listenTo(a,e,this._changeTabTitle),this.listenTo(this.collection,"add",function(e){!!e.get("required")&&this._showRequiredSwitch()}),this.listenTo(this.collection,"remove",function(e){this.isRequiredCatPresent()||this._hideRequiredSwitch()}),this.listenTo(this,"metadata:schema:updated",function(e){this.isRequiredCatPresent()?this._showRequiredSwitch():this._hideRequiredSwitch()},this)},"templateHelpers":function(){return{"onlyRequiredFieldsLabel":r.onlyRequiredFieldsLabel,"requiredFieldsLabelId":this.requiredFieldsLabelId}},"_changeTabTitle":function(e){this.$(this.ui.tabContentsHeaderTitle).html(e).attr("title",e)},"onRender":function(){this.requiredFieldSwitchModel=new o.Model({"data":!!this.options.node.collection.requireSwitched});var e=this;csui.require(["csui/controls/form/fields/booleanfield.view"],function(t){e.requiredFieldSwitchView=new t({"mode":"writeonly","model":e.requiredFieldSwitchModel,"labelId":e.requiredFieldsLabelId}),e.requiredFieldSwitchView.render(),e.listenTo(e.requiredFieldSwitchView,"field:changed",function(t){var i="pubsub:tab:contents:header:view:switch:"+e.pubsubPostFix;a.trigger(i,{"on":t.fieldvalue}),e.options.node.collection&&(e.options.node.collection.requireSwitched=t.fieldvalue)}),e.$(".required-fields-switch").append(e.requiredFieldSwitchView.$el),e.isRequiredCatPresent()&&e._showRequiredSwitch(),a.off("pubsub:header:rightbar:view:change:switch:status"),e.listenTo(a,"pubsub:header:rightbar:view:change:switch:status",function(t){t?e.requiredFieldSwitchView.curVal&&e.requiredFieldSwitchView.$el.trigger("click"):e.requiredFieldSwitchModel&&void 0!==e.requiredFieldSwitchModel.get("data")&&!e.requiredFieldSwitchModel.get("data")&&e.options.node&&e.options.node.collection&&e.options.node.collection.requireSwitched&&e.requiredFieldSwitchView.$el.trigger("click")})})},"currentlyFocusedElement":function(e){return!this.ui.requiredSwitchEle.hasClass("binf-hidden")&&this.requiredFieldSwitchView?t(this.ui.requiredSwitchIcon.find(":input")):void 0},"onKeyInView":function(e){var o=e||window.event,n=o.target||o.srcElement;32!==o.keyCode&&13!==o.keyCode||!this.ui.requiredSwitchEle.hasClass("binf-hidden")&&this.requiredFieldSwitchView&&(o.preventDefault(),o.stopPropagation(),setTimeout(i.bind(function(){t(n).trigger("click")},this),200))},"onClickRequiredIconDiv":function(e){this.requiredFieldSwitchView.onClickWriteField(e)},"_hideRequiredSwitch":function(){this.ui.tabContentsHeaderTitle.addClass("csui-tab-contents-header-title-full-width"),this.ui.requiredSwitchEle.addClass("binf-hidden"),!!this.requiredFieldSwitchView&&!!this.requiredFieldSwitchView.getValue()&&this.requiredFieldSwitchView.ui.flagWriteField.trigger("click")},"_showRequiredSwitch":function(){this.ui.tabContentsHeaderTitle.removeClass("csui-tab-contents-header-title-full-width"),this.ui.requiredSwitchEle.removeClass("binf-hidden")},
"isRequiredCatPresent":function(){if(this.options.hideRequiredFieldsSwitch)return!1;for(var e=!1,t=0;!e&&t<this.collection.models.length;t++)e=!0===this.collection.models[t].get("required");return e}})}),csui.define("csui/widgets/metadata/impl/metadata.properties.view",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/lib/marionette","csui/utils/url","csui/utils/base","csui/controls/tab.panel/tab.panel.view","csui/controls/tab.panel/tab.links.ext.view","csui/controls/tab.panel/tab.links.ext.scroll.mixin","csui/models/form","csui/controls/form/form.view","csui/utils/commands/compound.document/compound.document.util","csui/widgets/metadata/property.panels/categories/impl/category.form.view","csui/models/appliedcategories","csui/widgets/metadata/impl/metadata.forms","csui/dialogs/modal.alert/modal.alert","csui/controls/progressblocker/blocker","csui/models/version","csui/widgets/metadata/impl/metadata.utils","i18n","csui/controls/tile/behaviors/perfect.scrolling.behavior","csui/widgets/metadata/general.form.fields/general.form.field.behavior","csui/widgets/metadata/general.action.fields/general.action.field.behavior","i18n!csui/widgets/metadata/impl/nls/lang","csui/widgets/metadata/metadata.property.panels","csui/widgets/metadata/impl/add.properties/add.properties.dropdown.menu.view","csui/widgets/metadata/add.properties.menuitems","csui/widgets/metadata/add.properties.menuitems.mask","csui/widgets/metadata/impl/tab.contents.header/tab.contents.header.view","csui/controls/form/pub.sub","csui/widgets/metadata/impl/metadata.tabcontentcollection.view","csui/models/appliedcategories/appliedcategoriesaction","csui/utils/deepClone/deepClone"],function(e,t,i,o,n,a,s,r,l,d,c,u,m,h,p,g,f,w,b,v,y,_,x,V,T,C,I,k,M,A,F,S){var E=s.extend({"className":function(){var e=(a.isTouchBrowser()?"cs-touch-browser ":"")+"cs-metadata-properties binf-panel binf-panel-default";return e+=this.options&&this.options.topAlignLabel?" csui-top-align-label":""},"rtlEnabled":v.settings.rtl,"contentView":function(t){var i=e.findWhere(this._propertyPanels,{"model":t});return i?i.contentView||c:"categories"===t.get("role_name")?m:c},"contentViewOptions":function(t){var i={"context":this.options.context,"node":this.options.node,"mode":this.options.formMode,"fetchedModels":this.allForms,"displayedModels":this.collection,"originatingView":this,"layoutMode":"doubleCol","metadataView":this.options.metadataView,"generalFormFieldDescriptors":this._generalFormFieldDescriptors,"generalActionFieldDescriptors":this._generalActionFieldDescriptors},o=e.findWhere(this._propertyPanels,{"model":t});return o&&e.extend(i,o.contentViewOptions),i},"isTabable":function(){return!0!==this.options.notTabableRegion},"constructor":function(o){o||(o={});var n;if(n=a.isTouchBrowser()?"category_delete-touch-browser":"category_delete",e.defaults(o,{"tabType":"binf-nav-pills","mode":"spy","extraScrollTopOffset":3,"formMode":"update","toolbar":!0,"toolbarItems":I,"delete_icon":n,"delete_tooltip":V.removeCategoryTooltip,"contentView":this.getContentView,"TabLinkCollectionViewClass":r,"TabContentCollectionViewClass":F,"searchTabContentForTabableElements":!0,"tabContentAccSelectors":"a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[data-cstabindex], *[contenteditable]"}),this.context=o.context,o.toolbarItemsMask||(o.toolbarItemsMask=new k),this.behaviors=e.extend({"PerfectScrolling":{"behaviorClass":y,"contentParent":"> .binf-tab-content","scrollXMarginOffset":30,"scrollYMarginOffset":15}},this.behaviors),o.collection)this.allForms=o.collection;else{var l=o.node,d=l.get("enforcedRequiredAttrsForFolders"),c=l;d&&(c=l.clone(),c.set("type",144)),this.allForms=new p(void 0,{"node":c,"connector":o.node.connector,"container":o.container,"action":o.action,"inheritance":o.inheritance,"autoreset":!0,"formCollection":o.formCollection}),o.collection=new i.Collection}void 0===o.node.newCategories&&(o.node.newCategories=new i.Collection),void 0===o.node.removedCategories&&(o.node.removedCategories=[]),s.prototype.constructor.apply(this,arguments),this.widths=[],this.options.blockingParentView?f.delegate(this,this.options.blockingParentView):f.imbue(this),A.off("pubsub:tab:contents:panel:textarea:scrollupdate"),this.listenTo(A,"pubsub:tab:contents:panel:textarea:scrollupdate",this._updateToTextAreaScrollbar),this.listenTo(this.allForms,"request",this.blockActions).listenTo(this.allForms,"request",this._checkFormFetching).listenTo(this.allForms,"sync",this._syncForms).listenTo(this.allForms,"sync",this.unblockActions).listenTo(this.allForms,"destroy",this.unblockActions).listenTo(this.allForms,"error",this.unblockActions).listenTo(this.collection,"reset",this.render).listenTo(o.node,"change:id",function(){"create"===this.options.formMode||this._fetchingForms||this.isDestroyed||this._fetchForms()}).listenTo(this,"reset:switch",this._resetRequiredSwitchView).listenTo(this,"update:button",e.bind(function(e){this.options.metadataView&&this.options.metadataView.trigger("update:button",{"overlay":e})},this)),this.allForms.fetching&&this.blockActions(),t(window).on("resize",{"view":this},this._onWindowResize),t(window).on("resize.tableview",{"view":this},this._onWindowResize),this.listenTo(this,"render",this.onRendered),this.listenTo(i,"metadata:schema:updated",function(e){this.resolveHasRequiredFields(e),this.has_required_fields=this.collection.filter(function(e){return!0===e.get("required")}),this.tabLinks.trigger("metadata:schema:updated",e),this.tabContentHeader.trigger("metadata:schema:updated",e)},this)},"onBeforeDestroy":function(){t(window).off("resize",this._onWindowResize),t(window).off("resize.tableview",this._onWindowResize),this.addPropertiesView&&(this.cancelEventsToViewsPropagation(this.addPropertiesView),this.addPropertiesView.destroy()),this.contentHeaderRegion&&this.contentHeaderRegion.empty()},"_updateScrollbar":function(){this.trigger("update:scrollbar"),this.$(this.behaviors.PerfectScrolling.contentParent).animate({"scrollTop":0},"fast")},"_updateToTextAreaScrollbar":function(e){this.trigger("update:scrollbar");var t=e.$el.offset().top-this.$(this.behaviors.PerfectScrolling.contentParent).offset().top;this.$(this.behaviors.PerfectScrolling.contentParent).scrollTop()>0&&this.$(this.behaviors.PerfectScrolling.contentParent).animate({"scrollTop":t},"fast")},"_getModelFromCollectionByTitle":function(t){if(t&&e.isString(t)&&this.collection)return this.collection.find({"title":t})},"_getModelIndex":function(e,t){var i=-1;if(this.collection&&this.collection.length>0){var o,n;for(o=0;o<this.collection.length;o++)if(n=this.collection.at(o),e===n.get("id")||t===n.get("title")){i=o;break}}return i},"_activateTab":function(e){var t=this._getModelFromCollectionByTitle(e)||e;if(t&&t instanceof i.Model){var o=this._getModelIndex(t.get("id"),t.get("title"));-1!==o&&this._activateTabByIndex(o)}},"_activateTabByIndex":function(e){this.options.activeTab.set("tabIndex",e),this.tabLinks.children.findByIndex(e).activate(!0)},"_activateSelectedPropertyTab":function(){var e=this._getModelFromCollectionByTitle(this.options.selectedProperty)||this.options.selectedProperty;if(e&&e instanceof i.Model){var t=this._getModelIndex(e.get("id"),e.get("title"));-1!==t&&(this.options.activeTab.set("tabIndex",t),this.tabLinks.children.findByIndex(t).activate())}},"render":function(){var t=!0;if(this.allForms.fetched||this.allForms.error||(t=!1,this._fetchingForms||this._fetchForms()),!1===t||this._fetchingForms)return this;if(1===this.collection.length){var i=this.collection.first(),o=e.clone(i.get("schema"));o.title="",i.set("schema",o)}var n=this;return this.collection.each(function(e,t){n.resolveHasRequiredFields.call(n,e)&&(n.hasRequiredField=!0)}),e.extend(this,{"_":e}),s.prototype.render.apply(this),this._createAddPropertiesView(),this._initializeOthers(),this},"resolveHasRequiredFields":function(e){var t=new b,i=t.AlpacaFormOptionsSchemaHaveRequiredFields(e.get("options"),e.get("schema"),e.get("id"));return e.set("required",i),i},"onDestroy":function(){this._fetchingForms&&this.unblockActions()},"onRendered":function(){this._setTablinksAttributes(),setTimeout(e.bind(this._setTablinksAttributes,this),300),this.tabLinks.stopListening(this.collection,"reset"),this.tabContent.stopListening(this.collection,"reset"),this.tabContentHeader&&(this.tabContentHeader.destroy(),this.$el.find(".csui-tab-contents-header-wrapper").remove()),this.listenTo(this.tabLinks,"childview:delete:tab",e.bind(this._onDeleteCategory,this)),this.tabLinks.$el.addClass("binf-hidden"),this.tabContent.$el.addClass("binf-hidden"),this.blockActions(),this.updateTitle=!0;var i=[],n=this;this.tabContent.children.each(e.bind(function(e){var o=t.Deferred();i.push(o.promise());var n=e.content;n instanceof c&&!n.isRenderFinished()?this.listenTo(n,"render:form",function(e){var t=e.$el.find(".cs-form-singlecolumn")?e.$el.find(".cs-form-singlecolumn"):e.$el.find(".cs-form-doublecolumn");t&&t.length>0?t.html()&&o.resolve():o.resolve()}):o.resolve()},this)),t.when.apply(t,i).done(function(){if(n.unblockActions(),n.tabLinks.$el.removeClass("binf-hidden"),!n.options.hideStickyHeader){var e=n.options.node instanceof w?"v":"p";e="pubsub:tab:contents:header:view:switch:"+e+n.options.node.get("id"),A.off(e),n.listenTo(A,e,n._onRequiredSwitch),n.tabContent.$el.before("<div class='csui-tab-contents-header-wrapper'></div>"),n.contentHeaderRegion=new o.Region({"el":n.$el.find(".csui-tab-contents-header-wrapper")}),n.tabContentHeader=new M(n.options),n.contentHeaderRegion.show(n.tabContentHeader)}if(n.tabContentHeader&&n.options.node.collection.requireSwitched&&n.hasRequiredField&&n._hideNotRequiredFormFields(!0),n.tabContent.$el.removeClass("binf-hidden"),n.addPropertiesView&&n.rightToolbar){var i=n.addPropertiesView.render();o.triggerMethodOn(i,"before:show",i,n),n.rightToolbar.append(i.el),o.triggerMethodOn(i,"show",i,n),n.allFormsRendered=!0}var a,s=n.tabLinks.collection.find(function(e){return!n.tabLinks.children.findByModel(e).$el.hasClass("binf-hidden")});s&&!(a=n.tabLinks.children.findByModel(s)).isActive()&&a.activate(),n._initializeOthers(),n.triggerMethod("render:forms",this),setTimeout(function(){n._computeTablinkWidth(),n._enableToolbarState()},300);var r=t.Event("tab:content:render");if(n.$el.trigger(r),"create"!==n.options.formMode&&n.setFocus(),n.trigger("update:scrollbar"),n.updateTitle){var l=(n.options.node instanceof w?"v":"p")+n.options.node.get("id");l="pubsub:tab:contents:header:view:change:tab:title:"+l,A.trigger(l,a.el.innerText)}}).then(function(){n._activateSelectedPropertyTab()}),this.$el&&!this.$el.is(":visible")&&(this.updateTitle=!1),this.options.metadataView&&this.options.metadataView.metadataHeaderView&&this.options.metadataView.metadataHeaderView.metadataItemNameView.setToggleIconTabIndex()},"onShow":function(){},"setFocus":function(){},"_computeTablinkWidth":function(){var e=this.$el.find(".tab-links-bar"),i=e&&e.find("ul > li");if(e&&e.removeClass("wide-tablink very-wide-tablink"),e&&e.length>0&&i&&i.length>1){var o,n=t(e[0]).width(),a=0,s=0;for(o=0;o<i.length;o++){var r=t(i[o]);r.hasClass("hidden-by-switch")||(a+=r.width(),s++)}var l=s>0?a/s:t(i[0]).width(),d=2*a,c=a+1.3*l;n>d?e.addClass("very-wide-tablink"):n>c?e.addClass("wide-tablink"):e.removeClass("wide-tablink very-wide-tablink")}},"onPanelActivated":function(){setTimeout(e.bind(function(){this._setTablinksAttributes(),this._enableToolbarState()},this),300)},"validateForms":function(){function e(){++o===i&&(t?n._hideValidationError():n._showValidationError())}if(this.allFormsRendered){var t=!0,i=this.tabContent.children.length,o=0,n=this;return this.tabContent.children.each(function(i){var o=i.content.validate(e);t=t&&o}),t}return!1},"getFormsValues":function(){var t,i,o,n,a={};this.tabContent.children.each(function(t){var i,s,r=t.content.getValues(),l=t.content.model.get("role_name");r&&(l?(o=a.roles||(a.roles={}),n=o[l]||(o[l]={}),"categories"===l?(s=t.model.get("id").toString(),i=n[s]||(n[s]={}),e.isEmpty(r)?i=null:e.extend(i,r)):e.extend(n,r)):e.extend(a,r))}),this.options.node.removedCategories.length>0&&(o=a.roles||(a.roles={}),n=o.categories||(o.categories={}),e.each(this.options.node.removedCategories,function(e){n[e]||(n[e]={})}));var s=this.tabContent.children.find(function(e){return!!e.content.getGeneralFormFieldValues});return s&&(t=s.content.getGeneralFormFieldValues(),i=t.roles||{},delete t.roles,e.extend(a,t),e.each(e.keys(i),function(t){o=a.roles||(a.roles={}),n=o[t]||(o[t]={}),e.extend(n,i[t])})),a},"_addValidationErrorElement":function(){if(0===this.$el.find(".metadata-validation-error").length){this.tabLinks.$el.after('<div class="metadata-validation-error"></div>'),this.validationErrorElem=t(this.$el.find(".metadata-validation-error")[0]),this.validationErrorElem.append('<span class="icon notification_error cs-close-error-icon" alt="'+V.hideValidationErrorMessageIconTooltip+'" title="'+V.hideValidationErrorMessageIconTooltip+'"></span>'),this.validationErrorElem.append('<span class="validation-error-message">'+V.formValidationErrorMessage+"</span>"),this.validationErrorElem.hide();var i=t(this.$el.find(".metadata-validation-error .cs-close-error-icon")[0]);i&&i.on("click",e.bind(function(e){e.preventDefault(),e.stopPropagation(),this._hideValidationError()},this))}},"_showValidationError":function(){void 0===this.validationErrorElem&&this._addValidationErrorElement(),this.tabContent.$el.find(".alpaca-message-notOptional").length>0?(this.tabContent&&this.tabContent.$el.addClass("show-validation-error"),this.contentHeaderRegion&&this.contentHeaderRegion.$el.addClass("show-validation-error"),this.validationErrorElem&&this.validationErrorElem.show()):this._hideValidationError()},"_hideValidationError":function(){this.tabContent&&this.tabContent.$el.removeClass("show-validation-error"),this.contentHeaderRegion&&this.contentHeaderRegion.$el.removeClass("show-validation-error"),this.validationErrorElem&&this.validationErrorElem.hide()},"_clearValidationError":function(){this.tabContent&&this.tabContent.$el.removeClass("show-validation-error"),this.contentHeaderRegion&&this.contentHeaderRegion.$el.removeClass("show-validation-error"),this.validationErrorElem&&(this.validationErrorElem.remove(),delete this.validationErrorElem)},"_checkFormFetching":function(){this._fetchingForms=!0},"_fetchForms":function(){return this.allForms.fetch()},"_syncForms":function(){var t=this;return this.blockActions(),this._clearValidationError(),this._loadPanels().then(e.bind(this._loadGeneralFormFields,this)).then(e.bind(this._loadGeneralActionFields,this)).always(function(){t.unblockActions(),t._fetchingForms=!1}).then(function(){var i=e.pluck(t._propertyPanels,"model"),o=t.allForms.where({"role_name":"categories"});t.panelModelsLength=i.length,t.options.node.newCategories.models.length>0&&(o=t.options.node.get("override_source")?e.union(t.options.node.newCategories.models,o):e.union(o,t.options.node.newCategories.models));var n=e.sortBy(o,function(e){return e.attributes.title.toLowerCase()});o=i.concat(n),t._normalizeModels(o),t.collection.reset(o),t._checkCategoriesActions()}).fail(function(e){var t=new a.Error(e);g.showError(t.message,V.getPropertyPanelsFailTitle)})},"_loadPanels":function(){var i,o,n=this;"create"===this.options.action?(i="getPropertyPanelsForCreate",o=[{"forms":this.allForms}]):"copy"===this.options.action?(i="getPropertyPanelsForCopy",o=[{"forms":this.allForms}]):"move"===this.options.action?(i="getPropertyPanelsForMove",o=[{"forms":this.allForms}]):"restructure"===this.options.action?(i="getPropertyPanelsForMove",o=[{"forms":this.allForms}]):(i="getPropertyPanels",o=[{"forms":this.allForms}]);var a=T.chain().map(function(t){var a=t.get("controller"),s=t.get("controllerOptions"),r=new a(e.extend({"context":n.options.context,"model":n.options.node},s)),l=r[i];return l&&l.apply(r,o)}).compact().value();return t.when.apply(t,a).then(function(){n._propertyPanels=e.flatten(arguments)})},"_loadGeneralFormFields":function(){var e=this;return _.getFieldDescriptors({"context":this.options.context,"action":this.options.action,"node":this.options.node,"forms":this.allForms}).then(function(t){e._generalFormFieldDescriptors=t})},"_loadGeneralActionFields":function(){var e=this;return x.getFieldDescriptors({"context":this.options.context,"action":this.options.action,"node":this.options.node,"forms":this.allForms}).then(function(t){e._generalActionFieldDescriptors=t})},"_normalizeModels":function(t){e.each(t,function(e){if(e instanceof d){var t=e.get("schema");t&&t.title&&e.set("title",t.title)}null==e.get("id")&&e.set("id",e.cid),e.collection&&e.collection.remove(e)})},"_checkCategoriesActions":function(){var i=this.options.collection.where({"role_name":"categories"});if(i.length>0){var o=i[0].get("categoryId"),n=new S(void 0,{"node":this.options.node,"action":this.options.action,"urlResource":"categories/"+o+"/actions","autofetch":!0,"autoreset":!0});this.blockActions(),n.fetch().done(e.bind(function(){if(!(this.options.node instanceof w||void 0===this.options.node.get("id")||this.options.action)){var o;o=!!(n.length>0&&n.at(0).get("categories_remove")&&n.at(0).get("categories_remove").length>0),e.each(i,function(e){e.attributes.removeable=o,e.trigger("action:updated")})}this.unblockActions(),setTimeout(e.bind(function(){var e=t.Event("tab:content:render");this.$el.trigger(e)},this),300)},this)).fail(e.bind(function(t){var i=this._getRespError(t),n=V.getCategoryActionsFailTitle,a=e.str.sformat(V.getActionsForACategoryFailMessage,o,this.options.node.get("id"),i);g.showError(a,n),this.unblockActions()},this))}},"_initializeOthers":function(){var t={"gotoPreviousTooltip":V.gotoPreviousCategoryTooltip,"gotoNextTooltip":V.gotoNextCategoryTooltip};this._initializeToolbars(t),this._listenToTabEvent(),setTimeout(e.bind(this._enableToolbarState,this),300)},"_onWindowResize":function(e){if(e&&e.data&&e.data.view){var t=e.data.view;t.resizeTimer&&clearTimeout(t.resizeTimer);var i=t.options.node.collection&&t.options.node.collection.requireSwitched;t.resizeTimer=setTimeout(function(){t._setTablinksAttributes(),t._computeTablinkWidth(),t._enableToolbarState(),t._updateScrollbar(),t.tabContent&&t._hideNotRequiredFormFields(i)},200)}},"_setTablinksAttributes":function(){var e,i,o=this.$el.parent();for(e=0;e<5;e++){if(i=o.siblings(".cs-tab-links.binf-dropdown"),i.length>0){var n=t(i[0]).width();if(n>15){var a=n-12,s=a+"px",r=this.rtlEnabled?"margin-right":"margin-left",l=this.$el.find(".tab-links");if(l.css({"width":function(){return"calc(100% - "+s+")"}}),l.length){l.css(r,s);var d=parseInt(l.css("width").replace("px",""),10);d>20&&d<250?l.addClass("csui-mini-tablinks"):l.removeClass("csui-mini-tablinks")}}break}o=o.parent()}},"_createAddPropertiesView":function(){var t;this.addPropertiesView&&(this.cancelEventsToViewsPropagation(this.addPropertiesView),this.addPropertiesView.destroy()),this.options.node&&136===this.options.node.get("type")&&(t=!u.verifyNodeAncestors(this.context));var i=e.extend({"toolbarItems":this.options.toolbarItems,"toolbarItemsMask":this.options.toolbarItemsMask,"parentView":this,"blockingParentView":this.options.blockingParentView,"addPropertiesCallback":this.addPropertiesCallback,"suppressAddProperties":t||this.options.suppressAddProperties},this.options);this.addPropertiesView=new C(i),this.propagateEventsToViews(this.addPropertiesView)},"addCatAt":function(e,t){for(var i=this.panelModelsLength,o=i;o<e.length;o++){if(e[o].get("title").toLowerCase()>t.get("title").toLowerCase()){i=o;break}i+=1}return i},"addPropertiesCallback":function(e){this.options.action&&this.options.node.newCategories.add(e);var t=1===this.options.collection.models.length?1:this.addCatAt(this.options.collection.models,e);return this.doAddModelProperties(e,t),!1},"doAddModelProperties":function(i,o,n){function a(){var e=t.Event("tab:content:render");s.$el.trigger(e),s._autoScrollTabTo(o,{"animationOff":!0}).done(function(){var e=s.tabLinks.children.findByModel(s.options.collection.findWhere({"id":i.get("id")}));e.$el.removeClass("binf-active"),e.$el.find(">a").removeAttr("aria-selected"),e.activate(),e.$el.find("a.cs-tablink").trigger("focus")})}var s=this;this.tabLinks.$el.find(".binf-active").removeClass("binf-active").removeAttr("aria-selected"),this.options.collection.add(i,e.extend(n||{},{"at":o})),i.collection=this.options.collection,this._listenToTabIdEvent(o);var r=this.tabContent.children.findByModel(this.options.collection.findWhere({"id":i.get("id")})),l=r&&r.content;if(void 0!==l){if(l instanceof c?l.isRenderFinished():l._isRendered)a();else{var d=l instanceof c?"render:form":"dom:refresh";this.listenToOnce(l,d,e.bind(function(){this.trigger("update:button",!1),a()},this))}this._autoScrollTabTo(o,{"animationOff":!0})}else a();this._computeTablinkWidth(),this._enableToolbarState(),this.trigger("reset:switch")},"_resetRequiredSwitchView":function(){A.trigger("pubsub:header:rightbar:view:change:switch:status","reset")},"_onDeleteCategory":function(t){this.tabToDelete=t;var i=t.model.get("title"),o=V.removeCategoryWarningTitle,n=i?e.str.sformat(V.removeCategoryWarningMessage,i):V.removeCategoryWarningMessage;g.confirmWarning(n,o).done(e.bind(this._removeCategory,this)).fail(e.bind(function(e){e||this.tabToDelete.$el.find("a").trigger("focus")},this))},"_removeCategory":function(){if(this.tabToDelete){var t=this.tabToDelete.model.get("id");if(t=e.isNumber(t)?t.toString():t,void 0===this.options.node.get("id")||this.options.action)return this._removeTab(),void(void 0===this.options.node.newCategories.remove(t)&&this.options.node.removedCategories.push(t));var i=n.combine(this.options.node.urlBase(),"categories/"+t),o={"type":"DELETE","url":i};this.blockActions(),this.options.node.connector.makeAjaxCall(o).done(e.bind(function(){this.unblockActions(),this._removeTab()},this)).fail(e.bind(function(t){this.unblockActions();var i=this._getRespError(t),o=this.tabToDelete.model.get("title"),n=V.removeCategoryFailMessageTitle,a=e.str.sformat(V.removeCategoryFailMessage,o,i);g.showError(a,n)},this))}},"_removeTab":function(){if(this.tabToDelete.$el.hasClass("binf-active")){var i=this.tabToDelete._index-1,o=this.tabLinks.children.findByIndex(i);this._autoScrollTabTo(i,{"animationOff":!0}).done(function(){o&&o.activate()})}this.options.collection.remove(this.tabToDelete.model),this.trigger("reset:switch"),setTimeout(e.bind(function(){this._computeTablinkWidth(),this._enableToolbarState();var e=t.Event("tab:content:render");this.$el.trigger(e)},this),300)},"_onRequiredSwitch":function(e){return i.trigger("closeToggleAction"),this._updateScrollbar(),this._hideNotRequiredFormFields(e.on,e),!1},"_hideNotRequiredFormFields":function(i,o){this.tabContent.children.each(function(e){if(e.content.hideNotRequired){var t=e.content.hideNotRequired(i),o=this.tabLinks.children.findByModel(e.model);if(t){var n=i?"addClass":"removeClass";e.$el[n]("binf-hidden hidden-by-switch"),i?this._hideTabLinkByRequiredSwitch(o.$el):this._showTabLinkByRequiredSwitch(o.$el,e.model.get("removeable"))}else this._showTabLinkByRequiredSwitch(o.$el,e.model.get("removeable"))}},this),this.tabLinks.$el.find(".tab-links-first-visible").removeClass("tab-links-first-visible"),this.tabContent.onReorder();for(var n,a=this.tabLinks.children._views,s=Object.keys(a).sort(function(e,t){return a[e]._index-a[t]._index}),r=0;r<s.length;r++)if(!this.tabLinks.children._views[s[r]].$el.hasClass("binf-hidden")){n=this.tabLinks.children._views[s[r]];break}n&&n.$el.addClass("tab-links-first-visible"),n&&!n.isActive()&&n.activate(),setTimeout(e.bind(function(){this._computeTablinkWidth(),this._enableToolbarState();var e=t.Event("tab:content:render");this.$el.trigger(e),o&&(this.currentTabPosition=1)},this),300)},"_getRespError":function(e){var i="";return e&&e.responseJSON&&e.responseJSON.error?i=e.responseJSON.error:a.MessageHelper.hasMessages()&&(i=t(a.MessageHelper.toHtml()).text(),a.MessageHelper.clear()),i}});return e.extend(E.prototype,l),E}),csui.define("csui/widgets/metadata/metadata.properties.view",["module","csui/lib/underscore","csui/widgets/metadata/impl/metadata.properties.view","css!csui/widgets/metadata/impl/metadata"],function(e,t,i){var o=e.config();return t.defaults(o,{"topAlignLabel":!1}),i.extend({"constructor":function(e){e.topAlignLabel=o.topAlignLabel,i.prototype.constructor.apply(this,arguments)},"validateForms":function(){return i.prototype.validateForms.apply(this,arguments)},"getFormsValues":function(){return i.prototype.getFormsValues.apply(this,arguments)}})}),csui.define("csui/widgets/metadata/impl/metadata.properties.content.view",["csui/lib/underscore","csui/lib/marionette","csui/utils/nodesprites","csui/widgets/metadata/metadata.properties.view","csui/controls/mixins/view.events.propagation/view.events.propagation.mixin"],function(e,t,i,o,n){var a=t.ItemView.extend({"className":"metadata-inner-wrapper","constructor":function(e){this.options=e,t.ItemView.prototype.constructor.call(this,e);var i={"context":this.options.context,"node":this.options.model,"containerCollection":this.options.containerCollection,"metadataView":this.options.metadataView,"blockingParentView":this.options.blockingParentView,"selectedProperty":this.options.selectedProperty,"notTabableRegion":!0};this.childTabPanelView=new o(i),this.propagateEventsToViews(this.childTabPanelView)},"render":function(){this._ensureViewIsIntact(),this.triggerMethod("before:render",this);var e=this.childTabPanelView.render();return t.triggerMethodOn(e,"before:show",e,this),this.$el.append(e.el),t.triggerMethodOn(e,"show",e,this),this.triggerMethod("render",this),this},"onBeforeDestroy":function(){this.childTabPanelView.destroy()},"onPanelActivated":function(){this.childTabPanelView&&this.childTabPanelView.triggerMethod("panel:activated")}});return e.extend(a.prototype,n),a}),csui.define("csui/widgets/metadata/impl/versions/metadata.versions.columns",["csui/lib/backbone","i18n!csui/widgets/metadata/impl/nls/lang"],function(e,t){var i=e.Model.extend({"idAttribute":"key","defaults":{"key":null,"sequence":0}}),o=e.Collection.extend({"model":i,"comparator":"sequence","getColumnKeys":function(){return this.pluck("key")},"deepClone":function(){return new o(this.map(function(e){return e.attributes}))}});return new o([{"key":"version_number_name","align":"center","title":t.versionColumnVersionNumberTitle,"sequence":10},{"key":"name","sequence":20},{"key":"create_date","sequence":30},{"key":"owner_id","sequence":40},{"key":"file_size","align":"right","title":t.versionColumnSizeTitle,"sequence":50}])}),csui.define("hbs!csui/widgets/metadata/impl/versions/metadata.versions",["module","hbs","nuc/lib/handlebars"],function(e,t,i){var o=i.template({"compiler":[8,">= 4.3.0"],"main":function(e,t,i,o,n){return'<div class="csui-metadata-versions">\r\n  <div class="csui-metadata-versions-rowselection-toolbar-view"></div>\r\n  <div class="csui-table-view"></div>\r\n  <div class="csui-pagination-view"></div>\r\n</div>'}});return i.registerPartial("csui_widgets_metadata_impl_versions_metadata.versions",o),o}),csui.define("css!csui/widgets/metadata/impl/versions/metadata.versions",[],function(){}),csui.define("csui/widgets/metadata/impl/versions/metadata.versions.view",["module","csui/lib/jquery","csui/lib/underscore","csui/lib/backbone","csui/lib/marionette","csui/utils/base","csui/controls/globalmessage/globalmessage","csui/controls/mixins/layoutview.events.propagation/layoutview.events.propagation.mixin","csui/controls/toolbar/toolitems.filtered.model","csui/controls/toolbar/toolbar.view","csui/controls/toolbar/delayed.toolbar.view","csui/controls/table/table.view","csui/controls/pagination/nodespagination.view","csui/utils/versions.default.action.items","csui/utils/commands/versions","csui/utils/commandhelper","csui/utils/accessibility","csui/controls/table.rowselection.toolbar/table.rowselection.toolbar.view","csui/controls/tableactionbar/tableactionbar.view","csui/controls/toolbar/toolbar.command.controller","csui/models/nodes","csui/models/columns","csui/models/nodeversions","csui/models/version","csui/widgets/metadata/impl/versions/metadata.versions.columns","csui/widgets/metadata/versions.toolbaritems","csui/widgets/metadata/versions.toolbaritems.mask","csui/utils/log","csui/utils/url","hbs!csui/widgets/metadata/impl/versions/metadata.versions","i18n!csui/widgets/metadata/impl/nls/lang","css!csui/widgets/metadata/impl/versions/metadata.versions"],function(e,t,i,o,n,a,s,r,l,d,c,u,m,h,p,g,f,w,b,v,y,_,x,V,T,C,I,k,M,A,F){"use strict";var S=f.isAccessibleTable(),E=e.config();i.defaults(E,{"defaultPageSize":30,"defaultPageSizes":[30,50,100],"showInlineActionBarOnHover":!S,"forceInlineActionBarOnClick":!1,"inlineActionBarStyle":"csui-table-actionbar-bubble","enabled":!0,"useV2RestApi":!1});var P=n.LayoutView.extend({"className":function(){var e="metadata-inner-wrapper";return S&&(e+=" csui-no-animation"),e},"template":A,"ui":{"tableRowSelectionToolbarView":".csui-metadata-versions-rowselection-toolbar-view","tableView":".csui-table-view","childContainer":".csui-table-view","paginationView":".csui-pagination-view"},"regions":{"tableRowSelectionToolbarRegion":"@ui.tableRowSelectionToolbarView","tableRegion":"@ui.tableView","paginationRegion":"@ui.paginationView"},"constructor":function e(t){this.commands=p,i.defaults(t,{"pageSize":E.defaultPageSize,"ddItemsList":E.defaultPageSizes,"showInlineActionBarOnHover":E.showInlineActionBarOnHover,"forceInlineActionBarOnClick":E.forceInlineActionBarOnClick,"inlineActionBarStyle":E.inlineActionBarStyle,"toolbarItems":C,"originatingView":t.originatingView||t.metadataView}),e.__super__.constructor.call(this,t),this.selectedNodes=new y,this.collection=new x(void 0,{"node":this.options.model,"autoreset":!0,"expand":"user","commands":p.getAllSignatures(),"useV2RestApi":E.useV2RestApi,"onlyClientSideDefinedColumns":!0}),this._ensureNodeAdvanceInfo(),this.options.model.versions=this.collection,this.commandController=new v({"commands":this.commands}),this.collection.delayedActions&&this.listenTo(this.collection.delayedActions,"error",function(e,t,i){var o=new a.Error(t);s.showMessage("error",o.message)}),this.defaultActionItems=h,this.options.toolbarItemsMasks||(this.options.toolbarItemsMasks=new I(this.options)),this._setTableView(),this._setTableRowSelectionToolbar({"toolItemFactory":this.options.toolbarItems.tableHeaderToolbar,"toolbarItemsMask":this.options.toolbarItemsMasks,"commands":this.options.commands||p}),this._setTableRowSelectionToolbarEventListeners(),this._setPagination(),this._updateCollection(),this.propagateEventsToRegions(),this.listenTo(this.collection,"add",this._updateCollection).listenTo(this.collection,"remove",this._updateCollection)},"onRender":function(){this.tableRowSelectionToolbarRegion.show(this._tableRowSelectionToolbarView),this.tableRegion.show(this.tableView),this.paginationRegion.show(this.paginationView)},"_updateCollection":function(){var e,i=t.Deferred();this.collection.fetch().then(function(e){i.resolve()},function(o){if(o&&o.responseJSON&&o.responseJSON.error)e=o.responseJSON.error;else{var n=a.MessageHelper.toHtml();a.MessageHelper.reset(),e=t(n).text()}s.showMessage("error",e),i.reject()})},"_setTableView":function(){this.options||(this.options={});var e=i.extend({"tableColumns":T,"connector":this.model.connector,"collection":this.collection,"columns":this.collection.columns,"columnsWithSearch":[],"orderBy":"version_number_name desc","actionItems":h,"commands":p,"inlineBar":{"viewClass":b,"options":i.extend({"collection":this.options.toolbarItems.inlineActionbar,"toolItemsMask":this.options.toolbarItemsMasks,"container":this.collection.node,"containerCollection":this.collection},this.options.toolbarItems.inlineActionbar.options,{"inlineBarStyle":this.options.inlineActionBarStyle,"forceInlineBarOnClick":this.options.forceInlineActionBarOnClick,
"showInlineBarOnHover":this.options.showInlineActionBarOnHover})},"originatingView":this.options.originatingView,"focusView":"tableHeader","tableAria":i.str.sformat(F.versionTableAria,this.collection.node.get("name"))},this.options);delete e.blockingParentView,i.contains(this.options.ddItemsList,this.options.pageSize)||(this.options.ddItemsList.push(this.options.pageSize),this.options.ddItemsList.sort()),this.tableView=new u(e);var t={"context":this.options.context,"originatingView":this};this.listenTo(this.tableView,"execute:defaultAction",function(e){var i=this.defaultActionItems.find(function(t){if(t.get("type")===e.get("type"))return!0},this),o=p.get(i.get("signature")),n={"nodes":new x([e])},a=o.execute(n,t);g.handleExecutionResults(a,{"command":o,"suppressSuccessMessage":n.suppressSuccessMessage,"suppressFailMessage":n.suppressFailMessage})})},"_setTableRowSelectionToolbar":function(e){this._tableRowSelectionToolbarView=new w({"toolItemFactory":e.toolItemFactory,"toolbarItemsMask":e.toolbarItemsMask,"toolbarCommandController":this.commandController,"commands":p,"selectedChildren":this.tableView.selectedChildren,"container":this.collection.node,"context":this.options.context,"originatingView":this.options.originatingView,"collection":this.collection})},"_setTableRowSelectionToolbarEventListeners":function(){this.listenTo(this.tableView.selectedChildren,"reset",function(){this.tableView.selectedChildren.length>0?this.tableRowSelectionToolbarRegion.$el.addClass("csui-metadata-versions-rowselection-toolbar-visible"):this.tableRowSelectionToolbarRegion.$el.removeClass("csui-metadata-versions-rowselection-toolbar-visible")})},"_setPagination":function(){this.paginationView=new m({"collection":this.collection,"pageSize":this.options.pageSize,"defaultDDList":this.options.ddItemsList,"skipPaginationUpdateRequest":!0})},"_ensureNodeAdvanceInfo":function(){var e=this.options.model;if(void 0===e.get("advanced_versioning")){var t=e.get("id"),o=e.connector?e.connector:this.options.connector,n=M.combine(o.getConnectionUrl().getApiBase("v2"),"/nodes/"+t+"/properties"),s={"type":"GET","url":n};o.makeAjaxCall(s).done(i.bind(function(t){var i=t.results.data&&t.results.data.properties;i&&e.set({"advanced_versioning":i.advanced_versioning},{"silent":!0})},this)).fail(function(e){var t=new a.Error(e);k.warn("fetching node properties failed.\n{0}",t.message)&&console.warn(k.last)})}}});return i.extend(P.prototype,r),P}),csui.define("csui/widgets/metadata/metadata.versions.view",["module","csui/lib/jquery","csui/lib/underscore","csui/lib/backbone","csui/lib/marionette","csui/widgets/metadata/impl/versions/metadata.versions.view","csui/models/version"],function(e,t,i,o,n,a,s){"use strict";var r=e.config();return i.defaults(r,{"enabled":!0}),a.extend({"constructor":function(e){a.prototype.constructor.apply(this,arguments)}},{"enabled":function(e){return!1!==r.enabled&&!1!==e.enabled&&(!(e.node instanceof s)&&i.contains([144,736,749,5574],e.node.get("type")))}})}),csui.define("csui/widgets/metadata/impl/audit/metadata.audit.columns",["csui/lib/backbone","i18n!csui/widgets/metadata/impl/nls/lang"],function(e,t){var i=e.Model.extend({"idAttribute":"key","defaults":{"key":null,"sequence":0}}),o=e.Collection.extend({"model":i,"comparator":"sequence","getColumnKeys":function(){return this.pluck("key")},"deepClone":function(){return new o(this.map(function(e){return e.attributes}))}});return new o([{"key":"audit_name","align":"left","title":t.action,"sequence":10},{"key":"audit_date","align":"left","title":t.date,"sequence":20},{"key":"user_id","align":"left","title":t.user,"sequence":30}])}),csui.define("hbs!csui/widgets/metadata/impl/audit/metadata.audit",["module","hbs","nuc/lib/handlebars"],function(e,t,i){var o=i.template({"compiler":[8,">= 4.3.0"],"main":function(e,t,i,o,n){return'<div class="csui-audit-table"></div>\r\n<div class="csui-audit-pagination"></div>\r\n'}});return i.registerPartial("csui_widgets_metadata_impl_audit_metadata.audit",o),o}),csui.define("css!csui/widgets/metadata/impl/audit/metadata.audit",[],function(){}),csui.define("csui/widgets/metadata/impl/audit/metadata.audit.view",["module","csui/lib/underscore","csui/lib/jquery","csui/lib/marionette","csui/utils/contexts/factories/connector","csui/controls/mixins/layoutview.events.propagation/layoutview.events.propagation.mixin","csui/controls/table/table.view","csui/controls/pagination/nodespagination.view","csui/models/audit/audit.collection","csui/widgets/metadata/impl/audit/metadata.audit.columns","csui/models/members","csui/controls/userpicker/roles/user.view","csui/utils/base","hbs!csui/widgets/metadata/impl/audit/metadata.audit","i18n!csui/widgets/metadata/impl/nls/lang","css!csui/widgets/metadata/impl/audit/metadata.audit"],function(e,t,i,o,n,a,s,r,l,d,c,u,m,h,p){"use strict";var g=e.config();t.defaults(g,{"defaultPageSize":30,"defaultPageSizes":[30,50,100]});var f=o.LayoutView.extend({"className":"csui-audit","template":h,"ui":{"tableView":".csui-audit-table","paginationView":".csui-audit-pagination"},"regions":{"tableRegion":"@ui.tableView","paginationRegion":"@ui.paginationView"},"constructor":function(e){e||(e={}),o.LayoutView.prototype.constructor.apply(this,arguments),this.collection.fetch(),this.propagateEventsToRegions()},"initialize":function(){t.defaults(this.options,{"pageSize":g.defaultPageSize,"ddItemsList":g.defaultPageSizes}),this.collection=new l(void 0,{"connector":this.options.context.getObject(n),"node":this.options.model,"autoreset":!0}),this._setTableView(),this._setPagination(),this.listenTo(this.tableView,"before:render",function(e){var t=this.tableView.searchBoxes.length&&this.tableView.searchBoxes[0];!t||t.ui.searchBox.hasClass("binf-hidden")||this.eventDropDownOpts.doNotShowDropDown||0!==this.tableView.tableCaptionView.accFocusedColumn||(this.eventDropDownOpts.doNotShowDropDown=!0)})},"onRender":function(){this.tableRegion.show(this.tableView),this.paginationRegion.show(this.paginationView)},"getUserSearchboxOptions":function(){return{"collection":new c(void 0,{"connector":this.options.context.getObject(n),"memberFilter":{"type":[0]},"limit":10,"comparator":function(e){return e.get("name_formatted").toLowerCase()}}),"source":function(e){var t=this;return this.collection.query=e,this.collection.fetch().then(function(){return t.collection.models})},"displayText":function(e){return e.get("name")},"highlighter":function(e){var t=this.collection.findWhere({"name":e});return new u({"model":t,"connector":this.collection.connector,"lightWeight":!1}).render().el},"filter":"user_id","pickerListId":t.uniqueId("userList"),"pickerListClass":"userpickerul"}},"getEventSearchboxOptions":function(){this.eventDropDownOpts={"doNotShowDropDown":!1};var e=this.collection.auditEvents,o=function(e){return e.get("name")},n=function(e){var i=this,o=t.filter(i.collection.models,function(t){return-1!==t.get("name").toLowerCase().indexOf(e.toLowerCase())});return t.sortBy(o,function(e){return e.get("name")})},a=function(e){this.focused||(this.focused=!0,this.options.showHintOnFocus&&!this.options.dropDownOpts.doNotShowDropDown&&this.lookup()),this.options.dropDownOpts.doNotShowDropDown&&(this.options.dropDownOpts.doNotShowDropDown=!1)},s=function(e){return i("<div></div>").text(e).html()},r=function(e){this.options.dropDownOpts&&!this.options.dropDownOpts.doNotShowDropDown&&(this.options.dropDownOpts.doNotShowDropDown=!0);var t=this.options.clearOnSelect?"":m.formatMemberName(e);this.ui.searchBox.val(t),this.trigger(this.valueChangedEventName,{"column":this.options.filter,"keywords":e.get("id")})};return{"collection":e,"source":n,"displayText":o,"filter":"type","pickerListId":t.uniqueId("typeList"),"showHintOnFocus":!0,"dropDownOpts":this.eventDropDownOpts,"focus":a,"afterSelect":r,"highlighter":s}},"_setTableView":function(){var e=this.getUserSearchboxOptions(),i=this.getEventSearchboxOptions(),o=t.extend({"connector":this.model.connector,"collection":this.collection,"tableColumns":d,"orderBy":"audit_date desc","columnsWithTypeaheadSearchbox":{"user_id":e,"audit_name":i},"selectColumn":!1,"haveDetailsRowExpandCollapseColumn":!0,"actionItems":this.defaultActionItems,"commands":this.commands,"wfElementID":"","customLabels":{"emptyTableText":p.auditNoResultsPlaceholder},"focusView":"tableHeader","tableAria":t.str.sformat(p.auditTableAria,this.options.model.get("name"))},this.options);this.tableView=new s(o)},"_setPagination":function(){var e={"collection":this.collection,"pageSize":this.options.pageSize,"defaultDDList":this.options.ddItemsList};this.paginationView=new r(e)}});return t.extend(f.prototype,a),f}),csui.define("csui/widgets/metadata/metadata.audit.view",["module","csui/lib/jquery","csui/lib/underscore","csui/lib/backbone","csui/lib/marionette","csui/widgets/metadata/impl/audit/metadata.audit.view"],function(e,t,i,o,n,a){"use strict";return a.extend({"constructor":function(e){a.prototype.constructor.apply(this,arguments)}},{"enabled":function(t){var o=e.config();return i.defaults(o,{"enabled":!0}),!1!==o.enabled&&!!t.node.get("id")}})}),csui.define("csui/models/compound.document/releases/releases.collection",["csui/lib/underscore","csui/lib/backbone","nuc/models/browsable/browsable.mixin","csui/models/mixins/connectable/connectable.mixin","csui/models/mixins/fetchable/fetchable.mixin","nuc/models/browsable/v1.request.mixin","csui/models/browsable/v2.response.mixin","csui/models/compound.document/releases/server.adaptor.mixin","csui/models/mixins/v2.additional.resources/v2.additional.resources.mixin","csui/models/mixins/v2.fields/v2.fields.mixin","csui/models/mixins/v2.expandable/v2.expandable.mixin","csui/models/mixins/state.requestor/state.requestor.mixin","csui/models/mixins/v2.delayed.commandable/v2.delayed.commandable.mixin","csui/models/nodechildrencolumn","csui/models/nodechildrencolumns","csui/models/node/node.model"],function(e,t,i,o,n,a,s,r,l,d,c,u,m,h,p,g){var f={"type":"release_type","type_name":"type_name","name":"name","reserved":"reserved","release_value":"release_value","created":"release_date","createdBy":"create_user_name","favorite":"favorite","dateType":"-7"},w=h.extend({"constructor":function(e,t){h.prototype.constructor.call(this,e,t)}}),b=p.extend({"model":w,"resetColumnsV2":function(e,t){this.models.length||this.resetCollection(this.getV2Columns(e),t)},"getColumnModels":function(e,t){return p.prototype.getColumnModels.call(this,e,t)},"getV2Columns":function(){var t={},i=Object.keys(f);e.each(i,function(e){t[e]={},t[e].key=f[e]}),t.created.type=f.dateType,t.type.type_name=f.type_name;var o=e.keys(t);return this.getColumnModels(o,t)}}),v=g.extend({}),y=t.Collection.extend({"model":v,"constructor":function(e,i){this.options=i||{},t.Collection.prototype.constructor.call(this,e,i),this.makeConnectable(i).makeFetchable(i).makeBrowsableV2Response(i).makeAdditionalResourcesV2Mixin(i).makeFieldsV2(i).makeExpandableV2(i).makeStateRequestor(i).makeDelayedCommandableV2(i).makeServerAdaptor(i),this.columns=new b}});return i.mixin(y.prototype),a.mixin(y.prototype),s.mixin(y.prototype),o.mixin(y.prototype),n.mixin(y.prototype),r.mixin(y.prototype),l.mixin(y.prototype),d.mixin(y.prototype),c.mixin(y.prototype),u.mixin(y.prototype),m.mixin(y.prototype),y}),csui.define("csui/widgets/metadata/impl/releases/metadata.releases.columns",["csui/lib/backbone","i18n!csui/widgets/metadata/impl/nls/lang"],function(e,t){var i=e.Model.extend({"idAttribute":"key","defaults":{"key":null,"sequence":0}}),o=e.Collection.extend({"model":i,"comparator":"sequence","getColumnKeys":function(){return this.pluck("key")},"deepClone":function(){return new o(this.map(function(e){return e.attributes}))}});return new o([{"key":"type","titleIconInHeader":"mime_type","permanentColumn":!0,"sequence":10},{"key":"name","sequence":20},{"key":"reserved","title":"State","sequence":30,"noTitleInHeader":!0},{"key":"release_value","title":t.release,"sequence":40},{"key":"created","title":t.created,"sequence":50},{"key":"createdBy","title":t.createdBy,"sequence":60},{"key":"favorite","column_key":"favorite","sequence":70,"title":t.favorite,"noTitleInHeader":!0,"permanentColumn":!0}])}),csui.define("csui/widgets/metadata/impl/releases/toolbaritems",["csui/lib/underscore","i18n!csui/controls/tabletoolbar/nls/localized.strings","i18n!csui/controls/tabletoolbar/impl/nls/localized.strings","csui/controls/toolbar/toolitems.factory","csui/controls/toolbar/toolitem.model"],function(e,t,i,o,n){"use strict";return{"tableHeaderToolbar":new o({"info":[{"signature":"ReleasesProperties","name":i.ToolbarItemInfo,"iconName":"csui_action_properties32"},{"signature":"CopyLink","name":i.ToolbarItemCopyLink}],"main":[{"signature":"FavoriteRename","name":i.ToolbarItemRename,"onlyInTouchBrowser":!0},{"signature":"InlineEdit","name":i.ToolbarItemRename},{"signature":"Lock","name":i.ToolbarItemLock},{"signature":"Unlock","name":i.ToolbarItemUnlock},{"signature":"Delete","name":i.ToolbarItemDelete}]},{"maxItemsShown":15,"dropDownText":i.ToolbarItemMore,"dropDownIconName":"csui_action_more32","addGroupSeparators":!1,"lazyActions":!0}),"inlineToolbar":new o({"info":[{"signature":"ReleasesProperties","name":i.ToolbarItemInfo,"iconName":"csui_action_properties32"},{"signature":"CopyLink","name":i.ToolbarItemCopyLink,"iconName":"csui_action_copy_link32"}],"other":[{"signature":"InlineEdit","name":i.ToolbarItemRename,"iconName":"csui_action_rename32"},{"signature":"Lock","name":i.ToolbarItemLock,"iconName":"csui_action_reserve32"},{"signature":"Unlock","name":i.ToolbarItemUnlock,"iconName":"csui_action_unreserve32"},{"signature":"Delete","name":i.ToolbarItemDelete,"iconName":"csui_action_delete32"}]},{"maxItemsShown":5,"dropDownText":i.ToolbarItemMore,"dropDownIconName":"csui_action_more32","addGroupSeparators":!1})}}),csui.define("csui/widgets/metadata/impl/releases/toolbaritems.masks",["module","csui/lib/underscore","csui/controls/toolbar/toolitems.mask","csui/utils/toolitem.masks/global.toolitems.mask"],function(e,t,i,o){"use strict";function n(){var n=e.config(),s=new o;this.toolbars=t.reduce(a,function(e,o){var a=new i(s,{"normalize":!1});return t.each(n,function(e,t){(e=e[o])&&a.extendMask(e)}),a.storeMask(),e[o]=a,e},{})}var a=["tableHeaderToolbar","otherToolbar","inlineActionbar"];return n.toolbars=a,n}),csui.define("hbs!csui/widgets/metadata/impl/releases/metadata.releases",["module","hbs","nuc/lib/handlebars"],function(e,t,i){var o=i.template({"compiler":[8,">= 4.3.0"],"main":function(e,t,i,o,n){return'<div class="csui-metadata-releases-rowselection-toolbar-view"></div>\r\n<div class="csui-releases-table"></div>'}});return i.registerPartial("csui_widgets_metadata_impl_releases_metadata.releases",o),o}),csui.define("css!csui/widgets/metadata/impl/releases/metadata.releases",[],function(){}),csui.define("csui/widgets/metadata/impl/releases/metadata.releases.view",["module","csui/lib/underscore","csui/lib/marionette3","csui/utils/contexts/factories/connector","csui/controls/mixins/layoutview.events.propagation/layoutview.events.propagation.mixin","csui/controls/table/table.view","csui/utils/accessibility","csui/models/nodechildren","csui/models/compound.document/releases/releases.collection","csui/widgets/metadata/impl/releases/metadata.releases.columns","csui/widgets/metadata/impl/releases/toolbaritems","csui/widgets/metadata/impl/releases/toolbaritems.masks","csui/controls/table.rowselection.toolbar/table.rowselection.toolbar.view","csui/controls/toolbar/toolbar.command.controller","csui/behaviors/default.action/default.action.behavior","csui/utils/commands","csui/utils/commands/compound.document/releases.commands","csui/controls/tableactionbar/tableactionbar.view","hbs!csui/widgets/metadata/impl/releases/metadata.releases","i18n!csui/widgets/metadata/impl/nls/lang","css!csui/widgets/metadata/impl/releases/metadata.releases"],function(e,t,i,o,n,a,s,r,l,d,c,u,m,h,p,g,f,w,b,v){"use strict";var y=s.isAccessibleTable(),_=e.config();t.defaults(_,{"toolbarItems":c,"showInlineActionBarOnHover":!y});var x=i.View.extend({"className":"csui-compound-document-releases","template":b,"ui":{"tableView":".csui-releases-table","tableRowSelectionToolbarView":".csui-metadata-releases-rowselection-toolbar-view"},"regions":{"tableRegion":"@ui.tableView","tableRowSelectionToolbarRegion":"@ui.tableRowSelectionToolbarView"},"behaviors":{"DefaultAction":{"behaviorClass":p}},"constructor":function(e){e||(e={}),i.View.prototype.constructor.apply(this,arguments),e.toolbarItems||(e.toolbarItems=c),e.toolbarItemsMasks||(e.toolbarItemsMasks=new u),t.defaults(this.options,{"showInlineActionBarOnHover":_.showInlineActionBarOnHover},{"forceInlineActionBarOnClick":!1,"inlineActionBarStyle":"csui-table-actionbar-bubble","toolbarItems":c}),this.collection.commands=this.collection.options.commands,this.collection.fetch(),this.context=e.context,this.connector=this.context.getObject(o),this.commands=e.commands||g,f&&this.commands.push(f.models),this.commandController=new h({"commands":this.commands}),this.listenTo(this.commandController,"before:execute:command",this._beforeExecuteCommand),this.listenTo(this.commandController,"after:execute:command",this._afterExecuteCommand),this._setTableView(),this._setTableRowSelectionToolbar({"toolItemFactory":this.options.toolbarItems.tableHeaderToolbar,"toolbarItemsMask":this.options.toolbarItemsMasks,"commands":this.options.commands||g}),this._setTableRowSelectionToolbarEventListeners(),this.propagateEventsToRegions()},"initialize":function(){var e=this.defaultActionController.actionItems;this.collection=new l(void 0,{"connector":this.options.context.getObject(o),"node":this.options.model,"orderBy":"create_date desc","autoreset":!0,"commands":g.getAllSignatures(),"defaultActionCommands":e.getAllCommandSignatures(g),"delayRestCommands":!0}),this.collection.setEnabledDelayRestCommands(!0)},"onRender":function(){var e=this.getRegion("tableRegion");this.tableRowSelectionToolbarRegion=this.getRegion("tableRowSelectionToolbarRegion"),this.tableRowSelectionToolbarRegion.show(this._tableRowSelectionToolbarView),e.show(this.tableView),this.listenTo(this.tableView,"tableRowSelected",function(){this.tableView.cancelAnyExistingInlineForm.call(this.tableView)})},"_beforeExecuteCommand":function(){this.tableView.cancelAnyExistingInlineForm.call(this.tableView)},"_afterExecuteCommand":function(e){switch(e.commandSignature){case"Delete":if(!e||e.cancelled)return;this.tableView._selectAllCheckboxRegion.currentView.model.set("checked",!1)}},"_setTableView":function(){this.inlineToolbarItemsMasks||(this.inlineToolbarItemsMasks=new u(this.options));var e=t.extend({"connector":this.model.connector,"collection":this.collection,"context":this.context,"originatingView":this,"tableColumns":d,"selectColumn":!0,"haveDetailsRowExpandCollapseColumn":!0,"actionItems":this.defaultActionController.actionItems,"commands":this.commands,"customLabels":{"emptyTableText":v.releasesNoResultsPlaceholder},"focusView":"tableHeader","inlineBar":{"viewClass":w,"options":t.extend({"collection":this.options.toolbarItems.inlineToolbar,"toolItemsMask":this.inlineToolbarItemsMasks.toolbars.inlineActionBar,"delayedActions":this.collection.delayedActions,"container":this.container,"containerCollection":this.collection},this.options.toolbarItems.inlineToolbar&&this.options.toolbarItems.inlineToolbar.options,{"inlineBarStyle":this.options.inlineActionBarStyle,"forceInlineBarOnClick":this.options.forceInlineActionBarOnClick,"showInlineBarOnHover":this.options.showInlineActionBarOnHover})},"tableAria":t.str.sformat(v.releasesTableAria,this.options.model.get("name"))},this.options);this.tableView=new a(e),this.tableView.collection&&0===this.tableView.collection.length&&this.collection.fetched&&(this.tableView._showEmptyViewText=!0),this.listenTo(this.tableView,"execute:defaultAction",function(e){var i,o,n,a;i=this.options.context.getModel("nextNode"),n=new r(void 0,{"node":e,"autoreset":!0}),n.fetch().done(function(n){a=t.has(n.data[0],"id")&&n.data[0].id,o=a||e,i.set("id",o)})})},"_setTableRowSelectionToolbar":function(e){this._tableRowSelectionToolbarView=new m({"toolItemFactory":e.toolItemFactory,"toolbarItemsMask":e.toolbarItemsMask,"toolbarCommandController":this.commandController,"commands":g,"selectedChildren":this.tableView.selectedChildren,"container":this.collection.node,"context":this.options.context,"originatingView":this.options.originatingView,"collection":this.collection})},"_setTableRowSelectionToolbarEventListeners":function(){this.listenTo(this.tableView.selectedChildren,"reset",function(){this.tableView.selectedChildren.length>0?this.tableRowSelectionToolbarRegion.$el.addClass("csui-metadata-releases-rowselection-toolbar-visible"):this.tableRowSelectionToolbarRegion.$el.removeClass("csui-metadata-releases-rowselection-toolbar-visible")})}});return t.extend(x.prototype,n),x}),csui.define("csui/widgets/metadata/metadata.releases.view",["module","csui/lib/underscore","csui/widgets/metadata/impl/releases/metadata.releases.view","csui/utils/commands/compound.document/compound.document.util"],function(e,t,i,o){"use strict";var n=e.config();return t.defaults(n,{"enabled":!0}),i.extend({"constructor":function(){i.prototype.constructor.apply(this,arguments)}},{"enabled":function(e){return!1!==n.enabled&&(136===e.node.get("type")&&o.verifyNodeAncestors(e.context))}})}),csui.define("csui/widgets/metadata/metadata.panels",["csui/lib/underscore","csui/lib/backbone","csui/widgets/metadata/impl/metadata.properties.content.view","csui/widgets/metadata/metadata.versions.view","csui/widgets/metadata/metadata.audit.view","csui/widgets/metadata/metadata.releases.view","i18n!csui/widgets/metadata/impl/nls/lang","csui-ext!csui/widgets/metadata/metadata.panels"],function(e,t,i,o,n,a,s,r){var l=t.Model.extend({"defaults":{"sequence":100,"title":null,"name":"","contentView":null,"contentViewOptions":null},"constructor":function(e,i){t.Model.prototype.constructor.apply(this,arguments)}}),d=t.Collection.extend({"model":l,"comparator":"sequence","constructor":function(e,i){t.Collection.prototype.constructor.apply(this,arguments)}}),c=new d([{"title":s.properties,"name":"properties","sequence":10,"contentView":i},{"title":s.versions,"name":"versions","sequence":20,"contentView":o},{"title":s.audit,"name":"audit","sequence":20,"contentView":n},{"title":s.releases,"name":"releases","sequence":20,"contentView":a}]);if(r){c.add(e.flatten(r,!0));var u=1;c.forEach(function(e){e.get("name")||(e.set("name","unnamed_panel"+u,{"silent":!0}),u++)})}return c}),csui.define("csui/widgets/metadata/impl/metadata.dropdowntab.view",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/controls/tab.panel/tab.panel.view","csui/widgets/metadata/metadata.panels","csui/controls/tile/behaviors/perfect.scrolling.behavior","csui/controls/tab.panel/tab.links.dropdown.view","csui/lib/binf/js/binf"],function(e,t,i,o,n,a,s){"use strict";return o.extend({"className":"metadata-content-wrapper binf-panel binf-panel-default","ui":{"dropdownToggle":".binf-dropdown-toggle"},"contentView":function(){return this.options.contentView},"contentViewOptions":function(){return{"context":this.options.context,"model":this.options.node,"originatingView":this.options.originatingView,"metadataView":this.options.metadataView,"blockingParentView":this.options.blockingParentView,"selectedProperty":this.options.selectedProperty}},"constructor":function(t){this.options=t||(t={}),e.defaults(t,{"TabLinkCollectionViewClass":s,"implementTabContentsDefaultKeyboardHandling":!1,"delayTabContent":!1!==t.delayTabContent}),this.behaviors=e.extend({"PerfectScrolling":{"behaviorClass":a,"contentParent":".binf-dropdown-menu","suppressScrollX":!0,"includePadding":!0}},this.behaviors),t.tabs=this._buildTabs(),o.prototype.constructor.call(this,t),this.listenTo(this.options.node,"change",this._nodeChanged).listenTo(i,"closeToggleAction",this._closeToggle)},"_buildTabs":function(){return n.chain().filter(function(e){var t=e.get("contentView"),i=t.enabled;return this.options.node.attributes.customProperties?!!e.attributes.executeCommand&&(!i||i({"context":this.options.context,"node":this.options.node})):!i||i({"context":this.options.context,"node":this.options.node})},this).map(function(e){return e.attributes}).value()},"onRender":function(){this.$el.prepend("<div class='csui-metadata-tab-bar'></div>");var e=this;this.$el.find(".binf-dropdown-toggle").on("binf.dropdown.after.show",function(){e.trigger("update:scrollbar")})},"onActivateTab":function(e,t,i){e&&e.triggerMethod("panel:activated")},"_closeToggle":function(){var e=this.$el.find(".binf-dropdown-toggle");e.parent().hasClass("binf-open")&&(e.length&&e.length>1?e.each(function(e,i){t(i).parent().hasClass("binf-open")&&!t(i).is(":hidden")&&t(i).binf_dropdown("toggle")}):!e.is(":hidden")&&e.binf_dropdown("toggle"))},"_updateTabs":function(){var e=this._buildTabs();this.collection.reset(this._convertCollection({"tabs":e}).models)},"_nodeChanged":function(){(this.options.node.hasChanged("id")||this.options.node.hasChanged("type"))&&this._updateTabs()}})}),csui.define("csui/widgets/metadata/impl/metadata.controller",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/utils/url","csui/utils/base"],function(e,t,i,o,n){function a(e,t,i){this.status=e||{},this.options=t||{},this.attributes=i||{}}return e.extend(a.prototype,i.Events,{"save":function(e,t){return e.save(t,{"wait":!0,"patch":!0})},"createItem":function(e,t){return e.save(void 0,{"data":t,"wait":!0})}}),a.prototype.get=i.Model.prototype.get,e.extend(a,{"version":"1.0"}),a}),csui.define("csui/widgets/metadata/metadata.view",["module","csui/lib/underscore","csui/lib/jquery","csui/lib/marionette","csui/utils/base","csui/widgets/metadata/impl/header/metadata.header.view","csui/widgets/metadata/impl/metadata.dropdowntab.view","csui/utils/contexts/factories/node","csui/controls/mixins/view.events.propagation/view.events.propagation.mixin","csui/controls/mixins/view.state/metadata.view.state.mixin","csui/widgets/metadata/impl/metadata.controller","csui/controls/progressblocker/blocker","csui/utils/commandhelper","csui/widgets/permissions/permissions.view","csui/dialogs/modal.alert/modal.alert","csui/utils/contexts/factories/next.node","i18n!csui/widgets/metadata/impl/nls/lang","css!csui/widgets/metadata/impl/metadata"],function(e,t,i,o,n,a,s,r,l,d,c,u,m,h,p,g,f){"use strict";var w=e.config();t.defaults(w,{"showExtraRightActionBar":!1});var b=o.ItemView.extend({"className":"cs-metadata","template":!1,"constructor":function(e){var n=this;e||(e={}),e.data||(e.data={}),this.options=e,this.context=e.context,this.enableViewState=void 0===e.enableViewState||e.enableViewState,this.enableViewState&&this.isShowPermissionView()&&!e.model&&this.initOptionsFromMetadataInfo(e),this.options.showExtraRightActionBar=this.options.showPermissionView||w.showExtraRightActionBar,this.targetView=e.targetView,this.thumbnailViewState=e.originatingView&&e.originatingView.thumbnailViewState;var l=!1;if(!e.model){e.model=e.context.getModel(r);var d=t.keys(e.model.attributes);e.model.fetching||1!==d.length||"id"!==d[0]||(e.model.fetched=!1),l=!0}var c=this.context&&this.context.viewStateModel;if(this._isViewStateModelEnabled()?(l&&e.model&&e.model.ensureFetched&&(this.isShowPermissionView()&&!e.model.fetched&&(e.model.delayRestCommands=!1),e.model.ensureFetched()),this.isMetadataNavigation()?this.options.showBackIcon=!1:(this.options.showBackIcon=!0,c&&!c.hasRouted()&&(this.options.showBackIcon=!1),this._isViewStateModelEnabled()&&this._addUrlParametersSupport(e.context),this.listenTo(this,"metadata:close",this._backToPreviousPerspective),this.listenTo(e.model,"delete",this._navigateToParent))):!1===this.options.navigationView&&this.listenTo(e.model,"delete",function(){n.trigger("metadata:close")}),e.model.unset("initialPanel",{"silent":!0}),e.data.initialPanel&&e.model.set("initialPanel",e.data.initialPanel,{"silent":!0}),this.options.showShortcutSwitch=!0,this.options.showRequiredFieldsSwitch=!0,1===this.options.model.get("type")||this.options.model.get("shortcutNode")){if(l||!(this.options.model.get("shortcutNode")&&1!==this.options.model.get("type")||this.options.model.original&&(void 0===this.options.model.original.get("type")||this.options.model.original.get("type")<0))&&this.options.model.get("original_id"))if(this.options.model.get("shortcutNode")&&1!==this.options.model.get("type"))this.options.shortcutNode=this.options.model.get("shortcutNode");else{this.options.model.connector.assignTo(this.options.model.original),this.options.shortcutNode=this.options.model;var m=this.options.shortcutNode.getResourceScope();this.options.model.original.setResourceScope(m),this.options.model=this.options.model.original,this.options.model.set("shortcutNode",this.options.shortcutNode,{"silent":!0})}else this.options.shortcutNode=this.options.model.get("shortcutNode");this.options.actionsPromise=this._ensureCompleteNode()}else this.options.model.refetchNodeActions?this.options.actionsPromise=this._ensureCompleteNode():this.options.actionsPromise=i.Deferred().resolve().promise();this.options.originatingView&&this.options.originatingView.supportOriginatingView&&(this.options.baseOriginatingView=this.options.originatingView,this.options.originatingView=this),o.ItemView.prototype.constructor.call(this,e),u.imbue(this),this.options.showDropdownMenu=!0,this.options.originatingView=this.options.originatingView||this,this.metadataHeaderView=new a(t.extend({"metadataScenario":!0,"originatingView":this},this.options)),this.listenTo(this.metadataHeaderView,"metadata:item:name:save",this._saveItemName).listenTo(this.metadataHeaderView,"shortcut:switch",function(e){n.options.model=e.node,n.options.model.set("shortcutNode",n.model.get("shortcutNode"),{"silent":!0}),this._ensureCompleteNode().always(function(){!!n.metadataTabView&&n.metadataTabView.destroy(),n.options.showPermissionView?n.metadataTabView=new h({"model":n.options.model,"originatingView":n.options.originatingView,"context":n.options.context,"showCloseIcon":!n.options.originatingView,"showBackIcon":!!n.options.originatingView,"selectedTab":status.selectedTab,"selectedProperty":n.options.selectedProperty}):n.metadataTabView=new s({"context":n.options.context,"node":n.options.model,"containerCollection":n.options.containerCollection,"originatingView":n.options.originatingView,"metadataView":n,"activeTab":n.options.activeTab,"delayTabContent":n.options.delayTabContent}),n.$el.append(n.metadataTabView.render().$el),n.propagateEventsToViews(n.metadataTabView)})}).listenTo(this.metadataHeaderView,"metadata:close",function(){n.trigger("metadata:close")}).listenTo(this.options.context,"retain:perspective",function(){n._closeMetadata()});var p={"context":this.options.context,"node":this.options.model,"containerCollection":this.options.containerCollection,"originatingView":this.options.originatingView,"metadataView":this,"blockingParentView":this,"activeTab":this.options.activeTab,"selectedTab":this.options.selectedTab||this.getViewStateDropdown(),"selectedProperty":this.options.selectedProperty,"delayTabContent":n.options.delayTabContent};this.options.showPermissionView?this.options.actionsPromise.always(function(){n.metadataTabView=new h({"model":n.options.model,"originatingView":n.options.originatingView,"context":n.options.context,"showCloseIcon":!n.options.originatingView,"showBackIcon":!!n.options.originatingView,"selectedTab":status.selectedTab,"selectedProperty":n.options.selectedProperty}),n.propagateEventsToViews(n.metadataTabView,n.metadataHeaderView),n._isViewStateModelEnabled()&&n.listenTo(n.context.viewStateModel,"change:state",n.onViewStateChanged)}):this.options.actionsPromise.always(function(){n.metadataTabView=new s(p),n.propagateEventsToViews(n.metadataTabView,n.metadataHeaderView),n._isViewStateModelEnabled()&&n.listenTo(n.context.viewStateModel,"change:state",n.onViewStateChanged)}),
this.enableViewState&&c&&!this.isMetadataNavigation()&&this.listenTo(c,"navigate",function(e){e&&!0!==n.options.showBackIcon&&(n.options.showBackIcon=!0,n.metadataHeaderView.showBackIcon(!0,n.__isRendered))})},"onRender":function(){var e=this.options.model.fetchingActions||this.options.model.fetching;if(e)return e.always(t.bind(this.render,this));this.__isRendered=!0;var i=this.metadataHeaderView.render(),n=this.metadataTabView.render();o.triggerMethodOn(i,"before:show",i,this),o.triggerMethodOn(n,"before:show",n,this),this.$el.append(i.el),this.$el.append(n.el),this.$el.attr({"role":"region","aria-label":f.metadataRegionAria}),o.triggerMethodOn(i,"show",i,this),o.triggerMethodOn(n,"show",n,this),this._isViewStateModelEnabled()&&!this.showPermissionView&&this._listenToDropdownSelection()},"_isViewStateModelEnabled":function(){var e=this.context&&this.context.viewStateModel;return this.enableViewState&&e&&e.get("enabled")},"onViewStateChanged":function(){var e=this.getViewStateDropdown()||this.getDefaultViewStateDropdown(),t=this.metadataTabView.tabLinks;t&&t.selected&&e&&t.selected.get("name")!==e&&t.activateDropdownTab(e,!0)},"_listenToDropdownSelection":function(){var e=this.metadataTabView.tabLinks;if(e&&e.selected){var t=this.getViewStateDropdown();t!==e.selected.get("name")&&this.setViewStateDropdown(e.selected.get("name"),{"default":!t,"title":e.selected.get("title").toLowerCase()}),this.listenTo(e.selected,"change",this._onDropDownSelectionChanged)}},"_onDropDownSelectionChanged":function(e){this.setViewStateDropdown(e.get("name"),{"title":e.get("title").toLowerCase()})},"onBeforeDestroy":function(){this.metadataTabView&&(this.cancelEventsToViewsPropagation(this.metadataTabView),this.metadataTabView.destroy()),this.metadataHeaderView&&(this.cancelEventsToViewsPropagation(this.metadataHeaderView),this.metadataHeaderView.destroy()),this.targetView&&this.thumbnailViewState&&this.targetView.thumbnail.resultsView.triggerMethod("metadata:close")},"_saveItemName":function(e){var i=this,o=e.sender.getValue(),n={"name":o};this.model.changed&&this.model.changed.name_multilingual&&t.extend(n,{"name_multilingual":this.model.changed.name_multilingual});var a,s=new c,l=this.options.model;this.options.collection;if(this.options.shortcutNode&&this.options.shortcutNode.original===l){var d=this.options.collection.findWhere({"id":l.get("id")});d?(a=l,l=d):void 0}var u=i.context.getModel(r);u&&u.set("name",o),i._blockActions(),s.save(l,n).done(function(){return l.fetch().then(function(){a&&a.set(l.attributes),e.success&&e.success(),i._unblockActions(),i.options.originatingView&&t.isFunction(i.options.originatingView.unblockActions)&&i.options.originatingView.unblockActions()})}).fail(function(t){i._unblockActions();var o=m._getErrorMessageFromResponse(t);void 0===o&&(o=f.failedToSaveName),e.error&&e.error(o)})},"_ensureCompleteVersionNode":function(){return this._blockActions(),this.options.model.fetch().always(t.bind(this._unblockActions,this)).fail(function(e){var t=new n.Error(e);p.showError(t.message)})},"_ensureCompleteNode":function(){var e=this.options.model;return e&&e.refetchNodeActions?(e.fetchingActions||(e.fetchingActions=e.setEnabledLazyActionCommands(!0)),e.fetchingActions.done(t.bind(function(){e.refetchNodeActions=!1,e.fetchingActions=!1},this)).fail(t.bind(function(e){var t=new n.Error(e);p.showError(t.message)},this)),e.fetchingActions):this.options.showShortcutSwitch?e.fetch():i.Deferred().resolve().promise()},"_backToPreviousPerspective":function(){this._isViewStateModelEnabled()?this.context.viewStateModel.restoreRouterOfLastApplicationScope():this._setNextNodeModelFactory(this.options.model.get("id"))},"_navigateToParent":function(){var e=this.options.model.get("parent_id");e?this._setNextNodeModelFactory(e):this._backToPreviousPerspective()},"_setNextNodeModelFactory":function(e){if(this.context&&void 0!==e){var t=this.context.getModel(g);t&&(t.get("id")===e&&t.unset("id",{"silent":!0}),t.set("id",e))}},"_closeMetadata":function(){var e=this.options.model;1===e.get("type")&&e.original&&0===e.original.get("type")?this.trigger("metadata:close"):this.trigger("metadata:close:without:animation")},"_blockActions":function(){var e=this.options.originatingView;e&&e.blockActions&&e.blockActions()},"_unblockActions":function(){var e=this.options.originatingView;e&&e.unblockActions&&e.unblockActions()},"_addUrlParametersSupport":function(e){var t=e&&e.viewStateModel;t&&t.addUrlParameters(["dropdown"],e)}});return t.extend(b.prototype,l),t.extend(b.prototype,d),b}),csui.define("csui/widgets/metadata/metadata.action.one.item.properties.view",["module","csui/lib/underscore","csui/lib/jquery","csui/lib/marionette","csui/utils/base","csui/widgets/metadata/impl/header/metadata.header.view","csui/widgets/metadata/metadata.properties.view","csui/utils/log","csui/controls/mixins/view.events.propagation/view.events.propagation.mixin","css!csui/widgets/metadata/impl/metadata"],function(e,t,i,o,n,a,s,r,l){var d=o.ItemView.extend({"className":"cs-add-item-metadata-form","template":!1,"constructor":function(e){e||(e={}),this.options=e,o.ItemView.prototype.constructor.apply(this,arguments),e.showRequiredFieldsSwitch=!0,this.metadataHeaderView=new a(e),this.listenTo(this.metadataHeaderView,"metadata:item:name:save",this._saveItemName),this.listenTo(this.metadataHeaderView,"update:button",t.bind(function(e){this.trigger("update:button",e)},this)),this.metadataPropertiesView=new s({"node":e.model,"collection":e.collection,"container":e.container,"context":e.context,"hideStickyHeader":!!e.hideStickyHeader,"formMode":"create","action":e.action,"inheritance":e.inheritance,"metadataView":this,"formCollection":e.formCollection,"suppressAddProperties":e.suppressAddProperties}),e.collection||this.listenTo(this.metadataPropertiesView.allForms,"sync",this._updateSchema),this.listenTo(this.metadataPropertiesView,"render:forms",this.setNameFieldFocus),this.propagateEventsToViews(this.metadataHeaderView,this.metadataPropertiesView)},"_updateSchema":function(){var e=this.metadataPropertiesView.allForms.first(),t=e&&e.get("schema"),i=t&&t.properties&&t.properties.name;i?this.metadataHeaderView.metadataItemNameView.updateNameSchema(i):r.warn("Form collection lacks name field in the first form.")&&console.warn(r.last)},"onRender":function(){var e=this.metadataHeaderView.render(),t=this.metadataPropertiesView.render();o.triggerMethodOn(e,"before:show",e,this),o.triggerMethodOn(t,"before:show",t,this),!0!==this.options.suppressHeaderView&&this.$el.append(e.el),this.$el.append(t.el),this.options.suppressHeaderView&&this.$el.addClass("without-header-bar"),this.options.extraViewClass&&this.$el.addClass(this.options.extraViewClass),o.triggerMethodOn(e,"show",e,this),o.triggerMethodOn(t,"show",t,this)},"onBeforeDestroy":function(){this.cancelEventsToViewsPropagation(this.metadataHeaderView,this.metadataPropertiesView),this.metadataHeaderView.destroy(),this.metadataPropertiesView.destroy()},"validate":function(){var e=this.metadataHeaderView.validateName(),t=this.metadataPropertiesView.validateForms();return e&&t},"getValues":function(){var e={},i=this.validate(),o=n.getMetadataLanguageInfo().enabled,a=n.getMetadataLanguageInfo().defaultLanguage;if(i){var s=this.metadataHeaderView.getNameValue(),r=this.metadataHeaderView&&this.metadataHeaderView.model;if(e={"name":s,"type":this.options.model.get("type"),"parent_id":this.options.model.get("parent_id")},r&&o){var l={};!!r.has("name_multilingual")&&(l.name_multilingual=r.get("name_multilingual")),!!r.has("description_multilingual")&&(l.description_multilingual=r.get("description_multilingual")),t.extend(e,l)}var d=this.metadataPropertiesView.getFormsValues();d.description&&(d.description=o&&t.isObject(d.description)?d.description[a]:d.description),t.extend(e,d)}return e},"setNameFieldFocus":function(){!0!==this.firstFocusCalled&&!0!==this.options.suppressHeaderView&&this.metadataHeaderView.setNameEditModeFocus(),this.firstFocusCalled=!0},"_saveItemName":function(e){var t=e.sender.getValue();this.model.set("name",t,{"silent":!0}),e.success&&e.success()}});return d.version="1.0",t.extend(d.prototype,l),d}),csui.define("csui/widgets/metadata/impl/common/base.metadata.action.view",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/controls/dialog/dialog.view","csui/controls/progressblocker/blocker","i18n!csui/widgets/metadata/impl/nls/lang","css!csui/widgets/metadata/impl/metadata"],function(e,t,i,o,n,a){function s(){}return e.extend(s.prototype,i.Events,{"baseDisplayForm":function(i){if(i||(i={}),this.options=i,this.deferred=t.Deferred(),i.view&&n.imbue(i.view),i.originatingView);else{var s=i.dialogOptions||{},r=s.OkButtonClick||this._cancelAction,l=s.CancelButtonClick||this._cancelAction,d=[{"id":"okButton","default":!0,"label":s.OkButtonTitle?s.OkButtonTitle:a.defaultDialogOkButtonTitle,"click":e.bind(r,this,i)},{"id":"cancel","label":s.CancelButtonTitle?s.CancelButtonTitle:a.defaultDialogCancelButtonTitle,"close":!0,"click":e.bind(l,this),"actionToken":s.CancelButtonActionToken}];this.options.view.model&&(this.options.view.model.get("name")||(d[0].disabled=!0));var c=s.dialogTitle?s.dialogTitle:a.defaultDialogTitle,u=new o({"className":"cs-item-action-metadata","title":c,"buttons":d,"largeSize":!0,"view":i.view});this.dialog=u,this.listenTo(this.dialog,"hide",this._cancelAction).listenTo(this.dialog,"update:button",e.bind(function(e){if(void 0!==e.overlay){var t=this.dialog.footerView.collection.get("okButton"),i=this.dialog.footerView.children.findByModel(t),o=i&&!i.$el.is(":disabled")&&e.overlay?"addClass":"removeClass";i.$el[o]("cs-button-overlay")}else this.dialog.footerView.updateButton("okButton",e)},this)),u.show()}return this.deferred.promise()},"_cancelAction":function(e){!!this.node&&!!this.node.collection&&!!this.node.collection.requireSwitched&&(!!this.node.get("action")||!!this.options.view&&this.options.view.options.action)&&(this.node.collection.requireSwitched=!1),this.options.view&&this.options.view.unblockActions(),this.dialog.destroy(),void 0===e&&(e={"buttonAttributes":{"actionToken":"closeMetadataActionView"}}),this.deferred.reject(e)}}),s.prototype.get=i.Model.prototype.get,e.extend(s,{"version":"1.0"}),s}),csui.define("csui/widgets/metadata/impl/add.properties/metadata.add.categories.view",["require","csui/lib/underscore","csui/lib/jquery","csui/utils/url","csui/utils/log","csui/widgets/metadata/impl/common/base.metadata.action.view","csui/models/forms","csui/models/appliedcategories/category","i18n!csui/widgets/metadata/impl/nls/lang","csui/dialogs/modal.alert/modal.alert","css!csui/widgets/metadata/impl/metadata"],function(e,t,i,o,n,a,s,r,l,d){"use strict";function c(){}return t.extend(c.prototype,a.prototype,{"displayForm":function(e){var t=i.Deferred(),o=this;e||(e={}),this.node=e.model,this.catId=e.catId,this.catName=e.catName;var a=new s([e.catModel]);return a.fetching=!1,a.fetched=!0,csui.require(["csui/widgets/metadata/metadata.action.one.item.properties.view"],function(i){o.metadataAddItemPropView=new i({"model":e.model,"collection":a,"context":e.context,"commands":e.commands,"suppressAddProperties":!0,"suppressHeaderView":!0,"hideStickyHeader":!0,"extraViewClass":"add-category"});var n={};n.callerProcessData=e.callerProcessData,n.originatingView=e.originatingView,n.view=o.metadataAddItemPropView;var s={};s.dialogTitle=e.dialogTitle?e.dialogTitle:l.addNewCategoryDialogTitle,s.OkButtonTitle=e.okButtonTitle?e.okButtonTitle:l.addNewCategoryDialogAddButtonTitle,s.OkButtonClick=o._addCategory,n.dialogOptions=s,o.baseDisplayForm(n).done(function(e){t.resolve(e)}).fail(function(e){t.reject(e)})},function(e){n.warn("Failed to load MetadataActionOneItemPropertiesView. {0}",e)&&console.log(n.last),t.reject(e)}),t.promise()},"_addCategory":function(e){if(this.metadataAddItemPropView.validate()){this.options.view.$el.find(".cs-formfield-invalid").removeClass("cs-formfield-invalid");var i=this.node.get("id"),o=this.metadataAddItemPropView.getValues(),n={"id":i,"category_id":this.catId};o.roles&&o.roles.categories&&t.each(o.roles.categories,function(e,i){n=t.extend(n,e)});var a=new r({},{"connector":this.node.connector,"node":this.node});this.metadataAddItemPropView.blockActions(),a.save(n,{"type":"POST","processData":!1,"contentType":!1}).done(t.bind(function(e){this.metadataAddItemPropView.unblockActions(),this.dialog.destroy(),this.deferred.resolve(e)},this)).fail(t.bind(function(e){this.metadataAddItemPropView.unblockActions();var o="";e&&e.responseJSON&&e.responseJSON.error&&(o=e.responseJSON.error);var n=l.addNewCategoryFailTitle,a=t.str.sformat(l.addNewCategoryFailMessage,this.catName,this.node.get("name"),i,o);d.showError(a,n)},this))}else this.options.view.$el.find(".binf-has-error .cs-formfield").addClass("cs-formfield-invalid")}}),t.extend(c,{"version":"1.0"}),c}),csui.define("csui/widgets/metadata/metadata.add.categories.controller",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/utils/url","csui/utils/base","i18n!csui/widgets/metadata/impl/nls/lang","csui/dialogs/modal.alert/modal.alert","csui/widgets/metadata/impl/metadata.utils","csui/widgets/metadata/impl/add.properties/metadata.add.categories.view","csui/models/appliedcategoryform","csui/dialogs/node.picker/node.picker","csui/utils/commands","css!csui/widgets/metadata/impl/metadata"],function(e,t,i,o,n,a,s,r,l,d,c,u){"use strict";function m(){}return e.extend(m.prototype,i.Events,{"AddNewCategory":function(i){var o=t.Deferred();return new c({"startLocation":"category.volume","context":i.context,"selectableTypes":[131],"unselectableNodes":i.collection?i.collection.where({"role_name":"categories"}):[],"selectMultiple":!1,"dialogTitle":a.selectCategoryTitle,"globalSearch":!0,"selectButtonLabel":a.selectCategoryButtonLabel}).show().done(e.bind(function(n){e.reduce(n.nodes,function(t,o){return t.then(e.bind(function(){var e=o.get("id"),t=o.get("name");return void 0===i.node.get("id")||i.action?this._loadNewCategoryForm(i,e,t):this._displayAddCategoryForm(i,e,t)},this))},t.Deferred().resolve(),this).done(function(e){o.resolve(e)}).fail(function(e){o.reject(e)})},this)).fail(function(e){o.reject(e)}),o.promise()},"_displayAddCategoryForm":function(e,i,o){var n=t.Deferred(),a=this;return this._getCategoryModel(e,i,o).done(function(t){var s={"model":e.node,"context":e.context,"commands":u,"catId":i,"catName":o,"catModel":t.catModel};(new l).displayForm(s).done(function(t){a._loadNewCategoryForm(e,i,o,"update").done(function(e){n.resolve(e)}).fail(function(e){n.reject(e)})}).fail(function(e){n.reject(e)})}).fail(function(e){n.reject(e)}),n.promise()},"_loadNewCategoryForm":function(i,o,n,r){if(o&&i.collection.get(o)){var l=a.addNewCategoryFailTitle,d=e.str.sformat(a.categoryExistsMessage,n);return s.showError(d,l),t.Deferred().reject({})}var c=t.Deferred();return this._getCategoryModel(i,o,n,r).done(e.bind(function(e){c.resolve(e)},this)).fail(function(e){c.reject(e)}),c.promise()},"_getCategoryModel":function(i,n,l,c){var u=!0;c||(c="create",void 0===i.action&&(u=!1));var m,h=t.Deferred(),p=i.node&&i.node.connector||i.container&&i.container.connector,g=i.node.get("id");if(i.container&&(i.node.pId=i.container.get("id")),void 0===i.node.get("id")&&"create"===i.action)m=o.combine(p.connection.url,"forms/nodes/create?parent_id="+i.container.get("id")+"&type="+i.node.get("type")+"&category_id="+n);else if("copy"===i.action||"move"===i.action||"restructure"===i.action){var f=0;"destination"===i.inheritance?f=1:"merged"===i.inheritance&&(f=2),m=o.combine(p.connection.url,"forms/nodes/"+i.action+"?id="+g+"&parent_id="+i.container.get("id")+"&inheritance="+f+"&category_id="+n)}else m=o.combine(p.connection.url,"forms/nodes/categories/"+c+"?id="+g+"&category_id="+n);var w={"type":"GET","url":m};return i.parentView&&(i.parentView.blockActions(),i.parentView.trigger("update:button",!0)),p.makeAjaxCall(w).done(e.bind(function(t){i.parentView&&i.parentView.unblockActions();var o,a,s,c;if("create"===i.action||"copy"===i.action||"move"===i.action||"restructure"===i.action?t.forms.length>1&&(o=e.find(t.forms,function(e){return"categories"===e.role_name}))&&(a=o.data[n]||{},s=o.options.fields[n]||{},c=o.schema.properties[n]||{}):(o=t&&t.forms&&t.forms[0],a=o&&o.data||{},s=o.options||{},c=o.schema||{}),o){s.form&&(s=e.omit(s,"form")),void 0===c.title&&l&&(c.title=l);var m=new r,p=m.AlpacaFormOptionsSchemaHaveRequiredFields(s,c),g=new d({"id":n,"title":l||s&&s.fields&&s.fields.category_id&&s.fields.category_id.label,"allow_delete":u,"removeable":u,"required":p,"data":a,"schema":e.omit(c,"description"),"options":s,"role_name":"categories"},{"node":i.node,"categoryId":n,"action":"none","parse":!0});h.resolve({"catModel":g})}else h.reject({})},this)).fail(e.bind(function(t){i.parentView&&(i.parentView.unblockActions(),i.parentView.trigger("update:button",!1));var o=this._getRespError(t),n=a.loadNewCategoryFailTitle,r=e.str.sformat(a.loadNewCategoryFailMessage,l,i.node.get("name"),g,o);s.showError(r,n),h.reject(t)},this)),h.promise()},"_getRespError":function(e){var i="";return e&&e.responseJSON&&e.responseJSON.error?i=e.responseJSON.error:n.MessageHelper.hasMessages()&&(i=t(n.MessageHelper.toHtml()).text(),n.MessageHelper.clear()),i}}),e.extend(m,{"version":"1.0"}),m}),csui.define("csui/widgets/metadata/metadata.add.item.controller",["csui/lib/underscore","csui/widgets/metadata/impl/common/base.metadata.action.view","csui/widgets/metadata/impl/metadata.controller","csui/widgets/metadata/metadata.action.one.item.properties.view","csui/utils/commandhelper","i18n!csui/widgets/metadata/impl/nls/lang","csui/dialogs/modal.alert/modal.alert","csui/utils/nodesprites","csui/utils/commands","css!csui/widgets/metadata/impl/metadata"],function(e,t,i,o,n,a,s,r,l){function d(){}return e.extend(d.prototype,t.prototype,{"displayForm":function(t,i){var s=n.getAtLeastOneNode(t),d=s.length>0?s.models[0]:null,c=d.get("type_name")?r.findTypeByNode(d):a.addItemMetadataDialogTitleGeneric;this.node=d,this.metadataController=i.metadataController;var u=this.metadataAddItemPropView=new o({"model":d,"container":t.container,"id":i.id,"context":t.context||i&&i.context,"commands":l,"action":"create","inheritance":i.inheritance,"collection":i.completeFormCollection,"formCollection":i.formCollection,"suppressAddProperties":i.suppressAddProperties}),m={};m.callerProcessData=i.callerProcessData,m.originatingView=i.originatingView,m.view=u;var h={};h.dialogTitle=i.dialogTitle?i.dialogTitle:e.str.sformat(a.addItemMetadataDialogTitle1,c),h.OkButtonTitle=i.addButtonTitle?i.addButtonTitle:a.addItemMetadataDialogButtonAddTitle,h.OkButtonClick=this._addItem,h.CancelButtonActionToken=i.cancelButtonActionToken,m.dialogOptions=h;var p=this.baseDisplayForm(m);return this.listenTo(this.metadataAddItemPropView,"update:button",e.bind(function(e){this.dialog&&this.dialog.trigger("update:button",e)},this)),p},"_addItem":function(t){function o(e,t){e&&e.footerView&&e.footerView.getButtons().forEach(function(e){e.updateButton(t)})}if(t.view.metadataPropertiesView.allFormsRendered){var n=!1;!0!==t.callerProcessData&&(o(this.dialog,{"disabled":!0}),n=!0);if(this.metadataAddItemPropView.validate()){var r=this.metadataAddItemPropView.getValues();if(!0===t.callerProcessData)this.dialog.destroy(),this.deferred.resolve({"data":r});else{var l=this.metadataController||new i;this.metadataAddItemPropView.blockActions(),n=!1,l.createItem(this.node,r).done(e.bind(function(e){this.listenToOnce(this.dialog,"hide",function(){this.metadataAddItemPropView.unblockActions(),o(this.dialog,{"disabled":!1})}),this.dialog.destroy(),this.deferred.resolve({"name":r.name})},this)).fail(e.bind(function(e){this.metadataAddItemPropView.unblockActions();var t=a.failedToCreateItem;e&&(e.responseJSON&&e.responseJSON.error?t=e.responseJSON.error:e.responseText&&(t=e.responseText),s.showError(t)),o(this.dialog,{"disabled":!1})},this))}}n&&o(this.dialog,{"disabled":!1})}}}),e.extend(d,{"version":"1.0"}),d}),csui.define("csui/widgets/metadata/impl/metadata.navigation.list.keyboard.behavior",["module","csui/lib/underscore","csui/lib/jquery","csui/utils/log","csui/lib/marionette"],function(e,t,i,o,n){"use strict";var a={"none":-1,"header":0,"list":1};return n.Behavior.extend({"constructor":function(e,o){n.Behavior.prototype.constructor.apply(this,arguments),o.keyboardBehavior=this,this.tabableElements=[];var s=this;this.listenTo(o,"show",function(){s.refreshTabableElements(o)}),this.listenTo(o,"click:item",function(e){var t=o.selectedIndex,i=o.selectedIndexElem(t);i&&i.prop("tabindex","-1"),o.currentTabPosition=a.list,o.selectedIndex=o.collection.indexOf(e.model)}),t.extend(o,{"_focusHeader":function(){if(!0===this.headerFocusable&&this.headerElement)return this.currentTabPosition=a.header,i(this.ui.header)},"_focusList":function(){return(this.selectedIndex<0||void 0===this.selectedIndex)&&(this.selectedIndex=this.getSelectedIndex()),this.currentTabPosition=a.list,this.getSelectedItem()&&this.getSelectedItem().$el},"_setFocus":function(){return!0===this.headerFocusable&&this.headerElement?this._focusHeader():this._focusList()},"_headerIsInFocus":function(){return this.$(this.ui.header).is(":focus")},"_listIsInFocus":function(){var e,t=!1;for(e=0;e<this.collection.length;e++){var i=this.selectedIndexElem(e);if(i&&i.is(":focus")){t=!0;break}}return t},"_checkFocusAndSetCurrentTabPosition":function(){this._headerIsInFocus()?this.currentTabPosition=a.header:this._listIsInFocus()?this.currentTabPosition=a.list:this.currentTabPosition=a.none},"_setFirstAndLastFocusable":function(){!0===this.headerFocusable&&i(this.ui.header).prop("tabindex","0"),this.getSelectedItem()&&this.getSelectedItem().$el.prop("tabindex","0")},"currentlyFocusedElement":function(e){return this._checkFocusAndSetCurrentTabPosition(),this._setFirstAndLastFocusable(),e&&e.shiftKey?this._focusList():this.currentTabPosition===a.header?this._focusHeader():this.currentTabPosition===a.list?this._focusList():this._setFocus()},"_resetFocusedListElem":function(){var e,t;e=this.selectedIndex,t=this.selectedIndexElem(e),t&&t.prop("tabindex","-1"),e=this.getSelectedIndex(),t=this.selectedIndexElem(e),t&&(t.prop("tabindex","0"),this.selectedIndex=e),i(this.ui.header).prop("tabindex","0")},"_moveTo":function(e,i,o){e.preventDefault(),e.stopPropagation(),setTimeout(t.bind(function(){o&&o.prop("tabindex","-1"),i.prop("tabindex","0"),i[0].focus()},this),50)},"onKeyInView":function(e){this._checkFocusAndSetCurrentTabPosition(),9===e.keyCode?e.shiftKey?this.currentTabPosition===a.list&&!0===this.headerFocusable&&this.headerElement&&i(this.ui.header).is(":visible")&&(this._moveTo(e,this._focusHeader()),this._resetFocusedListElem()):this.currentTabPosition===a.header?this.$el.find(">.cs-content").is(":visible")&&this._moveTo(e,this._focusList()):setTimeout(t.bind(function(){this._resetFocusedListElem()},this),50):32!==e.keyCode&&13!==e.keyCode||(this.currentTabPosition===a.header?(e.preventDefault(),e.stopPropagation(),this.clickBack()):this.currentTabPosition===a.list&&(e.preventDefault(),e.stopPropagation(),this.selectAt(this.selectedIndex)))},"onKeyDown":function(e){if(this._checkFocusAndSetCurrentTabPosition(),this.currentTabPosition!==a.list)return void this.onKeyInView(e);var t=this.selectedIndex;(t<0||void 0===t)&&(t=this.getSelectedIndex());var i=this.selectedIndexElem(t);switch(e.which){case 33:this._moveTo(e,this._selectFirst(),i);break;case 34:this._moveTo(e,this._selectLast(),i);break;case 38:this._moveTo(e,this._selectPrevious(),i);break;case 40:this._moveTo(e,this._selectNext(),i);break;default:return void this.onKeyInView(e)}},"_selectFirst":function(){return this.selectedIndex=0,this.selectedIndexElem(this.selectedIndex)},"_selectLast":function(){return this.selectedIndex=this.collection.length-1,this.selectedIndexElem(this.selectedIndex)},"_selectNext":function(){return(this.selectedIndex<0||void 0===this.selectedIndex)&&(this.selectedIndex=this.getSelectedIndex()),this.selectedIndex<this.collection.length-1&&this.selectedIndex++,this.selectedIndexElem(this.selectedIndex)},"_selectPrevious":function(){return(this.selectedIndex<0||void 0===this.selectedIndex)&&(this.selectedIndex=this.getSelectedIndex()),this.selectedIndex>0&&this.selectedIndex--,this.selectedIndexElem(this.selectedIndex)},"selectAt":function(e){if(!(e>=this.collection.length||e<0)){var t=this.selectedIndexElem(e);t&&t.trigger("click")}}})},"refreshTabableElements":function(e){o.debug("MetadataNavigationListKeyboardBehavior::refreshTabableElements "+e.constructor.name)&&console.log(o.last),e.options.data.back_button&&(this.view.headerFocusable=!0,this.view.headerElement=e.ui.header),this.view.currentTabPosition=a.none,this.view.selectedIndex=-1}})}),csui.define("csui/widgets/metadata/impl/metadata.navigation.list.view",["csui/lib/underscore","csui/lib/jquery","csui/controls/list/simplelist.view","csui/behaviors/keyboard.navigation/tabable.region.behavior","csui/widgets/metadata/impl/metadata.navigation.list.keyboard.behavior","csui/controls/node-type.icon/node-type.icon.view","csui/models/version","i18n!csui/widgets/metadata/impl/nls/lang"],function(e,t,i,o,n,a,s,r){return i.extend({"childViewOptions":function(e){return{"templateHelpers":function(){var e=this.options.nameAttribute||"name";return{"enableIcon":!0,"name":this.model.get(e)}},"nameAttribute":this.options.data.nameAttribute,"childRole":this.options.data.childRole}},"events":{"keydown":"onKeyDown"},"behaviors":{"TabableRegionBehavior":{"behaviorClass":o,"initialActivationWeight":100},"MetadataNavigationListKeyboardBehavior":{"behaviorClass":n}},"constructor":function(t){this.options=t||{},this.events=e.extend({},i.prototype.events,this.events),i.apply(this,arguments),this.listenTo(this,"childview:render",this.onRenderItem),this.listenTo(this,"childview:before:destroy",this.onBeforeDestroyItem)},"onRenderItem":function(e){if(e.model instanceof s){var i=e.model.get("version_number_name");t(e.$(".csui-type-icon").get(0)).append("<span title='"+i+"' class='list-item-version'>"+i+"</span>")}else this.options&&this.options.isThumbnailView||this.options.originatingView&&this.options.originatingView.thumbnailView?(this.$el.addClass("csui-metadata-navigation-thumbnail"),e.model.attributes.image_url=e.model.get("csuiThumbnailImageUrl")):this.$el.find(".csui-metadata-navigation-thumbnail").removeClass("csui-metadata-navigation-thumbnail"),e._nodeIconView=new a({"el":e.$(".csui-type-icon").get(0),"node":e.model}),e._nodeIconView.render();var o=this.options.data&&!0===this.options.data.show_required,n=e.model&&e.model.options&&!0===e.model.options.enforcedRequiredAttrs;if(o&&n){var l=e.$(".list-item-title").get(0);if(l){var d,c;!0===e.model.validated?(d="cs-icon-required category_required_done",c=r.requiredPassedTooltip):(d="cs-icon-required category_required",c=r.requiredTooltip),t(l).before("<span class='"+d+"' aria-label='"+c+"' title='"+c+"'></span>")}}},"onBeforeDestroyItem":function(e){e._nodeIconView&&e._nodeIconView.destroy()}})}),csui.define("hbs!csui/widgets/metadata/impl/common/metadata.action.multiple.items",["module","hbs","nuc/lib/handlebars"],function(e,t,i){var o=i.template({"compiler":[8,">= 4.3.0"],"main":function(e,t,i,o,n){return'<div class="metadata-wrapper binf-col-md-12">\r\n  <div class="metadata-navigation">\r\n    <div class="metadata-sidebar"></div>\r\n    <div class="metadata-content"></div>\r\n  </div>\r\n</div>\r\n'}});return i.registerPartial("csui_widgets_metadata_impl_common_metadata.action.multiple.items",o),o}),csui.define("csui/widgets/metadata/impl/metadata.navigation.list.behavior",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/lib/marionette"],function(e,t,i,o){"use strict";return o.Behavior.extend({"constructor":function(t,n){o.Behavior.prototype.constructor.apply(this,arguments),e.extend(n,{"onBeforeShow":function(){this._showChildViews()},"onShow":function(){this._showScrollPosition()},"onBeforeDestroy":function(){this.mdv&&this.mdv.internal&&this.mdv.destroy(),this.mdn&&this.mdn.destroy()},"_showChildViews":function(){this.navigationRegion.show(this.mdn),this.contentRegion.show(this.mdv)},"_showScrollPosition":function(){if(this.initiallySelected instanceof i.Model){var e=this.mdn.collection.findIndex({"id":this.initiallySelected.get("id")});return(e<0||e>this.mdn.collection.length-1)&&(e=0),this.mdn.setSelectedIndex(e)}if(this.initiallySelected&&this.initiallySelected.length>0){var t=this.initiallySelected.models[0],o=this.mdn.collection.indexOf(t);-1===o&&(o=this.mdn.collection.findIndex({"id":t.get("id")})),this.mdn.setSelectedIndex(o)}else this.mdn.collection.models.length>0&&this.mdn.setSelectedIndex(0)}})}})}),csui.define("css!csui/widgets/metadata/impl/common/metadata.action.multiple.items",[],function(){}),csui.define("csui/widgets/metadata/impl/common/metadata.action.multiple.items.view",["csui/lib/underscore","csui/lib/backbone","csui/lib/marionette","csui/widgets/metadata/impl/metadata.navigation.list.view","csui/widgets/metadata/metadata.action.one.item.properties.view","hbs!csui/widgets/metadata/impl/common/metadata.action.multiple.items","csui/controls/mixins/layoutview.events.propagation/layoutview.events.propagation.mixin","csui/widgets/metadata/impl/metadata.navigation.list.behavior","csui/lib/jsonpath","css!csui/widgets/metadata/impl/common/metadata.action.multiple.items"],function(e,t,i,o,n,a,s,r,l){var d=i.LayoutView.extend({"className":"cs-metadata-add-items","template":a,"regions":{"navigationRegion":".metadata-sidebar","contentRegion":".metadata-content"},"behaviors":{"MetadataNavigationListBehavior":{"behaviorClass":r}},"constructor":function(e){e||(e={}),this.options=e,i.LayoutView.prototype.constructor.apply(this,arguments),this.collection=e.collection,this.container=e.container,this.context=e.context,this.originatingView=e.originatingView,this.initiallySelected=this.options.selected,this.commonCategories=e.commonCategories,this.initialFormData=e.initialFormData,this.requiredFields=[];var t=this._getInitiallySelectedModel();e.applyFlag&&t.set("applyFlag",e.applyFlag),this.mdv=new n({"model":t,"container":this.container,"context":this.context,"commands":e.commands,"originatingView":this.originatingView,"action":e.action,"inheritance":e.inheritance}),this.mdv.internal=!0,this._subscribeToMetadataViewEvents(),this.mdn=new o({"collection":e.collection,"data":{"back_button":!1,"title":"","show_required":!0}}),e.applyFlag&&this.setInitialCategories(),this.listenTo(this.mdn,"click:item",this.onClickItem),this.listenTo(this.mdn,"click:back",this.onClickBack),this.listenTo(this.mdn,"show:node",function(e){this._showNode(e.model)}),this.propagateEventsToRegions()},"_getInitiallySelectedModel":function(){return this.initiallySelected&&this.initiallySelected.length>0?this.initiallySelected.models[0]:this.collection&&this.collection.length>0?this.collection.models[0]:null},"onClickItem":function(e){this.validateAndSetValuesToNode()?this._showNode(e.model):e.cancelClick=!0},"setInitialCategories":function(){var t=this;e.each(this.mdn.collection.models,function(i){var o={};void 0===i.get("data")&&(0===i.get("type")||i.get("container")?(o.type=i.get("type")||0,o.container=i.get("container")||!0):(o.advanced_versioning=!1,o.mime_type=i.get("mime_type"),o.type=i.get("type")||144),o.name=i.get("newName")||i.get("name"),o.parent_id=this.mdv.options.container.get("id"),e.extend(o,JSON.parse(JSON.stringify(t.commonCategories)))),i.set("data",o)},this)},"getRequiredFields":function(){var t={},i=this;i.requiredFields=[],this.initialFormData&&this.initialFormData.models&&e.each(this.initialFormData.models,function(o,n){var a,s=o.get("data"),r=o.get("role_name"),d=o.get("options"),c=o.get("schema");if(s&&r&&(a=t.roles||(t.roles={}),a[r]||(a[r]={}),"categories"===r)){var u=l(c,"$..[?(@.required===true)]",{"resultType":"PATH"}),m=l(d,"$..[?(@.validate===false)]",{"resultType":"PATH"}),h=[];e.each(m,function(e){
var t=e.toString().match(/(\'[\w]*\')/g);t&&h.push(t[t.length-1].replace(/'/g,""))});var p=[];e.each(u,function(e){var t=e.toString().match(/(\'[\w]*\')/g);t&&p.push(t[t.length-1].replace(/'/g,""))}),p=p.filter(function(e){return-1===h.indexOf(e)}),p.length>0&&i.requiredFields.push(p)}})},"validateAndSetValuesToAllNode":function(){var t=this,i=!0,o=!0;return this.getRequiredFields(),e.each(this.mdn.collection.models,e.bind(function(n){var a=n.get("data");e.each(a.roles.categories,function(e){i=i&&t._checkForAlpacaRequiredFields(n,e)}),n.validated=i,o=o&&i},this)),o},"_checkForAlpacaRequiredFields":function(t,i){var o=!0,n=[];if(this.requiredFields){var a=!1;e.each(this.requiredFields,function(t){if(n=l(i,"$.."+t.toString(),{"resultType":"PATH"}.toArray),e.each(n,function(t){var i=function(t){if(t instanceof Array&&(null!==t||""!==t))e.each(t,function(e){i(e)});else if(null===t||""===t)return void(a=!0)};if(a)return void(o=!1);i(t)}),a)return void(o=!1)})}return o},"validateAndSetValuesToNode":function(){var t=this.mdn.getSelectedItem();if(this.mdv.validate()){var i=this.mdv.getValues();return t.model.newCategories.models.length>0&&e.each(t.model.newCategories.models,function(t){var o=t.get("id"),n=t.get("role_name"),a={};i&&i.roles&&i.roles[n]&&(a=i.roles[n]),!1===e.isEmpty(a[o])&&e.each(t.attributes.data,function(i,n){e.has(a[o],n)&&(t.attributes.data[n]=a[o][n])})}),t.model.validated=!0,t.model.set("data",i),!0}return this.mdv.metadataPropertiesView.allFormsRendered&&(t.model.validated=!1,t.model.trigger("change",t.model)),!1},"onClickBack":function(){this.trigger("metadata:close",{"sender":this})},"onItemNameChanged":function(e){var t=this.mdn.getSelectedItem(),i=this.mdn.getSelectedIndex();t.render(),this.mdn.setSelectedIndex(i)},"_showNode":function(e){this.mdv&&this.mdv.internal&&this.mdv.destroy(),e.set("applyFlag",this.options.applyFlag),this.mdv=new n({"model":e,"container":this.container,"context":this.context,"originatingView":this.originatingView,"action":this.options.action,"inheritance":this.options.inheritance}),this.mdv.internal=!0,this._subscribeToMetadataViewEvents(),this.contentRegion.show(this.mdv)},"_subscribeToMetadataViewEvents":function(){this.listenTo(this.mdv,"metadata:close",e.bind(function(){this.trigger("metadata:close",{"sender":this})},this)),this.listenTo(this.mdv,"item:name:changed",e.bind(this.onItemNameChanged,this))}});return e.extend(d.prototype,s),d}),csui.define("csui/widgets/metadata/impl/add.items/metadata.add.multiple.items.controller",["csui/lib/underscore","csui/widgets/metadata/impl/common/base.metadata.action.view","csui/models/node/node.model","csui/controls/dialog/dialog.view","csui/widgets/metadata/impl/common/metadata.action.multiple.items.view","i18n!csui/widgets/metadata/impl/nls/lang","csui/dialogs/modal.alert/modal.alert","csui/utils/commands","css!csui/widgets/metadata/impl/metadata","csui/utils/deepClone/deepClone"],function(e,t,i,o,n,a,s,r){function l(){}return e.extend(l.prototype,t.prototype,{"displayForm":function(t,i){var o=!1,s=this._getCommonCategories(i);i.initialFormData&&i.initialFormData.models&&i.initialFormData.models.length>1&&(o=!0),this.metadataAddItems=new n({"container":i.container,"collection":t.nodes,"selected":t.nodes,"action":"create","originatingView":i.originatingView,"context":i.context,"commands":r,"commonCategories":s,"applyFlag":o,"initialFormData":i.initialFormData}),this.listenTo(this.metadataAddItems,"metadata:add",e.bind(function(){this.deferred.resolve()},this));var l={};l.originatingView=i.originatingView,l.view=this.metadataAddItems;var d={};return d.dialogTitle=i.dialogTitle?i.dialogTitle:a.addItemsMetadataDialogTitle,d.OkButtonTitle=i.addButtonTitle?i.addButtonTitle:a.addDocumentMetadataDialogAddButtonTitle,d.OkButtonClick=this._addItems,l.dialogOptions=d,this.baseDisplayForm(l)},"_getCommonCategories":function(t){var i={};return t.initialFormData&&t.initialFormData.models&&e.each(t.initialFormData.models,function(t,o){var n,a,s,r=t.get("data"),l=t.get("role_name");t.get("options"),t.get("schema");if(r&&l&&(n=i.roles||(i.roles={}),a=n[l]||(n[l]={}),"categories"===l)){var d=t.get("id").toString();s=a[d]||(a[d]={}),e.isEmpty(r)?s=null:(r=JSON.parse(JSON.stringify(r).replace(/null/g,'""')),e.extend(s,r))}}),i},"_addItems":function(t){if(t.view.mdv&&t.view.mdv.metadataPropertiesView&&t.view.mdv.metadataPropertiesView.allFormsRendered){if(this.metadataAddItems.validateAndSetValuesToNode()){this.options.view.$el.find(".cs-formfield-invalid").removeClass("cs-formfield-invalid");var i=!0;if(this.metadataAddItems.validateAndSetValuesToAllNode(),this.metadataAddItems.collection.forEach(function(e){i=i&&!!e.validated}),i)this.metadataAddItems.collection.forEach(function(t){var i=t.get("data"),o=t.get("itemObject")||t.get("fileObject"),n=t.get("extended_data");if(i&&o){var a={};o.set("newName",i.name),i.name_multilingual&&(o.set("name_multilingual",i.name_multilingual),o.set("multilingual_provided",!0)),void 0!==i.description&&(a.description=i.description,!!i.description_multilingual&&(a.description_multilingual=i.description_multilingual)),void 0!==i.advanced_versioning&&(a.advanced_versioning=i.advanced_versioning),i.roles&&(a.roles=e.deepClone(i.roles)),!1===e.isEmpty(a)&&e.extend(n,a)}}),this.dialog.destroy(),this.deferred.resolve();else{var o=a.defaultDialogTitle,n=a.missingRequiredMetadataForObjects;s.showError(n,o)}}else this.options.view.$el.find(".binf-has-error .cs-formfield").addClass("cs-formfield-invalid")}}}),e.extend(l,{"version":"1.0"}),l}),csui.define("csui/widgets/metadata/impl/add.items/metadata.add.item.controller",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/models/nodes","csui/models/node/node.model","csui/widgets/metadata/metadata.add.item.controller","csui/widgets/metadata/impl/metadata.utils","csui/widgets/metadata/impl/add.items/metadata.add.multiple.items.controller","i18n!csui/widgets/metadata/impl/nls/lang","csui/utils/deepClone/deepClone"],function(e,t,i,o,n,a,s,r,l){"use strict";function d(){}return e.extend(d.prototype,i.Events,{"addItemsRequiredMetadata":function(i,o){if(!0!==o.openMetadata&&"original"===o.inheritance)return t.Deferred().resolve();var n=t.Deferred(),a=e.find(i,function(e){return void 0===e.get("newVersion")})||i[0],r=i.length>0?i[0].get("name"):"temp_name",l={"action":"create","name":r,"items":i,"container":o.container,"context":o.container.context,"collection":o.collection,"docParentId":i.length>0?a.get("id"):null,"addableType":void 0!=o.addableType?o.addableType:144},d=new s,c=t.grep(i,function(e){return void 0===e.get("newVersion")});return d.ContainerHasEnforcedEmptyRequiredMetadata(l).done(e.bind(function(e){if(!0===e.hasRequiredMetadata){var a=t.Deferred();c&&1===c.length?a=this._addOneItemWithRequiredMetadata(c,o):c&&c.length>1?(e.initialFormData&&(o.initialFormData=e.initialFormData),a=this._addMultipleItemsWithRequiredMetadata(c,o)):i.length?n.resolve():n.reject(),a.done(function(e){n.resolve(e)}).fail(function(e){n.reject(e)})}else n.resolve({})},this)).fail(function(e){n.reject(e)}),n.promise()},"_addOneItemWithRequiredMetadata":function(i,o){var n=t.Deferred(),a=this._makeNodeCollectionFromItems(i,o),s={"nodes":a,"container":o.container,"context":o.context};return o=o||{},e.extend(o,{"callerProcessData":!0,"cancelButtonActionToken":"cancelAddOneItemWithRequiredMetadata","dialogTitle":a.models[0].get("fileObject")?l.addDocumentMetadataDialogTitle:l.addFolderMetadataDialogTitle,"addButtonTitle":l.addItemMetadataDialogButtonUploadTitle}),this.displayForm(s,o).done(function(t){if(o.callerProcessData){var s=a.models[0],r=s.get("itemObject")||s.get("fileObject");if(r.set("newName",t.data.name),r){var l={};r.set("newName",t.data.name),t.data.name_multilingual&&(r.set("name_multilingual",t.data.name_multilingual),r.set("multilingual_provided",!0)),void 0!==t.data.description&&(l.description=t.data.description,!!t.data.description_multilingual&&(l.description_multilingual=t.data.description_multilingual)),void 0!==t.data.advanced_versioning&&(l.advanced_versioning=t.data.advanced_versioning),t.data.roles&&(l.roles=e.deepClone(t.data.roles)),!1===e.isEmpty(l)&&r.set("extended_data",l)}n.resolve(i)}else n.resolve.apply(n,arguments)}).fail(function(){n.reject.apply(n,arguments)}),n.promise()},"_addMultipleItemsWithRequiredMetadata":function(i,o){i=this._makeNodeCollectionFromItems(i,o);for(var n=0,a=0,s=i.length,d={"nodes":i},c=t.Deferred(),u=0;u<s;u++)i.models[u].get("fileObject")?a++:n++;return e.extend(o,{"dialogTitle":a===s?l.addDocumentsMetadataDialogTitle:n===s?l.addFoldersMetadataDialogTitle:l.addItemsMetadataDialogTitle,"addButtonTitle":l.addItemMetadataDialogButtonUploadTitle}),(new r).displayForm(d,o).done(function(e){c.resolve(i)}).fail(function(){c.reject()}),c.promise()},"_makeNodeCollectionFromItems":function(t,i){var a,s=new o;return t&&t.length>0&&e.each(t,function(t){var o=t.get("file");a=o?new n({"name":t.get("newName")||o.name,"type":t.get("type")||144,"size":o.size,"mime_type":o.type,"fileObject":t,"parent_id":i.container.get("id"),"extended_data":t.get("extended_data")},{"connector":i.container.connector}):new n({"container":!0,"name":t.get("newName")||t.get("name"),"type":t.get("type")||t.get("subType"),"type_name":t.get("type_name")||"Folder","itemObject":t,"parent_id":i.container.get("id"),"extended_data":t.get("extended_data"),"enforcedRequiredAttrsForFolders":t.get("enforcedRequiredAttrsForFolders")},{"connector":i.container.connector}),e.extend(a.options,{"enforcedRequiredAttrs":!0}),s.add(a,{"silent":!0})},this),s},"displayForm":function(e,t){return(new a).displayForm(e,t)}}),d.prototype.get=i.Model.prototype.get,e.extend(d,{"version":"1.0"}),d}),csui.define("csui/widgets/metadata/impl/add.items/metadata.add.multiple.docs.controller",["csui/lib/underscore","csui/widgets/metadata/impl/common/base.metadata.action.view","csui/models/node/node.model","csui/controls/dialog/dialog.view","csui/widgets/metadata/impl/common/metadata.action.multiple.items.view","i18n!csui/widgets/metadata/impl/nls/lang","csui/dialogs/modal.alert/modal.alert","csui/utils/commands","css!csui/widgets/metadata/impl/metadata","csui/utils/deepClone/deepClone"],function(e,t,i,o,n,a,s,r){function l(){}return e.extend(l.prototype,t.prototype,{"displayForm":function(t,i){var o=!1,s=this._getCommonCategories(i);i.initialFormData&&i.initialFormData.models&&i.initialFormData.models.length>1&&(o=!0),this.metadataAddItems=new n({"container":i.container,"collection":t.nodes,"selected":t.nodes,"action":"create","originatingView":i.originatingView,"context":i.context,"commands":r,"commonCategories":s,"applyFlag":o,"initialFormData":i.initialFormData}),this.listenTo(this.metadataAddItems,"metadata:add",e.bind(function(){this.deferred.resolve()},this));var l={};l.originatingView=i.originatingView,l.view=this.metadataAddItems;var d={};return d.dialogTitle=i.dialogTitle?i.dialogTitle:a.addDocumentMetadataDialogTitle,d.OkButtonTitle=i.addButtonTitle?i.addButtonTitle:a.addDocumentMetadataDialogAddButtonTitle,d.OkButtonClick=this._addItems,l.dialogOptions=d,this.baseDisplayForm(l)},"_getCommonCategories":function(t){var i={};return t.initialFormData&&t.initialFormData.models&&e.each(t.initialFormData.models,function(t,o){var n,a,s,r=t.get("data"),l=t.get("role_name");t.get("options"),t.get("schema");if(r&&l&&(n=i.roles||(i.roles={}),a=n[l]||(n[l]={}),"categories"===l)){var d=t.get("id").toString();s=a[d]||(a[d]={}),e.isEmpty(r)?s=null:(r=JSON.parse(JSON.stringify(r).replace(/null/g,'""')),e.extend(s,r))}}),i},"_addItems":function(t){if(t.view.mdv&&t.view.mdv.metadataPropertiesView&&t.view.mdv.metadataPropertiesView.allFormsRendered){if(this.metadataAddItems.validateAndSetValuesToNode()){this.options.view.$el.find(".cs-formfield-invalid").removeClass("cs-formfield-invalid");var i=!0;if(this.metadataAddItems.validateAndSetValuesToAllNode(),this.metadataAddItems.collection.forEach(function(e){i=i&&!!e.validated}),i)this.metadataAddItems.collection.forEach(function(t){var i=t.get("data"),o=t.get("fileObject"),n=t.get("extended_data");if(i&&o){o.set("newName",i.name),i.name_multilingual&&(o.set("name_multilingual",i.name_multilingual),o.set("multilingual_provided",!0));var a={};void 0!==i.description&&(a.description=i.description,!!i.description_multilingual&&(a.description_multilingual=i.description_multilingual)),void 0!==i.advanced_versioning&&(a.advanced_versioning=i.advanced_versioning),i.roles&&(a.roles=e.deepClone(i.roles)),!1===e.isEmpty(a)&&e.extend(n,a)}}),this.dialog.destroy(),this.deferred.resolve();else{var o=a.addDocumentMetadataDialogTitle,n=a.missingRequiredMetadataForDocuments;s.showError(n,o)}}else this.options.view.$el.find(".binf-has-error .cs-formfield").addClass("cs-formfield-invalid")}}}),e.extend(l,{"version":"1.0"}),l}),csui.define("csui/widgets/metadata/metadata.add.document.controller",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/models/nodes","csui/models/node/node.model","csui/widgets/metadata/impl/add.items/metadata.add.item.controller","csui/widgets/metadata/impl/metadata.utils","csui/widgets/metadata/impl/add.items/metadata.add.multiple.docs.controller","i18n!csui/widgets/metadata/impl/nls/lang","csui/utils/deepClone/deepClone"],function(e,t,i,o,n,a,s,r,l){"use strict";function d(){}return e.extend(d.prototype,i.Events,{"addItemsRequiredMetadata":function(i,o){if(!0!==o.openMetadata&&"original"===o.inheritance)return t.Deferred().resolve();var n=t.Deferred(),a=i.models,r=e.find(i.models,function(e){return void 0===e.get("newVersion")})||a[0],l=a.length>0?r.get("file").name:"temp_name",d={"action":"create","addableType":o.addableType,"name":l,"container":o.container,"docParentId":a.length>0?r.get("id"):null},c=new s,u=t.grep(i.models,function(e){return void 0===e.get("newVersion")});return c.ContainerHasEnforcedEmptyRequiredMetadata(d).done(e.bind(function(e){if(!0===e.hasRequiredMetadata){var a=t.Deferred();u&&1===u.length?a=this._addOneItemWithRequiredMetadata(u,o):u&&u.length>1?(e.initialFormData&&(o.initialFormData=e.initialFormData),a=this._addMultipleItemsWithRequiredMetadata(u,o)):i.length?n.resolve():n.reject(),a.done(function(e){n.resolve(e)}).fail(function(e){n.reject(e)})}else n.resolve({})},this)).fail(function(e){n.reject(e)}),n.promise()},"_makeNodeCollectionFromItems":function(t,i){var a=new o;return t&&t.length>0&&e.each(t,function(t){var o=t.get("file"),s=new n({"name":t.get("newName")||o.name,"type":t.get("type")||144,"size":o.size,"mime_type":o.type,"fileObject":t,"parent_id":i.container.get("id"),"extended_data":t.get("extended_data")},{"connector":i.container.connector});e.extend(s.options,{"enforcedRequiredAttrs":!0}),a.add(s,{"silent":!0})},this),a},"_addOneItemWithRequiredMetadata":function(i,o){var n=t.Deferred(),s=this._makeNodeCollectionFromItems(i,o),r={"nodes":s,"container":o.container,"context":o.context},d={"callerProcessData":!0,"dialogTitle":l.addDocumentMetadataDialogTitle,"addButtonTitle":l.addDocumentMetadataDialogAddButtonTitle,"cancelButtonActionToken":"cancelAddOneItemWithRequiredMetadata"};return(new a).displayForm(r,d).done(function(t){var o=i[0];o.set("newName",t.data.name),t.data.name_multilingual&&(o.set("name_multilingual",t.data.name_multilingual),o.set("multilingual_provided",!0));var a={};void 0!==t.data.description&&(a.description=t.data.description,!!t.data.description_multilingual&&(a.description_multilingual=t.data.description_multilingual)),void 0!==t.data.advanced_versioning&&(a.advanced_versioning=t.data.advanced_versioning),t.data.roles&&(a.roles=e.deepClone(t.data.roles)),!1===e.isEmpty(a)&&o.set("extended_data",a),n.resolve()}).fail(function(e){var t,i=e&&e.error?e.error:void 0;e&&e.buttonAttributes&&("cancelAddOneItemWithRequiredMetadata"===e.buttonAttributes.actionToken?t="cancelAddOneItemWithRequiredMetadata":"closeMetadataActionView"===e.buttonAttributes.actionToken&&(t="closeMetadataActionView")),n.reject({"error":i,"userAction":t})}),n.promise()},"_addMultipleItemsWithRequiredMetadata":function(e,i){var o=t.Deferred(),n=this._makeNodeCollectionFromItems(e,i),a={"nodes":n};return(new r).displayForm(a,i).done(function(e){o.resolve()}).fail(function(){o.reject()}),o.promise()}}),d.prototype.get=i.Model.prototype.get,e.extend(d,{"version":"1.0"}),d}),csui.define("csui/widgets/metadata/impl/copy.move.items/metadata.copy.move.one.item.controller",["csui/lib/underscore","csui/widgets/metadata/impl/common/base.metadata.action.view","csui/widgets/metadata/impl/metadata.controller","csui/widgets/metadata/metadata.action.one.item.properties.view","csui/utils/commandhelper","i18n!csui/widgets/metadata/impl/nls/lang","csui/dialogs/modal.alert/modal.alert","csui/utils/commands","css!csui/widgets/metadata/impl/metadata"],function(e,t,i,o,n,a,s,r){function l(){}return e.extend(l.prototype,t.prototype,{"displayForm":function(e,t){var i=n.getAtLeastOneNode(e),s=i.length>0?i.models[0]:null;this.node=s;var l=this.metadataAddItemPropView=new o({"model":s,"container":e.container,"originatingView":t.originatingView,"context":t.context,"commands":r,"action":t.action,"inheritance":t.inheritance}),d={};d.callerProcessData=t.callerProcessData,d.originatingView=t.originatingView,d.view=l;var c={};return c.dialogTitle=t.dialogTitle?t.dialogTitle:a.defaultDialogTitle,c.OkButtonTitle=t.okButtonTitle?t.okButtonTitle:a.defaultDialogOkButtonTitle,c.OkButtonClick=this._CopyMoveItem,d.dialogOptions=c,this.baseDisplayForm(d)},"_CopyMoveItem":function(t){if(t.view.metadataPropertiesView&&t.view.metadataPropertiesView.allFormsRendered){if(this.metadataAddItemPropView.validate()){var o=this.metadataAddItemPropView.getValues();if(!0===t.callerProcessData)this.dialog.destroy(),this.deferred.resolve({"data":o});else{(new i).createItem(this.node,o).done(e.bind(function(e){this.dialog.destroy(),this.deferred.resolve({"name":o.name})},this)).fail(function(e){var t=a.failedToCreateItem;e&&(e.responseJSON&&e.responseJSON.error?t=e.responseJSON.error:e.responseText&&(t=e.responseText),s.showError(t))})}}}}}),e.extend(l,{"version":"1.0"}),l}),csui.define("csui/widgets/metadata/impl/copy.move.items/metadata.copy.move.multiple.items.controller",["csui/lib/underscore","csui/utils/base","csui/widgets/metadata/impl/common/base.metadata.action.view","csui/models/node/node.model","csui/controls/dialog/dialog.view","csui/widgets/metadata/impl/common/metadata.action.multiple.items.view","i18n!csui/widgets/metadata/impl/nls/lang","csui/dialogs/modal.alert/modal.alert","css!csui/widgets/metadata/impl/metadata","csui/utils/deepClone/deepClone"],function(e,t,i,o,n,a,s,r){function l(){}return e.extend(l.prototype,i.prototype,{"displayForm":function(t,i){this.metadataAddItems=new a({"container":i.container,"collection":t.nodes,"selected":t.nodes,"originatingView":i.originatingView,"context":i.context,"action":i.action,"inheritance":i.inheritance}),this.listenTo(this.metadataAddItems,"metadata:add",e.bind(function(){this.deferred.resolve()},this));var o={};o.originatingView=i.originatingView,o.view=this.metadataAddItems;var n={};return n.dialogTitle=i.dialogTitle?i.dialogTitle:s.defaultDialogTitle,n.OkButtonTitle=i.okButtonTitle?i.okButtonTitle:s.defaultDialogOkButtonTitle,n.OkButtonClick=this._CopyMoveItems,o.dialogOptions=n,this.baseDisplayForm(o)},"_CopyMoveItems":function(i){if(i.view.mdv&&i.view.mdv.metadataPropertiesView&&i.view.mdv.metadataPropertiesView.allFormsRendered){if(this.metadataAddItems.validateAndSetValuesToNode()){var o=!0;if(this.metadataAddItems.collection.forEach(function(e){var t=!0!==e.options.enforcedRequiredAttrs||!!e.validated;o=o&&t}),o)this.metadataAddItems.collection.forEach(function(i){var o=i.get("data"),n=i.get("itemObject");if(o&&n){if(t.getMetadataLanguageInfo().enabled){var a={"multilingual_provided":!0},s=o.name_multilingual,r=o.description_multilingual;!!s&&(a.name_multilingual=s),!!r&&(a.description_multilingual=r),e.extend(n,a)}n.newName=o.name;var l={};void 0!==o.description&&(l.description=o.description),void 0!==o.advanced_versioning&&(l.advanced_versioning=o.advanced_versioning),o.roles&&(l.roles=e.deepClone(o.roles)),!1===e.isEmpty(l)&&(n.extended_data=l)}}),this.dialog.destroy(),this.deferred.resolve();else{var n=s.defaultDialogTitle,a=s.missingRequiredMetadataForObjects;r.showError(a,n)}}}}}),e.extend(l,{"version":"1.0"}),l}),csui.define("csui/widgets/metadata/metadata.copy.move.items.controller",["csui/lib/underscore","csui/utils/base","csui/lib/jquery","csui/lib/backbone","csui/models/nodes","csui/models/node/node.model","csui/widgets/metadata/impl/metadata.utils","csui/models/actions","csui/widgets/metadata/impl/copy.move.items/metadata.copy.move.one.item.controller","csui/widgets/metadata/impl/copy.move.items/metadata.copy.move.multiple.items.controller","i18n!csui/widgets/metadata/impl/nls/lang","csui/utils/deepClone/deepClone"],function(e,t,i,o,n,a,s,r,l,d,c){function u(){}return e.extend(u.prototype,o.Events,{"CopyMoveItemsWithMetadata":function(t,i){return this.CopyMoveItemsRequiredMetadata(t,e.extend(i,{"openMetadata":!0}))},"_copyMoveItemsWithMetadata":function(e,t){var o=i.Deferred(),n=i.Deferred();return e&&e.length>0&&(t.id||(t.id=e[0].id),t.container||(t.container=t.targetFolder)),e&&1===e.length?n=this._copyMoveOneItemWithRequiredMetadata(e,t):e&&e.length>1?n=this._copyMoveMultipleItemsWithRequiredMetadata(e,t):o.reject(),n.done(function(e){o.resolve()}).fail(function(e){o.reject(e)}),o.promise()},"CopyMoveItemsRequiredMetadata":function(t,o){if(!t||t.length<1)return i.Deferred().reject();if(!0!==o.openMetadata&&"original"===o.inheritance)return i.Deferred().resolve();if(!0!==o.openMetadata&&t.length>1&&"merged"===o.inheritance)return i.Deferred().resolve();var n=i.Deferred(),a={"action":o.action,"inheritance":o.inheritance,"items":t,"container":o.targetFolder,"context":o.context};return(new s).ContainerHasEnforcedEmptyRequiredMetadataOnNodes(a).done(e.bind(function(i){i.requiredMetadata&&i.enforcedItems&&i.enforcedItems.length>0||!0===o.openMetadata?(i.requiredMetadata&&(a=e.extend(a,{"enforcedItems":i.enforcedItems})),this._copyMoveItemsWithMetadata(t,a).done(function(e){n.resolve(e)}).fail(function(e){n.reject(e)})):n.resolve()},this)).fail(function(e){n.reject(e)}),n.promise()},"_makeNodeCollectionFromItems":function(t,i){var o=new n;return t&&t.length>0&&e.each(t,function(t){var n=void 0!==e.find(i.enforcedItems,function(e){return e.id===t.id}),s=new a({"id":t.id,"name":t.newName||t.name,"container":t.container,"mime_type":t.mime_type,"original_id":t.original_id,"type":t.type,"type_name":t.type_name,"action":i.action,"inheritance":i.inheritance,"itemObject":t,"size":t.size,"size_formatted":144===t.type||749===t.type||736===t.type||30309===t.type?t.size_formatted:void 0},{"connector":i.container.connector});140===t.type&&(s.attributes.url=t.url),e.extend(s.options,{"original":t.original,"enforcedRequiredAttrs":n}),s.original=t.original||s.original,s.actions=t.actions||new r,o.add(s,{"silent":!0})},this),o},"_copyMoveOneItemWithRequiredMetadata":function(o,n){var a,s,r=i.Deferred(),d=this._makeNodeCollectionFromItems(o,n),u={"nodes":d,"container":n.container};"copy"===n.action?(a=e.str.sformat(c.copyOneItemMetadataDialogTitle,o.length),s=c.copyItemsMetadataDialogButtonTitle):"move"===n.action?(a=e.str.sformat(c.moveOneItemMetadataDialogTitle,o.length),s=c.moveItemsMetadataDialogButtonTitle):"restructure"===n.action&&(a=e.str.sformat(c.restructureOneItemMetadataDialogTitle,o.length),s=c.restructureItemsMetadataDialogButtonTitle);var m={"callerProcessData":!0,"action":n.action,"context":n.context,"inheritance":n.inheritance,"originatingView":n.originatingView,"dialogTitle":a,"okButtonTitle":s};return(new l).displayForm(u,m).done(function(i){if(o[0].newName=i.data.name,t.getMetadataLanguageInfo().enabled){var n={"multilingual_provided":!0},a=i.data.name_multilingual,s=i.data.description_multilingual;!!a&&(n.name_multilingual=a),!!s&&(n.description_multilingual=s),e.extend(o[0],n)}var l={};void 0!==i.data.description&&(l.description=i.data.description),void 0!==i.data.advanced_versioning&&(l.advanced_versioning=i.data.advanced_versioning),i.data.roles&&(l.roles=e.deepClone(i.data.roles)),!1===e.isEmpty(l)&&(o[0].extended_data=l),r.resolve()}).fail(function(e){r.reject(e)}),r.promise()},"_copyMoveMultipleItemsWithRequiredMetadata":function(t,o){var n,a,s=i.Deferred();"copy"===o.action?(n=e.str.sformat(c.copyMultipleItemsMetadataDialogTitle,t.length),a=c.copyItemsMetadataDialogButtonTitle):"move"===o.action?(n=e.str.sformat(c.moveMultipleItemsMetadataDialogTitle,t.length),a=c.moveItemsMetadataDialogButtonTitle):"restructure"==o.action&&(n=e.str.sformat(c.restructureMultipleItemsMetadataDialogTitle,t.length),a=c.restructureItemsMetadataDialogButtonTitle);var r=this._makeNodeCollectionFromItems(t,o),l={"nodes":r},u={"action":o.action,"inheritance":o.inheritance,"container":o.container,"context":o.context,"originatingView":o.originatingView,"dialogTitle":n,"okButtonTitle":a};return(new d).displayForm(l,u).done(function(e){s.resolve()}).fail(function(e){s.reject(e)}),s.promise()}}),u.prototype.get=o.Model.prototype.get,e.extend(u,{"version":"1.0"}),u}),csui.define("hbs!csui/widgets/metadata/impl/metadatanavigation/impl/metadatanavigation",["module","hbs","nuc/lib/handlebars"],function(e,t,i){var o=i.template({"compiler":[8,">= 4.3.0"],"main":function(e,t,i,o,n){var a,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="metadata-wrapper binf-col-md-12">\r\n  <div class="metadata-navigation">\r\n    <div class="metadata-sidebar" role="navigation" aria-label="'+e.escapeExpression((a=null!=(a=s(i,"sidebarRegionAria")||(null!=t?s(t,"sidebarRegionAria"):t))?a:e.hooks.helperMissing,"function"==typeof a?a.call(null!=t?t:e.nullContext||{},{"name":"sidebarRegionAria","hash":{},"loc":{"start":{"line":3,"column":64},"end":{"line":3,"column":85}}}):a))+'"></div>\r\n    <div class="metadata-content"></div>\r\n    <div class="metadata-doc-preview binf-hidden"></div>\r\n  </div>\r\n</div>\r\n'}});return i.registerPartial("csui_widgets_metadata_impl_metadatanavigation_impl_metadatanavigation",o),o}),csui.define("csui/widgets/metadata/impl/metadatanavigation/impl/nls/lang",{"root":!0,"en-us":!1,"en":!1}),csui.define("csui/widgets/metadata/impl/metadatanavigation/impl/nls/root/lang",{"versionsTitle":"Versions","listAria":"Browse items","sidebarRegionAria":"Metadata item selection"}),csui.define("css!csui/widgets/metadata/impl/metadatanavigation/impl/metadatanavigation",[],function(){}),csui.define("csui/widgets/metadata/impl/metadatanavigation/metadatanavigation.view",["csui/lib/underscore","csui/lib/backbone","csui/lib/marionette","csui/lib/jquery","csui/behaviors/keyboard.navigation/tabable.region.behavior","csui/widgets/metadata/impl/metadata.navigation.list.behavior","csui/widgets/metadata/impl/metadata.navigation.list.view","csui/widgets/metadata/metadata.view","csui/controls/progressblocker/blocker","hbs!csui/widgets/metadata/impl/metadatanavigation/impl/metadatanavigation","csui/controls/mixins/layoutview.events.propagation/layoutview.events.propagation.mixin","csui/utils/contexts/factories/metadata.factory","csui/controls/mixins/view.state/metadata.view.state.mixin","csui/utils/contexts/factories/next.node","csui/models/nodeversions","i18n!csui/widgets/metadata/impl/metadatanavigation/impl/nls/lang","css!csui/widgets/metadata/impl/metadatanavigation/impl/metadatanavigation"],function(e,t,i,o,n,a,s,r,l,d,c,u,m,h,p,g){"use strict";var f=i.LayoutView.extend({"className":"cs-metadata","template":d,"regions":{"navigationRegion":".metadata-sidebar","contentRegion":".metadata-content","docPreviewRegion":".metadata-doc-preview"},"behaviors":{"TabableRegionBehavior":{"behaviorClass":n,"initialActivationWeight":100},"MetadataNavigationListBehavior":{"behaviorClass":a}},"constructor":function(t){t||(t={}),l.imbue(this),i.LayoutView.prototype.constructor.apply(this,arguments),this.enableViewState=!0,!1===t.enableViewState&&(this.enableViewState=!1),this.context=t.context,this._isViewStateModelEnabled()&&this._addUrlParametersSupport(t.context),this.collection=t.collection,this.container=t.container,this.containerCollection=t.containerCollection,this.originatingView=t.originatingView,this.showCloseIcon=t.showCloseIcon,this.initiallySelected=this.options.selected,this.selectedTab=t.selectedTab||this.getViewStateDropdown(),this.selectedProperty=t.selectedProperty||this.getViewStateSelectedProperty(),this.isThumbnailView=t.isThumbnailView||this.getThumbnailViewState(),this.showPermissionView=t.showPermissionView||this.isShowPermissionView(),this.thumbnailViewState=t.originatingView&&t.originatingView.thumbnailViewState,this.collection.inMetadataNavigationView=t.originatingView&&t.originatingView.isTabularView,this.largeFileSettingsModel=t.largeFileSettingsModel,!this.options.toolbarItems&&this.originatingView&&this.originatingView.options&&this.originatingView.options.toolbarItems&&(this.options.toolbarItems=this.originatingView.options.toolbarItems);var o=this._getInitiallySelectedModel();this.mdv=this.options.data&&this.options.data.contentView?this.options.data.contentView:new r({"model":o,"container":this.container,"containerCollection":this.containerCollection,"collection":this.collection,"context":this.context,"originatingView":this,"metadataNavigationView":this,"isExpandedView":!!this.options.isExpandedView,"showCloseIcon":void 0!==this.showCloseIcon&&this.showCloseIcon,"selectedTab":this.selectedTab,"selectedProperty":this.selectedProperty,"showPermissionView":this.showPermissionView,"enableViewState":this.enableViewState}),this.options.data&&this.options.data.contentView||(this.mdv.internal=!0),this._subscribeToMetadataViewEvents(o);var n,a=this.context&&this.context.viewStateModel;if(n=this._isViewStateModelEnabled()?a.hasRouted()||a.get("lastRouter"):!(!this.originatingView&&!this.containerCollection),this.mdn=new s({"collection":t.collection,"containerCollection":this.containerCollection,"data":{"back_button":n,"title":this._getBackButtonTitle(t),"nameAttribute":t.nameAttribute,"listAria":g.listAria,"listRole":"menu","childRole":"menuitem"},"originatingView":t.originatingView,"isThumbnailView":this.isThumbnailView}),this.listenTo(this.mdn,"click:item",this.onClickItem),this.listenTo(this.mdn,"click:back",this.onClickBack),this.listenTo(this.mdn,"show:node",function(e){this._showNode(e.model)}),this.listenTo(this.mdv,"disable:active:item",function(e){this.mdn.$el.find(".binf-active").addClass("active-item-disable")}).listenTo(this.mdv,"enable:active:item",function(){this.mdn.$el.find(".active-item-disable").removeClass("active-item-disable")}),!this.options.originatingView||e.isFunction(this.options.originatingView.cascadeDestroy)&&!this.options.originatingView.cascadeDestroy()||this.listenTo(this.options.originatingView,"before:destroy",function(){this._closeMetadata()}),this.propagateEventsToRegions(),this._isViewStateModelEnabled()){var d=this.context.getModel(u);this.listenTo(d,"change:metadata_info",function(){this.onMetadataInfoChanged()});var c=a&&a._currentHistoryEntry;c?c&&"Metadata"==c.router&&(this.goBacktoFragmentIndex=a._navigationHistory.length):(c=a.getLastHistoryEntry())&&"Metadata"==c.router&&(this.goBacktoFragmentIndex=a._navigationHistory.length-1)}},"templateHelpers":function(){return{"sidebarRegionAria":g.sidebarRegionAria}},"_getBackButtonTitle":function(e){var t=e.container?e.container.get("name"):"";if(!t&&e.collection.length>0&&e.collection.models[0].collection.title&&(t=e.collection.models[0].collection.title),e.collection&&e.collection instanceof p&&(t=g.versionsTitle),!t){var i=e.context&&e.context.viewStateModel;t=i&&i.getBackToTitle()}return t},"_isViewStateModelEnabled":function(){var e=this.context&&this.context.viewStateModel;return this.enableViewState&&e&&e.get("enabled")},"_getInitiallySelectedModel":function(){if(this.initiallySelected instanceof t.Model){
if(this.showPermissionView&&this.initiallySelected.actions&&this.initiallySelected.actions.get("permissions"))return this.initiallySelected;var e=this.collection.findIndex({"id":this.initiallySelected.get("id")});return e<0||e>this.collection.length-1?null:this.collection.at(e)}return this.initiallySelected&&this.initiallySelected.length>0?this.initiallySelected.models[0]:this.collection&&this.collection.length>0?this.collection.models[0]:null},"onRender":function(){if(!this.showPermissionView){var e;e=this.mdv&&this.mdv.model?this.mdv.model:this._getInitiallySelectedModel(),e&&this._showNode(e)}},"onClickItem":function(e){this._isViewStateModelEnabled()&&this.getViewStateId()!==e.model.get("id")?this.setViewStateId(e.model.get("id"),{"model":e.model}):this._showNode(e.model)},"onClickBack":function(){this._closeMetadata()},"onItemNameChanged":function(e){var t=this.mdn.getSelectedItem(),i=this.mdn.getSelectedIndex();t.render(),this.mdn.setSelectedIndex(i)},"_moveToNextItemAfterDeleteOrMove":function(){if(0===this.mdn.collection.length)this._closeMetadata();else{var e=this.currentIndex;e===this.mdn.collection.length&&e--,this.currentIndex=-1,this.mdn.selectAt(e)}},"_currentIndex":function(){this.currentIndex=this.mdn.getSelectedIndex()},"_onItemDeleted":function(){this._moveToNextItemAfterDeleteOrMove()},"_onItemMoved":function(e){this.mdn.collection.remove(e),this._moveToNextItemAfterDeleteOrMove()},"_showNode":function(e){var t=this._isViewStateModelEnabled()&&this.getViewStateDropdown()||(this.mdv.metadataTabView&&this.mdv.metadataTabView.tabLinks?this.mdv.metadataTabView.tabLinks.selected:this.mdv&&this.mdv.options&&this.mdv.options.selectedTab?this.mdv.options.selectedTab:""),i=this.mdv.metadataTabView&&this.mdv.metadataTabView.options.activeTab?this.mdv.metadataTabView&&this.mdv.metadataTabView.options.activeTab:this.mdv.options&&this.mdv.options.activeTab?this.mdv.options.activeTab:"";this.mdv&&this.mdv.internal&&this.mdv.destroy(),this.mdv=new r({"model":e,"container":this.container,"containerCollection":this.containerCollection,"collection":this.collection,"context":this.context,"originatingView":this,"metadataNavigationView":this,"showCloseIcon":void 0!==this.showCloseIcon&&this.showCloseIcon,"showBackIcon":!1,"activeTab":i,"selectedTab":t,"showPermissionView":this.showPermissionView,"enableViewState":this.enableViewState,"selectedProperty":this.selectedProperty}),this.mdv.internal=!0,this.selectedProperty=void 0,this._subscribeToMetadataViewEvents(e),this.contentRegion.show(this.mdv)},"_modelIdChanged":function(){var e=this.model.get("id");e&&this.setSelectedElementByModelId(e)},"onMetadataInfoChanged":function(){var e=this.context.getModel(u),t=e.get("metadata_info");t&&(this.showPermissionView=t.showPermissionView,this.setSelectedElementByModelId(t.id))},"setSelectedElementByModelId":function(e){var t=this.getItemByModelId(e);t&&(this.mdn.setSelectedElement(t),this._showNode(t.model))},"getItemByModelId":function(e){var t;return this.mdn.children.some(function(i){if(i.model.get("id")===e)return t=i,!0}),t},"onMetadataClose":function(){this._closeMetadata()},"onDestroy":function(){this.thumbnailViewState&&this.originatingView.thumbnail&&this.originatingView.thumbnail.resultsView.triggerMethod("metadata:close")},"_closeMetadata":function(){this.trigger("metadata:close",{"sender":this});var e=this.context.viewStateModel,t=e&&e.get(e.CONSTANTS.CURRENT_ROUTER);if(!this.originatingView)if(t&&"Metadata"===t||this._isViewStateModelEnabled()&&!this.showPermissionView)void 0!==this.goBacktoFragmentIndex?this.context.viewStateModel._restoreHistoryEntryByIndex(this.goBacktoFragmentIndex):this.context.viewStateModel.restoreLastRouter();else{var i=this._getCommonContainerId();i&&this._setNextNodeModelFactory(i)}},"_getCommonContainerId":function(){var e;return this.containerCollection&&(this.containerCollection.node?e=this.containerCollection.node.get("id"):this.containerCollection.models.length>0&&(e=this.containerCollection.models[0].get("parent_id"),this.containerCollection.models.some(function(t){if(t.get("parent_id")!==e)return e=void 0,!0}))),e},"_setNextNodeModelFactory":function(e){if(this.context&&void 0!==e){var t=this.context.getModel(h);t&&(t.get("id")===e&&t.unset("id",{"silent":!0}),t.set("id",e))}},"_subscribeToMetadataViewEvents":function(t){this.listenTo(this.mdv,"metadata:close",e.bind(function(){this._closeMetadata()},this)),this.listenTo(this.mdv,"metadata:close:without:animation",e.bind(function(){this.trigger("metadata:close:without:animation",{"sender":this})},this)),this.listenTo(this.mdv,"item:name:changed",e.bind(this.onItemNameChanged,this)),this.listenTo(t,"before:delete before:move",this._currentIndex),this.listenTo(t,"delete",this._onItemDeleted),this.listenTo(t,"move",this._onItemMoved)},"_addUrlParametersSupport":function(e){var t=e&&e.viewStateModel;t&&t.addUrlParameters(["dropdown"],e)}});return e.extend(f.prototype,c),e.extend(f.prototype,m),f}),csui.define("csui/widgets/metadata.navigation/impl/nls/lang",{"root":!0,"en-us":!1,"en":!1}),csui.define("csui/widgets/metadata.navigation/impl/nls/root/lang",{"FetchNodeFailTitle":"Error","FetchNodeFailMessage":'Failed to fetch node "{0}". \n\n{1}',"MetadataNavWrapperAria":"Metadata with navigation"}),csui.define("css!csui/widgets/metadata.navigation/impl/metadata.navigation",[],function(){}),csui.define("csui/widgets/metadata.navigation/metadata.navigation.view",["module","csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/lib/marionette","csui/utils/base","csui/controls/progressblocker/blocker","csui/utils/contexts/factories/node","csui/utils/contexts/factories/children","csui/utils/contexts/factories/children2","csui/widgets/nodestable/nodestable.view","csui/controls/mixins/view.events.propagation/view.events.propagation.mixin","csui/widgets/metadata/impl/metadatanavigation/metadatanavigation.view","csui/utils/contexts/factories/largefilesettings.factory","csui/dialogs/modal.alert/modal.alert","csui/utils/contexts/factories/metadata.factory","csui/utils/contexts/perspective/plugins/node/node.extra.data","csui/behaviors/default.action/impl/defaultaction","i18n!csui/widgets/metadata.navigation/impl/nls/lang","css!csui/widgets/metadata.navigation/impl/metadata.navigation"],function(e,t,i,o,n,a,s,r,l,d,c,u,m,h,p,g,f,w,b){"use strict";var v=e.config();c.useV2RestApi&&(l=d);var y=n.ItemView.extend({"className":"cs-metadata-navigation-wrapper","template":!1,"constructor":function(e){e=t.defaults(e,v),e.data||(e.data={}),e.showCloseIcon=!1,this.options=e,this.options.originatingView&&this.options.originatingView.supportOriginatingView&&(this.options.baseOriginatingView=this.options.originatingView,this.options.originatingView=this),this.context=this.options.context,n.ItemView.prototype.constructor.call(this,e),this.largeFileSettingsFactory=this.context.getFactory(h),this.options.largeFileSettingsModel=this.largeFileSettingsFactory&&this.largeFileSettingsFactory.property,s.imbue(this)},"onRender":function(){var e=this._ensureCompleteData();if(e)return e.done(t.bind(this.render,this));this.metadataNavigationView&&this.metadataNavigationView.destroy();var i=this.metadataNavigationView=new m(this.options);this.propagateEventsToViews(this.metadataNavigationView),this.metadataNavigationView.render(),n.triggerMethodOn(i,"before:show",i,this),this.$el.append(i.el),this.$el.attr({"role":"region","aria-label":b.MetadataNavWrapperAria}),n.triggerMethodOn(i,"show",i,this)},"onBeforeDestroy":function(){this.metadataNavigationView&&(this.cancelEventsToViewsPropagation(this.metadataNavigationView),this.metadataNavigationView.destroy())},"_modelIdChanged":function(){var e=this.options.context.getModel(g),t=e.get("metadata_info");t&&this.contextCollection!==t.collection&&(this.deleteData(),this.render())},"deleteData":function(){delete this.options.selected,delete this.options.collection,delete this.options.containerCollection},"_ensureCompleteData":function(){var e=this.options;if(!(e.model&&e.collection&&e.containerCollection))return this._loadingDataByMetadata()},"_loadingDataByMetadata":function(){function e(){o._loadCollection().always(function(){o.unblockActions()}).done(function(e){t&&t.resolve(e)}).fail(function(e){t&&t.reject(e)})}var t,o=this,n=this.options;if(n.model&&(n.collection||n.containerCollection)||(t=i.Deferred()),n.model)n.collection&&n.containerCollection||(n.selected=n.model,o.blockActions(),e());else{var a=n.data.id&&{"id":n.data.id};if(!a){var s=n.context.getModel(g);s&&(a=s.get("metadata_info").id)}var l=new w;n.model=n.context.getModel(r,{"attributes":a&&{"id":a},"temporary":!0,"options":{"defaultActionCommands":l.actionItems.getAllCommandSignatures(l.commands),"delayRestCommands":!1}}),n.selected=n.model,o.blockActions(),e()}return t&&t.promise()},"_loadCollection":function(){function e(){c.findWhere({"id":d.model.get("id")})||c.add(d.model,{"at":0,"silent":!0})}function t(e){var t=d.context.getModel(g);if(t){t.get("metadata_info").collection=e}}function n(){d.collection||(d.collection=c),d.containerCollection||(d.containerCollection=c)}var a=this,s=i.Deferred(),d=this.options,c=d.collection||d.containerCollection;if(!c){var u=d.context.getModel(g);if(u){var m=u.get("metadata_info");if(this.contextCollection=m&&m.collection,this.contextCollection&&this.contextCollection.length>0)return c=this.contextCollection.clone(),e(),t(c),n(),delete d.context.viewStateModel.get("state").collection,s.resolve().promise()}}return c?s.resolve().promise():(d.model.ensureFetched().done(function(i){if(-1===d.model.get("parent_id"))return c=new o.Collection,e(),t(c),n(),void s.resolve();var u=new w;d.container=d.context.getModel(r,{"attributes":{"id":d.model.get("parent_id")},"temporary":!0,"options":{"defaultActionCommands":u.actionItems.getAllCommandSignatures(u.commands),"delayRestCommands":!0}}),d.container.ensureFetched().done(function(i){c=d.context.getCollection(l,{"options":{"node":d.container,"defaultActionCommands":u.actionItems.getAllCommandSignatures(u.commands),"delayRestCommands":!0}}),c.setFields&&c.setFields(f.getModelFields()),c.setExpand&&c.setExpand(f.getModelExpand()),c.ensureFetched().done(function(i){e(),t(c),n(),s.resolve(i)}).fail(function(e){a._showFetchNodeFailMessage(e,d.container.get("id")),s.reject(e)})}).fail(function(e){a._showFetchNodeFailMessage(e,d.container.get("id")),s.reject(e)})}).fail(function(e){a.unblockActions(),a._showFetchNodeFailMessage(e,d.model.get("id")),s&&s.reject(e)}),s.promise())},"_showFetchNodeFailMessage":function(e,i){var o=new a.Error(e),n=b.FetchNodeFailTitle,s=t.str.sformat(b.FetchNodeFailMessage,i,o.message);p.showError(s,n)}});return t.extend(y.prototype,u),y}),csui.define("csui/widgets/metadata/metadata.save.query.controller",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/models/nodes","csui/models/node/node.model","csui/widgets/metadata/impl/metadata.utils","csui/utils/commands/add.item.metadata","i18n!csui/utils/commands/nls/localized.strings"],function(e,t,i,o,n,a,s,r){"use strict";function l(){}return e.extend(l.prototype,i.Events,{"_checkForRequiredMetadata":function(i,l){var d=l.context,c=i.get("parent_id"),u=t.Deferred(),m={"name":i.get("name"),"docParentId":i.get("parent_id"),"addableType":i.get("type"),"action":"create","container":new n({"id":c},{"connector":l.connector})};return(new a).ContainerHasEnforcedEmptyRequiredMetadata(m).done(e.bind(function(e){if(!0===e.hasRequiredMetadata){var t=new o;t.push(i);var a={"nodes":t,"container":new n({"id":c},{"connector":l.connector})},m={"context":d,"addableType":i.get("type"),"callerProcessData":!0,"addButtonTitle":r.saveButtonLabel,"dialogTitle":r.DialogTitleSaveQuery};(new s).execute(a,m).then(function(e){u.resolve(e)}).fail(function(e){u.reject()})}else u.resolve()})).fail(function(){u.reject()}),u.promise()}}),l.prototype.get=i.Model.prototype.get,e.extend(l,{"version":"1.0"}),l}),csui.define("json!csui/widgets/metadata/metadata.manifest.json",{"$schema":"http://opentext.com/cs/json-schema/draft-04/schema#","title":"{{widgetTitle}}","description":"{{widgetDescription}}","kind":"fullpage","schema":{"type":"object","properties":{"id":{"title":"{{idTitle}}","description":"{{idDescription}}","type":"integer"},"initialPanel":{"title":"{{initialPanelTitle}}","description":"{{initialPanelDescription}}","type":"string"}},"required":["id"]},"options":{"fields":{"id":{"type":"otcs_node_picker","type_control":{"parameters":{"select_types":[]}}}}},"actions":[{"toolItems":"csui/widgets/metadata/header.dropdown.menu.items","toolItemMasks":"csui/widgets/metadata/header.dropdown.menu.items.mask","toolbars":[{"id":"dropdownMenuList","title":"{{dropdownMenuTitle}}","description":"{{dropdownMenuDescription}}"}]},{"toolItems":"csui/widgets/metadata/add.properties.menuitems","toolItemMasks":"csui/widgets/metadata/add.properties.menuitems.mask","toolbars":[{"id":"addPropertiesToolbar","title":"{{addPropertiesTitle}}","description":"{{addPropertiesDescription}}"}]}]}),csui.define("json!csui/widgets/metadata.navigation/metadata.navigation.manifest.json",{"$schema":"http://opentext.com/cs/json-schema/draft-04/schema#","title":"{{widgetTitle}}","description":"{{widgetDescription}}","kind":"fullpage","schema":{"type":"object","properties":{"id":{"title":"{{idTitle}}","description":"{{idDescription}}","type":"integer"},"initialPanel":{"title":"{{initialPanelTitle}}","description":"{{initialPanelDescription}}","type":"string"}},"required":["id"]},"options":{"fields":{"id":{"type":"otcs_node_picker","type_control":{"parameters":{"select_types":[]}}}}}}),csui.define("csui/widgets/metadata/impl/nls/metadata.manifest",{"root":!0,"en-us":!1,"en":!1}),csui.define("csui/widgets/metadata/impl/nls/root/metadata.manifest",{"widgetTitle":"Object Information","widgetDescription":"Shows information about an object and offers the most important actions for it.","idTitle":"Object","idDescription":"An object to show the information for","initialPanelTitle":"Object information","initialPanelDescription":"An object to show the information for","dropdownMenuTitle":"Object Context Menu","dropdownMenuDescription":"Context menu, which is displayed when clicking on the arrow on the right side of the name of the opened object.","addPropertiesTitle":"Add Feature Menu","addPropertiesDescription":"Drop-down menu, which is displayed when clicking on the plus on the right side of the property tabs."}),csui.define("csui/widgets/metadata.navigation/impl/nls/metadata.navigation.manifest",{"root":!0,"en-us":!1,"en":!1}),csui.define("csui/widgets/metadata.navigation/impl/nls/root/metadata.navigation.manifest",{"widgetTitle":"Object Information","widgetDescription":"Shows information about an object and offers the most important actions for it.","idTitle":"Object","idDescription":"An object to show the information for","initialPanelTitle":"Object information","initialPanelDescription":"An object to show the information for"}),csui.define("bundles/csui-metadata",["csui/controls/tableheader/comment/comment.button.view","csui/widgets/metadata/versions.toolbaritems","csui/widgets/metadata/impl/metadata.tabcontentcollection.view","csui/widgets/metadata/impl/header/rightbar/toolbaritems","csui/widgets/metadata/impl/header/rightbar/toolbaritems.masks","csui/utils/versions.default.action.items","csui/widgets/metadata/metadata.view","csui/widgets/metadata/metadata.properties.view","csui/widgets/metadata/metadata.action.one.item.properties.view","csui/widgets/metadata/metadata.add.categories.controller","csui/widgets/metadata/metadata.add.document.controller","csui/widgets/metadata/impl/add.items/metadata.add.item.controller","csui/widgets/metadata/metadata.add.item.controller","csui/widgets/metadata/metadata.copy.move.items.controller","csui/widgets/metadata/property.panels/general/metadata.general.property.controller","csui/widgets/metadata/impl/metadatanavigation/metadatanavigation.view","csui/widgets/metadata.navigation/metadata.navigation.view","csui/widgets/metadata/impl/add.items/metadata.add.multiple.items.controller","csui/widgets/metadata/impl/header/item.name/metadata.item.name.view","csui/widgets/metadata/metadata.save.query.controller","json!csui/widgets/metadata/metadata.manifest.json","json!csui/widgets/metadata.navigation/metadata.navigation.manifest.json","i18n!csui/widgets/metadata/impl/nls/metadata.manifest","i18n!csui/widgets/metadata.navigation/impl/nls/metadata.navigation.manifest","csui/widgets/metadata/add.properties.menuitems","csui/widgets/metadata/add.properties.menuitems.mask","csui/widgets/metadata/header.dropdown.menu.items","csui/widgets/metadata/header.dropdown.menu.items.mask","csui/widgets/metadata/versions.toolbaritems.mask","csui/widgets/metadata/metadata.general.action.fields","csui/widgets/metadata/metadata.versions.view","csui/widgets/metadata/metadata.audit.view"],{}),csui.require(["require","css"],function(e,t){t.styleLoad(e,"csui/bundles/csui-metadata",!0)});
//# sourceMappingURL=csui-metadata.js.map